(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))s(u);new MutationObserver(u=>{for(const h of u)if(h.type==="childList")for(const p of h.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&s(p)}).observe(document,{childList:!0,subtree:!0});function l(u){const h={};return u.integrity&&(h.integrity=u.integrity),u.referrerPolicy&&(h.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?h.credentials="include":u.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(u){if(u.ep)return;u.ep=!0;const h=l(u);fetch(u.href,h)}})();var fc={exports:{}},vl={};var Lp;function y0(){if(Lp)return vl;Lp=1;var m=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function l(s,u,h){var p=null;if(h!==void 0&&(p=""+h),u.key!==void 0&&(p=""+u.key),"key"in u){h={};for(var f in u)f!=="key"&&(h[f]=u[f])}else h=u;return u=h.ref,{$$typeof:m,type:s,key:p,ref:u!==void 0?u:null,props:h}}return vl.Fragment=a,vl.jsx=l,vl.jsxs=l,vl}var wp;function S0(){return wp||(wp=1,fc.exports=y0()),fc.exports}var o=S0(),vc={exports:{}},ye={};var qp;function M0(){if(qp)return ye;qp=1;var m=Symbol.for("react.transitional.element"),a=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),h=Symbol.for("react.consumer"),p=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),S=Symbol.for("react.activity"),y=Symbol.iterator;function j(E){return E===null||typeof E!="object"?null:(E=y&&E[y]||E["@@iterator"],typeof E=="function"?E:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},B=Object.assign,G={};function Z(E,U,se){this.props=E,this.context=U,this.refs=G,this.updater=se||C}Z.prototype.isReactComponent={},Z.prototype.setState=function(E,U){if(typeof E!="object"&&typeof E!="function"&&E!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,E,U,"setState")},Z.prototype.forceUpdate=function(E){this.updater.enqueueForceUpdate(this,E,"forceUpdate")};function W(){}W.prototype=Z.prototype;function I(E,U,se){this.props=E,this.context=U,this.refs=G,this.updater=se||C}var Y=I.prototype=new W;Y.constructor=I,B(Y,Z.prototype),Y.isPureReactComponent=!0;var te=Array.isArray;function O(){}var w={H:null,A:null,T:null,S:null},L=Object.prototype.hasOwnProperty;function ne(E,U,se){var k=se.ref;return{$$typeof:m,type:E,key:U,ref:k!==void 0?k:null,props:se}}function Me(E,U){return ne(E.type,U,E.props)}function Be(E){return typeof E=="object"&&E!==null&&E.$$typeof===m}function qe(E){var U={"=":"=0",":":"=2"};return"$"+E.replace(/[=:]/g,function(se){return U[se]})}var P=/\/+/g;function ee(E,U){return typeof E=="object"&&E!==null&&E.key!=null?qe(""+E.key):U.toString(36)}function ge(E){switch(E.status){case"fulfilled":return E.value;case"rejected":throw E.reason;default:switch(typeof E.status=="string"?E.then(O,O):(E.status="pending",E.then(function(U){E.status==="pending"&&(E.status="fulfilled",E.value=U)},function(U){E.status==="pending"&&(E.status="rejected",E.reason=U)})),E.status){case"fulfilled":return E.value;case"rejected":throw E.reason}}throw E}function F(E,U,se,k,_){var ae=typeof E;(ae==="undefined"||ae==="boolean")&&(E=null);var ce=!1;if(E===null)ce=!0;else switch(ae){case"bigint":case"string":case"number":ce=!0;break;case"object":switch(E.$$typeof){case m:case a:ce=!0;break;case M:return ce=E._init,F(ce(E._payload),U,se,k,_)}}if(ce)return _=_(E),ce=k===""?"."+ee(E,0):k,te(_)?(se="",ce!=null&&(se=ce.replace(P,"$&/")+"/"),F(_,U,se,"",function(Rt){return Rt})):_!=null&&(Be(_)&&(_=Me(_,se+(_.key==null||E&&E.key===_.key?"":(""+_.key).replace(P,"$&/")+"/")+ce)),U.push(_)),1;ce=0;var ue=k===""?".":k+":";if(te(E))for(var Te=0;Te<E.length;Te++)k=E[Te],ae=ue+ee(k,Te),ce+=F(k,U,se,ae,_);else if(Te=j(E),typeof Te=="function")for(E=Te.call(E),Te=0;!(k=E.next()).done;)k=k.value,ae=ue+ee(k,Te++),ce+=F(k,U,se,ae,_);else if(ae==="object"){if(typeof E.then=="function")return F(ge(E),U,se,k,_);throw U=String(E),Error("Objects are not valid as a React child (found: "+(U==="[object Object]"?"object with keys {"+Object.keys(E).join(", ")+"}":U)+"). If you meant to render a collection of children, use an array instead.")}return ce}function $(E,U,se){if(E==null)return E;var k=[],_=0;return F(E,k,"","",function(ae){return U.call(se,ae,_++)}),k}function le(E){if(E._status===-1){var U=E._result;U=U(),U.then(function(se){(E._status===0||E._status===-1)&&(E._status=1,E._result=se)},function(se){(E._status===0||E._status===-1)&&(E._status=2,E._result=se)}),E._status===-1&&(E._status=0,E._result=U)}if(E._status===1)return E._result.default;throw E._result}var me=typeof reportError=="function"?reportError:function(E){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var U=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof E=="object"&&E!==null&&typeof E.message=="string"?String(E.message):String(E),error:E});if(!window.dispatchEvent(U))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",E);return}console.error(E)},fe={map:$,forEach:function(E,U,se){$(E,function(){U.apply(this,arguments)},se)},count:function(E){var U=0;return $(E,function(){U++}),U},toArray:function(E){return $(E,function(U){return U})||[]},only:function(E){if(!Be(E))throw Error("React.Children.only expected to receive a single React element child.");return E}};return ye.Activity=S,ye.Children=fe,ye.Component=Z,ye.Fragment=l,ye.Profiler=u,ye.PureComponent=I,ye.StrictMode=s,ye.Suspense=g,ye.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,ye.__COMPILER_RUNTIME={__proto__:null,c:function(E){return w.H.useMemoCache(E)}},ye.cache=function(E){return function(){return E.apply(null,arguments)}},ye.cacheSignal=function(){return null},ye.cloneElement=function(E,U,se){if(E==null)throw Error("The argument must be a React element, but you passed "+E+".");var k=B({},E.props),_=E.key;if(U!=null)for(ae in U.key!==void 0&&(_=""+U.key),U)!L.call(U,ae)||ae==="key"||ae==="__self"||ae==="__source"||ae==="ref"&&U.ref===void 0||(k[ae]=U[ae]);var ae=arguments.length-2;if(ae===1)k.children=se;else if(1<ae){for(var ce=Array(ae),ue=0;ue<ae;ue++)ce[ue]=arguments[ue+2];k.children=ce}return ne(E.type,_,k)},ye.createContext=function(E){return E={$$typeof:p,_currentValue:E,_currentValue2:E,_threadCount:0,Provider:null,Consumer:null},E.Provider=E,E.Consumer={$$typeof:h,_context:E},E},ye.createElement=function(E,U,se){var k,_={},ae=null;if(U!=null)for(k in U.key!==void 0&&(ae=""+U.key),U)L.call(U,k)&&k!=="key"&&k!=="__self"&&k!=="__source"&&(_[k]=U[k]);var ce=arguments.length-2;if(ce===1)_.children=se;else if(1<ce){for(var ue=Array(ce),Te=0;Te<ce;Te++)ue[Te]=arguments[Te+2];_.children=ue}if(E&&E.defaultProps)for(k in ce=E.defaultProps,ce)_[k]===void 0&&(_[k]=ce[k]);return ne(E,ae,_)},ye.createRef=function(){return{current:null}},ye.forwardRef=function(E){return{$$typeof:f,render:E}},ye.isValidElement=Be,ye.lazy=function(E){return{$$typeof:M,_payload:{_status:-1,_result:E},_init:le}},ye.memo=function(E,U){return{$$typeof:b,type:E,compare:U===void 0?null:U}},ye.startTransition=function(E){var U=w.T,se={};w.T=se;try{var k=E(),_=w.S;_!==null&&_(se,k),typeof k=="object"&&k!==null&&typeof k.then=="function"&&k.then(O,me)}catch(ae){me(ae)}finally{U!==null&&se.types!==null&&(U.types=se.types),w.T=U}},ye.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},ye.use=function(E){return w.H.use(E)},ye.useActionState=function(E,U,se){return w.H.useActionState(E,U,se)},ye.useCallback=function(E,U){return w.H.useCallback(E,U)},ye.useContext=function(E){return w.H.useContext(E)},ye.useDebugValue=function(){},ye.useDeferredValue=function(E,U){return w.H.useDeferredValue(E,U)},ye.useEffect=function(E,U){return w.H.useEffect(E,U)},ye.useEffectEvent=function(E){return w.H.useEffectEvent(E)},ye.useId=function(){return w.H.useId()},ye.useImperativeHandle=function(E,U,se){return w.H.useImperativeHandle(E,U,se)},ye.useInsertionEffect=function(E,U){return w.H.useInsertionEffect(E,U)},ye.useLayoutEffect=function(E,U){return w.H.useLayoutEffect(E,U)},ye.useMemo=function(E,U){return w.H.useMemo(E,U)},ye.useOptimistic=function(E,U){return w.H.useOptimistic(E,U)},ye.useReducer=function(E,U,se){return w.H.useReducer(E,U,se)},ye.useRef=function(E){return w.H.useRef(E)},ye.useState=function(E){return w.H.useState(E)},ye.useSyncExternalStore=function(E,U,se){return w.H.useSyncExternalStore(E,U,se)},ye.useTransition=function(){return w.H.useTransition()},ye.version="19.2.1",ye}var zp;function zc(){return zp||(zp=1,vc.exports=M0()),vc.exports}var T=zc(),gc={exports:{}},gl={},bc={exports:{}},xc={};var Bp;function T0(){return Bp||(Bp=1,(function(m){function a(F,$){var le=F.length;F.push($);e:for(;0<le;){var me=le-1>>>1,fe=F[me];if(0<u(fe,$))F[me]=$,F[le]=fe,le=me;else break e}}function l(F){return F.length===0?null:F[0]}function s(F){if(F.length===0)return null;var $=F[0],le=F.pop();if(le!==$){F[0]=le;e:for(var me=0,fe=F.length,E=fe>>>1;me<E;){var U=2*(me+1)-1,se=F[U],k=U+1,_=F[k];if(0>u(se,le))k<fe&&0>u(_,se)?(F[me]=_,F[k]=le,me=k):(F[me]=se,F[U]=le,me=U);else if(k<fe&&0>u(_,le))F[me]=_,F[k]=le,me=k;else break e}}return $}function u(F,$){var le=F.sortIndex-$.sortIndex;return le!==0?le:F.id-$.id}if(m.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var h=performance;m.unstable_now=function(){return h.now()}}else{var p=Date,f=p.now();m.unstable_now=function(){return p.now()-f}}var g=[],b=[],M=1,S=null,y=3,j=!1,C=!1,B=!1,G=!1,Z=typeof setTimeout=="function"?setTimeout:null,W=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function Y(F){for(var $=l(b);$!==null;){if($.callback===null)s(b);else if($.startTime<=F)s(b),$.sortIndex=$.expirationTime,a(g,$);else break;$=l(b)}}function te(F){if(B=!1,Y(F),!C)if(l(g)!==null)C=!0,O||(O=!0,qe());else{var $=l(b);$!==null&&ge(te,$.startTime-F)}}var O=!1,w=-1,L=5,ne=-1;function Me(){return G?!0:!(m.unstable_now()-ne<L)}function Be(){if(G=!1,O){var F=m.unstable_now();ne=F;var $=!0;try{e:{C=!1,B&&(B=!1,W(w),w=-1),j=!0;var le=y;try{t:{for(Y(F),S=l(g);S!==null&&!(S.expirationTime>F&&Me());){var me=S.callback;if(typeof me=="function"){S.callback=null,y=S.priorityLevel;var fe=me(S.expirationTime<=F);if(F=m.unstable_now(),typeof fe=="function"){S.callback=fe,Y(F),$=!0;break t}S===l(g)&&s(g),Y(F)}else s(g);S=l(g)}if(S!==null)$=!0;else{var E=l(b);E!==null&&ge(te,E.startTime-F),$=!1}}break e}finally{S=null,y=le,j=!1}$=void 0}}finally{$?qe():O=!1}}}var qe;if(typeof I=="function")qe=function(){I(Be)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,ee=P.port2;P.port1.onmessage=Be,qe=function(){ee.postMessage(null)}}else qe=function(){Z(Be,0)};function ge(F,$){w=Z(function(){F(m.unstable_now())},$)}m.unstable_IdlePriority=5,m.unstable_ImmediatePriority=1,m.unstable_LowPriority=4,m.unstable_NormalPriority=3,m.unstable_Profiling=null,m.unstable_UserBlockingPriority=2,m.unstable_cancelCallback=function(F){F.callback=null},m.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<F?Math.floor(1e3/F):5},m.unstable_getCurrentPriorityLevel=function(){return y},m.unstable_next=function(F){switch(y){case 1:case 2:case 3:var $=3;break;default:$=y}var le=y;y=$;try{return F()}finally{y=le}},m.unstable_requestPaint=function(){G=!0},m.unstable_runWithPriority=function(F,$){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var le=y;y=F;try{return $()}finally{y=le}},m.unstable_scheduleCallback=function(F,$,le){var me=m.unstable_now();switch(typeof le=="object"&&le!==null?(le=le.delay,le=typeof le=="number"&&0<le?me+le:me):le=me,F){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=le+fe,F={id:M++,callback:$,priorityLevel:F,startTime:le,expirationTime:fe,sortIndex:-1},le>me?(F.sortIndex=le,a(b,F),l(g)===null&&F===l(b)&&(B?(W(w),w=-1):B=!0,ge(te,le-me))):(F.sortIndex=fe,a(g,F),C||j||(C=!0,O||(O=!0,qe()))),F},m.unstable_shouldYield=Me,m.unstable_wrapCallback=function(F){var $=y;return function(){var le=y;y=$;try{return F.apply(this,arguments)}finally{y=le}}}})(xc)),xc}var _p;function C0(){return _p||(_p=1,bc.exports=T0()),bc.exports}var yc={exports:{}},ht={};var Vp;function R0(){if(Vp)return ht;Vp=1;var m=zc();function a(g){var b="https://react.dev/errors/"+g;if(1<arguments.length){b+="?args[]="+encodeURIComponent(arguments[1]);for(var M=2;M<arguments.length;M++)b+="&args[]="+encodeURIComponent(arguments[M])}return"Minified React error #"+g+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(){}var s={d:{f:l,r:function(){throw Error(a(522))},D:l,C:l,L:l,m:l,X:l,S:l,M:l},p:0,findDOMNode:null},u=Symbol.for("react.portal");function h(g,b,M){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:S==null?null:""+S,children:g,containerInfo:b,implementation:M}}var p=m.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(g,b){if(g==="font")return"";if(typeof b=="string")return b==="use-credentials"?b:""}return ht.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,ht.createPortal=function(g,b){var M=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!b||b.nodeType!==1&&b.nodeType!==9&&b.nodeType!==11)throw Error(a(299));return h(g,b,null,M)},ht.flushSync=function(g){var b=p.T,M=s.p;try{if(p.T=null,s.p=2,g)return g()}finally{p.T=b,s.p=M,s.d.f()}},ht.preconnect=function(g,b){typeof g=="string"&&(b?(b=b.crossOrigin,b=typeof b=="string"?b==="use-credentials"?b:"":void 0):b=null,s.d.C(g,b))},ht.prefetchDNS=function(g){typeof g=="string"&&s.d.D(g)},ht.preinit=function(g,b){if(typeof g=="string"&&b&&typeof b.as=="string"){var M=b.as,S=f(M,b.crossOrigin),y=typeof b.integrity=="string"?b.integrity:void 0,j=typeof b.fetchPriority=="string"?b.fetchPriority:void 0;M==="style"?s.d.S(g,typeof b.precedence=="string"?b.precedence:void 0,{crossOrigin:S,integrity:y,fetchPriority:j}):M==="script"&&s.d.X(g,{crossOrigin:S,integrity:y,fetchPriority:j,nonce:typeof b.nonce=="string"?b.nonce:void 0})}},ht.preinitModule=function(g,b){if(typeof g=="string")if(typeof b=="object"&&b!==null){if(b.as==null||b.as==="script"){var M=f(b.as,b.crossOrigin);s.d.M(g,{crossOrigin:M,integrity:typeof b.integrity=="string"?b.integrity:void 0,nonce:typeof b.nonce=="string"?b.nonce:void 0})}}else b==null&&s.d.M(g)},ht.preload=function(g,b){if(typeof g=="string"&&typeof b=="object"&&b!==null&&typeof b.as=="string"){var M=b.as,S=f(M,b.crossOrigin);s.d.L(g,M,{crossOrigin:S,integrity:typeof b.integrity=="string"?b.integrity:void 0,nonce:typeof b.nonce=="string"?b.nonce:void 0,type:typeof b.type=="string"?b.type:void 0,fetchPriority:typeof b.fetchPriority=="string"?b.fetchPriority:void 0,referrerPolicy:typeof b.referrerPolicy=="string"?b.referrerPolicy:void 0,imageSrcSet:typeof b.imageSrcSet=="string"?b.imageSrcSet:void 0,imageSizes:typeof b.imageSizes=="string"?b.imageSizes:void 0,media:typeof b.media=="string"?b.media:void 0})}},ht.preloadModule=function(g,b){if(typeof g=="string")if(b){var M=f(b.as,b.crossOrigin);s.d.m(g,{as:typeof b.as=="string"&&b.as!=="script"?b.as:void 0,crossOrigin:M,integrity:typeof b.integrity=="string"?b.integrity:void 0})}else s.d.m(g)},ht.requestFormReset=function(g){s.d.r(g)},ht.unstable_batchedUpdates=function(g,b){return g(b)},ht.useFormState=function(g,b,M){return p.H.useFormState(g,b,M)},ht.useFormStatus=function(){return p.H.useHostTransitionStatus()},ht.version="19.2.1",ht}var Gp;function A0(){if(Gp)return yc.exports;Gp=1;function m(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(m)}catch(a){console.error(a)}}return m(),yc.exports=R0(),yc.exports}var Fp;function k0(){if(Fp)return gl;Fp=1;var m=C0(),a=zc(),l=A0();function s(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function u(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function h(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function p(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function f(e){if(e.tag===31){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function g(e){if(h(e)!==e)throw Error(s(188))}function b(e){var t=e.alternate;if(!t){if(t=h(e),t===null)throw Error(s(188));return t!==e?null:e}for(var i=e,n=t;;){var r=i.return;if(r===null)break;var c=r.alternate;if(c===null){if(n=r.return,n!==null){i=n;continue}break}if(r.child===c.child){for(c=r.child;c;){if(c===i)return g(r),e;if(c===n)return g(r),t;c=c.sibling}throw Error(s(188))}if(i.return!==n.return)i=r,n=c;else{for(var d=!1,x=r.child;x;){if(x===i){d=!0,i=r,n=c;break}if(x===n){d=!0,n=r,i=c;break}x=x.sibling}if(!d){for(x=c.child;x;){if(x===i){d=!0,i=c,n=r;break}if(x===n){d=!0,n=c,i=r;break}x=x.sibling}if(!d)throw Error(s(189))}}if(i.alternate!==n)throw Error(s(190))}if(i.tag!==3)throw Error(s(188));return i.stateNode.current===i?e:t}function M(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=M(e),t!==null)return t;e=e.sibling}return null}var S=Object.assign,y=Symbol.for("react.element"),j=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),B=Symbol.for("react.fragment"),G=Symbol.for("react.strict_mode"),Z=Symbol.for("react.profiler"),W=Symbol.for("react.consumer"),I=Symbol.for("react.context"),Y=Symbol.for("react.forward_ref"),te=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),w=Symbol.for("react.memo"),L=Symbol.for("react.lazy"),ne=Symbol.for("react.activity"),Me=Symbol.for("react.memo_cache_sentinel"),Be=Symbol.iterator;function qe(e){return e===null||typeof e!="object"?null:(e=Be&&e[Be]||e["@@iterator"],typeof e=="function"?e:null)}var P=Symbol.for("react.client.reference");function ee(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===P?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case B:return"Fragment";case Z:return"Profiler";case G:return"StrictMode";case te:return"Suspense";case O:return"SuspenseList";case ne:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case C:return"Portal";case I:return e.displayName||"Context";case W:return(e._context.displayName||"Context")+".Consumer";case Y:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case w:return t=e.displayName||null,t!==null?t:ee(e.type)||"Memo";case L:t=e._payload,e=e._init;try{return ee(e(t))}catch{}}return null}var ge=Array.isArray,F=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$=l.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,le={pending:!1,data:null,method:null,action:null},me=[],fe=-1;function E(e){return{current:e}}function U(e){0>fe||(e.current=me[fe],me[fe]=null,fe--)}function se(e,t){fe++,me[fe]=e.current,e.current=t}var k=E(null),_=E(null),ae=E(null),ce=E(null);function ue(e,t){switch(se(ae,t),se(_,e),se(k,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?ip(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=ip(t),e=np(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}U(k),se(k,e)}function Te(){U(k),U(_),U(ae)}function Rt(e){e.memoizedState!==null&&se(ce,e);var t=k.current,i=np(t,e.type);t!==i&&(se(_,e),se(k,i))}function Qt(e){_.current===e&&(U(k),U(_)),ce.current===e&&(U(ce),hl._currentValue=le)}var ia,Aa;function na(e){if(ia===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);ia=t&&t[1]||"",Aa=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ia+e+Aa}var Ai=!1;function Tn(e,t){if(!e||Ai)return"";Ai=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(t){var J=function(){throw Error()};if(Object.defineProperty(J.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(J,[])}catch(H){var V=H}Reflect.construct(e,[],J)}else{try{J.call()}catch(H){V=H}e.call(J.prototype)}}else{try{throw Error()}catch(H){V=H}(J=e())&&typeof J.catch=="function"&&J.catch(function(){})}}catch(H){if(H&&V&&typeof H.stack=="string")return[H.stack,V.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var c=n.DetermineComponentFrameRoot(),d=c[0],x=c[1];if(d&&x){var A=d.split(`
`),z=x.split(`
`);for(r=n=0;n<A.length&&!A[n].includes("DetermineComponentFrameRoot");)n++;for(;r<z.length&&!z[r].includes("DetermineComponentFrameRoot");)r++;if(n===A.length||r===z.length)for(n=A.length-1,r=z.length-1;1<=n&&0<=r&&A[n]!==z[r];)r--;for(;1<=n&&0<=r;n--,r--)if(A[n]!==z[r]){if(n!==1||r!==1)do if(n--,r--,0>r||A[n]!==z[r]){var X=`
`+A[n].replace(" at new "," at ");return e.displayName&&X.includes("<anonymous>")&&(X=X.replace("<anonymous>",e.displayName)),X}while(1<=n&&0<=r);break}}}finally{Ai=!1,Error.prepareStackTrace=i}return(i=e?e.displayName||e.name:"")?na(i):""}function Ks(e,t){switch(e.tag){case 26:case 27:case 5:return na(e.type);case 16:return na("Lazy");case 13:return e.child!==t&&t!==null?na("Suspense Fallback"):na("Suspense");case 19:return na("SuspenseList");case 0:case 15:return Tn(e.type,!1);case 11:return Tn(e.type.render,!1);case 1:return Tn(e.type,!0);case 31:return na("Activity");default:return""}}function Rl(e){try{var t="",i=null;do t+=Ks(e,i),i=e,e=e.return;while(e);return t}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}var ka=Object.prototype.hasOwnProperty,Ea=m.unstable_scheduleCallback,ja=m.unstable_cancelCallback,Js=m.unstable_shouldYield,Cn=m.unstable_requestPaint,ft=m.unstable_now,$s=m.unstable_getCurrentPriorityLevel,Al=m.unstable_ImmediatePriority,kl=m.unstable_UserBlockingPriority,ki=m.unstable_NormalPriority,Ws=m.unstable_LowPriority,El=m.unstable_IdlePriority,Is=m.log,eo=m.unstable_setDisableYieldValue,ti=null,vt=null;function Jt(e){if(typeof Is=="function"&&eo(e),vt&&typeof vt.setStrictMode=="function")try{vt.setStrictMode(ti,e)}catch{}}var gt=Math.clz32?Math.clz32:io,to=Math.log,ao=Math.LN2;function io(e){return e>>>=0,e===0?32:31-(to(e)/ao|0)|0}var Ei=256,ji=262144,Ni=4194304;function la(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Oi(e,t,i){var n=e.pendingLanes;if(n===0)return 0;var r=0,c=e.suspendedLanes,d=e.pingedLanes;e=e.warmLanes;var x=n&134217727;return x!==0?(n=x&~c,n!==0?r=la(n):(d&=x,d!==0?r=la(d):i||(i=x&~e,i!==0&&(r=la(i))))):(x=n&~c,x!==0?r=la(x):d!==0?r=la(d):i||(i=n&~e,i!==0&&(r=la(i)))),r===0?0:t!==0&&t!==r&&(t&c)===0&&(c=r&-r,i=t&-t,c>=i||c===32&&(i&4194048)!==0)?t:r}function ai(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function no(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function jl(){var e=Ni;return Ni<<=1,(Ni&62914560)===0&&(Ni=4194304),e}function Rn(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function ii(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function lo(e,t,i,n,r,c){var d=e.pendingLanes;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=i,e.entangledLanes&=i,e.errorRecoveryDisabledLanes&=i,e.shellSuspendCounter=0;var x=e.entanglements,A=e.expirationTimes,z=e.hiddenUpdates;for(i=d&~i;0<i;){var X=31-gt(i),J=1<<X;x[X]=0,A[X]=-1;var V=z[X];if(V!==null)for(z[X]=null,X=0;X<V.length;X++){var H=V[X];H!==null&&(H.lane&=-536870913)}i&=~J}n!==0&&Nl(e,n,0),c!==0&&r===0&&e.tag!==0&&(e.suspendedLanes|=c&~(d&~t))}function Nl(e,t,i){e.pendingLanes|=t,e.suspendedLanes&=~t;var n=31-gt(t);e.entangledLanes|=t,e.entanglements[n]=e.entanglements[n]|1073741824|i&261930}function Ol(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var n=31-gt(i),r=1<<n;r&t|e[n]&t&&(e[n]|=t),i&=~r}}function Pl(e,t){var i=t&-t;return i=(i&42)!==0?1:Q(i),(i&(e.suspendedLanes|t))!==0?0:i}function Q(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function oe(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function re(){var e=$.p;return e!==0?e:(e=window.event,e===void 0?32:kp(e.type))}function pe(e,t){var i=$.p;try{return $.p=e,t()}finally{$.p=i}}var je=Math.random().toString(36).slice(2),Se="__reactFiber$"+je,Ne="__reactProps$"+je,nt="__reactContainer$"+je,An="__reactEvents$"+je,rd="__reactListeners$"+je,cd="__reactHandles$"+je,Uc="__reactResources$"+je,kn="__reactMarker$"+je;function so(e){delete e[Se],delete e[Ne],delete e[An],delete e[rd],delete e[cd]}function Pi(e){var t=e[Se];if(t)return t;for(var i=e.parentNode;i;){if(t=i[nt]||i[Se]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=mp(e);e!==null;){if(i=e[Se])return i;e=mp(e)}return t}e=i,i=e.parentNode}return null}function Di(e){if(e=e[Se]||e[nt]){var t=e.tag;if(t===5||t===6||t===13||t===31||t===26||t===27||t===3)return e}return null}function En(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(s(33))}function Li(e){var t=e[Uc];return t||(t=e[Uc]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function lt(e){e[kn]=!0}var Qc=new Set,Yc={};function ni(e,t){wi(e,t),wi(e+"Capture",t)}function wi(e,t){for(Yc[e]=t,e=0;e<t.length;e++)Qc.add(t[e])}var ud=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Xc={},Zc={};function md(e){return ka.call(Zc,e)?!0:ka.call(Xc,e)?!1:ud.test(e)?Zc[e]=!0:(Xc[e]=!0,!1)}function Dl(e,t,i){if(md(t))if(i===null)e.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var n=t.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+i)}}function Ll(e,t,i){if(i===null)e.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+i)}}function sa(e,t,i,n){if(n===null)e.removeAttribute(i);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(i);return}e.setAttributeNS(t,i,""+n)}}function Dt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Kc(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function hd(e,t,i){var n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,c=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(d){i=""+d,c.call(this,d)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(d){i=""+d},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function oo(e){if(!e._valueTracker){var t=Kc(e)?"checked":"value";e._valueTracker=hd(e,t,""+e[t])}}function Jc(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),n="";return e&&(n=Kc(e)?e.checked?"true":"false":e.value),e=n,e!==i?(t.setValue(e),!0):!1}function wl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var pd=/[\n"\\]/g;function Lt(e){return e.replace(pd,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function ro(e,t,i,n,r,c,d,x){e.name="",d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"?e.type=d:e.removeAttribute("type"),t!=null?d==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+Dt(t)):e.value!==""+Dt(t)&&(e.value=""+Dt(t)):d!=="submit"&&d!=="reset"||e.removeAttribute("value"),t!=null?co(e,d,Dt(t)):i!=null?co(e,d,Dt(i)):n!=null&&e.removeAttribute("value"),r==null&&c!=null&&(e.defaultChecked=!!c),r!=null&&(e.checked=r&&typeof r!="function"&&typeof r!="symbol"),x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?e.name=""+Dt(x):e.removeAttribute("name")}function $c(e,t,i,n,r,c,d,x){if(c!=null&&typeof c!="function"&&typeof c!="symbol"&&typeof c!="boolean"&&(e.type=c),t!=null||i!=null){if(!(c!=="submit"&&c!=="reset"||t!=null)){oo(e);return}i=i!=null?""+Dt(i):"",t=t!=null?""+Dt(t):i,x||t===e.value||(e.value=t),e.defaultValue=t}n=n??r,n=typeof n!="function"&&typeof n!="symbol"&&!!n,e.checked=x?e.checked:!!n,e.defaultChecked=!!n,d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(e.name=d),oo(e)}function co(e,t,i){t==="number"&&wl(e.ownerDocument)===e||e.defaultValue===""+i||(e.defaultValue=""+i)}function qi(e,t,i,n){if(e=e.options,t){t={};for(var r=0;r<i.length;r++)t["$"+i[r]]=!0;for(i=0;i<e.length;i++)r=t.hasOwnProperty("$"+e[i].value),e[i].selected!==r&&(e[i].selected=r),r&&n&&(e[i].defaultSelected=!0)}else{for(i=""+Dt(i),t=null,r=0;r<e.length;r++){if(e[r].value===i){e[r].selected=!0,n&&(e[r].defaultSelected=!0);return}t!==null||e[r].disabled||(t=e[r])}t!==null&&(t.selected=!0)}}function Wc(e,t,i){if(t!=null&&(t=""+Dt(t),t!==e.value&&(e.value=t),i==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=i!=null?""+Dt(i):""}function Ic(e,t,i,n){if(t==null){if(n!=null){if(i!=null)throw Error(s(92));if(ge(n)){if(1<n.length)throw Error(s(93));n=n[0]}i=n}i==null&&(i=""),t=i}i=Dt(t),e.defaultValue=i,n=e.textContent,n===i&&n!==""&&n!==null&&(e.value=n),oo(e)}function zi(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var dd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function eu(e,t,i){var n=t.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?n?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":n?e.setProperty(t,i):typeof i!="number"||i===0||dd.has(t)?t==="float"?e.cssFloat=i:e[t]=(""+i).trim():e[t]=i+"px"}function tu(e,t,i){if(t!=null&&typeof t!="object")throw Error(s(62));if(e=e.style,i!=null){for(var n in i)!i.hasOwnProperty(n)||t!=null&&t.hasOwnProperty(n)||(n.indexOf("--")===0?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="");for(var r in t)n=t[r],t.hasOwnProperty(r)&&i[r]!==n&&eu(e,r,n)}else for(var c in t)t.hasOwnProperty(c)&&eu(e,c,t[c])}function uo(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),vd=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ql(e){return vd.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function oa(){}var mo=null;function ho(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Bi=null,_i=null;function au(e){var t=Di(e);if(t&&(e=t.stateNode)){var i=e[Ne]||null;e:switch(e=t.stateNode,t.type){case"input":if(ro(e,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+Lt(""+t)+'"][type="radio"]'),t=0;t<i.length;t++){var n=i[t];if(n!==e&&n.form===e.form){var r=n[Ne]||null;if(!r)throw Error(s(90));ro(n,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(t=0;t<i.length;t++)n=i[t],n.form===e.form&&Jc(n)}break e;case"textarea":Wc(e,i.value,i.defaultValue);break e;case"select":t=i.value,t!=null&&qi(e,!!i.multiple,t,!1)}}}var po=!1;function iu(e,t,i){if(po)return e(t,i);po=!0;try{var n=e(t);return n}finally{if(po=!1,(Bi!==null||_i!==null)&&(Ts(),Bi&&(t=Bi,e=_i,_i=Bi=null,au(t),e)))for(t=0;t<e.length;t++)au(e[t])}}function jn(e,t){var i=e.stateNode;if(i===null)return null;var n=i[Ne]||null;if(n===null)return null;i=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(s(231,t,typeof i));return i}var ra=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),fo=!1;if(ra)try{var Nn={};Object.defineProperty(Nn,"passive",{get:function(){fo=!0}}),window.addEventListener("test",Nn,Nn),window.removeEventListener("test",Nn,Nn)}catch{fo=!1}var Na=null,vo=null,zl=null;function nu(){if(zl)return zl;var e,t=vo,i=t.length,n,r="value"in Na?Na.value:Na.textContent,c=r.length;for(e=0;e<i&&t[e]===r[e];e++);var d=i-e;for(n=1;n<=d&&t[i-n]===r[c-n];n++);return zl=r.slice(e,1<n?1-n:void 0)}function Bl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function _l(){return!0}function lu(){return!1}function xt(e){function t(i,n,r,c,d){this._reactName=i,this._targetInst=r,this.type=n,this.nativeEvent=c,this.target=d,this.currentTarget=null;for(var x in e)e.hasOwnProperty(x)&&(i=e[x],this[x]=i?i(c):c[x]);return this.isDefaultPrevented=(c.defaultPrevented!=null?c.defaultPrevented:c.returnValue===!1)?_l:lu,this.isPropagationStopped=lu,this}return S(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=_l)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=_l)},persist:function(){},isPersistent:_l}),t}var li={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Vl=xt(li),On=S({},li,{view:0,detail:0}),gd=xt(On),go,bo,Pn,Gl=S({},On,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yo,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Pn&&(Pn&&e.type==="mousemove"?(go=e.screenX-Pn.screenX,bo=e.screenY-Pn.screenY):bo=go=0,Pn=e),go)},movementY:function(e){return"movementY"in e?e.movementY:bo}}),su=xt(Gl),bd=S({},Gl,{dataTransfer:0}),xd=xt(bd),yd=S({},On,{relatedTarget:0}),xo=xt(yd),Sd=S({},li,{animationName:0,elapsedTime:0,pseudoElement:0}),Md=xt(Sd),Td=S({},li,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Cd=xt(Td),Rd=S({},li,{data:0}),ou=xt(Rd),Ad={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ed={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jd(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Ed[e])?!!t[e]:!1}function yo(){return jd}var Nd=S({},On,{key:function(e){if(e.key){var t=Ad[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Bl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?kd[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yo,charCode:function(e){return e.type==="keypress"?Bl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Bl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Od=xt(Nd),Pd=S({},Gl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ru=xt(Pd),Dd=S({},On,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yo}),Ld=xt(Dd),wd=S({},li,{propertyName:0,elapsedTime:0,pseudoElement:0}),qd=xt(wd),zd=S({},Gl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Bd=xt(zd),_d=S({},li,{newState:0,oldState:0}),Vd=xt(_d),Gd=[9,13,27,32],So=ra&&"CompositionEvent"in window,Dn=null;ra&&"documentMode"in document&&(Dn=document.documentMode);var Fd=ra&&"TextEvent"in window&&!Dn,cu=ra&&(!So||Dn&&8<Dn&&11>=Dn),uu=" ",mu=!1;function hu(e,t){switch(e){case"keyup":return Gd.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pu(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Vi=!1;function Hd(e,t){switch(e){case"compositionend":return pu(t);case"keypress":return t.which!==32?null:(mu=!0,uu);case"textInput":return e=t.data,e===uu&&mu?null:e;default:return null}}function Ud(e,t){if(Vi)return e==="compositionend"||!So&&hu(e,t)?(e=nu(),zl=vo=Na=null,Vi=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return cu&&t.locale!=="ko"?null:t.data;default:return null}}var Qd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function du(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Qd[e.type]:t==="textarea"}function fu(e,t,i,n){Bi?_i?_i.push(n):_i=[n]:Bi=n,t=Ns(t,"onChange"),0<t.length&&(i=new Vl("onChange","change",null,i,n),e.push({event:i,listeners:t}))}var Ln=null,wn=null;function Yd(e){$h(e,0)}function Fl(e){var t=En(e);if(Jc(t))return e}function vu(e,t){if(e==="change")return t}var gu=!1;if(ra){var Mo;if(ra){var To="oninput"in document;if(!To){var bu=document.createElement("div");bu.setAttribute("oninput","return;"),To=typeof bu.oninput=="function"}Mo=To}else Mo=!1;gu=Mo&&(!document.documentMode||9<document.documentMode)}function xu(){Ln&&(Ln.detachEvent("onpropertychange",yu),wn=Ln=null)}function yu(e){if(e.propertyName==="value"&&Fl(wn)){var t=[];fu(t,wn,e,ho(e)),iu(Yd,t)}}function Xd(e,t,i){e==="focusin"?(xu(),Ln=t,wn=i,Ln.attachEvent("onpropertychange",yu)):e==="focusout"&&xu()}function Zd(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Fl(wn)}function Kd(e,t){if(e==="click")return Fl(t)}function Jd(e,t){if(e==="input"||e==="change")return Fl(t)}function $d(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var At=typeof Object.is=="function"?Object.is:$d;function qn(e,t){if(At(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var r=i[n];if(!ka.call(t,r)||!At(e[r],t[r]))return!1}return!0}function Su(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Mu(e,t){var i=Su(e);e=0;for(var n;i;){if(i.nodeType===3){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Su(i)}}function Tu(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Tu(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Cu(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=wl(e.document);t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=wl(e.document)}return t}function Co(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var Wd=ra&&"documentMode"in document&&11>=document.documentMode,Gi=null,Ro=null,zn=null,Ao=!1;function Ru(e,t,i){var n=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Ao||Gi==null||Gi!==wl(n)||(n=Gi,"selectionStart"in n&&Co(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),zn&&qn(zn,n)||(zn=n,n=Ns(Ro,"onSelect"),0<n.length&&(t=new Vl("onSelect","select",null,t,i),e.push({event:t,listeners:n}),t.target=Gi)))}function si(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var Fi={animationend:si("Animation","AnimationEnd"),animationiteration:si("Animation","AnimationIteration"),animationstart:si("Animation","AnimationStart"),transitionrun:si("Transition","TransitionRun"),transitionstart:si("Transition","TransitionStart"),transitioncancel:si("Transition","TransitionCancel"),transitionend:si("Transition","TransitionEnd")},ko={},Au={};ra&&(Au=document.createElement("div").style,"AnimationEvent"in window||(delete Fi.animationend.animation,delete Fi.animationiteration.animation,delete Fi.animationstart.animation),"TransitionEvent"in window||delete Fi.transitionend.transition);function oi(e){if(ko[e])return ko[e];if(!Fi[e])return e;var t=Fi[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in Au)return ko[e]=t[i];return e}var ku=oi("animationend"),Eu=oi("animationiteration"),ju=oi("animationstart"),Id=oi("transitionrun"),ef=oi("transitionstart"),tf=oi("transitioncancel"),Nu=oi("transitionend"),Ou=new Map,Eo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Eo.push("scrollEnd");function Yt(e,t){Ou.set(e,t),ni(t,[e])}var Hl=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},wt=[],Hi=0,jo=0;function Ul(){for(var e=Hi,t=jo=Hi=0;t<e;){var i=wt[t];wt[t++]=null;var n=wt[t];wt[t++]=null;var r=wt[t];wt[t++]=null;var c=wt[t];if(wt[t++]=null,n!==null&&r!==null){var d=n.pending;d===null?r.next=r:(r.next=d.next,d.next=r),n.pending=r}c!==0&&Pu(i,r,c)}}function Ql(e,t,i,n){wt[Hi++]=e,wt[Hi++]=t,wt[Hi++]=i,wt[Hi++]=n,jo|=n,e.lanes|=n,e=e.alternate,e!==null&&(e.lanes|=n)}function No(e,t,i,n){return Ql(e,t,i,n),Yl(e)}function ri(e,t){return Ql(e,null,null,t),Yl(e)}function Pu(e,t,i){e.lanes|=i;var n=e.alternate;n!==null&&(n.lanes|=i);for(var r=!1,c=e.return;c!==null;)c.childLanes|=i,n=c.alternate,n!==null&&(n.childLanes|=i),c.tag===22&&(e=c.stateNode,e===null||e._visibility&1||(r=!0)),e=c,c=c.return;return e.tag===3?(c=e.stateNode,r&&t!==null&&(r=31-gt(i),e=c.hiddenUpdates,n=e[r],n===null?e[r]=[t]:n.push(t),t.lane=i|536870912),c):null}function Yl(e){if(50<ll)throw ll=0,_r=null,Error(s(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var Ui={};function af(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kt(e,t,i,n){return new af(e,t,i,n)}function Oo(e){return e=e.prototype,!(!e||!e.isReactComponent)}function ca(e,t){var i=e.alternate;return i===null?(i=kt(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&65011712,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i.refCleanup=e.refCleanup,i}function Du(e,t){e.flags&=65011714;var i=e.alternate;return i===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,e.type=i.type,t=i.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Xl(e,t,i,n,r,c){var d=0;if(n=e,typeof e=="function")Oo(e)&&(d=1);else if(typeof e=="string")d=r0(e,i,k.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case ne:return e=kt(31,i,t,r),e.elementType=ne,e.lanes=c,e;case B:return ci(i.children,r,c,t);case G:d=8,r|=24;break;case Z:return e=kt(12,i,t,r|2),e.elementType=Z,e.lanes=c,e;case te:return e=kt(13,i,t,r),e.elementType=te,e.lanes=c,e;case O:return e=kt(19,i,t,r),e.elementType=O,e.lanes=c,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case I:d=10;break e;case W:d=9;break e;case Y:d=11;break e;case w:d=14;break e;case L:d=16,n=null;break e}d=29,i=Error(s(130,e===null?"null":typeof e,"")),n=null}return t=kt(d,i,t,r),t.elementType=e,t.type=n,t.lanes=c,t}function ci(e,t,i,n){return e=kt(7,e,n,t),e.lanes=i,e}function Po(e,t,i){return e=kt(6,e,null,t),e.lanes=i,e}function Lu(e){var t=kt(18,null,null,0);return t.stateNode=e,t}function Do(e,t,i){return t=kt(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var wu=new WeakMap;function qt(e,t){if(typeof e=="object"&&e!==null){var i=wu.get(e);return i!==void 0?i:(t={value:e,source:t,stack:Rl(t)},wu.set(e,t),t)}return{value:e,source:t,stack:Rl(t)}}var Qi=[],Yi=0,Zl=null,Bn=0,zt=[],Bt=0,Oa=null,$t=1,Wt="";function ua(e,t){Qi[Yi++]=Bn,Qi[Yi++]=Zl,Zl=e,Bn=t}function qu(e,t,i){zt[Bt++]=$t,zt[Bt++]=Wt,zt[Bt++]=Oa,Oa=e;var n=$t;e=Wt;var r=32-gt(n)-1;n&=~(1<<r),i+=1;var c=32-gt(t)+r;if(30<c){var d=r-r%5;c=(n&(1<<d)-1).toString(32),n>>=d,r-=d,$t=1<<32-gt(t)+r|i<<r|n,Wt=c+e}else $t=1<<c|i<<r|n,Wt=e}function Lo(e){e.return!==null&&(ua(e,1),qu(e,1,0))}function wo(e){for(;e===Zl;)Zl=Qi[--Yi],Qi[Yi]=null,Bn=Qi[--Yi],Qi[Yi]=null;for(;e===Oa;)Oa=zt[--Bt],zt[Bt]=null,Wt=zt[--Bt],zt[Bt]=null,$t=zt[--Bt],zt[Bt]=null}function zu(e,t){zt[Bt++]=$t,zt[Bt++]=Wt,zt[Bt++]=Oa,$t=t.id,Wt=t.overflow,Oa=e}var rt=null,Qe=null,De=!1,Pa=null,_t=!1,qo=Error(s(519));function Da(e){var t=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw _n(qt(t,e)),qo}function Bu(e){var t=e.stateNode,i=e.type,n=e.memoizedProps;switch(t[Se]=e,t[Ne]=n,i){case"dialog":Ee("cancel",t),Ee("close",t);break;case"iframe":case"object":case"embed":Ee("load",t);break;case"video":case"audio":for(i=0;i<ol.length;i++)Ee(ol[i],t);break;case"source":Ee("error",t);break;case"img":case"image":case"link":Ee("error",t),Ee("load",t);break;case"details":Ee("toggle",t);break;case"input":Ee("invalid",t),$c(t,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":Ee("invalid",t);break;case"textarea":Ee("invalid",t),Ic(t,n.value,n.defaultValue,n.children)}i=n.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||t.textContent===""+i||n.suppressHydrationWarning===!0||tp(t.textContent,i)?(n.popover!=null&&(Ee("beforetoggle",t),Ee("toggle",t)),n.onScroll!=null&&Ee("scroll",t),n.onScrollEnd!=null&&Ee("scrollend",t),n.onClick!=null&&(t.onclick=oa),t=!0):t=!1,t||Da(e,!0)}function _u(e){for(rt=e.return;rt;)switch(rt.tag){case 5:case 31:case 13:_t=!1;return;case 27:case 3:_t=!0;return;default:rt=rt.return}}function Xi(e){if(e!==rt)return!1;if(!De)return _u(e),De=!0,!1;var t=e.tag,i;if((i=t!==3&&t!==27)&&((i=t===5)&&(i=e.type,i=!(i!=="form"&&i!=="button")||ec(e.type,e.memoizedProps)),i=!i),i&&Qe&&Da(e),_u(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));Qe=up(e)}else if(t===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));Qe=up(e)}else t===27?(t=Qe,Xa(e.type)?(e=lc,lc=null,Qe=e):Qe=t):Qe=rt?Gt(e.stateNode.nextSibling):null;return!0}function ui(){Qe=rt=null,De=!1}function zo(){var e=Pa;return e!==null&&(Tt===null?Tt=e:Tt.push.apply(Tt,e),Pa=null),e}function _n(e){Pa===null?Pa=[e]:Pa.push(e)}var Bo=E(null),mi=null,ma=null;function La(e,t,i){se(Bo,t._currentValue),t._currentValue=i}function ha(e){e._currentValue=Bo.current,U(Bo)}function _o(e,t,i){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===i)break;e=e.return}}function Vo(e,t,i,n){var r=e.child;for(r!==null&&(r.return=e);r!==null;){var c=r.dependencies;if(c!==null){var d=r.child;c=c.firstContext;e:for(;c!==null;){var x=c;c=r;for(var A=0;A<t.length;A++)if(x.context===t[A]){c.lanes|=i,x=c.alternate,x!==null&&(x.lanes|=i),_o(c.return,i,e),n||(d=null);break e}c=x.next}}else if(r.tag===18){if(d=r.return,d===null)throw Error(s(341));d.lanes|=i,c=d.alternate,c!==null&&(c.lanes|=i),_o(d,i,e),d=null}else d=r.child;if(d!==null)d.return=r;else for(d=r;d!==null;){if(d===e){d=null;break}if(r=d.sibling,r!==null){r.return=d.return,d=r;break}d=d.return}r=d}}function Zi(e,t,i,n){e=null;for(var r=t,c=!1;r!==null;){if(!c){if((r.flags&524288)!==0)c=!0;else if((r.flags&262144)!==0)break}if(r.tag===10){var d=r.alternate;if(d===null)throw Error(s(387));if(d=d.memoizedProps,d!==null){var x=r.type;At(r.pendingProps.value,d.value)||(e!==null?e.push(x):e=[x])}}else if(r===ce.current){if(d=r.alternate,d===null)throw Error(s(387));d.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(e!==null?e.push(hl):e=[hl])}r=r.return}e!==null&&Vo(t,e,i,n),t.flags|=262144}function Kl(e){for(e=e.firstContext;e!==null;){if(!At(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function hi(e){mi=e,ma=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function ct(e){return Vu(mi,e)}function Jl(e,t){return mi===null&&hi(e),Vu(e,t)}function Vu(e,t){var i=t._currentValue;if(t={context:t,memoizedValue:i,next:null},ma===null){if(e===null)throw Error(s(308));ma=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else ma=ma.next=t;return i}var nf=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(i,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(i){return i()})}},lf=m.unstable_scheduleCallback,sf=m.unstable_NormalPriority,We={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Go(){return{controller:new nf,data:new Map,refCount:0}}function Vn(e){e.refCount--,e.refCount===0&&lf(sf,function(){e.controller.abort()})}var Gn=null,Fo=0,Ki=0,Ji=null;function of(e,t){if(Gn===null){var i=Gn=[];Fo=0,Ki=Qr(),Ji={status:"pending",value:void 0,then:function(n){i.push(n)}}}return Fo++,t.then(Gu,Gu),t}function Gu(){if(--Fo===0&&Gn!==null){Ji!==null&&(Ji.status="fulfilled");var e=Gn;Gn=null,Ki=0,Ji=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function rf(e,t){var i=[],n={status:"pending",value:null,reason:null,then:function(r){i.push(r)}};return e.then(function(){n.status="fulfilled",n.value=t;for(var r=0;r<i.length;r++)(0,i[r])(t)},function(r){for(n.status="rejected",n.reason=r,r=0;r<i.length;r++)(0,i[r])(void 0)}),n}var Fu=F.S;F.S=function(e,t){Rh=ft(),typeof t=="object"&&t!==null&&typeof t.then=="function"&&of(e,t),Fu!==null&&Fu(e,t)};var pi=E(null);function Ho(){var e=pi.current;return e!==null?e:Ue.pooledCache}function $l(e,t){t===null?se(pi,pi.current):se(pi,t.pool)}function Hu(){var e=Ho();return e===null?null:{parent:We._currentValue,pool:e}}var $i=Error(s(460)),Uo=Error(s(474)),Wl=Error(s(542)),Il={then:function(){}};function Uu(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Qu(e,t,i){switch(i=e[i],i===void 0?e.push(t):i!==t&&(t.then(oa,oa),t=i),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Xu(e),e;default:if(typeof t.status=="string")t.then(oa,oa);else{if(e=Ue,e!==null&&100<e.shellSuspendCounter)throw Error(s(482));e=t,e.status="pending",e.then(function(n){if(t.status==="pending"){var r=t;r.status="fulfilled",r.value=n}},function(n){if(t.status==="pending"){var r=t;r.status="rejected",r.reason=n}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Xu(e),e}throw fi=t,$i}}function di(e){try{var t=e._init;return t(e._payload)}catch(i){throw i!==null&&typeof i=="object"&&typeof i.then=="function"?(fi=i,$i):i}}var fi=null;function Yu(){if(fi===null)throw Error(s(459));var e=fi;return fi=null,e}function Xu(e){if(e===$i||e===Wl)throw Error(s(483))}var Wi=null,Fn=0;function es(e){var t=Fn;return Fn+=1,Wi===null&&(Wi=[]),Qu(Wi,e,t)}function Hn(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function ts(e,t){throw t.$$typeof===y?Error(s(525)):(e=Object.prototype.toString.call(t),Error(s(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function Zu(e){function t(D,N){if(e){var q=D.deletions;q===null?(D.deletions=[N],D.flags|=16):q.push(N)}}function i(D,N){if(!e)return null;for(;N!==null;)t(D,N),N=N.sibling;return null}function n(D){for(var N=new Map;D!==null;)D.key!==null?N.set(D.key,D):N.set(D.index,D),D=D.sibling;return N}function r(D,N){return D=ca(D,N),D.index=0,D.sibling=null,D}function c(D,N,q){return D.index=q,e?(q=D.alternate,q!==null?(q=q.index,q<N?(D.flags|=67108866,N):q):(D.flags|=67108866,N)):(D.flags|=1048576,N)}function d(D){return e&&D.alternate===null&&(D.flags|=67108866),D}function x(D,N,q,K){return N===null||N.tag!==6?(N=Po(q,D.mode,K),N.return=D,N):(N=r(N,q),N.return=D,N)}function A(D,N,q,K){var ve=q.type;return ve===B?X(D,N,q.props.children,K,q.key):N!==null&&(N.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===L&&di(ve)===N.type)?(N=r(N,q.props),Hn(N,q),N.return=D,N):(N=Xl(q.type,q.key,q.props,null,D.mode,K),Hn(N,q),N.return=D,N)}function z(D,N,q,K){return N===null||N.tag!==4||N.stateNode.containerInfo!==q.containerInfo||N.stateNode.implementation!==q.implementation?(N=Do(q,D.mode,K),N.return=D,N):(N=r(N,q.children||[]),N.return=D,N)}function X(D,N,q,K,ve){return N===null||N.tag!==7?(N=ci(q,D.mode,K,ve),N.return=D,N):(N=r(N,q),N.return=D,N)}function J(D,N,q){if(typeof N=="string"&&N!==""||typeof N=="number"||typeof N=="bigint")return N=Po(""+N,D.mode,q),N.return=D,N;if(typeof N=="object"&&N!==null){switch(N.$$typeof){case j:return q=Xl(N.type,N.key,N.props,null,D.mode,q),Hn(q,N),q.return=D,q;case C:return N=Do(N,D.mode,q),N.return=D,N;case L:return N=di(N),J(D,N,q)}if(ge(N)||qe(N))return N=ci(N,D.mode,q,null),N.return=D,N;if(typeof N.then=="function")return J(D,es(N),q);if(N.$$typeof===I)return J(D,Jl(D,N),q);ts(D,N)}return null}function V(D,N,q,K){var ve=N!==null?N.key:null;if(typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint")return ve!==null?null:x(D,N,""+q,K);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case j:return q.key===ve?A(D,N,q,K):null;case C:return q.key===ve?z(D,N,q,K):null;case L:return q=di(q),V(D,N,q,K)}if(ge(q)||qe(q))return ve!==null?null:X(D,N,q,K,null);if(typeof q.then=="function")return V(D,N,es(q),K);if(q.$$typeof===I)return V(D,N,Jl(D,q),K);ts(D,q)}return null}function H(D,N,q,K,ve){if(typeof K=="string"&&K!==""||typeof K=="number"||typeof K=="bigint")return D=D.get(q)||null,x(N,D,""+K,ve);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case j:return D=D.get(K.key===null?q:K.key)||null,A(N,D,K,ve);case C:return D=D.get(K.key===null?q:K.key)||null,z(N,D,K,ve);case L:return K=di(K),H(D,N,q,K,ve)}if(ge(K)||qe(K))return D=D.get(q)||null,X(N,D,K,ve,null);if(typeof K.then=="function")return H(D,N,q,es(K),ve);if(K.$$typeof===I)return H(D,N,q,Jl(N,K),ve);ts(N,K)}return null}function he(D,N,q,K){for(var ve=null,Le=null,de=N,Re=N=0,Pe=null;de!==null&&Re<q.length;Re++){de.index>Re?(Pe=de,de=null):Pe=de.sibling;var we=V(D,de,q[Re],K);if(we===null){de===null&&(de=Pe);break}e&&de&&we.alternate===null&&t(D,de),N=c(we,N,Re),Le===null?ve=we:Le.sibling=we,Le=we,de=Pe}if(Re===q.length)return i(D,de),De&&ua(D,Re),ve;if(de===null){for(;Re<q.length;Re++)de=J(D,q[Re],K),de!==null&&(N=c(de,N,Re),Le===null?ve=de:Le.sibling=de,Le=de);return De&&ua(D,Re),ve}for(de=n(de);Re<q.length;Re++)Pe=H(de,D,Re,q[Re],K),Pe!==null&&(e&&Pe.alternate!==null&&de.delete(Pe.key===null?Re:Pe.key),N=c(Pe,N,Re),Le===null?ve=Pe:Le.sibling=Pe,Le=Pe);return e&&de.forEach(function(Wa){return t(D,Wa)}),De&&ua(D,Re),ve}function be(D,N,q,K){if(q==null)throw Error(s(151));for(var ve=null,Le=null,de=N,Re=N=0,Pe=null,we=q.next();de!==null&&!we.done;Re++,we=q.next()){de.index>Re?(Pe=de,de=null):Pe=de.sibling;var Wa=V(D,de,we.value,K);if(Wa===null){de===null&&(de=Pe);break}e&&de&&Wa.alternate===null&&t(D,de),N=c(Wa,N,Re),Le===null?ve=Wa:Le.sibling=Wa,Le=Wa,de=Pe}if(we.done)return i(D,de),De&&ua(D,Re),ve;if(de===null){for(;!we.done;Re++,we=q.next())we=J(D,we.value,K),we!==null&&(N=c(we,N,Re),Le===null?ve=we:Le.sibling=we,Le=we);return De&&ua(D,Re),ve}for(de=n(de);!we.done;Re++,we=q.next())we=H(de,D,Re,we.value,K),we!==null&&(e&&we.alternate!==null&&de.delete(we.key===null?Re:we.key),N=c(we,N,Re),Le===null?ve=we:Le.sibling=we,Le=we);return e&&de.forEach(function(x0){return t(D,x0)}),De&&ua(D,Re),ve}function He(D,N,q,K){if(typeof q=="object"&&q!==null&&q.type===B&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case j:e:{for(var ve=q.key;N!==null;){if(N.key===ve){if(ve=q.type,ve===B){if(N.tag===7){i(D,N.sibling),K=r(N,q.props.children),K.return=D,D=K;break e}}else if(N.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===L&&di(ve)===N.type){i(D,N.sibling),K=r(N,q.props),Hn(K,q),K.return=D,D=K;break e}i(D,N);break}else t(D,N);N=N.sibling}q.type===B?(K=ci(q.props.children,D.mode,K,q.key),K.return=D,D=K):(K=Xl(q.type,q.key,q.props,null,D.mode,K),Hn(K,q),K.return=D,D=K)}return d(D);case C:e:{for(ve=q.key;N!==null;){if(N.key===ve)if(N.tag===4&&N.stateNode.containerInfo===q.containerInfo&&N.stateNode.implementation===q.implementation){i(D,N.sibling),K=r(N,q.children||[]),K.return=D,D=K;break e}else{i(D,N);break}else t(D,N);N=N.sibling}K=Do(q,D.mode,K),K.return=D,D=K}return d(D);case L:return q=di(q),He(D,N,q,K)}if(ge(q))return he(D,N,q,K);if(qe(q)){if(ve=qe(q),typeof ve!="function")throw Error(s(150));return q=ve.call(q),be(D,N,q,K)}if(typeof q.then=="function")return He(D,N,es(q),K);if(q.$$typeof===I)return He(D,N,Jl(D,q),K);ts(D,q)}return typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint"?(q=""+q,N!==null&&N.tag===6?(i(D,N.sibling),K=r(N,q),K.return=D,D=K):(i(D,N),K=Po(q,D.mode,K),K.return=D,D=K),d(D)):i(D,N)}return function(D,N,q,K){try{Fn=0;var ve=He(D,N,q,K);return Wi=null,ve}catch(de){if(de===$i||de===Wl)throw de;var Le=kt(29,de,null,D.mode);return Le.lanes=K,Le.return=D,Le}finally{}}}var vi=Zu(!0),Ku=Zu(!1),wa=!1;function Qo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Yo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function qa(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function za(e,t,i){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,(ze&2)!==0){var r=n.pending;return r===null?t.next=t:(t.next=r.next,r.next=t),n.pending=t,t=Yl(e),Pu(e,null,i),t}return Ql(e,n,t,i),Yl(e)}function Un(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194048)!==0)){var n=t.lanes;n&=e.pendingLanes,i|=n,t.lanes=i,Ol(e,i)}}function Xo(e,t){var i=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,i===n)){var r=null,c=null;if(i=i.firstBaseUpdate,i!==null){do{var d={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};c===null?r=c=d:c=c.next=d,i=i.next}while(i!==null);c===null?r=c=t:c=c.next=t}else r=c=t;i={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:c,shared:n.shared,callbacks:n.callbacks},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}var Zo=!1;function Qn(){if(Zo){var e=Ji;if(e!==null)throw e}}function Yn(e,t,i,n){Zo=!1;var r=e.updateQueue;wa=!1;var c=r.firstBaseUpdate,d=r.lastBaseUpdate,x=r.shared.pending;if(x!==null){r.shared.pending=null;var A=x,z=A.next;A.next=null,d===null?c=z:d.next=z,d=A;var X=e.alternate;X!==null&&(X=X.updateQueue,x=X.lastBaseUpdate,x!==d&&(x===null?X.firstBaseUpdate=z:x.next=z,X.lastBaseUpdate=A))}if(c!==null){var J=r.baseState;d=0,X=z=A=null,x=c;do{var V=x.lane&-536870913,H=V!==x.lane;if(H?(Oe&V)===V:(n&V)===V){V!==0&&V===Ki&&(Zo=!0),X!==null&&(X=X.next={lane:0,tag:x.tag,payload:x.payload,callback:null,next:null});e:{var he=e,be=x;V=t;var He=i;switch(be.tag){case 1:if(he=be.payload,typeof he=="function"){J=he.call(He,J,V);break e}J=he;break e;case 3:he.flags=he.flags&-65537|128;case 0:if(he=be.payload,V=typeof he=="function"?he.call(He,J,V):he,V==null)break e;J=S({},J,V);break e;case 2:wa=!0}}V=x.callback,V!==null&&(e.flags|=64,H&&(e.flags|=8192),H=r.callbacks,H===null?r.callbacks=[V]:H.push(V))}else H={lane:V,tag:x.tag,payload:x.payload,callback:x.callback,next:null},X===null?(z=X=H,A=J):X=X.next=H,d|=V;if(x=x.next,x===null){if(x=r.shared.pending,x===null)break;H=x,x=H.next,H.next=null,r.lastBaseUpdate=H,r.shared.pending=null}}while(!0);X===null&&(A=J),r.baseState=A,r.firstBaseUpdate=z,r.lastBaseUpdate=X,c===null&&(r.shared.lanes=0),Fa|=d,e.lanes=d,e.memoizedState=J}}function Ju(e,t){if(typeof e!="function")throw Error(s(191,e));e.call(t)}function $u(e,t){var i=e.callbacks;if(i!==null)for(e.callbacks=null,e=0;e<i.length;e++)Ju(i[e],t)}var Ii=E(null),as=E(0);function Wu(e,t){e=Sa,se(as,e),se(Ii,t),Sa=e|t.baseLanes}function Ko(){se(as,Sa),se(Ii,Ii.current)}function Jo(){Sa=as.current,U(Ii),U(as)}var Et=E(null),Vt=null;function Ba(e){var t=e.alternate;se(Je,Je.current&1),se(Et,e),Vt===null&&(t===null||Ii.current!==null||t.memoizedState!==null)&&(Vt=e)}function $o(e){se(Je,Je.current),se(Et,e),Vt===null&&(Vt=e)}function Iu(e){e.tag===22?(se(Je,Je.current),se(Et,e),Vt===null&&(Vt=e)):_a()}function _a(){se(Je,Je.current),se(Et,Et.current)}function jt(e){U(Et),Vt===e&&(Vt=null),U(Je)}var Je=E(0);function is(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||ic(i)||nc(i)))return t}else if(t.tag===19&&(t.memoizedProps.revealOrder==="forwards"||t.memoizedProps.revealOrder==="backwards"||t.memoizedProps.revealOrder==="unstable_legacy-backwards"||t.memoizedProps.revealOrder==="together")){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var pa=0,Ce=null,Ge=null,Ie=null,ns=!1,en=!1,gi=!1,ls=0,Xn=0,tn=null,cf=0;function Ze(){throw Error(s(321))}function Wo(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!At(e[i],t[i]))return!1;return!0}function Io(e,t,i,n,r,c){return pa=c,Ce=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,F.H=e===null||e.memoizedState===null?qm:dr,gi=!1,c=i(n,r),gi=!1,en&&(c=tm(t,i,n,r)),em(e),c}function em(e){F.H=Jn;var t=Ge!==null&&Ge.next!==null;if(pa=0,Ie=Ge=Ce=null,ns=!1,Xn=0,tn=null,t)throw Error(s(300));e===null||et||(e=e.dependencies,e!==null&&Kl(e)&&(et=!0))}function tm(e,t,i,n){Ce=e;var r=0;do{if(en&&(tn=null),Xn=0,en=!1,25<=r)throw Error(s(301));if(r+=1,Ie=Ge=null,e.updateQueue!=null){var c=e.updateQueue;c.lastEffect=null,c.events=null,c.stores=null,c.memoCache!=null&&(c.memoCache.index=0)}F.H=zm,c=t(i,n)}while(en);return c}function uf(){var e=F.H,t=e.useState()[0];return t=typeof t.then=="function"?Zn(t):t,e=e.useState()[0],(Ge!==null?Ge.memoizedState:null)!==e&&(Ce.flags|=1024),t}function er(){var e=ls!==0;return ls=0,e}function tr(e,t,i){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i}function ar(e){if(ns){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}ns=!1}pa=0,Ie=Ge=Ce=null,en=!1,Xn=ls=0,tn=null}function bt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ie===null?Ce.memoizedState=Ie=e:Ie=Ie.next=e,Ie}function $e(){if(Ge===null){var e=Ce.alternate;e=e!==null?e.memoizedState:null}else e=Ge.next;var t=Ie===null?Ce.memoizedState:Ie.next;if(t!==null)Ie=t,Ge=e;else{if(e===null)throw Ce.alternate===null?Error(s(467)):Error(s(310));Ge=e,e={memoizedState:Ge.memoizedState,baseState:Ge.baseState,baseQueue:Ge.baseQueue,queue:Ge.queue,next:null},Ie===null?Ce.memoizedState=Ie=e:Ie=Ie.next=e}return Ie}function ss(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Zn(e){var t=Xn;return Xn+=1,tn===null&&(tn=[]),e=Qu(tn,e,t),t=Ce,(Ie===null?t.memoizedState:Ie.next)===null&&(t=t.alternate,F.H=t===null||t.memoizedState===null?qm:dr),e}function os(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Zn(e);if(e.$$typeof===I)return ct(e)}throw Error(s(438,String(e)))}function ir(e){var t=null,i=Ce.updateQueue;if(i!==null&&(t=i.memoCache),t==null){var n=Ce.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(t={data:n.data.map(function(r){return r.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),i===null&&(i=ss(),Ce.updateQueue=i),i.memoCache=t,i=t.data[t.index],i===void 0)for(i=t.data[t.index]=Array(e),n=0;n<e;n++)i[n]=Me;return t.index++,i}function da(e,t){return typeof t=="function"?t(e):t}function rs(e){var t=$e();return nr(t,Ge,e)}function nr(e,t,i){var n=e.queue;if(n===null)throw Error(s(311));n.lastRenderedReducer=i;var r=e.baseQueue,c=n.pending;if(c!==null){if(r!==null){var d=r.next;r.next=c.next,c.next=d}t.baseQueue=r=c,n.pending=null}if(c=e.baseState,r===null)e.memoizedState=c;else{t=r.next;var x=d=null,A=null,z=t,X=!1;do{var J=z.lane&-536870913;if(J!==z.lane?(Oe&J)===J:(pa&J)===J){var V=z.revertLane;if(V===0)A!==null&&(A=A.next={lane:0,revertLane:0,gesture:null,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null}),J===Ki&&(X=!0);else if((pa&V)===V){z=z.next,V===Ki&&(X=!0);continue}else J={lane:0,revertLane:z.revertLane,gesture:null,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null},A===null?(x=A=J,d=c):A=A.next=J,Ce.lanes|=V,Fa|=V;J=z.action,gi&&i(c,J),c=z.hasEagerState?z.eagerState:i(c,J)}else V={lane:J,revertLane:z.revertLane,gesture:z.gesture,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null},A===null?(x=A=V,d=c):A=A.next=V,Ce.lanes|=J,Fa|=J;z=z.next}while(z!==null&&z!==t);if(A===null?d=c:A.next=x,!At(c,e.memoizedState)&&(et=!0,X&&(i=Ji,i!==null)))throw i;e.memoizedState=c,e.baseState=d,e.baseQueue=A,n.lastRenderedState=c}return r===null&&(n.lanes=0),[e.memoizedState,n.dispatch]}function lr(e){var t=$e(),i=t.queue;if(i===null)throw Error(s(311));i.lastRenderedReducer=e;var n=i.dispatch,r=i.pending,c=t.memoizedState;if(r!==null){i.pending=null;var d=r=r.next;do c=e(c,d.action),d=d.next;while(d!==r);At(c,t.memoizedState)||(et=!0),t.memoizedState=c,t.baseQueue===null&&(t.baseState=c),i.lastRenderedState=c}return[c,n]}function am(e,t,i){var n=Ce,r=$e(),c=De;if(c){if(i===void 0)throw Error(s(407));i=i()}else i=t();var d=!At((Ge||r).memoizedState,i);if(d&&(r.memoizedState=i,et=!0),r=r.queue,rr(lm.bind(null,n,r,e),[e]),r.getSnapshot!==t||d||Ie!==null&&Ie.memoizedState.tag&1){if(n.flags|=2048,an(9,{destroy:void 0},nm.bind(null,n,r,i,t),null),Ue===null)throw Error(s(349));c||(pa&127)!==0||im(n,t,i)}return i}function im(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Ce.updateQueue,t===null?(t=ss(),Ce.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function nm(e,t,i,n){t.value=i,t.getSnapshot=n,sm(t)&&om(e)}function lm(e,t,i){return i(function(){sm(t)&&om(e)})}function sm(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!At(e,i)}catch{return!0}}function om(e){var t=ri(e,2);t!==null&&Ct(t,e,2)}function sr(e){var t=bt();if(typeof e=="function"){var i=e;if(e=i(),gi){Jt(!0);try{i()}finally{Jt(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:da,lastRenderedState:e},t}function rm(e,t,i,n){return e.baseState=i,nr(e,Ge,typeof n=="function"?n:da)}function mf(e,t,i,n,r){if(ms(e))throw Error(s(485));if(e=t.action,e!==null){var c={payload:r,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(d){c.listeners.push(d)}};F.T!==null?i(!0):c.isTransition=!1,n(c),i=t.pending,i===null?(c.next=t.pending=c,cm(t,c)):(c.next=i.next,t.pending=i.next=c)}}function cm(e,t){var i=t.action,n=t.payload,r=e.state;if(t.isTransition){var c=F.T,d={};F.T=d;try{var x=i(r,n),A=F.S;A!==null&&A(d,x),um(e,t,x)}catch(z){or(e,t,z)}finally{c!==null&&d.types!==null&&(c.types=d.types),F.T=c}}else try{c=i(r,n),um(e,t,c)}catch(z){or(e,t,z)}}function um(e,t,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(n){mm(e,t,n)},function(n){return or(e,t,n)}):mm(e,t,i)}function mm(e,t,i){t.status="fulfilled",t.value=i,hm(t),e.state=i,t=e.pending,t!==null&&(i=t.next,i===t?e.pending=null:(i=i.next,t.next=i,cm(e,i)))}function or(e,t,i){var n=e.pending;if(e.pending=null,n!==null){n=n.next;do t.status="rejected",t.reason=i,hm(t),t=t.next;while(t!==n)}e.action=null}function hm(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function pm(e,t){return t}function dm(e,t){if(De){var i=Ue.formState;if(i!==null){e:{var n=Ce;if(De){if(Qe){t:{for(var r=Qe,c=_t;r.nodeType!==8;){if(!c){r=null;break t}if(r=Gt(r.nextSibling),r===null){r=null;break t}}c=r.data,r=c==="F!"||c==="F"?r:null}if(r){Qe=Gt(r.nextSibling),n=r.data==="F!";break e}}Da(n)}n=!1}n&&(t=i[0])}}return i=bt(),i.memoizedState=i.baseState=t,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pm,lastRenderedState:t},i.queue=n,i=Dm.bind(null,Ce,n),n.dispatch=i,n=sr(!1),c=pr.bind(null,Ce,!1,n.queue),n=bt(),r={state:t,dispatch:null,action:e,pending:null},n.queue=r,i=mf.bind(null,Ce,r,c,i),r.dispatch=i,n.memoizedState=e,[t,i,!1]}function fm(e){var t=$e();return vm(t,Ge,e)}function vm(e,t,i){if(t=nr(e,t,pm)[0],e=rs(da)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var n=Zn(t)}catch(d){throw d===$i?Wl:d}else n=t;t=$e();var r=t.queue,c=r.dispatch;return i!==t.memoizedState&&(Ce.flags|=2048,an(9,{destroy:void 0},hf.bind(null,r,i),null)),[n,c,e]}function hf(e,t){e.action=t}function gm(e){var t=$e(),i=Ge;if(i!==null)return vm(t,i,e);$e(),t=t.memoizedState,i=$e();var n=i.queue.dispatch;return i.memoizedState=e,[t,n,!1]}function an(e,t,i,n){return e={tag:e,create:i,deps:n,inst:t,next:null},t=Ce.updateQueue,t===null&&(t=ss(),Ce.updateQueue=t),i=t.lastEffect,i===null?t.lastEffect=e.next=e:(n=i.next,i.next=e,e.next=n,t.lastEffect=e),e}function bm(){return $e().memoizedState}function cs(e,t,i,n){var r=bt();Ce.flags|=e,r.memoizedState=an(1|t,{destroy:void 0},i,n===void 0?null:n)}function us(e,t,i,n){var r=$e();n=n===void 0?null:n;var c=r.memoizedState.inst;Ge!==null&&n!==null&&Wo(n,Ge.memoizedState.deps)?r.memoizedState=an(t,c,i,n):(Ce.flags|=e,r.memoizedState=an(1|t,c,i,n))}function xm(e,t){cs(8390656,8,e,t)}function rr(e,t){us(2048,8,e,t)}function pf(e){Ce.flags|=4;var t=Ce.updateQueue;if(t===null)t=ss(),Ce.updateQueue=t,t.events=[e];else{var i=t.events;i===null?t.events=[e]:i.push(e)}}function ym(e){var t=$e().memoizedState;return pf({ref:t,nextImpl:e}),function(){if((ze&2)!==0)throw Error(s(440));return t.impl.apply(void 0,arguments)}}function Sm(e,t){return us(4,2,e,t)}function Mm(e,t){return us(4,4,e,t)}function Tm(e,t){if(typeof t=="function"){e=e();var i=t(e);return function(){typeof i=="function"?i():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Cm(e,t,i){i=i!=null?i.concat([e]):null,us(4,4,Tm.bind(null,t,e),i)}function cr(){}function Rm(e,t){var i=$e();t=t===void 0?null:t;var n=i.memoizedState;return t!==null&&Wo(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function Am(e,t){var i=$e();t=t===void 0?null:t;var n=i.memoizedState;if(t!==null&&Wo(t,n[1]))return n[0];if(n=e(),gi){Jt(!0);try{e()}finally{Jt(!1)}}return i.memoizedState=[n,t],n}function ur(e,t,i){return i===void 0||(pa&1073741824)!==0&&(Oe&261930)===0?e.memoizedState=t:(e.memoizedState=i,e=kh(),Ce.lanes|=e,Fa|=e,i)}function km(e,t,i,n){return At(i,t)?i:Ii.current!==null?(e=ur(e,i,n),At(e,t)||(et=!0),e):(pa&42)===0||(pa&1073741824)!==0&&(Oe&261930)===0?(et=!0,e.memoizedState=i):(e=kh(),Ce.lanes|=e,Fa|=e,t)}function Em(e,t,i,n,r){var c=$.p;$.p=c!==0&&8>c?c:8;var d=F.T,x={};F.T=x,pr(e,!1,t,i);try{var A=r(),z=F.S;if(z!==null&&z(x,A),A!==null&&typeof A=="object"&&typeof A.then=="function"){var X=rf(A,n);Kn(e,t,X,Pt(e))}else Kn(e,t,n,Pt(e))}catch(J){Kn(e,t,{then:function(){},status:"rejected",reason:J},Pt())}finally{$.p=c,d!==null&&x.types!==null&&(d.types=x.types),F.T=d}}function df(){}function mr(e,t,i,n){if(e.tag!==5)throw Error(s(476));var r=jm(e).queue;Em(e,r,t,le,i===null?df:function(){return Nm(e),i(n)})}function jm(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:le,baseState:le,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:da,lastRenderedState:le},next:null};var i={};return t.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:da,lastRenderedState:i},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function Nm(e){var t=jm(e);t.next===null&&(t=e.alternate.memoizedState),Kn(e,t.next.queue,{},Pt())}function hr(){return ct(hl)}function Om(){return $e().memoizedState}function Pm(){return $e().memoizedState}function ff(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var i=Pt();e=qa(i);var n=za(t,e,i);n!==null&&(Ct(n,t,i),Un(n,t,i)),t={cache:Go()},e.payload=t;return}t=t.return}}function vf(e,t,i){var n=Pt();i={lane:n,revertLane:0,gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null},ms(e)?Lm(t,i):(i=No(e,t,i,n),i!==null&&(Ct(i,e,n),wm(i,t,n)))}function Dm(e,t,i){var n=Pt();Kn(e,t,i,n)}function Kn(e,t,i,n){var r={lane:n,revertLane:0,gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null};if(ms(e))Lm(t,r);else{var c=e.alternate;if(e.lanes===0&&(c===null||c.lanes===0)&&(c=t.lastRenderedReducer,c!==null))try{var d=t.lastRenderedState,x=c(d,i);if(r.hasEagerState=!0,r.eagerState=x,At(x,d))return Ql(e,t,r,0),Ue===null&&Ul(),!1}catch{}finally{}if(i=No(e,t,r,n),i!==null)return Ct(i,e,n),wm(i,t,n),!0}return!1}function pr(e,t,i,n){if(n={lane:2,revertLane:Qr(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},ms(e)){if(t)throw Error(s(479))}else t=No(e,i,n,2),t!==null&&Ct(t,e,2)}function ms(e){var t=e.alternate;return e===Ce||t!==null&&t===Ce}function Lm(e,t){en=ns=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function wm(e,t,i){if((i&4194048)!==0){var n=t.lanes;n&=e.pendingLanes,i|=n,t.lanes=i,Ol(e,i)}}var Jn={readContext:ct,use:os,useCallback:Ze,useContext:Ze,useEffect:Ze,useImperativeHandle:Ze,useLayoutEffect:Ze,useInsertionEffect:Ze,useMemo:Ze,useReducer:Ze,useRef:Ze,useState:Ze,useDebugValue:Ze,useDeferredValue:Ze,useTransition:Ze,useSyncExternalStore:Ze,useId:Ze,useHostTransitionStatus:Ze,useFormState:Ze,useActionState:Ze,useOptimistic:Ze,useMemoCache:Ze,useCacheRefresh:Ze};Jn.useEffectEvent=Ze;var qm={readContext:ct,use:os,useCallback:function(e,t){return bt().memoizedState=[e,t===void 0?null:t],e},useContext:ct,useEffect:xm,useImperativeHandle:function(e,t,i){i=i!=null?i.concat([e]):null,cs(4194308,4,Tm.bind(null,t,e),i)},useLayoutEffect:function(e,t){return cs(4194308,4,e,t)},useInsertionEffect:function(e,t){cs(4,2,e,t)},useMemo:function(e,t){var i=bt();t=t===void 0?null:t;var n=e();if(gi){Jt(!0);try{e()}finally{Jt(!1)}}return i.memoizedState=[n,t],n},useReducer:function(e,t,i){var n=bt();if(i!==void 0){var r=i(t);if(gi){Jt(!0);try{i(t)}finally{Jt(!1)}}}else r=t;return n.memoizedState=n.baseState=r,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r},n.queue=e,e=e.dispatch=vf.bind(null,Ce,e),[n.memoizedState,e]},useRef:function(e){var t=bt();return e={current:e},t.memoizedState=e},useState:function(e){e=sr(e);var t=e.queue,i=Dm.bind(null,Ce,t);return t.dispatch=i,[e.memoizedState,i]},useDebugValue:cr,useDeferredValue:function(e,t){var i=bt();return ur(i,e,t)},useTransition:function(){var e=sr(!1);return e=Em.bind(null,Ce,e.queue,!0,!1),bt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,i){var n=Ce,r=bt();if(De){if(i===void 0)throw Error(s(407));i=i()}else{if(i=t(),Ue===null)throw Error(s(349));(Oe&127)!==0||im(n,t,i)}r.memoizedState=i;var c={value:i,getSnapshot:t};return r.queue=c,xm(lm.bind(null,n,c,e),[e]),n.flags|=2048,an(9,{destroy:void 0},nm.bind(null,n,c,i,t),null),i},useId:function(){var e=bt(),t=Ue.identifierPrefix;if(De){var i=Wt,n=$t;i=(n&~(1<<32-gt(n)-1)).toString(32)+i,t="_"+t+"R_"+i,i=ls++,0<i&&(t+="H"+i.toString(32)),t+="_"}else i=cf++,t="_"+t+"r_"+i.toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:hr,useFormState:dm,useActionState:dm,useOptimistic:function(e){var t=bt();t.memoizedState=t.baseState=e;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=i,t=pr.bind(null,Ce,!0,i),i.dispatch=t,[e,t]},useMemoCache:ir,useCacheRefresh:function(){return bt().memoizedState=ff.bind(null,Ce)},useEffectEvent:function(e){var t=bt(),i={impl:e};return t.memoizedState=i,function(){if((ze&2)!==0)throw Error(s(440));return i.impl.apply(void 0,arguments)}}},dr={readContext:ct,use:os,useCallback:Rm,useContext:ct,useEffect:rr,useImperativeHandle:Cm,useInsertionEffect:Sm,useLayoutEffect:Mm,useMemo:Am,useReducer:rs,useRef:bm,useState:function(){return rs(da)},useDebugValue:cr,useDeferredValue:function(e,t){var i=$e();return km(i,Ge.memoizedState,e,t)},useTransition:function(){var e=rs(da)[0],t=$e().memoizedState;return[typeof e=="boolean"?e:Zn(e),t]},useSyncExternalStore:am,useId:Om,useHostTransitionStatus:hr,useFormState:fm,useActionState:fm,useOptimistic:function(e,t){var i=$e();return rm(i,Ge,e,t)},useMemoCache:ir,useCacheRefresh:Pm};dr.useEffectEvent=ym;var zm={readContext:ct,use:os,useCallback:Rm,useContext:ct,useEffect:rr,useImperativeHandle:Cm,useInsertionEffect:Sm,useLayoutEffect:Mm,useMemo:Am,useReducer:lr,useRef:bm,useState:function(){return lr(da)},useDebugValue:cr,useDeferredValue:function(e,t){var i=$e();return Ge===null?ur(i,e,t):km(i,Ge.memoizedState,e,t)},useTransition:function(){var e=lr(da)[0],t=$e().memoizedState;return[typeof e=="boolean"?e:Zn(e),t]},useSyncExternalStore:am,useId:Om,useHostTransitionStatus:hr,useFormState:gm,useActionState:gm,useOptimistic:function(e,t){var i=$e();return Ge!==null?rm(i,Ge,e,t):(i.baseState=e,[e,i.queue.dispatch])},useMemoCache:ir,useCacheRefresh:Pm};zm.useEffectEvent=ym;function fr(e,t,i,n){t=e.memoizedState,i=i(n,t),i=i==null?t:S({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var vr={enqueueSetState:function(e,t,i){e=e._reactInternals;var n=Pt(),r=qa(n);r.payload=t,i!=null&&(r.callback=i),t=za(e,r,n),t!==null&&(Ct(t,e,n),Un(t,e,n))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var n=Pt(),r=qa(n);r.tag=1,r.payload=t,i!=null&&(r.callback=i),t=za(e,r,n),t!==null&&(Ct(t,e,n),Un(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=Pt(),n=qa(i);n.tag=2,t!=null&&(n.callback=t),t=za(e,n,i),t!==null&&(Ct(t,e,i),Un(t,e,i))}};function Bm(e,t,i,n,r,c,d){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,c,d):t.prototype&&t.prototype.isPureReactComponent?!qn(i,n)||!qn(r,c):!0}function _m(e,t,i,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&vr.enqueueReplaceState(t,t.state,null)}function bi(e,t){var i=t;if("ref"in t){i={};for(var n in t)n!=="ref"&&(i[n]=t[n])}if(e=e.defaultProps){i===t&&(i=S({},i));for(var r in e)i[r]===void 0&&(i[r]=e[r])}return i}function Vm(e){Hl(e)}function Gm(e){console.error(e)}function Fm(e){Hl(e)}function hs(e,t){try{var i=e.onUncaughtError;i(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Hm(e,t,i){try{var n=e.onCaughtError;n(i.value,{componentStack:i.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function gr(e,t,i){return i=qa(i),i.tag=3,i.payload={element:null},i.callback=function(){hs(e,t)},i}function Um(e){return e=qa(e),e.tag=3,e}function Qm(e,t,i,n){var r=i.type.getDerivedStateFromError;if(typeof r=="function"){var c=n.value;e.payload=function(){return r(c)},e.callback=function(){Hm(t,i,n)}}var d=i.stateNode;d!==null&&typeof d.componentDidCatch=="function"&&(e.callback=function(){Hm(t,i,n),typeof r!="function"&&(Ha===null?Ha=new Set([this]):Ha.add(this));var x=n.stack;this.componentDidCatch(n.value,{componentStack:x!==null?x:""})})}function gf(e,t,i,n,r){if(i.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(t=i.alternate,t!==null&&Zi(t,i,r,!0),i=Et.current,i!==null){switch(i.tag){case 31:case 13:return Vt===null?Cs():i.alternate===null&&Ke===0&&(Ke=3),i.flags&=-257,i.flags|=65536,i.lanes=r,n===Il?i.flags|=16384:(t=i.updateQueue,t===null?i.updateQueue=new Set([n]):t.add(n),Fr(e,n,r)),!1;case 22:return i.flags|=65536,n===Il?i.flags|=16384:(t=i.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([n])},i.updateQueue=t):(i=t.retryQueue,i===null?t.retryQueue=new Set([n]):i.add(n)),Fr(e,n,r)),!1}throw Error(s(435,i.tag))}return Fr(e,n,r),Cs(),!1}if(De)return t=Et.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=r,n!==qo&&(e=Error(s(422),{cause:n}),_n(qt(e,i)))):(n!==qo&&(t=Error(s(423),{cause:n}),_n(qt(t,i))),e=e.current.alternate,e.flags|=65536,r&=-r,e.lanes|=r,n=qt(n,i),r=gr(e.stateNode,n,r),Xo(e,r),Ke!==4&&(Ke=2)),!1;var c=Error(s(520),{cause:n});if(c=qt(c,i),nl===null?nl=[c]:nl.push(c),Ke!==4&&(Ke=2),t===null)return!0;n=qt(n,i),i=t;do{switch(i.tag){case 3:return i.flags|=65536,e=r&-r,i.lanes|=e,e=gr(i.stateNode,n,e),Xo(i,e),!1;case 1:if(t=i.type,c=i.stateNode,(i.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||c!==null&&typeof c.componentDidCatch=="function"&&(Ha===null||!Ha.has(c))))return i.flags|=65536,r&=-r,i.lanes|=r,r=Um(r),Qm(r,e,i,n),Xo(i,r),!1}i=i.return}while(i!==null);return!1}var br=Error(s(461)),et=!1;function ut(e,t,i,n){t.child=e===null?Ku(t,null,i,n):vi(t,e.child,i,n)}function Ym(e,t,i,n,r){i=i.render;var c=t.ref;if("ref"in n){var d={};for(var x in n)x!=="ref"&&(d[x]=n[x])}else d=n;return hi(t),n=Io(e,t,i,d,c,r),x=er(),e!==null&&!et?(tr(e,t,r),fa(e,t,r)):(De&&x&&Lo(t),t.flags|=1,ut(e,t,n,r),t.child)}function Xm(e,t,i,n,r){if(e===null){var c=i.type;return typeof c=="function"&&!Oo(c)&&c.defaultProps===void 0&&i.compare===null?(t.tag=15,t.type=c,Zm(e,t,c,n,r)):(e=Xl(i.type,null,n,t,t.mode,r),e.ref=t.ref,e.return=t,t.child=e)}if(c=e.child,!Ar(e,r)){var d=c.memoizedProps;if(i=i.compare,i=i!==null?i:qn,i(d,n)&&e.ref===t.ref)return fa(e,t,r)}return t.flags|=1,e=ca(c,n),e.ref=t.ref,e.return=t,t.child=e}function Zm(e,t,i,n,r){if(e!==null){var c=e.memoizedProps;if(qn(c,n)&&e.ref===t.ref)if(et=!1,t.pendingProps=n=c,Ar(e,r))(e.flags&131072)!==0&&(et=!0);else return t.lanes=e.lanes,fa(e,t,r)}return xr(e,t,i,n,r)}function Km(e,t,i,n){var r=n.children,c=e!==null?e.memoizedState:null;if(e===null&&t.stateNode===null&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.mode==="hidden"){if((t.flags&128)!==0){if(c=c!==null?c.baseLanes|i:i,e!==null){for(n=t.child=e.child,r=0;n!==null;)r=r|n.lanes|n.childLanes,n=n.sibling;n=r&~c}else n=0,t.child=null;return Jm(e,t,c,i,n)}if((i&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&$l(t,c!==null?c.cachePool:null),c!==null?Wu(t,c):Ko(),Iu(t);else return n=t.lanes=536870912,Jm(e,t,c!==null?c.baseLanes|i:i,i,n)}else c!==null?($l(t,c.cachePool),Wu(t,c),_a(),t.memoizedState=null):(e!==null&&$l(t,null),Ko(),_a());return ut(e,t,r,i),t.child}function $n(e,t){return e!==null&&e.tag===22||t.stateNode!==null||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Jm(e,t,i,n,r){var c=Ho();return c=c===null?null:{parent:We._currentValue,pool:c},t.memoizedState={baseLanes:i,cachePool:c},e!==null&&$l(t,null),Ko(),Iu(t),e!==null&&Zi(e,t,n,!0),t.childLanes=r,null}function ps(e,t){return t=fs({mode:t.mode,children:t.children},e.mode),t.ref=e.ref,e.child=t,t.return=e,t}function $m(e,t,i){return vi(t,e.child,null,i),e=ps(t,t.pendingProps),e.flags|=2,jt(t),t.memoizedState=null,e}function bf(e,t,i){var n=t.pendingProps,r=(t.flags&128)!==0;if(t.flags&=-129,e===null){if(De){if(n.mode==="hidden")return e=ps(t,n),t.lanes=536870912,$n(null,e);if($o(t),(e=Qe)?(e=cp(e,_t),e=e!==null&&e.data==="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:Oa!==null?{id:$t,overflow:Wt}:null,retryLane:536870912,hydrationErrors:null},i=Lu(e),i.return=t,t.child=i,rt=t,Qe=null)):e=null,e===null)throw Da(t);return t.lanes=536870912,null}return ps(t,n)}var c=e.memoizedState;if(c!==null){var d=c.dehydrated;if($o(t),r)if(t.flags&256)t.flags&=-257,t=$m(e,t,i);else if(t.memoizedState!==null)t.child=e.child,t.flags|=128,t=null;else throw Error(s(558));else if(et||Zi(e,t,i,!1),r=(i&e.childLanes)!==0,et||r){if(n=Ue,n!==null&&(d=Pl(n,i),d!==0&&d!==c.retryLane))throw c.retryLane=d,ri(e,d),Ct(n,e,d),br;Cs(),t=$m(e,t,i)}else e=c.treeContext,Qe=Gt(d.nextSibling),rt=t,De=!0,Pa=null,_t=!1,e!==null&&zu(t,e),t=ps(t,n),t.flags|=4096;return t}return e=ca(e.child,{mode:n.mode,children:n.children}),e.ref=t.ref,t.child=e,e.return=t,e}function ds(e,t){var i=t.ref;if(i===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(s(284));(e===null||e.ref!==i)&&(t.flags|=4194816)}}function xr(e,t,i,n,r){return hi(t),i=Io(e,t,i,n,void 0,r),n=er(),e!==null&&!et?(tr(e,t,r),fa(e,t,r)):(De&&n&&Lo(t),t.flags|=1,ut(e,t,i,r),t.child)}function Wm(e,t,i,n,r,c){return hi(t),t.updateQueue=null,i=tm(t,n,i,r),em(e),n=er(),e!==null&&!et?(tr(e,t,c),fa(e,t,c)):(De&&n&&Lo(t),t.flags|=1,ut(e,t,i,c),t.child)}function Im(e,t,i,n,r){if(hi(t),t.stateNode===null){var c=Ui,d=i.contextType;typeof d=="object"&&d!==null&&(c=ct(d)),c=new i(n,c),t.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,c.updater=vr,t.stateNode=c,c._reactInternals=t,c=t.stateNode,c.props=n,c.state=t.memoizedState,c.refs={},Qo(t),d=i.contextType,c.context=typeof d=="object"&&d!==null?ct(d):Ui,c.state=t.memoizedState,d=i.getDerivedStateFromProps,typeof d=="function"&&(fr(t,i,d,n),c.state=t.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(d=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),d!==c.state&&vr.enqueueReplaceState(c,c.state,null),Yn(t,n,c,r),Qn(),c.state=t.memoizedState),typeof c.componentDidMount=="function"&&(t.flags|=4194308),n=!0}else if(e===null){c=t.stateNode;var x=t.memoizedProps,A=bi(i,x);c.props=A;var z=c.context,X=i.contextType;d=Ui,typeof X=="object"&&X!==null&&(d=ct(X));var J=i.getDerivedStateFromProps;X=typeof J=="function"||typeof c.getSnapshotBeforeUpdate=="function",x=t.pendingProps!==x,X||typeof c.UNSAFE_componentWillReceiveProps!="function"&&typeof c.componentWillReceiveProps!="function"||(x||z!==d)&&_m(t,c,n,d),wa=!1;var V=t.memoizedState;c.state=V,Yn(t,n,c,r),Qn(),z=t.memoizedState,x||V!==z||wa?(typeof J=="function"&&(fr(t,i,J,n),z=t.memoizedState),(A=wa||Bm(t,i,A,n,V,z,d))?(X||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount()),typeof c.componentDidMount=="function"&&(t.flags|=4194308)):(typeof c.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=z),c.props=n,c.state=z,c.context=d,n=A):(typeof c.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{c=t.stateNode,Yo(e,t),d=t.memoizedProps,X=bi(i,d),c.props=X,J=t.pendingProps,V=c.context,z=i.contextType,A=Ui,typeof z=="object"&&z!==null&&(A=ct(z)),x=i.getDerivedStateFromProps,(z=typeof x=="function"||typeof c.getSnapshotBeforeUpdate=="function")||typeof c.UNSAFE_componentWillReceiveProps!="function"&&typeof c.componentWillReceiveProps!="function"||(d!==J||V!==A)&&_m(t,c,n,A),wa=!1,V=t.memoizedState,c.state=V,Yn(t,n,c,r),Qn();var H=t.memoizedState;d!==J||V!==H||wa||e!==null&&e.dependencies!==null&&Kl(e.dependencies)?(typeof x=="function"&&(fr(t,i,x,n),H=t.memoizedState),(X=wa||Bm(t,i,X,n,V,H,A)||e!==null&&e.dependencies!==null&&Kl(e.dependencies))?(z||typeof c.UNSAFE_componentWillUpdate!="function"&&typeof c.componentWillUpdate!="function"||(typeof c.componentWillUpdate=="function"&&c.componentWillUpdate(n,H,A),typeof c.UNSAFE_componentWillUpdate=="function"&&c.UNSAFE_componentWillUpdate(n,H,A)),typeof c.componentDidUpdate=="function"&&(t.flags|=4),typeof c.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof c.componentDidUpdate!="function"||d===e.memoizedProps&&V===e.memoizedState||(t.flags|=4),typeof c.getSnapshotBeforeUpdate!="function"||d===e.memoizedProps&&V===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=H),c.props=n,c.state=H,c.context=A,n=X):(typeof c.componentDidUpdate!="function"||d===e.memoizedProps&&V===e.memoizedState||(t.flags|=4),typeof c.getSnapshotBeforeUpdate!="function"||d===e.memoizedProps&&V===e.memoizedState||(t.flags|=1024),n=!1)}return c=n,ds(e,t),n=(t.flags&128)!==0,c||n?(c=t.stateNode,i=n&&typeof i.getDerivedStateFromError!="function"?null:c.render(),t.flags|=1,e!==null&&n?(t.child=vi(t,e.child,null,r),t.child=vi(t,null,i,r)):ut(e,t,i,r),t.memoizedState=c.state,e=t.child):e=fa(e,t,r),e}function eh(e,t,i,n){return ui(),t.flags|=256,ut(e,t,i,n),t.child}var yr={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Sr(e){return{baseLanes:e,cachePool:Hu()}}function Mr(e,t,i){return e=e!==null?e.childLanes&~i:0,t&&(e|=Ot),e}function th(e,t,i){var n=t.pendingProps,r=!1,c=(t.flags&128)!==0,d;if((d=c)||(d=e!==null&&e.memoizedState===null?!1:(Je.current&2)!==0),d&&(r=!0,t.flags&=-129),d=(t.flags&32)!==0,t.flags&=-33,e===null){if(De){if(r?Ba(t):_a(),(e=Qe)?(e=cp(e,_t),e=e!==null&&e.data!=="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:Oa!==null?{id:$t,overflow:Wt}:null,retryLane:536870912,hydrationErrors:null},i=Lu(e),i.return=t,t.child=i,rt=t,Qe=null)):e=null,e===null)throw Da(t);return nc(e)?t.lanes=32:t.lanes=536870912,null}var x=n.children;return n=n.fallback,r?(_a(),r=t.mode,x=fs({mode:"hidden",children:x},r),n=ci(n,r,i,null),x.return=t,n.return=t,x.sibling=n,t.child=x,n=t.child,n.memoizedState=Sr(i),n.childLanes=Mr(e,d,i),t.memoizedState=yr,$n(null,n)):(Ba(t),Tr(t,x))}var A=e.memoizedState;if(A!==null&&(x=A.dehydrated,x!==null)){if(c)t.flags&256?(Ba(t),t.flags&=-257,t=Cr(e,t,i)):t.memoizedState!==null?(_a(),t.child=e.child,t.flags|=128,t=null):(_a(),x=n.fallback,r=t.mode,n=fs({mode:"visible",children:n.children},r),x=ci(x,r,i,null),x.flags|=2,n.return=t,x.return=t,n.sibling=x,t.child=n,vi(t,e.child,null,i),n=t.child,n.memoizedState=Sr(i),n.childLanes=Mr(e,d,i),t.memoizedState=yr,t=$n(null,n));else if(Ba(t),nc(x)){if(d=x.nextSibling&&x.nextSibling.dataset,d)var z=d.dgst;d=z,n=Error(s(419)),n.stack="",n.digest=d,_n({value:n,source:null,stack:null}),t=Cr(e,t,i)}else if(et||Zi(e,t,i,!1),d=(i&e.childLanes)!==0,et||d){if(d=Ue,d!==null&&(n=Pl(d,i),n!==0&&n!==A.retryLane))throw A.retryLane=n,ri(e,n),Ct(d,e,n),br;ic(x)||Cs(),t=Cr(e,t,i)}else ic(x)?(t.flags|=192,t.child=e.child,t=null):(e=A.treeContext,Qe=Gt(x.nextSibling),rt=t,De=!0,Pa=null,_t=!1,e!==null&&zu(t,e),t=Tr(t,n.children),t.flags|=4096);return t}return r?(_a(),x=n.fallback,r=t.mode,A=e.child,z=A.sibling,n=ca(A,{mode:"hidden",children:n.children}),n.subtreeFlags=A.subtreeFlags&65011712,z!==null?x=ca(z,x):(x=ci(x,r,i,null),x.flags|=2),x.return=t,n.return=t,n.sibling=x,t.child=n,$n(null,n),n=t.child,x=e.child.memoizedState,x===null?x=Sr(i):(r=x.cachePool,r!==null?(A=We._currentValue,r=r.parent!==A?{parent:A,pool:A}:r):r=Hu(),x={baseLanes:x.baseLanes|i,cachePool:r}),n.memoizedState=x,n.childLanes=Mr(e,d,i),t.memoizedState=yr,$n(e.child,n)):(Ba(t),i=e.child,e=i.sibling,i=ca(i,{mode:"visible",children:n.children}),i.return=t,i.sibling=null,e!==null&&(d=t.deletions,d===null?(t.deletions=[e],t.flags|=16):d.push(e)),t.child=i,t.memoizedState=null,i)}function Tr(e,t){return t=fs({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function fs(e,t){return e=kt(22,e,null,t),e.lanes=0,e}function Cr(e,t,i){return vi(t,e.child,null,i),e=Tr(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function ah(e,t,i){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),_o(e.return,t,i)}function Rr(e,t,i,n,r,c){var d=e.memoizedState;d===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:r,treeForkCount:c}:(d.isBackwards=t,d.rendering=null,d.renderingStartTime=0,d.last=n,d.tail=i,d.tailMode=r,d.treeForkCount=c)}function ih(e,t,i){var n=t.pendingProps,r=n.revealOrder,c=n.tail;n=n.children;var d=Je.current,x=(d&2)!==0;if(x?(d=d&1|2,t.flags|=128):d&=1,se(Je,d),ut(e,t,n,i),n=De?Bn:0,!x&&e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&ah(e,i,t);else if(e.tag===19)ah(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(r){case"forwards":for(i=t.child,r=null;i!==null;)e=i.alternate,e!==null&&is(e)===null&&(r=i),i=i.sibling;i=r,i===null?(r=t.child,t.child=null):(r=i.sibling,i.sibling=null),Rr(t,!1,r,i,c,n);break;case"backwards":case"unstable_legacy-backwards":for(i=null,r=t.child,t.child=null;r!==null;){if(e=r.alternate,e!==null&&is(e)===null){t.child=r;break}e=r.sibling,r.sibling=i,i=r,r=e}Rr(t,!0,i,null,c,n);break;case"together":Rr(t,!1,null,null,void 0,n);break;default:t.memoizedState=null}return t.child}function fa(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),Fa|=t.lanes,(i&t.childLanes)===0)if(e!==null){if(Zi(e,t,i,!1),(i&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(s(153));if(t.child!==null){for(e=t.child,i=ca(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=ca(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function Ar(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&Kl(e)))}function xf(e,t,i){switch(t.tag){case 3:ue(t,t.stateNode.containerInfo),La(t,We,e.memoizedState.cache),ui();break;case 27:case 5:Rt(t);break;case 4:ue(t,t.stateNode.containerInfo);break;case 10:La(t,t.type,t.memoizedProps.value);break;case 31:if(t.memoizedState!==null)return t.flags|=128,$o(t),null;break;case 13:var n=t.memoizedState;if(n!==null)return n.dehydrated!==null?(Ba(t),t.flags|=128,null):(i&t.child.childLanes)!==0?th(e,t,i):(Ba(t),e=fa(e,t,i),e!==null?e.sibling:null);Ba(t);break;case 19:var r=(e.flags&128)!==0;if(n=(i&t.childLanes)!==0,n||(Zi(e,t,i,!1),n=(i&t.childLanes)!==0),r){if(n)return ih(e,t,i);t.flags|=128}if(r=t.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),se(Je,Je.current),n)break;return null;case 22:return t.lanes=0,Km(e,t,i,t.pendingProps);case 24:La(t,We,e.memoizedState.cache)}return fa(e,t,i)}function nh(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps)et=!0;else{if(!Ar(e,i)&&(t.flags&128)===0)return et=!1,xf(e,t,i);et=(e.flags&131072)!==0}else et=!1,De&&(t.flags&1048576)!==0&&qu(t,Bn,t.index);switch(t.lanes=0,t.tag){case 16:e:{var n=t.pendingProps;if(e=di(t.elementType),t.type=e,typeof e=="function")Oo(e)?(n=bi(e,n),t.tag=1,t=Im(null,t,e,n,i)):(t.tag=0,t=xr(null,t,e,n,i));else{if(e!=null){var r=e.$$typeof;if(r===Y){t.tag=11,t=Ym(null,t,e,n,i);break e}else if(r===w){t.tag=14,t=Xm(null,t,e,n,i);break e}}throw t=ee(e)||e,Error(s(306,t,""))}}return t;case 0:return xr(e,t,t.type,t.pendingProps,i);case 1:return n=t.type,r=bi(n,t.pendingProps),Im(e,t,n,r,i);case 3:e:{if(ue(t,t.stateNode.containerInfo),e===null)throw Error(s(387));n=t.pendingProps;var c=t.memoizedState;r=c.element,Yo(e,t),Yn(t,n,null,i);var d=t.memoizedState;if(n=d.cache,La(t,We,n),n!==c.cache&&Vo(t,[We],i,!0),Qn(),n=d.element,c.isDehydrated)if(c={element:n,isDehydrated:!1,cache:d.cache},t.updateQueue.baseState=c,t.memoizedState=c,t.flags&256){t=eh(e,t,n,i);break e}else if(n!==r){r=qt(Error(s(424)),t),_n(r),t=eh(e,t,n,i);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(Qe=Gt(e.firstChild),rt=t,De=!0,Pa=null,_t=!0,i=Ku(t,null,n,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling}else{if(ui(),n===r){t=fa(e,t,i);break e}ut(e,t,n,i)}t=t.child}return t;case 26:return ds(e,t),e===null?(i=fp(t.type,null,t.pendingProps,null))?t.memoizedState=i:De||(i=t.type,e=t.pendingProps,n=Os(ae.current).createElement(i),n[Se]=t,n[Ne]=e,mt(n,i,e),lt(n),t.stateNode=n):t.memoizedState=fp(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Rt(t),e===null&&De&&(n=t.stateNode=hp(t.type,t.pendingProps,ae.current),rt=t,_t=!0,r=Qe,Xa(t.type)?(lc=r,Qe=Gt(n.firstChild)):Qe=r),ut(e,t,t.pendingProps.children,i),ds(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&De&&((r=n=Qe)&&(n=Kf(n,t.type,t.pendingProps,_t),n!==null?(t.stateNode=n,rt=t,Qe=Gt(n.firstChild),_t=!1,r=!0):r=!1),r||Da(t)),Rt(t),r=t.type,c=t.pendingProps,d=e!==null?e.memoizedProps:null,n=c.children,ec(r,c)?n=null:d!==null&&ec(r,d)&&(t.flags|=32),t.memoizedState!==null&&(r=Io(e,t,uf,null,null,i),hl._currentValue=r),ds(e,t),ut(e,t,n,i),t.child;case 6:return e===null&&De&&((e=i=Qe)&&(i=Jf(i,t.pendingProps,_t),i!==null?(t.stateNode=i,rt=t,Qe=null,e=!0):e=!1),e||Da(t)),null;case 13:return th(e,t,i);case 4:return ue(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=vi(t,null,n,i):ut(e,t,n,i),t.child;case 11:return Ym(e,t,t.type,t.pendingProps,i);case 7:return ut(e,t,t.pendingProps,i),t.child;case 8:return ut(e,t,t.pendingProps.children,i),t.child;case 12:return ut(e,t,t.pendingProps.children,i),t.child;case 10:return n=t.pendingProps,La(t,t.type,n.value),ut(e,t,n.children,i),t.child;case 9:return r=t.type._context,n=t.pendingProps.children,hi(t),r=ct(r),n=n(r),t.flags|=1,ut(e,t,n,i),t.child;case 14:return Xm(e,t,t.type,t.pendingProps,i);case 15:return Zm(e,t,t.type,t.pendingProps,i);case 19:return ih(e,t,i);case 31:return bf(e,t,i);case 22:return Km(e,t,i,t.pendingProps);case 24:return hi(t),n=ct(We),e===null?(r=Ho(),r===null&&(r=Ue,c=Go(),r.pooledCache=c,c.refCount++,c!==null&&(r.pooledCacheLanes|=i),r=c),t.memoizedState={parent:n,cache:r},Qo(t),La(t,We,r)):((e.lanes&i)!==0&&(Yo(e,t),Yn(t,null,null,i),Qn()),r=e.memoizedState,c=t.memoizedState,r.parent!==n?(r={parent:n,cache:n},t.memoizedState=r,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=r),La(t,We,n)):(n=c.cache,La(t,We,n),n!==r.cache&&Vo(t,[We],i,!0))),ut(e,t,t.pendingProps.children,i),t.child;case 29:throw t.pendingProps}throw Error(s(156,t.tag))}function va(e){e.flags|=4}function kr(e,t,i,n,r){if((t=(e.mode&32)!==0)&&(t=!1),t){if(e.flags|=16777216,(r&335544128)===r)if(e.stateNode.complete)e.flags|=8192;else if(Oh())e.flags|=8192;else throw fi=Il,Uo}else e.flags&=-16777217}function lh(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!yp(t))if(Oh())e.flags|=8192;else throw fi=Il,Uo}function vs(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?jl():536870912,e.lanes|=t,on|=t)}function Wn(e,t){if(!De)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var n=null;i!==null;)i.alternate!==null&&(n=i),i=i.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Ye(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,n=0;if(t)for(var r=e.child;r!==null;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags&65011712,n|=r.flags&65011712,r.return=e,r=r.sibling;else for(r=e.child;r!==null;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=n,e.childLanes=i,t}function yf(e,t,i){var n=t.pendingProps;switch(wo(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ye(t),null;case 1:return Ye(t),null;case 3:return i=t.stateNode,n=null,e!==null&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),ha(We),Te(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(Xi(t)?va(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,zo())),Ye(t),null;case 26:var r=t.type,c=t.memoizedState;return e===null?(va(t),c!==null?(Ye(t),lh(t,c)):(Ye(t),kr(t,r,null,n,i))):c?c!==e.memoizedState?(va(t),Ye(t),lh(t,c)):(Ye(t),t.flags&=-16777217):(e=e.memoizedProps,e!==n&&va(t),Ye(t),kr(t,r,e,n,i)),null;case 27:if(Qt(t),i=ae.current,r=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==n&&va(t);else{if(!n){if(t.stateNode===null)throw Error(s(166));return Ye(t),null}e=k.current,Xi(t)?Bu(t):(e=hp(r,n,i),t.stateNode=e,va(t))}return Ye(t),null;case 5:if(Qt(t),r=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==n&&va(t);else{if(!n){if(t.stateNode===null)throw Error(s(166));return Ye(t),null}if(c=k.current,Xi(t))Bu(t);else{var d=Os(ae.current);switch(c){case 1:c=d.createElementNS("http://www.w3.org/2000/svg",r);break;case 2:c=d.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;default:switch(r){case"svg":c=d.createElementNS("http://www.w3.org/2000/svg",r);break;case"math":c=d.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;case"script":c=d.createElement("div"),c.innerHTML="<script><\/script>",c=c.removeChild(c.firstChild);break;case"select":c=typeof n.is=="string"?d.createElement("select",{is:n.is}):d.createElement("select"),n.multiple?c.multiple=!0:n.size&&(c.size=n.size);break;default:c=typeof n.is=="string"?d.createElement(r,{is:n.is}):d.createElement(r)}}c[Se]=t,c[Ne]=n;e:for(d=t.child;d!==null;){if(d.tag===5||d.tag===6)c.appendChild(d.stateNode);else if(d.tag!==4&&d.tag!==27&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}t.stateNode=c;e:switch(mt(c,r,n),r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&va(t)}}return Ye(t),kr(t,t.type,e===null?null:e.memoizedProps,t.pendingProps,i),null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==n&&va(t);else{if(typeof n!="string"&&t.stateNode===null)throw Error(s(166));if(e=ae.current,Xi(t)){if(e=t.stateNode,i=t.memoizedProps,n=null,r=rt,r!==null)switch(r.tag){case 27:case 5:n=r.memoizedProps}e[Se]=t,e=!!(e.nodeValue===i||n!==null&&n.suppressHydrationWarning===!0||tp(e.nodeValue,i)),e||Da(t,!0)}else e=Os(e).createTextNode(n),e[Se]=t,t.stateNode=e}return Ye(t),null;case 31:if(i=t.memoizedState,e===null||e.memoizedState!==null){if(n=Xi(t),i!==null){if(e===null){if(!n)throw Error(s(318));if(e=t.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(557));e[Se]=t}else ui(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Ye(t),e=!1}else i=zo(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=i),e=!0;if(!e)return t.flags&256?(jt(t),t):(jt(t),null);if((t.flags&128)!==0)throw Error(s(558))}return Ye(t),null;case 13:if(n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(r=Xi(t),n!==null&&n.dehydrated!==null){if(e===null){if(!r)throw Error(s(318));if(r=t.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(s(317));r[Se]=t}else ui(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Ye(t),r=!1}else r=zo(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=r),r=!0;if(!r)return t.flags&256?(jt(t),t):(jt(t),null)}return jt(t),(t.flags&128)!==0?(t.lanes=i,t):(i=n!==null,e=e!==null&&e.memoizedState!==null,i&&(n=t.child,r=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(r=n.alternate.memoizedState.cachePool.pool),c=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),c!==r&&(n.flags|=2048)),i!==e&&i&&(t.child.flags|=8192),vs(t,t.updateQueue),Ye(t),null);case 4:return Te(),e===null&&Kr(t.stateNode.containerInfo),Ye(t),null;case 10:return ha(t.type),Ye(t),null;case 19:if(U(Je),n=t.memoizedState,n===null)return Ye(t),null;if(r=(t.flags&128)!==0,c=n.rendering,c===null)if(r)Wn(n,!1);else{if(Ke!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(c=is(e),c!==null){for(t.flags|=128,Wn(n,!1),e=c.updateQueue,t.updateQueue=e,vs(t,e),t.subtreeFlags=0,e=i,i=t.child;i!==null;)Du(i,e),i=i.sibling;return se(Je,Je.current&1|2),De&&ua(t,n.treeForkCount),t.child}e=e.sibling}n.tail!==null&&ft()>Ss&&(t.flags|=128,r=!0,Wn(n,!1),t.lanes=4194304)}else{if(!r)if(e=is(c),e!==null){if(t.flags|=128,r=!0,e=e.updateQueue,t.updateQueue=e,vs(t,e),Wn(n,!0),n.tail===null&&n.tailMode==="hidden"&&!c.alternate&&!De)return Ye(t),null}else 2*ft()-n.renderingStartTime>Ss&&i!==536870912&&(t.flags|=128,r=!0,Wn(n,!1),t.lanes=4194304);n.isBackwards?(c.sibling=t.child,t.child=c):(e=n.last,e!==null?e.sibling=c:t.child=c,n.last=c)}return n.tail!==null?(e=n.tail,n.rendering=e,n.tail=e.sibling,n.renderingStartTime=ft(),e.sibling=null,i=Je.current,se(Je,r?i&1|2:i&1),De&&ua(t,n.treeForkCount),e):(Ye(t),null);case 22:case 23:return jt(t),Jo(),n=t.memoizedState!==null,e!==null?e.memoizedState!==null!==n&&(t.flags|=8192):n&&(t.flags|=8192),n?(i&536870912)!==0&&(t.flags&128)===0&&(Ye(t),t.subtreeFlags&6&&(t.flags|=8192)):Ye(t),i=t.updateQueue,i!==null&&vs(t,i.retryQueue),i=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),n=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),n!==i&&(t.flags|=2048),e!==null&&U(pi),null;case 24:return i=null,e!==null&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),ha(We),Ye(t),null;case 25:return null;case 30:return null}throw Error(s(156,t.tag))}function Sf(e,t){switch(wo(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ha(We),Te(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return Qt(t),null;case 31:if(t.memoizedState!==null){if(jt(t),t.alternate===null)throw Error(s(340));ui()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 13:if(jt(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(s(340));ui()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return U(Je),null;case 4:return Te(),null;case 10:return ha(t.type),null;case 22:case 23:return jt(t),Jo(),e!==null&&U(pi),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return ha(We),null;case 25:return null;default:return null}}function sh(e,t){switch(wo(t),t.tag){case 3:ha(We),Te();break;case 26:case 27:case 5:Qt(t);break;case 4:Te();break;case 31:t.memoizedState!==null&&jt(t);break;case 13:jt(t);break;case 19:U(Je);break;case 10:ha(t.type);break;case 22:case 23:jt(t),Jo(),e!==null&&U(pi);break;case 24:ha(We)}}function In(e,t){try{var i=t.updateQueue,n=i!==null?i.lastEffect:null;if(n!==null){var r=n.next;i=r;do{if((i.tag&e)===e){n=void 0;var c=i.create,d=i.inst;n=c(),d.destroy=n}i=i.next}while(i!==r)}}catch(x){Ve(t,t.return,x)}}function Va(e,t,i){try{var n=t.updateQueue,r=n!==null?n.lastEffect:null;if(r!==null){var c=r.next;n=c;do{if((n.tag&e)===e){var d=n.inst,x=d.destroy;if(x!==void 0){d.destroy=void 0,r=t;var A=i,z=x;try{z()}catch(X){Ve(r,A,X)}}}n=n.next}while(n!==c)}}catch(X){Ve(t,t.return,X)}}function oh(e){var t=e.updateQueue;if(t!==null){var i=e.stateNode;try{$u(t,i)}catch(n){Ve(e,e.return,n)}}}function rh(e,t,i){i.props=bi(e.type,e.memoizedProps),i.state=e.memoizedState;try{i.componentWillUnmount()}catch(n){Ve(e,t,n)}}function el(e,t){try{var i=e.ref;if(i!==null){switch(e.tag){case 26:case 27:case 5:var n=e.stateNode;break;case 30:n=e.stateNode;break;default:n=e.stateNode}typeof i=="function"?e.refCleanup=i(n):i.current=n}}catch(r){Ve(e,t,r)}}function It(e,t){var i=e.ref,n=e.refCleanup;if(i!==null)if(typeof n=="function")try{n()}catch(r){Ve(e,t,r)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(r){Ve(e,t,r)}else i.current=null}function ch(e){var t=e.type,i=e.memoizedProps,n=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":i.autoFocus&&n.focus();break e;case"img":i.src?n.src=i.src:i.srcSet&&(n.srcset=i.srcSet)}}catch(r){Ve(e,e.return,r)}}function Er(e,t,i){try{var n=e.stateNode;Hf(n,e.type,i,t),n[Ne]=t}catch(r){Ve(e,e.return,r)}}function uh(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Xa(e.type)||e.tag===4}function jr(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||uh(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Xa(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Nr(e,t,i){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(e,t):(t=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,t.appendChild(e),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=oa));else if(n!==4&&(n===27&&Xa(e.type)&&(i=e.stateNode,t=null),e=e.child,e!==null))for(Nr(e,t,i),e=e.sibling;e!==null;)Nr(e,t,i),e=e.sibling}function gs(e,t,i){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(n!==4&&(n===27&&Xa(e.type)&&(i=e.stateNode),e=e.child,e!==null))for(gs(e,t,i),e=e.sibling;e!==null;)gs(e,t,i),e=e.sibling}function mh(e){var t=e.stateNode,i=e.memoizedProps;try{for(var n=e.type,r=t.attributes;r.length;)t.removeAttributeNode(r[0]);mt(t,n,i),t[Se]=e,t[Ne]=i}catch(c){Ve(e,e.return,c)}}var ga=!1,tt=!1,Or=!1,hh=typeof WeakSet=="function"?WeakSet:Set,st=null;function Mf(e,t){if(e=e.containerInfo,Wr=Bs,e=Cu(e),Co(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var n=i.getSelection&&i.getSelection();if(n&&n.rangeCount!==0){i=n.anchorNode;var r=n.anchorOffset,c=n.focusNode;n=n.focusOffset;try{i.nodeType,c.nodeType}catch{i=null;break e}var d=0,x=-1,A=-1,z=0,X=0,J=e,V=null;t:for(;;){for(var H;J!==i||r!==0&&J.nodeType!==3||(x=d+r),J!==c||n!==0&&J.nodeType!==3||(A=d+n),J.nodeType===3&&(d+=J.nodeValue.length),(H=J.firstChild)!==null;)V=J,J=H;for(;;){if(J===e)break t;if(V===i&&++z===r&&(x=d),V===c&&++X===n&&(A=d),(H=J.nextSibling)!==null)break;J=V,V=J.parentNode}J=H}i=x===-1||A===-1?null:{start:x,end:A}}else i=null}i=i||{start:0,end:0}}else i=null;for(Ir={focusedElem:e,selectionRange:i},Bs=!1,st=t;st!==null;)if(t=st,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,st=e;else for(;st!==null;){switch(t=st,c=t.alternate,e=t.flags,t.tag){case 0:if((e&4)!==0&&(e=t.updateQueue,e=e!==null?e.events:null,e!==null))for(i=0;i<e.length;i++)r=e[i],r.ref.impl=r.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&c!==null){e=void 0,i=t,r=c.memoizedProps,c=c.memoizedState,n=i.stateNode;try{var he=bi(i.type,r);e=n.getSnapshotBeforeUpdate(he,c),n.__reactInternalSnapshotBeforeUpdate=e}catch(be){Ve(i,i.return,be)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,i=e.nodeType,i===9)ac(e);else if(i===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":ac(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(s(163))}if(e=t.sibling,e!==null){e.return=t.return,st=e;break}st=t.return}}function ph(e,t,i){var n=i.flags;switch(i.tag){case 0:case 11:case 15:xa(e,i),n&4&&In(5,i);break;case 1:if(xa(e,i),n&4)if(e=i.stateNode,t===null)try{e.componentDidMount()}catch(d){Ve(i,i.return,d)}else{var r=bi(i.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(r,t,e.__reactInternalSnapshotBeforeUpdate)}catch(d){Ve(i,i.return,d)}}n&64&&oh(i),n&512&&el(i,i.return);break;case 3:if(xa(e,i),n&64&&(e=i.updateQueue,e!==null)){if(t=null,i.child!==null)switch(i.child.tag){case 27:case 5:t=i.child.stateNode;break;case 1:t=i.child.stateNode}try{$u(e,t)}catch(d){Ve(i,i.return,d)}}break;case 27:t===null&&n&4&&mh(i);case 26:case 5:xa(e,i),t===null&&n&4&&ch(i),n&512&&el(i,i.return);break;case 12:xa(e,i);break;case 31:xa(e,i),n&4&&vh(e,i);break;case 13:xa(e,i),n&4&&gh(e,i),n&64&&(e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(i=Of.bind(null,i),$f(e,i))));break;case 22:if(n=i.memoizedState!==null||ga,!n){t=t!==null&&t.memoizedState!==null||tt,r=ga;var c=tt;ga=n,(tt=t)&&!c?ya(e,i,(i.subtreeFlags&8772)!==0):xa(e,i),ga=r,tt=c}break;case 30:break;default:xa(e,i)}}function dh(e){var t=e.alternate;t!==null&&(e.alternate=null,dh(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&so(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Xe=null,yt=!1;function ba(e,t,i){for(i=i.child;i!==null;)fh(e,t,i),i=i.sibling}function fh(e,t,i){if(vt&&typeof vt.onCommitFiberUnmount=="function")try{vt.onCommitFiberUnmount(ti,i)}catch{}switch(i.tag){case 26:tt||It(i,t),ba(e,t,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:tt||It(i,t);var n=Xe,r=yt;Xa(i.type)&&(Xe=i.stateNode,yt=!1),ba(e,t,i),cl(i.stateNode),Xe=n,yt=r;break;case 5:tt||It(i,t);case 6:if(n=Xe,r=yt,Xe=null,ba(e,t,i),Xe=n,yt=r,Xe!==null)if(yt)try{(Xe.nodeType===9?Xe.body:Xe.nodeName==="HTML"?Xe.ownerDocument.body:Xe).removeChild(i.stateNode)}catch(c){Ve(i,t,c)}else try{Xe.removeChild(i.stateNode)}catch(c){Ve(i,t,c)}break;case 18:Xe!==null&&(yt?(e=Xe,op(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,i.stateNode),fn(e)):op(Xe,i.stateNode));break;case 4:n=Xe,r=yt,Xe=i.stateNode.containerInfo,yt=!0,ba(e,t,i),Xe=n,yt=r;break;case 0:case 11:case 14:case 15:Va(2,i,t),tt||Va(4,i,t),ba(e,t,i);break;case 1:tt||(It(i,t),n=i.stateNode,typeof n.componentWillUnmount=="function"&&rh(i,t,n)),ba(e,t,i);break;case 21:ba(e,t,i);break;case 22:tt=(n=tt)||i.memoizedState!==null,ba(e,t,i),tt=n;break;default:ba(e,t,i)}}function vh(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{fn(e)}catch(i){Ve(t,t.return,i)}}}function gh(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{fn(e)}catch(i){Ve(t,t.return,i)}}function Tf(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new hh),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new hh),t;default:throw Error(s(435,e.tag))}}function bs(e,t){var i=Tf(e);t.forEach(function(n){if(!i.has(n)){i.add(n);var r=Pf.bind(null,e,n);n.then(r,r)}})}function St(e,t){var i=t.deletions;if(i!==null)for(var n=0;n<i.length;n++){var r=i[n],c=e,d=t,x=d;e:for(;x!==null;){switch(x.tag){case 27:if(Xa(x.type)){Xe=x.stateNode,yt=!1;break e}break;case 5:Xe=x.stateNode,yt=!1;break e;case 3:case 4:Xe=x.stateNode.containerInfo,yt=!0;break e}x=x.return}if(Xe===null)throw Error(s(160));fh(c,d,r),Xe=null,yt=!1,c=r.alternate,c!==null&&(c.return=null),r.return=null}if(t.subtreeFlags&13886)for(t=t.child;t!==null;)bh(t,e),t=t.sibling}var Xt=null;function bh(e,t){var i=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:St(t,e),Mt(e),n&4&&(Va(3,e,e.return),In(3,e),Va(5,e,e.return));break;case 1:St(t,e),Mt(e),n&512&&(tt||i===null||It(i,i.return)),n&64&&ga&&(e=e.updateQueue,e!==null&&(n=e.callbacks,n!==null&&(i=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=i===null?n:i.concat(n))));break;case 26:var r=Xt;if(St(t,e),Mt(e),n&512&&(tt||i===null||It(i,i.return)),n&4){var c=i!==null?i.memoizedState:null;if(n=e.memoizedState,i===null)if(n===null)if(e.stateNode===null){e:{n=e.type,i=e.memoizedProps,r=r.ownerDocument||r;t:switch(n){case"title":c=r.getElementsByTagName("title")[0],(!c||c[kn]||c[Se]||c.namespaceURI==="http://www.w3.org/2000/svg"||c.hasAttribute("itemprop"))&&(c=r.createElement(n),r.head.insertBefore(c,r.querySelector("head > title"))),mt(c,n,i),c[Se]=e,lt(c),n=c;break e;case"link":var d=bp("link","href",r).get(n+(i.href||""));if(d){for(var x=0;x<d.length;x++)if(c=d[x],c.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&c.getAttribute("rel")===(i.rel==null?null:i.rel)&&c.getAttribute("title")===(i.title==null?null:i.title)&&c.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){d.splice(x,1);break t}}c=r.createElement(n),mt(c,n,i),r.head.appendChild(c);break;case"meta":if(d=bp("meta","content",r).get(n+(i.content||""))){for(x=0;x<d.length;x++)if(c=d[x],c.getAttribute("content")===(i.content==null?null:""+i.content)&&c.getAttribute("name")===(i.name==null?null:i.name)&&c.getAttribute("property")===(i.property==null?null:i.property)&&c.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&c.getAttribute("charset")===(i.charSet==null?null:i.charSet)){d.splice(x,1);break t}}c=r.createElement(n),mt(c,n,i),r.head.appendChild(c);break;default:throw Error(s(468,n))}c[Se]=e,lt(c),n=c}e.stateNode=n}else xp(r,e.type,e.stateNode);else e.stateNode=gp(r,n,e.memoizedProps);else c!==n?(c===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):c.count--,n===null?xp(r,e.type,e.stateNode):gp(r,n,e.memoizedProps)):n===null&&e.stateNode!==null&&Er(e,e.memoizedProps,i.memoizedProps)}break;case 27:St(t,e),Mt(e),n&512&&(tt||i===null||It(i,i.return)),i!==null&&n&4&&Er(e,e.memoizedProps,i.memoizedProps);break;case 5:if(St(t,e),Mt(e),n&512&&(tt||i===null||It(i,i.return)),e.flags&32){r=e.stateNode;try{zi(r,"")}catch(he){Ve(e,e.return,he)}}n&4&&e.stateNode!=null&&(r=e.memoizedProps,Er(e,r,i!==null?i.memoizedProps:r)),n&1024&&(Or=!0);break;case 6:if(St(t,e),Mt(e),n&4){if(e.stateNode===null)throw Error(s(162));n=e.memoizedProps,i=e.stateNode;try{i.nodeValue=n}catch(he){Ve(e,e.return,he)}}break;case 3:if(Ls=null,r=Xt,Xt=Ps(t.containerInfo),St(t,e),Xt=r,Mt(e),n&4&&i!==null&&i.memoizedState.isDehydrated)try{fn(t.containerInfo)}catch(he){Ve(e,e.return,he)}Or&&(Or=!1,xh(e));break;case 4:n=Xt,Xt=Ps(e.stateNode.containerInfo),St(t,e),Mt(e),Xt=n;break;case 12:St(t,e),Mt(e);break;case 31:St(t,e),Mt(e),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,bs(e,n)));break;case 13:St(t,e),Mt(e),e.child.flags&8192&&e.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(ys=ft()),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,bs(e,n)));break;case 22:r=e.memoizedState!==null;var A=i!==null&&i.memoizedState!==null,z=ga,X=tt;if(ga=z||r,tt=X||A,St(t,e),tt=X,ga=z,Mt(e),n&8192)e:for(t=e.stateNode,t._visibility=r?t._visibility&-2:t._visibility|1,r&&(i===null||A||ga||tt||xi(e)),i=null,t=e;;){if(t.tag===5||t.tag===26){if(i===null){A=i=t;try{if(c=A.stateNode,r)d=c.style,typeof d.setProperty=="function"?d.setProperty("display","none","important"):d.display="none";else{x=A.stateNode;var J=A.memoizedProps.style,V=J!=null&&J.hasOwnProperty("display")?J.display:null;x.style.display=V==null||typeof V=="boolean"?"":(""+V).trim()}}catch(he){Ve(A,A.return,he)}}}else if(t.tag===6){if(i===null){A=t;try{A.stateNode.nodeValue=r?"":A.memoizedProps}catch(he){Ve(A,A.return,he)}}}else if(t.tag===18){if(i===null){A=t;try{var H=A.stateNode;r?rp(H,!0):rp(A.stateNode,!1)}catch(he){Ve(A,A.return,he)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;i===t&&(i=null),t=t.return}i===t&&(i=null),t.sibling.return=t.return,t=t.sibling}n&4&&(n=e.updateQueue,n!==null&&(i=n.retryQueue,i!==null&&(n.retryQueue=null,bs(e,i))));break;case 19:St(t,e),Mt(e),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,bs(e,n)));break;case 30:break;case 21:break;default:St(t,e),Mt(e)}}function Mt(e){var t=e.flags;if(t&2){try{for(var i,n=e.return;n!==null;){if(uh(n)){i=n;break}n=n.return}if(i==null)throw Error(s(160));switch(i.tag){case 27:var r=i.stateNode,c=jr(e);gs(e,c,r);break;case 5:var d=i.stateNode;i.flags&32&&(zi(d,""),i.flags&=-33);var x=jr(e);gs(e,x,d);break;case 3:case 4:var A=i.stateNode.containerInfo,z=jr(e);Nr(e,z,A);break;default:throw Error(s(161))}}catch(X){Ve(e,e.return,X)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function xh(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;xh(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function xa(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)ph(e,t.alternate,t),t=t.sibling}function xi(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Va(4,t,t.return),xi(t);break;case 1:It(t,t.return);var i=t.stateNode;typeof i.componentWillUnmount=="function"&&rh(t,t.return,i),xi(t);break;case 27:cl(t.stateNode);case 26:case 5:It(t,t.return),xi(t);break;case 22:t.memoizedState===null&&xi(t);break;case 30:xi(t);break;default:xi(t)}e=e.sibling}}function ya(e,t,i){for(i=i&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var n=t.alternate,r=e,c=t,d=c.flags;switch(c.tag){case 0:case 11:case 15:ya(r,c,i),In(4,c);break;case 1:if(ya(r,c,i),n=c,r=n.stateNode,typeof r.componentDidMount=="function")try{r.componentDidMount()}catch(z){Ve(n,n.return,z)}if(n=c,r=n.updateQueue,r!==null){var x=n.stateNode;try{var A=r.shared.hiddenCallbacks;if(A!==null)for(r.shared.hiddenCallbacks=null,r=0;r<A.length;r++)Ju(A[r],x)}catch(z){Ve(n,n.return,z)}}i&&d&64&&oh(c),el(c,c.return);break;case 27:mh(c);case 26:case 5:ya(r,c,i),i&&n===null&&d&4&&ch(c),el(c,c.return);break;case 12:ya(r,c,i);break;case 31:ya(r,c,i),i&&d&4&&vh(r,c);break;case 13:ya(r,c,i),i&&d&4&&gh(r,c);break;case 22:c.memoizedState===null&&ya(r,c,i),el(c,c.return);break;case 30:break;default:ya(r,c,i)}t=t.sibling}}function Pr(e,t){var i=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==i&&(e!=null&&e.refCount++,i!=null&&Vn(i))}function Dr(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Vn(e))}function Zt(e,t,i,n){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)yh(e,t,i,n),t=t.sibling}function yh(e,t,i,n){var r=t.flags;switch(t.tag){case 0:case 11:case 15:Zt(e,t,i,n),r&2048&&In(9,t);break;case 1:Zt(e,t,i,n);break;case 3:Zt(e,t,i,n),r&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Vn(e)));break;case 12:if(r&2048){Zt(e,t,i,n),e=t.stateNode;try{var c=t.memoizedProps,d=c.id,x=c.onPostCommit;typeof x=="function"&&x(d,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(A){Ve(t,t.return,A)}}else Zt(e,t,i,n);break;case 31:Zt(e,t,i,n);break;case 13:Zt(e,t,i,n);break;case 23:break;case 22:c=t.stateNode,d=t.alternate,t.memoizedState!==null?c._visibility&2?Zt(e,t,i,n):tl(e,t):c._visibility&2?Zt(e,t,i,n):(c._visibility|=2,nn(e,t,i,n,(t.subtreeFlags&10256)!==0||!1)),r&2048&&Pr(d,t);break;case 24:Zt(e,t,i,n),r&2048&&Dr(t.alternate,t);break;default:Zt(e,t,i,n)}}function nn(e,t,i,n,r){for(r=r&&((t.subtreeFlags&10256)!==0||!1),t=t.child;t!==null;){var c=e,d=t,x=i,A=n,z=d.flags;switch(d.tag){case 0:case 11:case 15:nn(c,d,x,A,r),In(8,d);break;case 23:break;case 22:var X=d.stateNode;d.memoizedState!==null?X._visibility&2?nn(c,d,x,A,r):tl(c,d):(X._visibility|=2,nn(c,d,x,A,r)),r&&z&2048&&Pr(d.alternate,d);break;case 24:nn(c,d,x,A,r),r&&z&2048&&Dr(d.alternate,d);break;default:nn(c,d,x,A,r)}t=t.sibling}}function tl(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var i=e,n=t,r=n.flags;switch(n.tag){case 22:tl(i,n),r&2048&&Pr(n.alternate,n);break;case 24:tl(i,n),r&2048&&Dr(n.alternate,n);break;default:tl(i,n)}t=t.sibling}}var al=8192;function ln(e,t,i){if(e.subtreeFlags&al)for(e=e.child;e!==null;)Sh(e,t,i),e=e.sibling}function Sh(e,t,i){switch(e.tag){case 26:ln(e,t,i),e.flags&al&&e.memoizedState!==null&&c0(i,Xt,e.memoizedState,e.memoizedProps);break;case 5:ln(e,t,i);break;case 3:case 4:var n=Xt;Xt=Ps(e.stateNode.containerInfo),ln(e,t,i),Xt=n;break;case 22:e.memoizedState===null&&(n=e.alternate,n!==null&&n.memoizedState!==null?(n=al,al=16777216,ln(e,t,i),al=n):ln(e,t,i));break;default:ln(e,t,i)}}function Mh(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function il(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var i=0;i<t.length;i++){var n=t[i];st=n,Ch(n,e)}Mh(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Th(e),e=e.sibling}function Th(e){switch(e.tag){case 0:case 11:case 15:il(e),e.flags&2048&&Va(9,e,e.return);break;case 3:il(e);break;case 12:il(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,xs(e)):il(e);break;default:il(e)}}function xs(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var i=0;i<t.length;i++){var n=t[i];st=n,Ch(n,e)}Mh(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:Va(8,t,t.return),xs(t);break;case 22:i=t.stateNode,i._visibility&2&&(i._visibility&=-3,xs(t));break;default:xs(t)}e=e.sibling}}function Ch(e,t){for(;st!==null;){var i=st;switch(i.tag){case 0:case 11:case 15:Va(8,i,t);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var n=i.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:Vn(i.memoizedState.cache)}if(n=i.child,n!==null)n.return=i,st=n;else e:for(i=e;st!==null;){n=st;var r=n.sibling,c=n.return;if(dh(n),n===i){st=null;break e}if(r!==null){r.return=c,st=r;break e}st=c}}}var Cf={getCacheForType:function(e){var t=ct(We),i=t.data.get(e);return i===void 0&&(i=e(),t.data.set(e,i)),i},cacheSignal:function(){return ct(We).controller.signal}},Rf=typeof WeakMap=="function"?WeakMap:Map,ze=0,Ue=null,ke=null,Oe=0,_e=0,Nt=null,Ga=!1,sn=!1,Lr=!1,Sa=0,Ke=0,Fa=0,yi=0,wr=0,Ot=0,on=0,nl=null,Tt=null,qr=!1,ys=0,Rh=0,Ss=1/0,Ms=null,Ha=null,it=0,Ua=null,rn=null,Ma=0,zr=0,Br=null,Ah=null,ll=0,_r=null;function Pt(){return(ze&2)!==0&&Oe!==0?Oe&-Oe:F.T!==null?Qr():re()}function kh(){if(Ot===0)if((Oe&536870912)===0||De){var e=ji;ji<<=1,(ji&3932160)===0&&(ji=262144),Ot=e}else Ot=536870912;return e=Et.current,e!==null&&(e.flags|=32),Ot}function Ct(e,t,i){(e===Ue&&(_e===2||_e===9)||e.cancelPendingCommit!==null)&&(cn(e,0),Qa(e,Oe,Ot,!1)),ii(e,i),((ze&2)===0||e!==Ue)&&(e===Ue&&((ze&2)===0&&(yi|=i),Ke===4&&Qa(e,Oe,Ot,!1)),ea(e))}function Eh(e,t,i){if((ze&6)!==0)throw Error(s(327));var n=!i&&(t&127)===0&&(t&e.expiredLanes)===0||ai(e,t),r=n?Ef(e,t):Gr(e,t,!0),c=n;do{if(r===0){sn&&!n&&Qa(e,t,0,!1);break}else{if(i=e.current.alternate,c&&!Af(i)){r=Gr(e,t,!1),c=!1;continue}if(r===2){if(c=t,e.errorRecoveryDisabledLanes&c)var d=0;else d=e.pendingLanes&-536870913,d=d!==0?d:d&536870912?536870912:0;if(d!==0){t=d;e:{var x=e;r=nl;var A=x.current.memoizedState.isDehydrated;if(A&&(cn(x,d).flags|=256),d=Gr(x,d,!1),d!==2){if(Lr&&!A){x.errorRecoveryDisabledLanes|=c,yi|=c,r=4;break e}c=Tt,Tt=r,c!==null&&(Tt===null?Tt=c:Tt.push.apply(Tt,c))}r=d}if(c=!1,r!==2)continue}}if(r===1){cn(e,0),Qa(e,t,0,!0);break}e:{switch(n=e,c=r,c){case 0:case 1:throw Error(s(345));case 4:if((t&4194048)!==t)break;case 6:Qa(n,t,Ot,!Ga);break e;case 2:Tt=null;break;case 3:case 5:break;default:throw Error(s(329))}if((t&62914560)===t&&(r=ys+300-ft(),10<r)){if(Qa(n,t,Ot,!Ga),Oi(n,0,!0)!==0)break e;Ma=t,n.timeoutHandle=lp(jh.bind(null,n,i,Tt,Ms,qr,t,Ot,yi,on,Ga,c,"Throttled",-0,0),r);break e}jh(n,i,Tt,Ms,qr,t,Ot,yi,on,Ga,c,null,-0,0)}}break}while(!0);ea(e)}function jh(e,t,i,n,r,c,d,x,A,z,X,J,V,H){if(e.timeoutHandle=-1,J=t.subtreeFlags,J&8192||(J&16785408)===16785408){J={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:oa},Sh(t,c,J);var he=(c&62914560)===c?ys-ft():(c&4194048)===c?Rh-ft():0;if(he=u0(J,he),he!==null){Ma=c,e.cancelPendingCommit=he(zh.bind(null,e,t,c,i,n,r,d,x,A,X,J,null,V,H)),Qa(e,c,d,!z);return}}zh(e,t,c,i,n,r,d,x,A)}function Af(e){for(var t=e;;){var i=t.tag;if((i===0||i===11||i===15)&&t.flags&16384&&(i=t.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var n=0;n<i.length;n++){var r=i[n],c=r.getSnapshot;r=r.value;try{if(!At(c(),r))return!1}catch{return!1}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Qa(e,t,i,n){t&=~wr,t&=~yi,e.suspendedLanes|=t,e.pingedLanes&=~t,n&&(e.warmLanes|=t),n=e.expirationTimes;for(var r=t;0<r;){var c=31-gt(r),d=1<<c;n[c]=-1,r&=~d}i!==0&&Nl(e,i,t)}function Ts(){return(ze&6)===0?(sl(0),!1):!0}function Vr(){if(ke!==null){if(_e===0)var e=ke.return;else e=ke,ma=mi=null,ar(e),Wi=null,Fn=0,e=ke;for(;e!==null;)sh(e.alternate,e),e=e.return;ke=null}}function cn(e,t){var i=e.timeoutHandle;i!==-1&&(e.timeoutHandle=-1,Yf(i)),i=e.cancelPendingCommit,i!==null&&(e.cancelPendingCommit=null,i()),Ma=0,Vr(),Ue=e,ke=i=ca(e.current,null),Oe=t,_e=0,Nt=null,Ga=!1,sn=ai(e,t),Lr=!1,on=Ot=wr=yi=Fa=Ke=0,Tt=nl=null,qr=!1,(t&8)!==0&&(t|=t&32);var n=e.entangledLanes;if(n!==0)for(e=e.entanglements,n&=t;0<n;){var r=31-gt(n),c=1<<r;t|=e[r],n&=~c}return Sa=t,Ul(),i}function Nh(e,t){Ce=null,F.H=Jn,t===$i||t===Wl?(t=Yu(),_e=3):t===Uo?(t=Yu(),_e=4):_e=t===br?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,Nt=t,ke===null&&(Ke=1,hs(e,qt(t,e.current)))}function Oh(){var e=Et.current;return e===null?!0:(Oe&4194048)===Oe?Vt===null:(Oe&62914560)===Oe||(Oe&536870912)!==0?e===Vt:!1}function Ph(){var e=F.H;return F.H=Jn,e===null?Jn:e}function Dh(){var e=F.A;return F.A=Cf,e}function Cs(){Ke=4,Ga||(Oe&4194048)!==Oe&&Et.current!==null||(sn=!0),(Fa&134217727)===0&&(yi&134217727)===0||Ue===null||Qa(Ue,Oe,Ot,!1)}function Gr(e,t,i){var n=ze;ze|=2;var r=Ph(),c=Dh();(Ue!==e||Oe!==t)&&(Ms=null,cn(e,t)),t=!1;var d=Ke;e:do try{if(_e!==0&&ke!==null){var x=ke,A=Nt;switch(_e){case 8:Vr(),d=6;break e;case 3:case 2:case 9:case 6:Et.current===null&&(t=!0);var z=_e;if(_e=0,Nt=null,un(e,x,A,z),i&&sn){d=0;break e}break;default:z=_e,_e=0,Nt=null,un(e,x,A,z)}}kf(),d=Ke;break}catch(X){Nh(e,X)}while(!0);return t&&e.shellSuspendCounter++,ma=mi=null,ze=n,F.H=r,F.A=c,ke===null&&(Ue=null,Oe=0,Ul()),d}function kf(){for(;ke!==null;)Lh(ke)}function Ef(e,t){var i=ze;ze|=2;var n=Ph(),r=Dh();Ue!==e||Oe!==t?(Ms=null,Ss=ft()+500,cn(e,t)):sn=ai(e,t);e:do try{if(_e!==0&&ke!==null){t=ke;var c=Nt;t:switch(_e){case 1:_e=0,Nt=null,un(e,t,c,1);break;case 2:case 9:if(Uu(c)){_e=0,Nt=null,wh(t);break}t=function(){_e!==2&&_e!==9||Ue!==e||(_e=7),ea(e)},c.then(t,t);break e;case 3:_e=7;break e;case 4:_e=5;break e;case 7:Uu(c)?(_e=0,Nt=null,wh(t)):(_e=0,Nt=null,un(e,t,c,7));break;case 5:var d=null;switch(ke.tag){case 26:d=ke.memoizedState;case 5:case 27:var x=ke;if(d?yp(d):x.stateNode.complete){_e=0,Nt=null;var A=x.sibling;if(A!==null)ke=A;else{var z=x.return;z!==null?(ke=z,Rs(z)):ke=null}break t}}_e=0,Nt=null,un(e,t,c,5);break;case 6:_e=0,Nt=null,un(e,t,c,6);break;case 8:Vr(),Ke=6;break e;default:throw Error(s(462))}}jf();break}catch(X){Nh(e,X)}while(!0);return ma=mi=null,F.H=n,F.A=r,ze=i,ke!==null?0:(Ue=null,Oe=0,Ul(),Ke)}function jf(){for(;ke!==null&&!Js();)Lh(ke)}function Lh(e){var t=nh(e.alternate,e,Sa);e.memoizedProps=e.pendingProps,t===null?Rs(e):ke=t}function wh(e){var t=e,i=t.alternate;switch(t.tag){case 15:case 0:t=Wm(i,t,t.pendingProps,t.type,void 0,Oe);break;case 11:t=Wm(i,t,t.pendingProps,t.type.render,t.ref,Oe);break;case 5:ar(t);default:sh(i,t),t=ke=Du(t,Sa),t=nh(i,t,Sa)}e.memoizedProps=e.pendingProps,t===null?Rs(e):ke=t}function un(e,t,i,n){ma=mi=null,ar(t),Wi=null,Fn=0;var r=t.return;try{if(gf(e,r,t,i,Oe)){Ke=1,hs(e,qt(i,e.current)),ke=null;return}}catch(c){if(r!==null)throw ke=r,c;Ke=1,hs(e,qt(i,e.current)),ke=null;return}t.flags&32768?(De||n===1?e=!0:sn||(Oe&536870912)!==0?e=!1:(Ga=e=!0,(n===2||n===9||n===3||n===6)&&(n=Et.current,n!==null&&n.tag===13&&(n.flags|=16384))),qh(t,e)):Rs(t)}function Rs(e){var t=e;do{if((t.flags&32768)!==0){qh(t,Ga);return}e=t.return;var i=yf(t.alternate,t,Sa);if(i!==null){ke=i;return}if(t=t.sibling,t!==null){ke=t;return}ke=t=e}while(t!==null);Ke===0&&(Ke=5)}function qh(e,t){do{var i=Sf(e.alternate,e);if(i!==null){i.flags&=32767,ke=i;return}if(i=e.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!t&&(e=e.sibling,e!==null)){ke=e;return}ke=e=i}while(e!==null);Ke=6,ke=null}function zh(e,t,i,n,r,c,d,x,A){e.cancelPendingCommit=null;do As();while(it!==0);if((ze&6)!==0)throw Error(s(327));if(t!==null){if(t===e.current)throw Error(s(177));if(c=t.lanes|t.childLanes,c|=jo,lo(e,i,c,d,x,A),e===Ue&&(ke=Ue=null,Oe=0),rn=t,Ua=e,Ma=i,zr=c,Br=r,Ah=n,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Df(ki,function(){return Fh(),null})):(e.callbackNode=null,e.callbackPriority=0),n=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||n){n=F.T,F.T=null,r=$.p,$.p=2,d=ze,ze|=4;try{Mf(e,t,i)}finally{ze=d,$.p=r,F.T=n}}it=1,Bh(),_h(),Vh()}}function Bh(){if(it===1){it=0;var e=Ua,t=rn,i=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||i){i=F.T,F.T=null;var n=$.p;$.p=2;var r=ze;ze|=4;try{bh(t,e);var c=Ir,d=Cu(e.containerInfo),x=c.focusedElem,A=c.selectionRange;if(d!==x&&x&&x.ownerDocument&&Tu(x.ownerDocument.documentElement,x)){if(A!==null&&Co(x)){var z=A.start,X=A.end;if(X===void 0&&(X=z),"selectionStart"in x)x.selectionStart=z,x.selectionEnd=Math.min(X,x.value.length);else{var J=x.ownerDocument||document,V=J&&J.defaultView||window;if(V.getSelection){var H=V.getSelection(),he=x.textContent.length,be=Math.min(A.start,he),He=A.end===void 0?be:Math.min(A.end,he);!H.extend&&be>He&&(d=He,He=be,be=d);var D=Mu(x,be),N=Mu(x,He);if(D&&N&&(H.rangeCount!==1||H.anchorNode!==D.node||H.anchorOffset!==D.offset||H.focusNode!==N.node||H.focusOffset!==N.offset)){var q=J.createRange();q.setStart(D.node,D.offset),H.removeAllRanges(),be>He?(H.addRange(q),H.extend(N.node,N.offset)):(q.setEnd(N.node,N.offset),H.addRange(q))}}}}for(J=[],H=x;H=H.parentNode;)H.nodeType===1&&J.push({element:H,left:H.scrollLeft,top:H.scrollTop});for(typeof x.focus=="function"&&x.focus(),x=0;x<J.length;x++){var K=J[x];K.element.scrollLeft=K.left,K.element.scrollTop=K.top}}Bs=!!Wr,Ir=Wr=null}finally{ze=r,$.p=n,F.T=i}}e.current=t,it=2}}function _h(){if(it===2){it=0;var e=Ua,t=rn,i=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||i){i=F.T,F.T=null;var n=$.p;$.p=2;var r=ze;ze|=4;try{ph(e,t.alternate,t)}finally{ze=r,$.p=n,F.T=i}}it=3}}function Vh(){if(it===4||it===3){it=0,Cn();var e=Ua,t=rn,i=Ma,n=Ah;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?it=5:(it=0,rn=Ua=null,Gh(e,e.pendingLanes));var r=e.pendingLanes;if(r===0&&(Ha=null),oe(i),t=t.stateNode,vt&&typeof vt.onCommitFiberRoot=="function")try{vt.onCommitFiberRoot(ti,t,void 0,(t.current.flags&128)===128)}catch{}if(n!==null){t=F.T,r=$.p,$.p=2,F.T=null;try{for(var c=e.onRecoverableError,d=0;d<n.length;d++){var x=n[d];c(x.value,{componentStack:x.stack})}}finally{F.T=t,$.p=r}}(Ma&3)!==0&&As(),ea(e),r=e.pendingLanes,(i&261930)!==0&&(r&42)!==0?e===_r?ll++:(ll=0,_r=e):ll=0,sl(0)}}function Gh(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,Vn(t)))}function As(){return Bh(),_h(),Vh(),Fh()}function Fh(){if(it!==5)return!1;var e=Ua,t=zr;zr=0;var i=oe(Ma),n=F.T,r=$.p;try{$.p=32>i?32:i,F.T=null,i=Br,Br=null;var c=Ua,d=Ma;if(it=0,rn=Ua=null,Ma=0,(ze&6)!==0)throw Error(s(331));var x=ze;if(ze|=4,Th(c.current),yh(c,c.current,d,i),ze=x,sl(0,!1),vt&&typeof vt.onPostCommitFiberRoot=="function")try{vt.onPostCommitFiberRoot(ti,c)}catch{}return!0}finally{$.p=r,F.T=n,Gh(e,t)}}function Hh(e,t,i){t=qt(i,t),t=gr(e.stateNode,t,2),e=za(e,t,2),e!==null&&(ii(e,2),ea(e))}function Ve(e,t,i){if(e.tag===3)Hh(e,e,i);else for(;t!==null;){if(t.tag===3){Hh(t,e,i);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Ha===null||!Ha.has(n))){e=qt(i,e),i=Um(2),n=za(t,i,2),n!==null&&(Qm(i,n,t,e),ii(n,2),ea(n));break}}t=t.return}}function Fr(e,t,i){var n=e.pingCache;if(n===null){n=e.pingCache=new Rf;var r=new Set;n.set(t,r)}else r=n.get(t),r===void 0&&(r=new Set,n.set(t,r));r.has(i)||(Lr=!0,r.add(i),e=Nf.bind(null,e,t,i),t.then(e,e))}function Nf(e,t,i){var n=e.pingCache;n!==null&&n.delete(t),e.pingedLanes|=e.suspendedLanes&i,e.warmLanes&=~i,Ue===e&&(Oe&i)===i&&(Ke===4||Ke===3&&(Oe&62914560)===Oe&&300>ft()-ys?(ze&2)===0&&cn(e,0):wr|=i,on===Oe&&(on=0)),ea(e)}function Uh(e,t){t===0&&(t=jl()),e=ri(e,t),e!==null&&(ii(e,t),ea(e))}function Of(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),Uh(e,i)}function Pf(e,t){var i=0;switch(e.tag){case 31:case 13:var n=e.stateNode,r=e.memoizedState;r!==null&&(i=r.retryLane);break;case 19:n=e.stateNode;break;case 22:n=e.stateNode._retryCache;break;default:throw Error(s(314))}n!==null&&n.delete(t),Uh(e,i)}function Df(e,t){return Ea(e,t)}var ks=null,mn=null,Hr=!1,Es=!1,Ur=!1,Ya=0;function ea(e){e!==mn&&e.next===null&&(mn===null?ks=mn=e:mn=mn.next=e),Es=!0,Hr||(Hr=!0,wf())}function sl(e,t){if(!Ur&&Es){Ur=!0;do for(var i=!1,n=ks;n!==null;){if(e!==0){var r=n.pendingLanes;if(r===0)var c=0;else{var d=n.suspendedLanes,x=n.pingedLanes;c=(1<<31-gt(42|e)+1)-1,c&=r&~(d&~x),c=c&201326741?c&201326741|1:c?c|2:0}c!==0&&(i=!0,Zh(n,c))}else c=Oe,c=Oi(n,n===Ue?c:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),(c&3)===0||ai(n,c)||(i=!0,Zh(n,c));n=n.next}while(i);Ur=!1}}function Lf(){Qh()}function Qh(){Es=Hr=!1;var e=0;Ya!==0&&Qf()&&(e=Ya);for(var t=ft(),i=null,n=ks;n!==null;){var r=n.next,c=Yh(n,t);c===0?(n.next=null,i===null?ks=r:i.next=r,r===null&&(mn=i)):(i=n,(e!==0||(c&3)!==0)&&(Es=!0)),n=r}it!==0&&it!==5||sl(e),Ya!==0&&(Ya=0)}function Yh(e,t){for(var i=e.suspendedLanes,n=e.pingedLanes,r=e.expirationTimes,c=e.pendingLanes&-62914561;0<c;){var d=31-gt(c),x=1<<d,A=r[d];A===-1?((x&i)===0||(x&n)!==0)&&(r[d]=no(x,t)):A<=t&&(e.expiredLanes|=x),c&=~x}if(t=Ue,i=Oe,i=Oi(e,e===t?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),n=e.callbackNode,i===0||e===t&&(_e===2||_e===9)||e.cancelPendingCommit!==null)return n!==null&&n!==null&&ja(n),e.callbackNode=null,e.callbackPriority=0;if((i&3)===0||ai(e,i)){if(t=i&-i,t===e.callbackPriority)return t;switch(n!==null&&ja(n),oe(i)){case 2:case 8:i=kl;break;case 32:i=ki;break;case 268435456:i=El;break;default:i=ki}return n=Xh.bind(null,e),i=Ea(i,n),e.callbackPriority=t,e.callbackNode=i,t}return n!==null&&n!==null&&ja(n),e.callbackPriority=2,e.callbackNode=null,2}function Xh(e,t){if(it!==0&&it!==5)return e.callbackNode=null,e.callbackPriority=0,null;var i=e.callbackNode;if(As()&&e.callbackNode!==i)return null;var n=Oe;return n=Oi(e,e===Ue?n:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),n===0?null:(Eh(e,n,t),Yh(e,ft()),e.callbackNode!=null&&e.callbackNode===i?Xh.bind(null,e):null)}function Zh(e,t){if(As())return null;Eh(e,t,!0)}function wf(){Xf(function(){(ze&6)!==0?Ea(Al,Lf):Qh()})}function Qr(){if(Ya===0){var e=Ki;e===0&&(e=Ei,Ei<<=1,(Ei&261888)===0&&(Ei=256)),Ya=e}return Ya}function Kh(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:ql(""+e)}function Jh(e,t){var i=t.ownerDocument.createElement("input");return i.name=t.name,i.value=t.value,e.id&&i.setAttribute("form",e.id),t.parentNode.insertBefore(i,t),e=new FormData(e),i.parentNode.removeChild(i),e}function qf(e,t,i,n,r){if(t==="submit"&&i&&i.stateNode===r){var c=Kh((r[Ne]||null).action),d=n.submitter;d&&(t=(t=d[Ne]||null)?Kh(t.formAction):d.getAttribute("formAction"),t!==null&&(c=t,d=null));var x=new Vl("action","action",null,n,r);e.push({event:x,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(Ya!==0){var A=d?Jh(r,d):new FormData(r);mr(i,{pending:!0,data:A,method:r.method,action:c},null,A)}}else typeof c=="function"&&(x.preventDefault(),A=d?Jh(r,d):new FormData(r),mr(i,{pending:!0,data:A,method:r.method,action:c},c,A))},currentTarget:r}]})}}for(var Yr=0;Yr<Eo.length;Yr++){var Xr=Eo[Yr],zf=Xr.toLowerCase(),Bf=Xr[0].toUpperCase()+Xr.slice(1);Yt(zf,"on"+Bf)}Yt(ku,"onAnimationEnd"),Yt(Eu,"onAnimationIteration"),Yt(ju,"onAnimationStart"),Yt("dblclick","onDoubleClick"),Yt("focusin","onFocus"),Yt("focusout","onBlur"),Yt(Id,"onTransitionRun"),Yt(ef,"onTransitionStart"),Yt(tf,"onTransitionCancel"),Yt(Nu,"onTransitionEnd"),wi("onMouseEnter",["mouseout","mouseover"]),wi("onMouseLeave",["mouseout","mouseover"]),wi("onPointerEnter",["pointerout","pointerover"]),wi("onPointerLeave",["pointerout","pointerover"]),ni("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ni("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ni("onBeforeInput",["compositionend","keypress","textInput","paste"]),ni("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ni("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ni("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ol="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_f=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ol));function $h(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var n=e[i],r=n.event;n=n.listeners;e:{var c=void 0;if(t)for(var d=n.length-1;0<=d;d--){var x=n[d],A=x.instance,z=x.currentTarget;if(x=x.listener,A!==c&&r.isPropagationStopped())break e;c=x,r.currentTarget=z;try{c(r)}catch(X){Hl(X)}r.currentTarget=null,c=A}else for(d=0;d<n.length;d++){if(x=n[d],A=x.instance,z=x.currentTarget,x=x.listener,A!==c&&r.isPropagationStopped())break e;c=x,r.currentTarget=z;try{c(r)}catch(X){Hl(X)}r.currentTarget=null,c=A}}}}function Ee(e,t){var i=t[An];i===void 0&&(i=t[An]=new Set);var n=e+"__bubble";i.has(n)||(Wh(t,e,2,!1),i.add(n))}function Zr(e,t,i){var n=0;t&&(n|=4),Wh(i,e,n,t)}var js="_reactListening"+Math.random().toString(36).slice(2);function Kr(e){if(!e[js]){e[js]=!0,Qc.forEach(function(i){i!=="selectionchange"&&(_f.has(i)||Zr(i,!1,e),Zr(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[js]||(t[js]=!0,Zr("selectionchange",!1,t))}}function Wh(e,t,i,n){switch(kp(t)){case 2:var r=p0;break;case 8:r=d0;break;default:r=uc}i=r.bind(null,t,i,e),r=void 0,!fo||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(r=!0),n?r!==void 0?e.addEventListener(t,i,{capture:!0,passive:r}):e.addEventListener(t,i,!0):r!==void 0?e.addEventListener(t,i,{passive:r}):e.addEventListener(t,i,!1)}function Jr(e,t,i,n,r){var c=n;if((t&1)===0&&(t&2)===0&&n!==null)e:for(;;){if(n===null)return;var d=n.tag;if(d===3||d===4){var x=n.stateNode.containerInfo;if(x===r)break;if(d===4)for(d=n.return;d!==null;){var A=d.tag;if((A===3||A===4)&&d.stateNode.containerInfo===r)return;d=d.return}for(;x!==null;){if(d=Pi(x),d===null)return;if(A=d.tag,A===5||A===6||A===26||A===27){n=c=d;continue e}x=x.parentNode}}n=n.return}iu(function(){var z=c,X=ho(i),J=[];e:{var V=Ou.get(e);if(V!==void 0){var H=Vl,he=e;switch(e){case"keypress":if(Bl(i)===0)break e;case"keydown":case"keyup":H=Od;break;case"focusin":he="focus",H=xo;break;case"focusout":he="blur",H=xo;break;case"beforeblur":case"afterblur":H=xo;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":H=su;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":H=xd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":H=Ld;break;case ku:case Eu:case ju:H=Md;break;case Nu:H=qd;break;case"scroll":case"scrollend":H=gd;break;case"wheel":H=Bd;break;case"copy":case"cut":case"paste":H=Cd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":H=ru;break;case"toggle":case"beforetoggle":H=Vd}var be=(t&4)!==0,He=!be&&(e==="scroll"||e==="scrollend"),D=be?V!==null?V+"Capture":null:V;be=[];for(var N=z,q;N!==null;){var K=N;if(q=K.stateNode,K=K.tag,K!==5&&K!==26&&K!==27||q===null||D===null||(K=jn(N,D),K!=null&&be.push(rl(N,K,q))),He)break;N=N.return}0<be.length&&(V=new H(V,he,null,i,X),J.push({event:V,listeners:be}))}}if((t&7)===0){e:{if(V=e==="mouseover"||e==="pointerover",H=e==="mouseout"||e==="pointerout",V&&i!==mo&&(he=i.relatedTarget||i.fromElement)&&(Pi(he)||he[nt]))break e;if((H||V)&&(V=X.window===X?X:(V=X.ownerDocument)?V.defaultView||V.parentWindow:window,H?(he=i.relatedTarget||i.toElement,H=z,he=he?Pi(he):null,he!==null&&(He=h(he),be=he.tag,he!==He||be!==5&&be!==27&&be!==6)&&(he=null)):(H=null,he=z),H!==he)){if(be=su,K="onMouseLeave",D="onMouseEnter",N="mouse",(e==="pointerout"||e==="pointerover")&&(be=ru,K="onPointerLeave",D="onPointerEnter",N="pointer"),He=H==null?V:En(H),q=he==null?V:En(he),V=new be(K,N+"leave",H,i,X),V.target=He,V.relatedTarget=q,K=null,Pi(X)===z&&(be=new be(D,N+"enter",he,i,X),be.target=q,be.relatedTarget=He,K=be),He=K,H&&he)t:{for(be=Vf,D=H,N=he,q=0,K=D;K;K=be(K))q++;K=0;for(var ve=N;ve;ve=be(ve))K++;for(;0<q-K;)D=be(D),q--;for(;0<K-q;)N=be(N),K--;for(;q--;){if(D===N||N!==null&&D===N.alternate){be=D;break t}D=be(D),N=be(N)}be=null}else be=null;H!==null&&Ih(J,V,H,be,!1),he!==null&&He!==null&&Ih(J,He,he,be,!0)}}e:{if(V=z?En(z):window,H=V.nodeName&&V.nodeName.toLowerCase(),H==="select"||H==="input"&&V.type==="file")var Le=vu;else if(du(V))if(gu)Le=Jd;else{Le=Zd;var de=Xd}else H=V.nodeName,!H||H.toLowerCase()!=="input"||V.type!=="checkbox"&&V.type!=="radio"?z&&uo(z.elementType)&&(Le=vu):Le=Kd;if(Le&&(Le=Le(e,z))){fu(J,Le,i,X);break e}de&&de(e,V,z),e==="focusout"&&z&&V.type==="number"&&z.memoizedProps.value!=null&&co(V,"number",V.value)}switch(de=z?En(z):window,e){case"focusin":(du(de)||de.contentEditable==="true")&&(Gi=de,Ro=z,zn=null);break;case"focusout":zn=Ro=Gi=null;break;case"mousedown":Ao=!0;break;case"contextmenu":case"mouseup":case"dragend":Ao=!1,Ru(J,i,X);break;case"selectionchange":if(Wd)break;case"keydown":case"keyup":Ru(J,i,X)}var Re;if(So)e:{switch(e){case"compositionstart":var Pe="onCompositionStart";break e;case"compositionend":Pe="onCompositionEnd";break e;case"compositionupdate":Pe="onCompositionUpdate";break e}Pe=void 0}else Vi?hu(e,i)&&(Pe="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(Pe="onCompositionStart");Pe&&(cu&&i.locale!=="ko"&&(Vi||Pe!=="onCompositionStart"?Pe==="onCompositionEnd"&&Vi&&(Re=nu()):(Na=X,vo="value"in Na?Na.value:Na.textContent,Vi=!0)),de=Ns(z,Pe),0<de.length&&(Pe=new ou(Pe,e,null,i,X),J.push({event:Pe,listeners:de}),Re?Pe.data=Re:(Re=pu(i),Re!==null&&(Pe.data=Re)))),(Re=Fd?Hd(e,i):Ud(e,i))&&(Pe=Ns(z,"onBeforeInput"),0<Pe.length&&(de=new ou("onBeforeInput","beforeinput",null,i,X),J.push({event:de,listeners:Pe}),de.data=Re)),qf(J,e,z,i,X)}$h(J,t)})}function rl(e,t,i){return{instance:e,listener:t,currentTarget:i}}function Ns(e,t){for(var i=t+"Capture",n=[];e!==null;){var r=e,c=r.stateNode;if(r=r.tag,r!==5&&r!==26&&r!==27||c===null||(r=jn(e,i),r!=null&&n.unshift(rl(e,r,c)),r=jn(e,t),r!=null&&n.push(rl(e,r,c))),e.tag===3)return n;e=e.return}return[]}function Vf(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Ih(e,t,i,n,r){for(var c=t._reactName,d=[];i!==null&&i!==n;){var x=i,A=x.alternate,z=x.stateNode;if(x=x.tag,A!==null&&A===n)break;x!==5&&x!==26&&x!==27||z===null||(A=z,r?(z=jn(i,c),z!=null&&d.unshift(rl(i,z,A))):r||(z=jn(i,c),z!=null&&d.push(rl(i,z,A)))),i=i.return}d.length!==0&&e.push({event:t,listeners:d})}var Gf=/\r\n?/g,Ff=/\u0000|\uFFFD/g;function ep(e){return(typeof e=="string"?e:""+e).replace(Gf,`
`).replace(Ff,"")}function tp(e,t){return t=ep(t),ep(e)===t}function Fe(e,t,i,n,r,c){switch(i){case"children":typeof n=="string"?t==="body"||t==="textarea"&&n===""||zi(e,n):(typeof n=="number"||typeof n=="bigint")&&t!=="body"&&zi(e,""+n);break;case"className":Ll(e,"class",n);break;case"tabIndex":Ll(e,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":Ll(e,i,n);break;case"style":tu(e,n,c);break;case"data":if(t!=="object"){Ll(e,"data",n);break}case"src":case"href":if(n===""&&(t!=="a"||i!=="href")){e.removeAttribute(i);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){e.removeAttribute(i);break}n=ql(""+n),e.setAttribute(i,n);break;case"action":case"formAction":if(typeof n=="function"){e.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof c=="function"&&(i==="formAction"?(t!=="input"&&Fe(e,t,"name",r.name,r,null),Fe(e,t,"formEncType",r.formEncType,r,null),Fe(e,t,"formMethod",r.formMethod,r,null),Fe(e,t,"formTarget",r.formTarget,r,null)):(Fe(e,t,"encType",r.encType,r,null),Fe(e,t,"method",r.method,r,null),Fe(e,t,"target",r.target,r,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){e.removeAttribute(i);break}n=ql(""+n),e.setAttribute(i,n);break;case"onClick":n!=null&&(e.onclick=oa);break;case"onScroll":n!=null&&Ee("scroll",e);break;case"onScrollEnd":n!=null&&Ee("scrollend",e);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(s(61));if(i=n.__html,i!=null){if(r.children!=null)throw Error(s(60));e.innerHTML=i}}break;case"multiple":e.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":e.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){e.removeAttribute("xlink:href");break}i=ql(""+n),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(i,""+n):e.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(i,""):e.removeAttribute(i);break;case"capture":case"download":n===!0?e.setAttribute(i,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(i,n):e.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?e.setAttribute(i,n):e.removeAttribute(i);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?e.removeAttribute(i):e.setAttribute(i,n);break;case"popover":Ee("beforetoggle",e),Ee("toggle",e),Dl(e,"popover",n);break;case"xlinkActuate":sa(e,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":sa(e,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":sa(e,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":sa(e,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":sa(e,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":sa(e,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":sa(e,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":sa(e,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":sa(e,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":Dl(e,"is",n);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=fd.get(i)||i,Dl(e,i,n))}}function $r(e,t,i,n,r,c){switch(i){case"style":tu(e,n,c);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(s(61));if(i=n.__html,i!=null){if(r.children!=null)throw Error(s(60));e.innerHTML=i}}break;case"children":typeof n=="string"?zi(e,n):(typeof n=="number"||typeof n=="bigint")&&zi(e,""+n);break;case"onScroll":n!=null&&Ee("scroll",e);break;case"onScrollEnd":n!=null&&Ee("scrollend",e);break;case"onClick":n!=null&&(e.onclick=oa);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Yc.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(r=i.endsWith("Capture"),t=i.slice(2,r?i.length-7:void 0),c=e[Ne]||null,c=c!=null?c[i]:null,typeof c=="function"&&e.removeEventListener(t,c,r),typeof n=="function")){typeof c!="function"&&c!==null&&(i in e?e[i]=null:e.hasAttribute(i)&&e.removeAttribute(i)),e.addEventListener(t,n,r);break e}i in e?e[i]=n:n===!0?e.setAttribute(i,""):Dl(e,i,n)}}}function mt(e,t,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ee("error",e),Ee("load",e);var n=!1,r=!1,c;for(c in i)if(i.hasOwnProperty(c)){var d=i[c];if(d!=null)switch(c){case"src":n=!0;break;case"srcSet":r=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:Fe(e,t,c,d,i,null)}}r&&Fe(e,t,"srcSet",i.srcSet,i,null),n&&Fe(e,t,"src",i.src,i,null);return;case"input":Ee("invalid",e);var x=c=d=r=null,A=null,z=null;for(n in i)if(i.hasOwnProperty(n)){var X=i[n];if(X!=null)switch(n){case"name":r=X;break;case"type":d=X;break;case"checked":A=X;break;case"defaultChecked":z=X;break;case"value":c=X;break;case"defaultValue":x=X;break;case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(s(137,t));break;default:Fe(e,t,n,X,i,null)}}$c(e,c,x,A,z,d,r,!1);return;case"select":Ee("invalid",e),n=d=c=null;for(r in i)if(i.hasOwnProperty(r)&&(x=i[r],x!=null))switch(r){case"value":c=x;break;case"defaultValue":d=x;break;case"multiple":n=x;default:Fe(e,t,r,x,i,null)}t=c,i=d,e.multiple=!!n,t!=null?qi(e,!!n,t,!1):i!=null&&qi(e,!!n,i,!0);return;case"textarea":Ee("invalid",e),c=r=n=null;for(d in i)if(i.hasOwnProperty(d)&&(x=i[d],x!=null))switch(d){case"value":n=x;break;case"defaultValue":r=x;break;case"children":c=x;break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(s(91));break;default:Fe(e,t,d,x,i,null)}Ic(e,n,r,c);return;case"option":for(A in i)if(i.hasOwnProperty(A)&&(n=i[A],n!=null))switch(A){case"selected":e.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:Fe(e,t,A,n,i,null)}return;case"dialog":Ee("beforetoggle",e),Ee("toggle",e),Ee("cancel",e),Ee("close",e);break;case"iframe":case"object":Ee("load",e);break;case"video":case"audio":for(n=0;n<ol.length;n++)Ee(ol[n],e);break;case"image":Ee("error",e),Ee("load",e);break;case"details":Ee("toggle",e);break;case"embed":case"source":case"link":Ee("error",e),Ee("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(z in i)if(i.hasOwnProperty(z)&&(n=i[z],n!=null))switch(z){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:Fe(e,t,z,n,i,null)}return;default:if(uo(t)){for(X in i)i.hasOwnProperty(X)&&(n=i[X],n!==void 0&&$r(e,t,X,n,i,void 0));return}}for(x in i)i.hasOwnProperty(x)&&(n=i[x],n!=null&&Fe(e,t,x,n,i,null))}function Hf(e,t,i,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,c=null,d=null,x=null,A=null,z=null,X=null;for(H in i){var J=i[H];if(i.hasOwnProperty(H)&&J!=null)switch(H){case"checked":break;case"value":break;case"defaultValue":A=J;default:n.hasOwnProperty(H)||Fe(e,t,H,null,n,J)}}for(var V in n){var H=n[V];if(J=i[V],n.hasOwnProperty(V)&&(H!=null||J!=null))switch(V){case"type":c=H;break;case"name":r=H;break;case"checked":z=H;break;case"defaultChecked":X=H;break;case"value":d=H;break;case"defaultValue":x=H;break;case"children":case"dangerouslySetInnerHTML":if(H!=null)throw Error(s(137,t));break;default:H!==J&&Fe(e,t,V,H,n,J)}}ro(e,d,x,A,z,X,c,r);return;case"select":H=d=x=V=null;for(c in i)if(A=i[c],i.hasOwnProperty(c)&&A!=null)switch(c){case"value":break;case"multiple":H=A;default:n.hasOwnProperty(c)||Fe(e,t,c,null,n,A)}for(r in n)if(c=n[r],A=i[r],n.hasOwnProperty(r)&&(c!=null||A!=null))switch(r){case"value":V=c;break;case"defaultValue":x=c;break;case"multiple":d=c;default:c!==A&&Fe(e,t,r,c,n,A)}t=x,i=d,n=H,V!=null?qi(e,!!i,V,!1):!!n!=!!i&&(t!=null?qi(e,!!i,t,!0):qi(e,!!i,i?[]:"",!1));return;case"textarea":H=V=null;for(x in i)if(r=i[x],i.hasOwnProperty(x)&&r!=null&&!n.hasOwnProperty(x))switch(x){case"value":break;case"children":break;default:Fe(e,t,x,null,n,r)}for(d in n)if(r=n[d],c=i[d],n.hasOwnProperty(d)&&(r!=null||c!=null))switch(d){case"value":V=r;break;case"defaultValue":H=r;break;case"children":break;case"dangerouslySetInnerHTML":if(r!=null)throw Error(s(91));break;default:r!==c&&Fe(e,t,d,r,n,c)}Wc(e,V,H);return;case"option":for(var he in i)if(V=i[he],i.hasOwnProperty(he)&&V!=null&&!n.hasOwnProperty(he))switch(he){case"selected":e.selected=!1;break;default:Fe(e,t,he,null,n,V)}for(A in n)if(V=n[A],H=i[A],n.hasOwnProperty(A)&&V!==H&&(V!=null||H!=null))switch(A){case"selected":e.selected=V&&typeof V!="function"&&typeof V!="symbol";break;default:Fe(e,t,A,V,n,H)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var be in i)V=i[be],i.hasOwnProperty(be)&&V!=null&&!n.hasOwnProperty(be)&&Fe(e,t,be,null,n,V);for(z in n)if(V=n[z],H=i[z],n.hasOwnProperty(z)&&V!==H&&(V!=null||H!=null))switch(z){case"children":case"dangerouslySetInnerHTML":if(V!=null)throw Error(s(137,t));break;default:Fe(e,t,z,V,n,H)}return;default:if(uo(t)){for(var He in i)V=i[He],i.hasOwnProperty(He)&&V!==void 0&&!n.hasOwnProperty(He)&&$r(e,t,He,void 0,n,V);for(X in n)V=n[X],H=i[X],!n.hasOwnProperty(X)||V===H||V===void 0&&H===void 0||$r(e,t,X,V,n,H);return}}for(var D in i)V=i[D],i.hasOwnProperty(D)&&V!=null&&!n.hasOwnProperty(D)&&Fe(e,t,D,null,n,V);for(J in n)V=n[J],H=i[J],!n.hasOwnProperty(J)||V===H||V==null&&H==null||Fe(e,t,J,V,n,H)}function ap(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Uf(){if(typeof performance.getEntriesByType=="function"){for(var e=0,t=0,i=performance.getEntriesByType("resource"),n=0;n<i.length;n++){var r=i[n],c=r.transferSize,d=r.initiatorType,x=r.duration;if(c&&x&&ap(d)){for(d=0,x=r.responseEnd,n+=1;n<i.length;n++){var A=i[n],z=A.startTime;if(z>x)break;var X=A.transferSize,J=A.initiatorType;X&&ap(J)&&(A=A.responseEnd,d+=X*(A<x?1:(x-z)/(A-z)))}if(--n,t+=8*(c+d)/(r.duration/1e3),e++,10<e)break}}if(0<e)return t/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var Wr=null,Ir=null;function Os(e){return e.nodeType===9?e:e.ownerDocument}function ip(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function np(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function ec(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var tc=null;function Qf(){var e=window.event;return e&&e.type==="popstate"?e===tc?!1:(tc=e,!0):(tc=null,!1)}var lp=typeof setTimeout=="function"?setTimeout:void 0,Yf=typeof clearTimeout=="function"?clearTimeout:void 0,sp=typeof Promise=="function"?Promise:void 0,Xf=typeof queueMicrotask=="function"?queueMicrotask:typeof sp<"u"?function(e){return sp.resolve(null).then(e).catch(Zf)}:lp;function Zf(e){setTimeout(function(){throw e})}function Xa(e){return e==="head"}function op(e,t){var i=t,n=0;do{var r=i.nextSibling;if(e.removeChild(i),r&&r.nodeType===8)if(i=r.data,i==="/$"||i==="/&"){if(n===0){e.removeChild(r),fn(t);return}n--}else if(i==="$"||i==="$?"||i==="$~"||i==="$!"||i==="&")n++;else if(i==="html")cl(e.ownerDocument.documentElement);else if(i==="head"){i=e.ownerDocument.head,cl(i);for(var c=i.firstChild;c;){var d=c.nextSibling,x=c.nodeName;c[kn]||x==="SCRIPT"||x==="STYLE"||x==="LINK"&&c.rel.toLowerCase()==="stylesheet"||i.removeChild(c),c=d}}else i==="body"&&cl(e.ownerDocument.body);i=r}while(i);fn(t)}function rp(e,t){var i=e;e=0;do{var n=i.nextSibling;if(i.nodeType===1?t?(i._stashedDisplay=i.style.display,i.style.display="none"):(i.style.display=i._stashedDisplay||"",i.getAttribute("style")===""&&i.removeAttribute("style")):i.nodeType===3&&(t?(i._stashedText=i.nodeValue,i.nodeValue=""):i.nodeValue=i._stashedText||""),n&&n.nodeType===8)if(i=n.data,i==="/$"){if(e===0)break;e--}else i!=="$"&&i!=="$?"&&i!=="$~"&&i!=="$!"||e++;i=n}while(i)}function ac(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var i=t;switch(t=t.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":ac(i),so(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}e.removeChild(i)}}function Kf(e,t,i,n){for(;e.nodeType===1;){var r=i;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!n&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(n){if(!e[kn])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(c=e.getAttribute("rel"),c==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(c!==r.rel||e.getAttribute("href")!==(r.href==null||r.href===""?null:r.href)||e.getAttribute("crossorigin")!==(r.crossOrigin==null?null:r.crossOrigin)||e.getAttribute("title")!==(r.title==null?null:r.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(c=e.getAttribute("src"),(c!==(r.src==null?null:r.src)||e.getAttribute("type")!==(r.type==null?null:r.type)||e.getAttribute("crossorigin")!==(r.crossOrigin==null?null:r.crossOrigin))&&c&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var c=r.name==null?null:""+r.name;if(r.type==="hidden"&&e.getAttribute("name")===c)return e}else return e;if(e=Gt(e.nextSibling),e===null)break}return null}function Jf(e,t,i){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!i||(e=Gt(e.nextSibling),e===null))return null;return e}function cp(e,t){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!t||(e=Gt(e.nextSibling),e===null))return null;return e}function ic(e){return e.data==="$?"||e.data==="$~"}function nc(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function $f(e,t){var i=e.ownerDocument;if(e.data==="$~")e._reactRetry=t;else if(e.data!=="$?"||i.readyState!=="loading")t();else{var n=function(){t(),i.removeEventListener("DOMContentLoaded",n)};i.addEventListener("DOMContentLoaded",n),e._reactRetry=n}}function Gt(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="$~"||t==="&"||t==="F!"||t==="F")break;if(t==="/$"||t==="/&")return null}}return e}var lc=null;function up(e){e=e.nextSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"||i==="/&"){if(t===0)return Gt(e.nextSibling);t--}else i!=="$"&&i!=="$!"&&i!=="$?"&&i!=="$~"&&i!=="&"||t++}e=e.nextSibling}return null}function mp(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"){if(t===0)return e;t--}else i!=="/$"&&i!=="/&"||t++}e=e.previousSibling}return null}function hp(e,t,i){switch(t=Os(i),e){case"html":if(e=t.documentElement,!e)throw Error(s(452));return e;case"head":if(e=t.head,!e)throw Error(s(453));return e;case"body":if(e=t.body,!e)throw Error(s(454));return e;default:throw Error(s(451))}}function cl(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);so(e)}var Ft=new Map,pp=new Set;function Ps(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Ta=$.d;$.d={f:Wf,r:If,D:e0,C:t0,L:a0,m:i0,X:l0,S:n0,M:s0};function Wf(){var e=Ta.f(),t=Ts();return e||t}function If(e){var t=Di(e);t!==null&&t.tag===5&&t.type==="form"?Nm(t):Ta.r(e)}var hn=typeof document>"u"?null:document;function dp(e,t,i){var n=hn;if(n&&typeof t=="string"&&t){var r=Lt(t);r='link[rel="'+e+'"][href="'+r+'"]',typeof i=="string"&&(r+='[crossorigin="'+i+'"]'),pp.has(r)||(pp.add(r),e={rel:e,crossOrigin:i,href:t},n.querySelector(r)===null&&(t=n.createElement("link"),mt(t,"link",e),lt(t),n.head.appendChild(t)))}}function e0(e){Ta.D(e),dp("dns-prefetch",e,null)}function t0(e,t){Ta.C(e,t),dp("preconnect",e,t)}function a0(e,t,i){Ta.L(e,t,i);var n=hn;if(n&&e&&t){var r='link[rel="preload"][as="'+Lt(t)+'"]';t==="image"&&i&&i.imageSrcSet?(r+='[imagesrcset="'+Lt(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(r+='[imagesizes="'+Lt(i.imageSizes)+'"]')):r+='[href="'+Lt(e)+'"]';var c=r;switch(t){case"style":c=pn(e);break;case"script":c=dn(e)}Ft.has(c)||(e=S({rel:"preload",href:t==="image"&&i&&i.imageSrcSet?void 0:e,as:t},i),Ft.set(c,e),n.querySelector(r)!==null||t==="style"&&n.querySelector(ul(c))||t==="script"&&n.querySelector(ml(c))||(t=n.createElement("link"),mt(t,"link",e),lt(t),n.head.appendChild(t)))}}function i0(e,t){Ta.m(e,t);var i=hn;if(i&&e){var n=t&&typeof t.as=="string"?t.as:"script",r='link[rel="modulepreload"][as="'+Lt(n)+'"][href="'+Lt(e)+'"]',c=r;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":c=dn(e)}if(!Ft.has(c)&&(e=S({rel:"modulepreload",href:e},t),Ft.set(c,e),i.querySelector(r)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(ml(c)))return}n=i.createElement("link"),mt(n,"link",e),lt(n),i.head.appendChild(n)}}}function n0(e,t,i){Ta.S(e,t,i);var n=hn;if(n&&e){var r=Li(n).hoistableStyles,c=pn(e);t=t||"default";var d=r.get(c);if(!d){var x={loading:0,preload:null};if(d=n.querySelector(ul(c)))x.loading=5;else{e=S({rel:"stylesheet",href:e,"data-precedence":t},i),(i=Ft.get(c))&&sc(e,i);var A=d=n.createElement("link");lt(A),mt(A,"link",e),A._p=new Promise(function(z,X){A.onload=z,A.onerror=X}),A.addEventListener("load",function(){x.loading|=1}),A.addEventListener("error",function(){x.loading|=2}),x.loading|=4,Ds(d,t,n)}d={type:"stylesheet",instance:d,count:1,state:x},r.set(c,d)}}}function l0(e,t){Ta.X(e,t);var i=hn;if(i&&e){var n=Li(i).hoistableScripts,r=dn(e),c=n.get(r);c||(c=i.querySelector(ml(r)),c||(e=S({src:e,async:!0},t),(t=Ft.get(r))&&oc(e,t),c=i.createElement("script"),lt(c),mt(c,"link",e),i.head.appendChild(c)),c={type:"script",instance:c,count:1,state:null},n.set(r,c))}}function s0(e,t){Ta.M(e,t);var i=hn;if(i&&e){var n=Li(i).hoistableScripts,r=dn(e),c=n.get(r);c||(c=i.querySelector(ml(r)),c||(e=S({src:e,async:!0,type:"module"},t),(t=Ft.get(r))&&oc(e,t),c=i.createElement("script"),lt(c),mt(c,"link",e),i.head.appendChild(c)),c={type:"script",instance:c,count:1,state:null},n.set(r,c))}}function fp(e,t,i,n){var r=(r=ae.current)?Ps(r):null;if(!r)throw Error(s(446));switch(e){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(t=pn(i.href),i=Li(r).hoistableStyles,n=i.get(t),n||(n={type:"style",instance:null,count:0,state:null},i.set(t,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){e=pn(i.href);var c=Li(r).hoistableStyles,d=c.get(e);if(d||(r=r.ownerDocument||r,d={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},c.set(e,d),(c=r.querySelector(ul(e)))&&!c._p&&(d.instance=c,d.state.loading=5),Ft.has(e)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},Ft.set(e,i),c||o0(r,e,i,d.state))),t&&n===null)throw Error(s(528,""));return d}if(t&&n!==null)throw Error(s(529,""));return null;case"script":return t=i.async,i=i.src,typeof i=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=dn(i),i=Li(r).hoistableScripts,n=i.get(t),n||(n={type:"script",instance:null,count:0,state:null},i.set(t,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,e))}}function pn(e){return'href="'+Lt(e)+'"'}function ul(e){return'link[rel="stylesheet"]['+e+"]"}function vp(e){return S({},e,{"data-precedence":e.precedence,precedence:null})}function o0(e,t,i,n){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?n.loading=1:(t=e.createElement("link"),n.preload=t,t.addEventListener("load",function(){return n.loading|=1}),t.addEventListener("error",function(){return n.loading|=2}),mt(t,"link",i),lt(t),e.head.appendChild(t))}function dn(e){return'[src="'+Lt(e)+'"]'}function ml(e){return"script[async]"+e}function gp(e,t,i){if(t.count++,t.instance===null)switch(t.type){case"style":var n=e.querySelector('style[data-href~="'+Lt(i.href)+'"]');if(n)return t.instance=n,lt(n),n;var r=S({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return n=(e.ownerDocument||e).createElement("style"),lt(n),mt(n,"style",r),Ds(n,i.precedence,e),t.instance=n;case"stylesheet":r=pn(i.href);var c=e.querySelector(ul(r));if(c)return t.state.loading|=4,t.instance=c,lt(c),c;n=vp(i),(r=Ft.get(r))&&sc(n,r),c=(e.ownerDocument||e).createElement("link"),lt(c);var d=c;return d._p=new Promise(function(x,A){d.onload=x,d.onerror=A}),mt(c,"link",n),t.state.loading|=4,Ds(c,i.precedence,e),t.instance=c;case"script":return c=dn(i.src),(r=e.querySelector(ml(c)))?(t.instance=r,lt(r),r):(n=i,(r=Ft.get(c))&&(n=S({},i),oc(n,r)),e=e.ownerDocument||e,r=e.createElement("script"),lt(r),mt(r,"link",n),e.head.appendChild(r),t.instance=r);case"void":return null;default:throw Error(s(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(n=t.instance,t.state.loading|=4,Ds(n,i.precedence,e));return t.instance}function Ds(e,t,i){for(var n=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=n.length?n[n.length-1]:null,c=r,d=0;d<n.length;d++){var x=n[d];if(x.dataset.precedence===t)c=x;else if(c!==r)break}c?c.parentNode.insertBefore(e,c.nextSibling):(t=i.nodeType===9?i.head:i,t.insertBefore(e,t.firstChild))}function sc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function oc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var Ls=null;function bp(e,t,i){if(Ls===null){var n=new Map,r=Ls=new Map;r.set(i,n)}else r=Ls,n=r.get(i),n||(n=new Map,r.set(i,n));if(n.has(e))return n;for(n.set(e,null),i=i.getElementsByTagName(e),r=0;r<i.length;r++){var c=i[r];if(!(c[kn]||c[Se]||e==="link"&&c.getAttribute("rel")==="stylesheet")&&c.namespaceURI!=="http://www.w3.org/2000/svg"){var d=c.getAttribute(t)||"";d=e+d;var x=n.get(d);x?x.push(c):n.set(d,[c])}}return n}function xp(e,t,i){e=e.ownerDocument||e,e.head.insertBefore(i,t==="title"?e.querySelector("head > title"):null)}function r0(e,t,i){if(i===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function yp(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function c0(e,t,i,n){if(i.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&(i.state.loading&4)===0){if(i.instance===null){var r=pn(n.href),c=t.querySelector(ul(r));if(c){t=c._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(e.count++,e=ws.bind(e),t.then(e,e)),i.state.loading|=4,i.instance=c,lt(c);return}c=t.ownerDocument||t,n=vp(n),(r=Ft.get(r))&&sc(n,r),c=c.createElement("link"),lt(c);var d=c;d._p=new Promise(function(x,A){d.onload=x,d.onerror=A}),mt(c,"link",n),i.instance=c}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(i,t),(t=i.state.preload)&&(i.state.loading&3)===0&&(e.count++,i=ws.bind(e),t.addEventListener("load",i),t.addEventListener("error",i))}}var rc=0;function u0(e,t){return e.stylesheets&&e.count===0&&zs(e,e.stylesheets),0<e.count||0<e.imgCount?function(i){var n=setTimeout(function(){if(e.stylesheets&&zs(e,e.stylesheets),e.unsuspend){var c=e.unsuspend;e.unsuspend=null,c()}},6e4+t);0<e.imgBytes&&rc===0&&(rc=62500*Uf());var r=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&zs(e,e.stylesheets),e.unsuspend)){var c=e.unsuspend;e.unsuspend=null,c()}},(e.imgBytes>rc?50:800)+t);return e.unsuspend=i,function(){e.unsuspend=null,clearTimeout(n),clearTimeout(r)}}:null}function ws(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)zs(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var qs=null;function zs(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,qs=new Map,t.forEach(m0,e),qs=null,ws.call(e))}function m0(e,t){if(!(t.state.loading&4)){var i=qs.get(e);if(i)var n=i.get(null);else{i=new Map,qs.set(e,i);for(var r=e.querySelectorAll("link[data-precedence],style[data-precedence]"),c=0;c<r.length;c++){var d=r[c];(d.nodeName==="LINK"||d.getAttribute("media")!=="not all")&&(i.set(d.dataset.precedence,d),n=d)}n&&i.set(null,n)}r=t.instance,d=r.getAttribute("data-precedence"),c=i.get(d)||n,c===n&&i.set(null,r),i.set(d,r),this.count++,n=ws.bind(this),r.addEventListener("load",n),r.addEventListener("error",n),c?c.parentNode.insertBefore(r,c.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(r,e.firstChild)),t.state.loading|=4}}var hl={$$typeof:I,Provider:null,Consumer:null,_currentValue:le,_currentValue2:le,_threadCount:0};function h0(e,t,i,n,r,c,d,x,A){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Rn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Rn(0),this.hiddenUpdates=Rn(null),this.identifierPrefix=n,this.onUncaughtError=r,this.onCaughtError=c,this.onRecoverableError=d,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=A,this.incompleteTransitions=new Map}function Sp(e,t,i,n,r,c,d,x,A,z,X,J){return e=new h0(e,t,i,d,A,z,X,J,x),t=1,c===!0&&(t|=24),c=kt(3,null,null,t),e.current=c,c.stateNode=e,t=Go(),t.refCount++,e.pooledCache=t,t.refCount++,c.memoizedState={element:n,isDehydrated:i,cache:t},Qo(c),e}function Mp(e){return e?(e=Ui,e):Ui}function Tp(e,t,i,n,r,c){r=Mp(r),n.context===null?n.context=r:n.pendingContext=r,n=qa(t),n.payload={element:i},c=c===void 0?null:c,c!==null&&(n.callback=c),i=za(e,n,t),i!==null&&(Ct(i,e,t),Un(i,e,t))}function Cp(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function cc(e,t){Cp(e,t),(e=e.alternate)&&Cp(e,t)}function Rp(e){if(e.tag===13||e.tag===31){var t=ri(e,67108864);t!==null&&Ct(t,e,67108864),cc(e,67108864)}}function Ap(e){if(e.tag===13||e.tag===31){var t=Pt();t=Q(t);var i=ri(e,t);i!==null&&Ct(i,e,t),cc(e,t)}}var Bs=!0;function p0(e,t,i,n){var r=F.T;F.T=null;var c=$.p;try{$.p=2,uc(e,t,i,n)}finally{$.p=c,F.T=r}}function d0(e,t,i,n){var r=F.T;F.T=null;var c=$.p;try{$.p=8,uc(e,t,i,n)}finally{$.p=c,F.T=r}}function uc(e,t,i,n){if(Bs){var r=mc(n);if(r===null)Jr(e,t,n,_s,i),Ep(e,n);else if(v0(r,e,t,i,n))n.stopPropagation();else if(Ep(e,n),t&4&&-1<f0.indexOf(e)){for(;r!==null;){var c=Di(r);if(c!==null)switch(c.tag){case 3:if(c=c.stateNode,c.current.memoizedState.isDehydrated){var d=la(c.pendingLanes);if(d!==0){var x=c;for(x.pendingLanes|=2,x.entangledLanes|=2;d;){var A=1<<31-gt(d);x.entanglements[1]|=A,d&=~A}ea(c),(ze&6)===0&&(Ss=ft()+500,sl(0))}}break;case 31:case 13:x=ri(c,2),x!==null&&Ct(x,c,2),Ts(),cc(c,2)}if(c=mc(n),c===null&&Jr(e,t,n,_s,i),c===r)break;r=c}r!==null&&n.stopPropagation()}else Jr(e,t,n,null,i)}}function mc(e){return e=ho(e),hc(e)}var _s=null;function hc(e){if(_s=null,e=Pi(e),e!==null){var t=h(e);if(t===null)e=null;else{var i=t.tag;if(i===13){if(e=p(t),e!==null)return e;e=null}else if(i===31){if(e=f(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return _s=e,null}function kp(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch($s()){case Al:return 2;case kl:return 8;case ki:case Ws:return 32;case El:return 268435456;default:return 32}default:return 32}}var pc=!1,Za=null,Ka=null,Ja=null,pl=new Map,dl=new Map,$a=[],f0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ep(e,t){switch(e){case"focusin":case"focusout":Za=null;break;case"dragenter":case"dragleave":Ka=null;break;case"mouseover":case"mouseout":Ja=null;break;case"pointerover":case"pointerout":pl.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":dl.delete(t.pointerId)}}function fl(e,t,i,n,r,c){return e===null||e.nativeEvent!==c?(e={blockedOn:t,domEventName:i,eventSystemFlags:n,nativeEvent:c,targetContainers:[r]},t!==null&&(t=Di(t),t!==null&&Rp(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,r!==null&&t.indexOf(r)===-1&&t.push(r),e)}function v0(e,t,i,n,r){switch(t){case"focusin":return Za=fl(Za,e,t,i,n,r),!0;case"dragenter":return Ka=fl(Ka,e,t,i,n,r),!0;case"mouseover":return Ja=fl(Ja,e,t,i,n,r),!0;case"pointerover":var c=r.pointerId;return pl.set(c,fl(pl.get(c)||null,e,t,i,n,r)),!0;case"gotpointercapture":return c=r.pointerId,dl.set(c,fl(dl.get(c)||null,e,t,i,n,r)),!0}return!1}function jp(e){var t=Pi(e.target);if(t!==null){var i=h(t);if(i!==null){if(t=i.tag,t===13){if(t=p(i),t!==null){e.blockedOn=t,pe(e.priority,function(){Ap(i)});return}}else if(t===31){if(t=f(i),t!==null){e.blockedOn=t,pe(e.priority,function(){Ap(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Vs(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=mc(e.nativeEvent);if(i===null){i=e.nativeEvent;var n=new i.constructor(i.type,i);mo=n,i.target.dispatchEvent(n),mo=null}else return t=Di(i),t!==null&&Rp(t),e.blockedOn=i,!1;t.shift()}return!0}function Np(e,t,i){Vs(e)&&i.delete(t)}function g0(){pc=!1,Za!==null&&Vs(Za)&&(Za=null),Ka!==null&&Vs(Ka)&&(Ka=null),Ja!==null&&Vs(Ja)&&(Ja=null),pl.forEach(Np),dl.forEach(Np)}function Gs(e,t){e.blockedOn===t&&(e.blockedOn=null,pc||(pc=!0,m.unstable_scheduleCallback(m.unstable_NormalPriority,g0)))}var Fs=null;function Op(e){Fs!==e&&(Fs=e,m.unstable_scheduleCallback(m.unstable_NormalPriority,function(){Fs===e&&(Fs=null);for(var t=0;t<e.length;t+=3){var i=e[t],n=e[t+1],r=e[t+2];if(typeof n!="function"){if(hc(n||i)===null)continue;break}var c=Di(i);c!==null&&(e.splice(t,3),t-=3,mr(c,{pending:!0,data:r,method:i.method,action:n},n,r))}}))}function fn(e){function t(A){return Gs(A,e)}Za!==null&&Gs(Za,e),Ka!==null&&Gs(Ka,e),Ja!==null&&Gs(Ja,e),pl.forEach(t),dl.forEach(t);for(var i=0;i<$a.length;i++){var n=$a[i];n.blockedOn===e&&(n.blockedOn=null)}for(;0<$a.length&&(i=$a[0],i.blockedOn===null);)jp(i),i.blockedOn===null&&$a.shift();if(i=(e.ownerDocument||e).$$reactFormReplay,i!=null)for(n=0;n<i.length;n+=3){var r=i[n],c=i[n+1],d=r[Ne]||null;if(typeof c=="function")d||Op(i);else if(d){var x=null;if(c&&c.hasAttribute("formAction")){if(r=c,d=c[Ne]||null)x=d.formAction;else if(hc(r)!==null)continue}else x=d.action;typeof x=="function"?i[n+1]=x:(i.splice(n,3),n-=3),Op(i)}}}function Pp(){function e(c){c.canIntercept&&c.info==="react-transition"&&c.intercept({handler:function(){return new Promise(function(d){return r=d})},focusReset:"manual",scroll:"manual"})}function t(){r!==null&&(r(),r=null),n||setTimeout(i,20)}function i(){if(!n&&!navigation.transition){var c=navigation.currentEntry;c&&c.url!=null&&navigation.navigate(c.url,{state:c.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var n=!1,r=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(i,100),function(){n=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),r!==null&&(r(),r=null)}}}function dc(e){this._internalRoot=e}Hs.prototype.render=dc.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(s(409));var i=t.current,n=Pt();Tp(i,n,e,t,null,null)},Hs.prototype.unmount=dc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Tp(e.current,2,null,e,null,null),Ts(),t[nt]=null}};function Hs(e){this._internalRoot=e}Hs.prototype.unstable_scheduleHydration=function(e){if(e){var t=re();e={blockedOn:null,target:e,priority:t};for(var i=0;i<$a.length&&t!==0&&t<$a[i].priority;i++);$a.splice(i,0,e),i===0&&jp(e)}};var Dp=a.version;if(Dp!=="19.2.1")throw Error(s(527,Dp,"19.2.1"));$.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(s(188)):(e=Object.keys(e).join(","),Error(s(268,e)));return e=b(t),e=e!==null?M(e):null,e=e===null?null:e.stateNode,e};var b0={bundleType:0,version:"19.2.1",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.2.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Us=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Us.isDisabled&&Us.supportsFiber)try{ti=Us.inject(b0),vt=Us}catch{}}return gl.createRoot=function(e,t){if(!u(e))throw Error(s(299));var i=!1,n="",r=Vm,c=Gm,d=Fm;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onUncaughtError!==void 0&&(r=t.onUncaughtError),t.onCaughtError!==void 0&&(c=t.onCaughtError),t.onRecoverableError!==void 0&&(d=t.onRecoverableError)),t=Sp(e,1,!1,null,null,i,n,null,r,c,d,Pp),e[nt]=t.current,Kr(e),new dc(t)},gl.hydrateRoot=function(e,t,i){if(!u(e))throw Error(s(299));var n=!1,r="",c=Vm,d=Gm,x=Fm,A=null;return i!=null&&(i.unstable_strictMode===!0&&(n=!0),i.identifierPrefix!==void 0&&(r=i.identifierPrefix),i.onUncaughtError!==void 0&&(c=i.onUncaughtError),i.onCaughtError!==void 0&&(d=i.onCaughtError),i.onRecoverableError!==void 0&&(x=i.onRecoverableError),i.formState!==void 0&&(A=i.formState)),t=Sp(e,1,!0,t,i??null,n,r,A,c,d,x,Pp),t.context=Mp(null),i=t.current,n=Pt(),n=Q(n),r=qa(n),r.callback=null,za(i,r,n),i=n,t.current.lanes=i,ii(t,i),ea(t),e[nt]=t.current,Kr(e),new Hs(t)},gl.version="19.2.1",gl}var Hp;function E0(){if(Hp)return gc.exports;Hp=1;function m(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(m)}catch(a){console.error(a)}}return m(),gc.exports=k0(),gc.exports}var j0=E0();class N0{audioContext;workletNode=null;tickCallbacks=new Set;isInitialized=!1;_isRunning=!1;_bpm=120;_swing=0;_ppqn=96;constructor(a){this.audioContext=a}async init(){if(this.isInitialized)return;await this.audioContext.audioWorklet.addModule("/tQr4x/worklets/master-clock-processor.js"),this.workletNode=new AudioWorkletNode(this.audioContext,"master-clock-processor"),this.workletNode.port.onmessage=l=>{const s=l.data;s.type==="tick"&&this.handleTick(s)},this.workletNode.connect(this.audioContext.destination),this.isInitialized=!0}handleTick(a){for(const l of this.tickCallbacks)l(a)}onTick(a){return this.tickCallbacks.add(a),()=>{this.tickCallbacks.delete(a)}}start(){if(!this.workletNode)throw new Error("MasterClock not initialized. Call init() first.");this.workletNode.port.postMessage({type:"start"}),this._isRunning=!0}stop(){this.workletNode&&(this.workletNode.port.postMessage({type:"stop"}),this._isRunning=!1)}pause(){this.workletNode&&(this.workletNode.port.postMessage({type:"pause"}),this._isRunning=!1)}resume(){this.workletNode&&(this.workletNode.port.postMessage({type:"resume"}),this._isRunning=!0)}get isRunning(){return this._isRunning}get bpm(){return this._bpm}set bpm(a){this._bpm=Math.max(20,Math.min(300,a)),this.workletNode&&this.workletNode.port.postMessage({type:"setTempo",bpm:this._bpm})}get swing(){return this._swing}set swing(a){this._swing=Math.max(0,Math.min(1,a)),this.workletNode&&this.workletNode.port.postMessage({type:"setSwing",swing:this._swing})}get ppqn(){return this._ppqn}set ppqn(a){this._ppqn=a,this.workletNode&&this.workletNode.port.postMessage({type:"setPpqn",ppqn:this._ppqn})}get currentTime(){return this.audioContext.currentTime}get samplesPerTick(){const a=this._bpm/60*this._ppqn;return this.audioContext.sampleRate/a}get secondsPerStep(){return 1/(this._bpm/60*4)}dispose(){this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.tickCallbacks.clear(),this.isInitialized=!1}}const $p={major:[0,2,4,5,7,9,11],dorian:[0,2,3,5,7,9,10],phrygian:[0,1,3,5,7,8,10],lydian:[0,2,4,6,7,9,11],mixolydian:[0,2,4,5,7,9,10],minor:[0,2,3,5,7,8,10],locrian:[0,1,3,5,6,8,10],harmonicMinor:[0,2,3,5,7,8,11],melodicMinor:[0,2,3,5,7,9,11],pentatonicMajor:[0,2,4,7,9],pentatonicMinor:[0,3,5,7,10],blues:[0,3,5,6,7,10],wholeTone:[0,2,4,6,8,10],diminished:[0,2,3,5,6,8,9,11],chromatic:[0,1,2,3,4,5,6,7,8,9,10,11],hirajoshi:[0,2,3,7,8],insen:[0,1,5,7,10],iwato:[0,1,5,6,10],hungarian:[0,2,3,6,7,8,11],arabic:[0,1,4,5,7,8,11]},Bc=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function Cl(m,a=3){const l=$p[m.scale];if(!l)return[];const s=[],u=m.root+(m.octave+1)*12;for(let h=0;h<a;h++)for(const p of l){const f=u+p+h*12;f>=0&&f<=127&&s.push(f)}return s}function O0(m,a,l=1){const s=Cl(a,4),u=s.indexOf(m);if(u===-1){let h=0,p=Math.abs(s[0]-m);for(let f=1;f<s.length;f++){const g=Math.abs(s[f]-m);g<p&&(p=g,h=f)}return Up(s,h,l)}return Up(s,u,l)}function Up(m,a,l){const s=[];for(let u=-l;u<=l;u++){const h=a+u;h>=0&&h<m.length&&s.push(m[h])}return s}function P0(m,a,l){if(a<=0)return m;const s=Cl(l,4);if(a>=1)return s[Math.floor(Math.random()*s.length)];if(Math.random()>a)return m;const u=Math.ceil(a*s.length*.5),h=O0(m,l,u),p=h.map((b,M)=>{const S=Math.abs(M-Math.floor(h.length/2));return Math.pow(1-a,S+1)}),f=p.reduce((b,M)=>b+M,0);let g=Math.random()*f;for(let b=0;b<h.length;b++)if(g-=p[b],g<=0)return h[b];return h[h.length-1]}function D0(m,a){if(a===0)return m;if(a<0){if(!m)return!1;const l=Math.abs(a);return Math.random()>l}else return m?!0:Math.random()<a}function bl(m){const a=Math.floor(m/12)-1,l=m%12;return Bc[l]+a}class L0{editState={isActive:!1,trackId:"",stepIndex:-1};trackLatchedStates=new Map;editStateListeners=new Set;auditionCallback=null;enterEditMode(a,l){this.editState.isActive&&(this.editState.trackId!==a||this.editState.stepIndex!==l)&&this.exitEditMode(),this.editState={isActive:!0,trackId:a,stepIndex:l},this.notifyEditStateListeners()}exitEditMode(){this.editState.isActive&&(this.editState={isActive:!1,trackId:"",stepIndex:-1},this.notifyEditStateListeners())}toggleEditMode(a,l){return this.editState.isActive&&this.editState.trackId===a&&this.editState.stepIndex===l?(this.exitEditMode(),!1):(this.enterEditMode(a,l),!0)}getEditState(){return{...this.editState}}isEditing(a,l){return this.editState.isActive&&this.editState.trackId===a&&this.editState.stepIndex===l}isEditingTrack(a){return this.editState.isActive&&this.editState.trackId===a}onEditStateChange(a){return this.editStateListeners.add(a),()=>this.editStateListeners.delete(a)}notifyEditStateListeners(){const a=this.getEditState();for(const l of this.editStateListeners)l(a)}setAuditionCallback(a){this.auditionCallback=a}triggerAudition(){this.editState.isActive&&this.auditionCallback&&this.auditionCallback(this.editState.trackId,this.editState.stepIndex)}initTrackLatchedState(a){this.trackLatchedStates.has(a)||this.trackLatchedStates.set(a,{latchedParams:{},lastTrigStep:-1})}getTrackLatchedState(a){return this.trackLatchedStates.get(a)??null}updateLatchedParams(a,l,s,u){this.initTrackLatchedState(a);const h=this.trackLatchedStates.get(a);return u&&s?h.latchedParams={...s}:h.latchedParams={},h.lastTrigStep=l,{...h.latchedParams}}getLatchedParams(a){return{...this.trackLatchedStates.get(a)?.latchedParams??{}}}clearLatchedParams(a){const l=this.trackLatchedStates.get(a);l&&(l.latchedParams={},l.lastTrigStep=-1)}clearAllLatchedParams(){for(const a of this.trackLatchedStates.keys())this.clearLatchedParams(a)}reset(){this.exitEditMode(),this.clearAllLatchedParams()}shouldRouteToStepLocks(a){return this.editState.isActive&&this.editState.trackId===a?this.editState.stepIndex:-1}}const ta=new L0;function ot(m){return JSON.parse(JSON.stringify(m))}const Ht=16,Dc={"1/8":.125,"1/4":.25,"1/2":.5,"1/1":1,"2/1":2,"4/1":4,"8/1":8};class w0{clock;tracks=new Map;triggerCallbacks=new Map;trackStepPositions=new Map;trackCycleCounts=new Map;trackTickAccumulators=new Map;unsubscribeClock=null;lastGlobalTick=0;globalScale={root:0,scale:"minor",octave:3};activePatternSlot=1;patternBankClipboard=null;patternSlotListeners=new Set;patternSlotConfigs=new Map;patternSequencerEnabled=!1;patternSequencerCells=Array(16).fill(null).map(()=>({patternSlot:null,cycles:1}));patternSequencerCurrentCell=0;patternSequencerCycleCount=0;patternSequencerListeners=new Set;lastTrack1CycleCount=0;constructor(a){this.clock=a}start(){for(const a of this.tracks.keys())this.trackStepPositions.set(a,0),this.trackCycleCounts.set(a,1),this.trackTickAccumulators.set(a,0);this.lastGlobalTick=0,this.unsubscribeClock=this.clock.onTick(a=>{this.handleTick(a)})}stop(){this.unsubscribeClock&&(this.unsubscribeClock(),this.unsubscribeClock=null)}resyncTrack(a){const l=this.tracks.get(a);if(!l)return;const s=l.patterns.get(l.currentPatternId);if(!s){this.trackStepPositions.set(a,0),this.trackCycleCounts.set(a,1),this.trackTickAccumulators.set(a,0);return}let u=1;l.clockConfig.useGlobalClock||(u=Dc[l.clockConfig.division]);const h=this.clock.ppqn/4,f=this.lastGlobalTick/h*u/s.division,g=s.length,b=Math.floor(f),M=b%g,S=Math.floor(b/g)+1,y=f-b,j=h*s.division/u,C=y*j;this.trackStepPositions.set(a,M),this.trackCycleCounts.set(a,S),this.trackTickAccumulators.set(a,C)}resyncAllTracks(){for(const a of this.tracks.keys())this.trackStepPositions.set(a,0),this.trackCycleCounts.set(a,1),this.trackTickAccumulators.set(a,0);this.lastGlobalTick=0,this.pendingResetToCurrentTick=!0}pendingResetToCurrentTick=!1;handleTick(a){if(this.pendingResetToCurrentTick){this.lastGlobalTick=a.tick,this.pendingResetToCurrentTick=!1;return}const l=this.clock.ppqn/4,s=a.tick-this.lastGlobalTick;this.lastGlobalTick=a.tick;for(const[u,h]of this.tracks){if(h.muted)continue;const p=h.patterns.get(h.currentPatternId);if(!p)continue;let f=1;h.clockConfig.useGlobalClock||(f=Dc[h.clockConfig.division]);const g=l*p.division/f;let b=this.trackTickAccumulators.get(u)||0;for(b+=s;b>=g;){b-=g;let M=this.trackStepPositions.get(u)||0;const S=p.steps[M%p.length],y=this.trackCycleCounts.get(u)||1;this.processStep(u,h,p,S,M,a,y);const j=M;M=(M+1)%p.length,this.trackStepPositions.set(u,M),M===0&&j===p.length-1&&(this.trackCycleCounts.set(u,y+1),u==="track1"&&this.checkPatternSequencerAdvance())}this.trackTickAccumulators.set(u,b)}}processStep(a,l,s,u,h,p,f){if(!D0(u.trigger,l.performance.fill))return;if(u.condition){const{a:W,b:I}=u.condition;if((f-1)%I+1!==W)return}if(u.trigger&&u.probability<1&&Math.random()>u.probability)return;const b=this.clock.secondsPerStep*s.division,M=u.microTime*b,S=p.time+M,y=this.triggerCallbacks.get(a);if(!y||y.size===0)return;let j=u.note;j!==void 0&&this.globalScale&&l.performance.drift>0&&(j=P0(j,l.performance.drift,this.globalScale));const C=u.hasParamLocks===!0&&u.paramLocks!==void 0,B=ta.updateLatchedParams(a,h,u.paramLocks,C),G=u.ratchets>0?u.ratchets+1:1,Z=b/G;for(let W=0;W<G;W++){const I=S+W*Z,Y=W>0?Math.pow(.7,W):1,O=(u.trigger?u.velocity:.6)*Y,w={trackId:a,time:I,velocity:O,step:h,isRatchet:W>0,ratchetIndex:W,note:j,paramLocks:u.paramLocks,latchedParams:B};for(const L of y)L(w)}}createTrack(a,l){const s=new Map;for(let h=1;h<=Ht;h++){const p=this.createDefaultPattern(`${a}-pattern-${h}`,`Pattern ${h}`,16);s.set(p.id,p)}const u={id:a,name:l,muted:!1,solo:!1,currentPatternId:`${a}-pattern-1`,patterns:s,performance:{drift:0,fill:0},clockConfig:{useGlobalClock:!0,division:"1/1"}};return this.tracks.set(a,u),this.trackStepPositions.set(a,0),this.trackCycleCounts.set(a,1),this.trackTickAccumulators.set(a,0),u}setTrackDrift(a,l){const s=this.tracks.get(a);s&&(s.performance.drift=Math.max(0,Math.min(1,l)))}setTrackFill(a,l){const s=this.tracks.get(a);s&&(s.performance.fill=Math.max(-1,Math.min(1,l)))}setTrackOctave(a,l){const s=this.tracks.get(a);s&&(s.performance.octaveRange=Math.max(0,Math.min(6,l)))}getTrackOctave(a){return this.tracks.get(a)?.performance.octaveRange}setTrackScale(a,l){this.globalScale=l}setGlobalScale(a){this.globalScale=a}getTrackPerformance(a){return this.tracks.get(a)?.performance??null}setTrackClockConfig(a,l){const s=this.tracks.get(a);s&&(l.useGlobalClock!==void 0&&(s.clockConfig.useGlobalClock=l.useGlobalClock),l.division!==void 0&&(s.clockConfig.division=l.division))}getTrackClockConfig(a){return this.tracks.get(a)?.clockConfig??null}getTrackScale(a){return this.globalScale}getGlobalScale(){return this.globalScale}getTrack(a){return this.tracks.get(a)}getAllTracks(){return Array.from(this.tracks.values())}getTrackStepPosition(a){return this.trackStepPositions.get(a)??0}deleteTrack(a){this.tracks.delete(a),this.trackStepPositions.delete(a),this.trackCycleCounts.delete(a),this.trackTickAccumulators.delete(a),this.triggerCallbacks.delete(a)}createDefaultPattern(a,l,s){const u=[];for(let h=0;h<s;h++)u.push({trigger:!1,velocity:.8,microTime:0,probability:1,ratchets:0});return{id:a,name:l,length:s,division:1,steps:u}}createPattern(a,l,s,u){const h=this.tracks.get(a);if(!h)return null;const p=this.createDefaultPattern(l,s,u);return h.patterns.set(l,p),p}getCurrentPattern(a){const l=this.tracks.get(a);return l&&l.patterns.get(l.currentPatternId)||null}setCurrentPattern(a,l){const s=this.tracks.get(a);return!s||!s.patterns.has(l)?!1:(s.currentPatternId=l,!0)}setStep(a,l,s){const u=this.getCurrentPattern(a);return!u||l<0||l>=u.length?!1:(Object.assign(u.steps[l],s),!0)}getStep(a,l){const s=this.getCurrentPattern(a);return!s||l<0||l>=s.length?null:s.steps[l]}toggleStep(a,l){const s=this.getStep(a,l);return s?(s.trigger=!s.trigger,s.trigger):!1}setPatternLength(a,l){const s=this.getCurrentPattern(a);if(!s)return!1;const u=s.length;if(s.length=l,l>u)for(let h=u;h<l;h++)s.steps.push({trigger:!1,velocity:.8,microTime:0,probability:1,ratchets:0});else s.steps.length=l;return!0}setPatternDivision(a,l){const s=this.getCurrentPattern(a);return s?(s.division=l,!0):!1}onTrigger(a,l){return this.triggerCallbacks.has(a)||this.triggerCallbacks.set(a,new Set),this.triggerCallbacks.get(a).add(l),()=>{this.triggerCallbacks.get(a)?.delete(l)}}setMuted(a,l){const s=this.tracks.get(a);s&&(s.muted=l)}setSolo(a,l){const s=this.tracks.get(a);s&&(s.solo=l)}getState(){const a=[];for(const l of this.tracks.values())a.push({id:l.id,name:l.name,muted:l.muted,solo:l.solo,currentPatternId:l.currentPatternId,patterns:Array.from(l.patterns.values()),performance:{...l.performance},scale:l.scale,clockConfig:{...l.clockConfig}});return{tracks:a}}setState(a){this.tracks.clear();for(const l of a.tracks){const s={id:l.id,name:l.name,muted:l.muted,solo:l.solo,currentPatternId:l.currentPatternId,patterns:new Map(l.patterns.map(u=>[u.id,u])),performance:l.performance??{drift:0,fill:0},scale:l.scale,clockConfig:l.clockConfig??{useGlobalClock:!0,division:"1/1"}};this.tracks.set(s.id,s),this.trackStepPositions.set(s.id,0),this.trackCycleCounts.set(s.id,1),this.trackTickAccumulators.set(s.id,0)}}getActivePatternSlot(){return this.activePatternSlot}setActivePatternSlot(a){if(a<1||a>Ht)return!1;this.activePatternSlot=a;for(const l of this.tracks.values()){const s=`${l.id}-pattern-${a}`;l.patterns.has(s)&&(l.currentPatternId=s)}for(const l of this.patternSlotListeners)l(a);return!0}onPatternSlotChange(a){return this.patternSlotListeners.add(a),()=>this.patternSlotListeners.delete(a)}ensureSlotInitialized(a){return this.patternSlotConfigs.has(a)||this.patternSlotConfigs.set(a,{trackConfigs:new Map,channelConfigs:new Map,trackPerformance:new Map}),this.patternSlotConfigs.get(a)}hasSlotConfig(a){return this.patternSlotConfigs.has(a)}getSlotVoiceConfig(a,l){return this.patternSlotConfigs.get(a)?.trackConfigs.get(l)}setSlotVoiceConfig(a,l,s){this.ensureSlotInitialized(a).trackConfigs.set(l,ot(s))}getSlotChannelConfig(a,l){return this.patternSlotConfigs.get(a)?.channelConfigs.get(l)}setSlotChannelConfig(a,l,s){this.ensureSlotInitialized(a).channelConfigs.set(l,ot(s))}getSlotPerformanceConfig(a,l){return this.patternSlotConfigs.get(a)?.trackPerformance.get(l)}setSlotPerformanceConfig(a,l,s){this.ensureSlotInitialized(a).trackPerformance.set(l,ot(s))}getSlotTrackIds(a){const l=this.patternSlotConfigs.get(a);return l?Array.from(l.trackConfigs.keys()):[]}hasSlotVoiceConfig(a,l){return this.patternSlotConfigs.get(a)?.trackConfigs.has(l)??!1}hasSlotChannelConfig(a,l){return this.patternSlotConfigs.get(a)?.channelConfigs.has(l)??!1}slotHasVoiceConfigs(a){const l=this.patternSlotConfigs.get(a);return l!==void 0&&l.trackConfigs.size>0}slotHasChannelConfigs(a){const l=this.patternSlotConfigs.get(a);return l!==void 0&&l.channelConfigs.size>0}slotHasPerformanceConfigs(a){const l=this.patternSlotConfigs.get(a);return l!==void 0&&l.trackPerformance.size>0}getSlotFXConfig(a){return this.patternSlotConfigs.get(a)?.fxConfig}setSlotFXConfig(a,l){const s=this.ensureSlotInitialized(a);s.fxConfig=ot(l)}slotHasFXConfig(a){return this.patternSlotConfigs.get(a)?.fxConfig!==void 0}exportSlotConfigs(){const a={};return this.patternSlotConfigs.forEach((l,s)=>{const u=[];l.trackConfigs.forEach((f,g)=>{u.push({trackId:g,config:ot(f)})});const h=[];l.channelConfigs.forEach((f,g)=>{h.push({trackId:g,config:ot(f)})});const p=[];l.trackPerformance.forEach((f,g)=>{p.push({trackId:g,config:ot(f)})}),a[s]={trackConfigs:u,channelConfigs:h,performanceConfigs:p,fxConfig:l.fxConfig?ot(l.fxConfig):void 0}}),a}importSlotConfigs(a){this.patternSlotConfigs.clear();for(const[l,s]of Object.entries(a)){const u=parseInt(l,10);if(isNaN(u))continue;const h={trackConfigs:new Map,channelConfigs:new Map,trackPerformance:new Map};for(const{trackId:p,config:f}of s.trackConfigs)h.trackConfigs.set(p,ot(f));for(const{trackId:p,config:f}of s.channelConfigs)h.channelConfigs.set(p,ot(f));for(const{trackId:p,config:f}of s.performanceConfigs)h.trackPerformance.set(p,ot(f));s.fxConfig&&(h.fxConfig=ot(s.fxConfig)),this.patternSlotConfigs.set(u,h)}}isPatternSlotEmpty(a){for(const l of this.tracks.values()){const s=`${l.id}-pattern-${a}`,u=l.patterns.get(s);if(u){for(const h of u.steps)if(h.trigger||h.hasParamLocks)return!1}}return!0}clearPatternSlot(a){if(a<1||a>Ht)return!1;for(const l of this.tracks.values()){const s=`${l.id}-pattern-${a}`,u=l.patterns.get(s);if(u)for(let h=0;h<u.steps.length;h++)u.steps[h]={trigger:!1,velocity:.8,microTime:0,probability:1,ratchets:0}}return!0}copyPatternSlot(a,l,s,u){if(a<1||a>Ht)return!1;const h={mode:l,trackConfigs:[],channelConfigs:[],trackPerformance:[]};for(const p of this.tracks.values()){const f=s(p.id);f&&h.trackConfigs.push({trackId:p.id,voiceType:f.voiceType,preset:f.preset,params:f.params?ot(f.params):void 0,note:f.note});const g=u(p.id);g&&h.channelConfigs.push({trackId:p.id,filter:ot(g.filter),saturation:ot(g.saturation),delaySend:g.delaySend,delaySend2:g.delaySend2,delaySend3:g.delaySend3,delaySend4:g.delaySend4,reverbSend:g.reverbSend,volume:g.volume,pan:g.pan}),h.trackPerformance.push({trackId:p.id,performance:{...p.performance},clockConfig:{...p.clockConfig}})}if(l==="all"){h.patterns=[];for(const p of this.tracks.values()){const f=`${p.id}-pattern-${a}`,g=p.patterns.get(f);g&&h.patterns.push({trackId:p.id,pattern:{id:g.id,name:g.name,length:g.length,division:g.division,steps:g.steps.map(b=>({...b,paramLocks:b.paramLocks?{...b.paramLocks}:void 0,condition:b.condition?{...b.condition}:void 0}))}})}}return this.patternBankClipboard=h,!0}pastePatternSlot(a,l,s){if(a<1||a>Ht||!this.patternBankClipboard)return!1;const u=this.patternBankClipboard;for(const h of u.trackConfigs)l(h.trackId,{voiceType:h.voiceType,preset:h.preset,params:h.params?ot(h.params):void 0,note:h.note});for(const h of u.channelConfigs)s(h.trackId,{filter:ot(h.filter),saturation:ot(h.saturation),delaySend:h.delaySend,delaySend2:h.delaySend2,delaySend3:h.delaySend3,delaySend4:h.delaySend4,reverbSend:h.reverbSend,volume:h.volume,pan:h.pan});for(const h of u.trackPerformance){const p=this.tracks.get(h.trackId);p&&(p.performance={...h.performance},p.clockConfig={...h.clockConfig})}if(u.patterns)for(const h of u.patterns){const p=this.tracks.get(h.trackId);if(p){const f=`${h.trackId}-pattern-${a}`,g=p.patterns.get(f);g&&(g.length=h.pattern.length,g.division=h.pattern.division,g.steps=h.pattern.steps.map(b=>({...b,paramLocks:b.paramLocks?{...b.paramLocks}:void 0,condition:b.condition?{...b.condition}:void 0})))}}return!0}hasPatternClipboard(){return this.patternBankClipboard!==null}getPatternClipboardMode(){return this.patternBankClipboard?.mode??null}clearPatternClipboard(){this.patternBankClipboard=null}getPatternForSlot(a,l){if(l<1||l>Ht)return null;const s=this.tracks.get(a);return s?s.patterns.get(`${a}-pattern-${l}`)??null:null}checkPatternSequencerAdvance(){if(!this.patternSequencerEnabled)return;const a=this.trackCycleCounts.get("track1")||1;if(a>this.lastTrack1CycleCount){this.lastTrack1CycleCount=a,this.patternSequencerCycleCount++;const l=this.patternSequencerCells[this.patternSequencerCurrentCell];l&&l.patternSlot!==null&&this.patternSequencerCycleCount>=l.cycles&&this.advanceToNextCell(),this.notifyPatternSequencerListeners()}}advanceToNextCell(){let l=(this.patternSequencerCurrentCell+1)%16,s=0;for(;s<16;){const u=this.patternSequencerCells[l];if(u&&u.patternSlot!==null){this.patternSequencerCurrentCell=l,this.patternSequencerCycleCount=0,this.setActivePatternSlot(u.patternSlot);return}l=(l+1)%16,s++}this.patternSequencerEnabled=!1,this.notifyPatternSequencerListeners()}setPatternSequencerEnabled(a){if(this.patternSequencerEnabled=a,a){this.patternSequencerCurrentCell=-1,this.patternSequencerCycleCount=0,this.lastTrack1CycleCount=this.trackCycleCounts.get("track1")||1;for(let l=0;l<16;l++){const s=this.patternSequencerCells[l];if(s&&s.patternSlot!==null){this.patternSequencerCurrentCell=l,this.setActivePatternSlot(s.patternSlot);break}}}this.notifyPatternSequencerListeners()}isPatternSequencerEnabled(){return this.patternSequencerEnabled}setPatternSequencerCell(a,l,s=1){return a<0||a>=16||l!==null&&(l<1||l>Ht)||s<1||s>16?!1:(this.patternSequencerCells[a]={patternSlot:l,cycles:s},this.notifyPatternSequencerListeners(),!0)}clearPatternSequencerCell(a){return a<0||a>=16?!1:(this.patternSequencerCells[a]={patternSlot:null,cycles:1},this.notifyPatternSequencerListeners(),!0)}getPatternSequencerCell(a){return a<0||a>=16?null:this.patternSequencerCells[a]}getPatternSequencerCells(){return[...this.patternSequencerCells]}getPatternSequencerState(){const l=this.patternSequencerCells[this.patternSequencerCurrentCell]?.cycles??1;return{enabled:this.patternSequencerEnabled,cells:[...this.patternSequencerCells],currentCell:this.patternSequencerCurrentCell,cyclesRemaining:Math.max(0,l-this.patternSequencerCycleCount)}}onPatternSequencerChange(a){return this.patternSequencerListeners.add(a),()=>this.patternSequencerListeners.delete(a)}notifyPatternSequencerListeners(){const a=this.getPatternSequencerState();for(const l of this.patternSequencerListeners)l(a)}resetPatternSequencer(){this.patternSequencerCurrentCell=0,this.patternSequencerCycleCount=0,this.lastTrack1CycleCount=this.trackCycleCounts.get("track1")||1;const a=this.patternSequencerCells[0];a&&a.patternSlot!==null&&this.setActivePatternSlot(a.patternSlot),this.notifyPatternSequencerListeners()}clearPatternSequencer(){this.patternSequencerCells=Array(16).fill(null).map(()=>({patternSlot:null,cycles:1})),this.patternSequencerCurrentCell=0,this.patternSequencerCycleCount=0,this.notifyPatternSequencerListeners()}}const Lc=.001;function q0(m,a,l,s=1,u){const h=(a.peak??1)*s,p=z0(a,h);m.cancelScheduledValues(l),m.setValueAtTime(Lc,l);let f=l;for(let g=0;g<p.length;g++){const b=p[g],M=f+b.time,S=Math.max(b.level,Lc);B0(m,S,M,b.curve),f=M}return f-l}function yl(m,a,l,s,u=1,h=1,p="exponential"){return q0(m,{type:"ad",attack:a,decay:l,curve:p,peak:h},s,u)}function Sc(m,a,l,s,u,h="exponential"){m.cancelScheduledValues(u),m.setValueAtTime(a,u),h==="exponential"&&a>0&&l>0?m.exponentialRampToValueAtTime(l,u+s):m.linearRampToValueAtTime(l,u+s)}function z0(m,a){const l=[];switch(m.type){case"ad":l.push({time:m.attack,level:a,curve:m.curve}),l.push({time:m.decay??.1,level:0,curve:m.curve});break;case"ar":l.push({time:m.attack,level:a,curve:m.curve}),l.push({time:m.release??.1,level:0,curve:m.curve});break;case"adsr":l.push({time:m.attack,level:a,curve:m.curve});const s=(m.sustain??.7)*a;l.push({time:m.decay??.1,level:s,curve:m.curve}),l.push({time:0,level:s,curve:"linear"}),l.push({time:m.release??.1,level:0,curve:m.curve});break}return l}function B0(m,a,l,s){const u=Math.max(a,Lc);switch(s){case"exponential":m.exponentialRampToValueAtTime(u,l);break;case"linear":m.linearRampToValueAtTime(u,l);break;case"sharp":const h=(l-m.value)*.2;m.setTargetAtTime(u,m.value,Math.max(h,.001));break}}const _0={pitch:55,pitchEnvAmount:4,pitchEnvDecay:.05,op1Ratio:1.5,op1Index:3,op1Feedback:0,op2Ratio:3,op2Index:1,op2ToOp1:.5,ampAttack:.001,ampDecay:.3,ampCurve:"exponential",noiseMix:0,noiseDecay:.1,noiseFilterFreq:2e3,gain:.8},Sl={kick:{pitch:55,pitchEnvAmount:6,pitchEnvDecay:.04,op1Ratio:1,op1Index:2,op1Feedback:.1,op2Ratio:2,op2Index:.5,op2ToOp1:0,ampAttack:.001,ampDecay:.4,noiseMix:.02,noiseDecay:.02},snare:{pitch:180,pitchEnvAmount:2,pitchEnvDecay:.03,op1Ratio:1.47,op1Index:4,op1Feedback:.2,op2Ratio:2.9,op2Index:2,op2ToOp1:.4,ampAttack:.001,ampDecay:.15,noiseMix:.6,noiseDecay:.12,noiseFilterFreq:3e3},tom:{pitch:100,pitchEnvAmount:3,pitchEnvDecay:.06,op1Ratio:1.2,op1Index:2.5,op1Feedback:.05,op2Ratio:2.5,op2Index:1,op2ToOp1:.3,ampAttack:.001,ampDecay:.25,noiseMix:.05,noiseDecay:.03},clap:{pitch:400,pitchEnvAmount:1.5,pitchEnvDecay:.01,op1Ratio:2.3,op1Index:5,op1Feedback:.3,op2Ratio:4.7,op2Index:3,op2ToOp1:.6,ampAttack:.005,ampDecay:.12,noiseMix:.7,noiseDecay:.1,noiseFilterFreq:1500},perc:{pitch:300,pitchEnvAmount:2,pitchEnvDecay:.02,op1Ratio:2.5,op1Index:6,op1Feedback:.15,op2Ratio:5.2,op2Index:2,op2ToOp1:.5,ampAttack:.001,ampDecay:.08,noiseMix:.1,noiseDecay:.04},zap:{pitch:800,pitchEnvAmount:8,pitchEnvDecay:.08,op1Ratio:1,op1Index:8,op1Feedback:.4,op2Ratio:2,op2Index:4,op2ToOp1:.8,ampAttack:.001,ampDecay:.1,noiseMix:0,noiseDecay:.01}};class V0{ctx;output;params;constructor(a,l){this.ctx=a,this.params={..._0},this.output=a.createGain(),this.output.gain.value=this.params.gain,l?this.output.connect(l):this.output.connect(a.destination)}trigger(a,l=1,s){const u=s?{...this.params,...s}:this.params,h=u.pitch,p=h*u.pitchEnvAmount,f=h*u.op1Ratio,g=h*u.op2Ratio,b=this.ctx.createOscillator(),M=this.ctx.createOscillator(),S=this.ctx.createOscillator();b.type="sine",M.type="sine",S.type="sine";const y=this.ctx.createGain(),j=this.ctx.createGain(),C=this.ctx.createGain(),B=this.ctx.createGain(),G=this.ctx.createGain();b.frequency.setValueAtTime(p,a),M.frequency.setValueAtTime(f*u.pitchEnvAmount,a),S.frequency.setValueAtTime(g*u.pitchEnvAmount,a),Sc(b.frequency,p,h,u.pitchEnvDecay,a),Sc(M.frequency,f*u.pitchEnvAmount,f,u.pitchEnvDecay,a),Sc(S.frequency,g*u.pitchEnvAmount,g,u.pitchEnvDecay,a),j.gain.setValueAtTime(u.op2Index*g,a),C.gain.setValueAtTime(u.op2ToOp1,a),y.gain.setValueAtTime(u.op1Index*f,a),B.gain.setValueAtTime(u.op1Feedback*500,a),S.connect(j),j.connect(C),C.connect(M.frequency),M.connect(B),B.connect(M.frequency),M.connect(y),y.connect(b.frequency),S.connect(j);const Z=this.ctx.createGain();if(Z.gain.setValueAtTime(u.op2Index*.3*g,a),S.connect(Z),Z.connect(b.frequency),b.connect(G),yl(G.gain,u.ampAttack,u.ampDecay,a,l,1,u.ampCurve),u.noiseMix>0){const I=this.createNoiseBuffer(),Y=this.ctx.createBufferSource();Y.buffer=I;const te=this.ctx.createBiquadFilter();te.type="highpass",te.frequency.setValueAtTime(u.noiseFilterFreq,a);const O=this.ctx.createGain();Y.connect(te),te.connect(O),yl(O.gain,.001,u.noiseDecay,a,l*u.noiseMix,1,"exponential"),O.connect(G),Y.start(a),Y.stop(a+u.noiseDecay+.1)}G.connect(this.output);const W=u.ampDecay+.1;b.start(a),M.start(a),S.start(a),b.stop(a+W),M.stop(a+W),S.stop(a+W)}createNoiseBuffer(){const a=this.ctx.sampleRate,l=a*.5,s=this.ctx.createBuffer(1,l,a),u=s.getChannelData(0);for(let h=0;h<l;h++)u[h]=Math.random()*2-1;return s}get pitch(){return this.params.pitch}set pitch(a){this.params.pitch=Math.max(20,Math.min(2e3,a))}get pitchEnvAmount(){return this.params.pitchEnvAmount}set pitchEnvAmount(a){this.params.pitchEnvAmount=Math.max(1,Math.min(16,a))}get pitchEnvDecay(){return this.params.pitchEnvDecay}set pitchEnvDecay(a){this.params.pitchEnvDecay=Math.max(.001,Math.min(1,a))}get op1Ratio(){return this.params.op1Ratio}set op1Ratio(a){this.params.op1Ratio=Math.max(.1,Math.min(16,a))}get op1Index(){return this.params.op1Index}set op1Index(a){this.params.op1Index=Math.max(0,Math.min(20,a))}get op1Feedback(){return this.params.op1Feedback}set op1Feedback(a){this.params.op1Feedback=Math.max(0,Math.min(1,a))}get op2Ratio(){return this.params.op2Ratio}set op2Ratio(a){this.params.op2Ratio=Math.max(.1,Math.min(16,a))}get op2Index(){return this.params.op2Index}set op2Index(a){this.params.op2Index=Math.max(0,Math.min(20,a))}get op2ToOp1(){return this.params.op2ToOp1}set op2ToOp1(a){this.params.op2ToOp1=Math.max(0,Math.min(1,a))}get ampAttack(){return this.params.ampAttack}set ampAttack(a){this.params.ampAttack=Math.max(.001,Math.min(.5,a))}get ampDecay(){return this.params.ampDecay}set ampDecay(a){this.params.ampDecay=Math.max(.01,Math.min(5,a))}get ampCurve(){return this.params.ampCurve}set ampCurve(a){this.params.ampCurve=a}get noiseMix(){return this.params.noiseMix}set noiseMix(a){this.params.noiseMix=Math.max(0,Math.min(1,a))}get noiseDecay(){return this.params.noiseDecay}set noiseDecay(a){this.params.noiseDecay=Math.max(.01,Math.min(2,a))}get noiseFilterFreq(){return this.params.noiseFilterFreq}set noiseFilterFreq(a){this.params.noiseFilterFreq=Math.max(100,Math.min(1e4,a))}get gain(){return this.params.gain}set gain(a){this.params.gain=Math.max(0,Math.min(1,a)),this.output.gain.setValueAtTime(this.params.gain,this.ctx.currentTime)}getParams(){return{...this.params}}setParams(a){Object.assign(this.params,a),a.gain!==void 0&&this.output.gain.setValueAtTime(this.params.gain,this.ctx.currentTime)}loadPreset(a){const l=Sl[a];l&&this.setParams(l)}connect(a){this.output.connect(a)}disconnect(){this.output.disconnect()}getOutput(){return this.output}}const G0={op1Ratio:1,op2Ratio:2,op3Ratio:3,op2Index:2,op3Index:1,op2Feedback:0,op3ToOp2:.3,ampAttack:.01,ampDecay:.2,ampSustain:.6,ampRelease:.3,ampCurve:"exponential",indexEnvAmount:.5,indexEnvDecay:.3,filterEnabled:!1,filterFreq:2e3,filterQ:1,filterEnvAmount:0,filterEnvDecay:.3,glideTime:.05,glideEnabled:!1,gain:.7},Ml={bass:{op1Ratio:1,op2Ratio:1,op3Ratio:2,op2Index:3,op3Index:1,op2Feedback:.1,ampAttack:.005,ampDecay:.1,ampSustain:.8,ampRelease:.1,filterEnabled:!0,filterFreq:800,filterQ:2,filterEnvAmount:2e3,filterEnvDecay:.2},acidSquelch:{op1Ratio:1,op2Ratio:1,op3Ratio:2,op2Index:2,op3Index:.5,op2Feedback:.15,ampAttack:.002,ampDecay:.15,ampSustain:.4,ampRelease:.08,filterEnabled:!0,filterFreq:300,filterQ:12,filterEnvAmount:4e3,filterEnvDecay:.12,glideEnabled:!0,glideTime:.04},acidHard:{op1Ratio:1,op2Ratio:1,op3Ratio:3,op2Index:4,op3Index:1,op2Feedback:.2,ampAttack:.001,ampDecay:.1,ampSustain:.5,ampRelease:.05,filterEnabled:!0,filterFreq:200,filterQ:15,filterEnvAmount:5e3,filterEnvDecay:.08,glideEnabled:!0,glideTime:.03},acidSoft:{op1Ratio:1,op2Ratio:1,op3Ratio:2,op2Index:1.5,op3Index:.3,op2Feedback:.05,ampAttack:.01,ampDecay:.2,ampSustain:.6,ampRelease:.15,filterEnabled:!0,filterFreq:400,filterQ:8,filterEnvAmount:2500,filterEnvDecay:.18,glideEnabled:!0,glideTime:.06},acidBubble:{op1Ratio:1,op2Ratio:2,op3Ratio:3,op2Index:3,op3Index:1.5,op2Feedback:.1,op3ToOp2:.4,ampAttack:.001,ampDecay:.08,ampSustain:.3,ampRelease:.1,filterEnabled:!0,filterFreq:250,filterQ:18,filterEnvAmount:6e3,filterEnvDecay:.06,glideEnabled:!0,glideTime:.02},acidDeep:{op1Ratio:.5,op2Ratio:1,op3Ratio:2,op2Index:2.5,op3Index:.8,op2Feedback:.1,ampAttack:.003,ampDecay:.25,ampSustain:.7,ampRelease:.12,filterEnabled:!0,filterFreq:180,filterQ:10,filterEnvAmount:3e3,filterEnvDecay:.2,glideEnabled:!0,glideTime:.05},acidScream:{op1Ratio:1,op2Ratio:1.5,op3Ratio:4,op2Index:5,op3Index:2,op2Feedback:.25,op3ToOp2:.5,ampAttack:.001,ampDecay:.05,ampSustain:.4,ampRelease:.08,filterEnabled:!0,filterFreq:400,filterQ:20,filterEnvAmount:8e3,filterEnvDecay:.04,glideEnabled:!0,glideTime:.02},pad:{op1Ratio:1,op2Ratio:2.01,op3Ratio:3.99,op2Index:1.5,op3Index:.8,ampAttack:.5,ampDecay:.5,ampSustain:.7,ampRelease:1,indexEnvAmount:.2,indexEnvDecay:1},lead:{op1Ratio:1,op2Ratio:2,op3Ratio:4,op2Index:4,op3Index:2,op2Feedback:.2,op3ToOp2:.5,ampAttack:.01,ampDecay:.1,ampSustain:.7,ampRelease:.2,glideEnabled:!0,glideTime:.08},bell:{op1Ratio:1,op2Ratio:1.414,op3Ratio:5.19,op2Index:5,op3Index:2,ampAttack:.001,ampDecay:2,ampSustain:0,ampRelease:2,indexEnvAmount:.8,indexEnvDecay:.5},pluck:{op1Ratio:1,op2Ratio:3,op3Ratio:7,op2Index:6,op3Index:2,ampAttack:.001,ampDecay:.3,ampSustain:0,ampRelease:.1,indexEnvAmount:1,indexEnvDecay:.1,filterEnabled:!0,filterFreq:3e3,filterEnvAmount:4e3,filterEnvDecay:.2},brass:{op1Ratio:1,op2Ratio:1,op3Ratio:3,op2Index:2,op3Index:1.5,op2Feedback:.3,ampAttack:.08,ampDecay:.1,ampSustain:.8,ampRelease:.15,indexEnvAmount:.6,indexEnvDecay:.15}};class F0{ctx;output;params;voices=[];maxPolyphony=6;lastNote=60;constructor(a,l){this.ctx=a,this.params={...G0},this.output=a.createGain(),this.output.gain.value=this.params.gain,l?this.output.connect(l):this.output.connect(a.destination)}midiToFreq(a){return 440*Math.pow(2,(a-69)/12)}findVoiceToSteal(){const a=this.voices.find(l=>l.released);return a||(this.voices.length>=this.maxPolyphony?this.voices.reduce((l,s)=>s.startTime<l.startTime?s:l):null)}cleanupVoice(a){try{a.carrier.stop(),a.op2.stop(),a.op3.stop(),a.carrier.disconnect(),a.op2.disconnect(),a.op3.disconnect(),a.ampEnv.disconnect()}catch{}const l=this.voices.indexOf(a);l>-1&&this.voices.splice(l,1)}noteOn(a,l=1,s,u){const h=s??this.ctx.currentTime,p=u?{...this.params,...u}:this.params,f=this.findVoiceToSteal();f&&this.cleanupVoice(f);const g=this.midiToFreq(a),b=g*p.op1Ratio,M=g*p.op2Ratio,S=g*p.op3Ratio,y=p.glideEnabled?this.midiToFreq(this.lastNote)*p.op1Ratio:b,j=this.ctx.createOscillator(),C=this.ctx.createOscillator(),B=this.ctx.createOscillator();j.type="sine",C.type="sine",B.type="sine",j.frequency.setValueAtTime(y,h),C.frequency.setValueAtTime(M,h),B.frequency.setValueAtTime(S,h),p.glideEnabled&&y!==b&&j.frequency.linearRampToValueAtTime(b,h+p.glideTime);const G=this.ctx.createGain(),Z=this.ctx.createGain(),W=this.ctx.createGain(),I=this.ctx.createGain(),Y=this.ctx.createGain(),te=p.op2Index*M,O=te*(1+p.indexEnvAmount);G.gain.setValueAtTime(O,h),G.gain.exponentialRampToValueAtTime(Math.max(te,.001),h+p.indexEnvDecay),Z.gain.setValueAtTime(p.op3Index*S,h),W.gain.setValueAtTime(p.op3ToOp2,h),I.gain.setValueAtTime(p.op2Feedback*500,h),B.connect(Z),Z.connect(W),W.connect(C.frequency),C.connect(I),I.connect(C.frequency),C.connect(G),G.connect(j.frequency);let w;p.filterEnabled?(w=this.ctx.createBiquadFilter(),w.type="lowpass",w.frequency.setValueAtTime(p.filterFreq+p.filterEnvAmount,h),w.frequency.exponentialRampToValueAtTime(Math.max(p.filterFreq,20),h+p.filterEnvDecay),w.Q.value=p.filterQ,j.connect(w),w.connect(Y)):j.connect(Y),Y.gain.setValueAtTime(.001,h),Y.gain.linearRampToValueAtTime(l,h+p.ampAttack),Y.gain.exponentialRampToValueAtTime(Math.max(l*p.ampSustain,.001),h+p.ampAttack+p.ampDecay),Y.connect(this.output),j.start(h),C.start(h),B.start(h);const L={carrier:j,op2:C,op3:B,op2Gain:G,op3Gain:Z,op3ToOp2Gain:W,feedbackGain:I,ampEnv:Y,filter:w,note:a,startTime:h,released:!1,releaseTime:0};this.voices.push(L),this.lastNote=a}noteOff(a,l){const s=l??this.ctx.currentTime,u=this.params,h=this.voices.filter(p=>p.note===a&&!p.released);for(const p of h){p.released=!0,p.releaseTime=s,p.ampEnv.gain.cancelScheduledValues(s),p.ampEnv.gain.setValueAtTime(p.ampEnv.gain.value,s),p.ampEnv.gain.exponentialRampToValueAtTime(.001,s+u.ampRelease);const f=s+u.ampRelease+.1;setTimeout(()=>{this.cleanupVoice(p)},(f-this.ctx.currentTime)*1e3)}}trigger(a,l=1,s,u,h){this.noteOn(a,l,s,h),setTimeout(()=>{this.noteOff(a)},(s+u-this.ctx.currentTime)*1e3)}allNotesOff(a){const l=a??this.ctx.currentTime;for(const s of this.voices)s.released||this.noteOff(s.note,l)}get op1Ratio(){return this.params.op1Ratio}set op1Ratio(a){this.params.op1Ratio=Math.max(.1,Math.min(16,a))}get op2Ratio(){return this.params.op2Ratio}set op2Ratio(a){this.params.op2Ratio=Math.max(.1,Math.min(16,a))}get op3Ratio(){return this.params.op3Ratio}set op3Ratio(a){this.params.op3Ratio=Math.max(.1,Math.min(16,a))}get op2Index(){return this.params.op2Index}set op2Index(a){this.params.op2Index=Math.max(0,Math.min(20,a))}get op3Index(){return this.params.op3Index}set op3Index(a){this.params.op3Index=Math.max(0,Math.min(20,a))}get op2Feedback(){return this.params.op2Feedback}set op2Feedback(a){this.params.op2Feedback=Math.max(0,Math.min(1,a))}get op3ToOp2(){return this.params.op3ToOp2}set op3ToOp2(a){this.params.op3ToOp2=Math.max(0,Math.min(1,a))}get ampAttack(){return this.params.ampAttack}set ampAttack(a){this.params.ampAttack=Math.max(.001,Math.min(5,a))}get ampDecay(){return this.params.ampDecay}set ampDecay(a){this.params.ampDecay=Math.max(.001,Math.min(5,a))}get ampSustain(){return this.params.ampSustain}set ampSustain(a){this.params.ampSustain=Math.max(0,Math.min(1,a))}get ampRelease(){return this.params.ampRelease}set ampRelease(a){this.params.ampRelease=Math.max(.001,Math.min(10,a))}get filterEnabled(){return this.params.filterEnabled}set filterEnabled(a){this.params.filterEnabled=a}get filterFreq(){return this.params.filterFreq}set filterFreq(a){this.params.filterFreq=Math.max(20,Math.min(2e4,a))}get filterQ(){return this.params.filterQ}set filterQ(a){this.params.filterQ=Math.max(.1,Math.min(20,a))}get glideTime(){return this.params.glideTime}set glideTime(a){this.params.glideTime=Math.max(0,Math.min(2,a))}get glideEnabled(){return this.params.glideEnabled}set glideEnabled(a){this.params.glideEnabled=a}get gain(){return this.params.gain}set gain(a){this.params.gain=Math.max(0,Math.min(1,a)),this.output.gain.setValueAtTime(this.params.gain,this.ctx.currentTime)}getParams(){return{...this.params}}setParams(a){Object.assign(this.params,a),a.gain!==void 0&&this.output.gain.setValueAtTime(this.params.gain,this.ctx.currentTime)}loadPreset(a){const l=Ml[a];l&&this.setParams(l)}connect(a){this.output.connect(a)}disconnect(){this.output.disconnect()}getOutput(){return this.output}get activeVoices(){return this.voices.length}}const H0={noiseType:"white",noiseGain:1,filterType:"highpass",filterFreq:8e3,filterQ:1,attack:.001,decay:.08,curve:"exponential",metallicEnabled:!1,metallicFreq:40,metallicRatio1:1.414,metallicRatio2:1.732,metallicIndex:2,metallicGain:.5,clickEnabled:!1,clickFreq:1500,clickDecay:.002,gain:.8},Tl={closedHat:{noiseType:"white",filterType:"highpass",filterFreq:8e3,filterQ:1.5,attack:.001,decay:.04,metallicEnabled:!0,metallicFreq:40,metallicRatio1:1.414,metallicRatio2:1.732,metallicIndex:3,metallicGain:.6,clickEnabled:!0,clickFreq:1200,clickDecay:.003},openHat:{noiseType:"white",filterType:"bandpass",filterFreq:1e4,filterQ:.8,attack:.001,decay:.35,metallicEnabled:!0,metallicFreq:40,metallicRatio1:1.414,metallicRatio2:1.732,metallicIndex:2,metallicGain:.5,clickEnabled:!0,clickFreq:1e3,clickDecay:.005},ride:{noiseType:"white",filterType:"bandpass",filterFreq:6e3,filterQ:1.2,attack:.001,decay:1.2,metallicEnabled:!0,metallicFreq:300,metallicRatio1:1.5,metallicRatio2:2.333,metallicIndex:2.5,metallicGain:.7},crash:{noiseType:"white",filterType:"bandpass",filterFreq:5e3,filterQ:.5,attack:.001,decay:2,metallicEnabled:!0,metallicFreq:200,metallicRatio1:1.618,metallicRatio2:2.414,metallicIndex:3,metallicGain:.6},shaker:{noiseType:"white",filterType:"bandpass",filterFreq:5e3,filterQ:2,attack:.001,decay:.05,metallicEnabled:!1},snap:{noiseType:"white",filterType:"bandpass",filterFreq:2500,filterQ:3,attack:.001,decay:.03,clickEnabled:!0,clickFreq:2e3,clickDecay:.01},rim:{noiseType:"white",filterType:"highpass",filterFreq:3e3,filterQ:4,attack:5e-4,decay:.02,clickEnabled:!0,clickFreq:800,clickDecay:.008,noiseGain:.4,metallicEnabled:!0,metallicFreq:500,metallicRatio1:1.2,metallicRatio2:1.8,metallicIndex:4,metallicGain:.8},hiss:{noiseType:"white",filterType:"highpass",filterFreq:12e3,filterQ:.5,attack:.3,decay:.5,curve:"linear"},static:{noiseType:"white",filterType:"bandpass",filterFreq:3e3,filterQ:.3,attack:.001,decay:.1,metallicEnabled:!0,metallicFreq:50,metallicRatio1:7.1,metallicRatio2:11.3,metallicIndex:5,metallicGain:.3}};class U0{ctx;output;params;whiteNoiseBuffer=null;pinkNoiseBuffer=null;brownNoiseBuffer=null;constructor(a,l){this.ctx=a,this.params={...H0},this.output=a.createGain(),this.output.gain.value=this.params.gain,l?this.output.connect(l):this.output.connect(a.destination),this.generateNoiseBuffers()}generateNoiseBuffers(){const a=this.ctx.sampleRate,l=a*2;this.whiteNoiseBuffer=this.ctx.createBuffer(1,l,a);const s=this.whiteNoiseBuffer.getChannelData(0);for(let C=0;C<l;C++)s[C]=Math.random()*2-1;this.pinkNoiseBuffer=this.ctx.createBuffer(1,l,a);const u=this.pinkNoiseBuffer.getChannelData(0);let h=0,p=0,f=0,g=0,b=0,M=0,S=0;for(let C=0;C<l;C++){const B=Math.random()*2-1;h=.99886*h+B*.0555179,p=.99332*p+B*.0750759,f=.969*f+B*.153852,g=.8665*g+B*.3104856,b=.55*b+B*.5329522,M=-.7616*M-B*.016898,u[C]=(h+p+f+g+b+M+S+B*.5362)*.11,S=B*.115926}this.brownNoiseBuffer=this.ctx.createBuffer(1,l,a);const y=this.brownNoiseBuffer.getChannelData(0);let j=0;for(let C=0;C<l;C++){const B=Math.random()*2-1;y[C]=(j+.02*B)/1.02,j=y[C],y[C]*=3.5}}getNoiseBuffer(){switch(this.params.noiseType){case"white":return this.whiteNoiseBuffer;case"pink":return this.pinkNoiseBuffer;case"brown":return this.brownNoiseBuffer}}trigger(a,l=1,s){const u=s?{...this.params,...s}:this.params,h=this.ctx.createGain();if(u.noiseGain>0){const p=this.getNoiseBuffer();if(p){const f=this.ctx.createBufferSource();f.buffer=p,f.loop=!0;const g=this.ctx.createBiquadFilter();g.type=u.filterType,g.frequency.setValueAtTime(u.filterFreq,a),g.Q.value=u.filterQ;const b=this.ctx.createGain();f.connect(g),g.connect(b),yl(b.gain,u.attack,u.decay,a,l*u.noiseGain,1,u.curve),b.connect(h),f.start(a),f.stop(a+u.attack+u.decay+.1)}}if(u.metallicEnabled&&u.metallicGain>0){const p=this.ctx.createOscillator(),f=this.ctx.createOscillator(),g=this.ctx.createOscillator();p.type="square",f.type="square",g.type="square";const b=u.metallicFreq,M=u.metallicFreq*u.metallicRatio1,S=u.metallicFreq*u.metallicRatio2;p.frequency.setValueAtTime(b,a),f.frequency.setValueAtTime(M,a),g.frequency.setValueAtTime(S,a);const y=this.ctx.createGain(),j=this.ctx.createGain();y.gain.setValueAtTime(u.metallicIndex*M,a),j.gain.setValueAtTime(u.metallicIndex*S,a),f.connect(y),y.connect(p.frequency),g.connect(j),j.connect(f.frequency);const C=this.ctx.createGain();yl(C.gain,u.attack,u.decay,a,l*u.metallicGain*.3,1,u.curve);const B=this.ctx.createBiquadFilter();B.type="highpass",B.frequency.setValueAtTime(u.filterFreq*.5,a),p.connect(B),B.connect(C),C.connect(h);const G=u.attack+u.decay+.1;p.start(a),f.start(a),g.start(a),p.stop(a+G),f.stop(a+G),g.stop(a+G)}if(u.clickEnabled){const p=this.ctx.createOscillator();p.type="sine",p.frequency.setValueAtTime(u.clickFreq,a);const f=this.ctx.createGain();yl(f.gain,1e-4,u.clickDecay,a,l*.5,1,"exponential"),p.connect(f),f.connect(h),p.start(a),p.stop(a+u.clickDecay+.01)}h.gain.setValueAtTime(1,a),h.connect(this.output)}get noiseType(){return this.params.noiseType}set noiseType(a){this.params.noiseType=a}get noiseGain(){return this.params.noiseGain}set noiseGain(a){this.params.noiseGain=Math.max(0,Math.min(1,a))}get filterType(){return this.params.filterType}set filterType(a){this.params.filterType=a}get filterFreq(){return this.params.filterFreq}set filterFreq(a){this.params.filterFreq=Math.max(20,Math.min(2e4,a))}get filterQ(){return this.params.filterQ}set filterQ(a){this.params.filterQ=Math.max(.1,Math.min(20,a))}get attack(){return this.params.attack}set attack(a){this.params.attack=Math.max(1e-4,Math.min(.5,a))}get decay(){return this.params.decay}set decay(a){this.params.decay=Math.max(.001,Math.min(5,a))}get curve(){return this.params.curve}set curve(a){this.params.curve=a}get metallicEnabled(){return this.params.metallicEnabled}set metallicEnabled(a){this.params.metallicEnabled=a}get metallicFreq(){return this.params.metallicFreq}set metallicFreq(a){this.params.metallicFreq=Math.max(20,Math.min(500,a))}get metallicRatio1(){return this.params.metallicRatio1}set metallicRatio1(a){this.params.metallicRatio1=Math.max(.5,Math.min(5,a))}get metallicRatio2(){return this.params.metallicRatio2}set metallicRatio2(a){this.params.metallicRatio2=Math.max(.5,Math.min(5,a))}get metallicIndex(){return this.params.metallicIndex}set metallicIndex(a){this.params.metallicIndex=Math.max(0,Math.min(10,a))}get metallicGain(){return this.params.metallicGain}set metallicGain(a){this.params.metallicGain=Math.max(0,Math.min(1,a))}get clickEnabled(){return this.params.clickEnabled}set clickEnabled(a){this.params.clickEnabled=a}get clickFreq(){return this.params.clickFreq}set clickFreq(a){this.params.clickFreq=Math.max(100,Math.min(5e3,a))}get clickDecay(){return this.params.clickDecay}set clickDecay(a){this.params.clickDecay=Math.max(.001,Math.min(.1,a))}get gain(){return this.params.gain}set gain(a){this.params.gain=Math.max(0,Math.min(1,a)),this.output.gain.setValueAtTime(this.params.gain,this.ctx.currentTime)}getParams(){return{...this.params}}setParams(a){Object.assign(this.params,a),a.gain!==void 0&&this.output.gain.setValueAtTime(this.params.gain,this.ctx.currentTime)}loadPreset(a){const l=Tl[a];l&&this.setParams(l)}connect(a){this.output.connect(a)}disconnect(){this.output.disconnect()}getOutput(){return this.output}}function Ia(m=.5,a=1,l="cycle"){return{breakpoints:[{time:0,value:m,curve:"linear"},{time:1,value:m,curve:"linear"}],period:a,syncToTempo:!1,amount:1,enabled:!0,loopMode:l}}function vn(m=1,a="cycle"){return{breakpoints:[{time:0,value:.5,curve:"linear"},{time:.25,value:1,curve:"exp"},{time:.5,value:.5,curve:"exp"},{time:.75,value:0,curve:"exp"},{time:1,value:.5,curve:"exp"}],period:m,syncToTempo:!1,amount:1,enabled:!0,loopMode:a}}function Q0(){return{pitch:Ia(.5,1),pitchRange:100,index:Ia(.5,1),indexMin:0,indexMax:10,level:Ia(1,1),levelMax:1}}function Mc(m){return{freq:m,envelopes:Q0()}}const wc={carrierFreq:110,carrierPitchEnv:Ia(.5,1),carrierPitchRange:50,opA:Mc(220),opB:Mc(330),opC:Mc(165),ampEnv:Ia(1,1),notchFreq:800,notchQ:12,notchEnv:Ia(.5,1),notchRange:600,outputLevel:.7,gain:.8},bn={empty:{...wc},pluck:{carrierFreq:165,carrierPitchEnv:{breakpoints:[{time:0,value:1,curve:"linear"},{time:.05,value:.5,curve:"punch"},{time:1,value:.5,curve:"linear"}],period:.3,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},carrierPitchRange:80,opA:{freq:330,envelopes:{pitch:{breakpoints:[{time:0,value:1,curve:"linear"},{time:.03,value:.5,curve:"punch"},{time:1,value:.5,curve:"linear"}],period:.25,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},pitchRange:120,index:{breakpoints:[{time:0,value:1,curve:"linear"},{time:.1,value:.2,curve:"exp"},{time:1,value:.2,curve:"linear"}],period:.3,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},indexMin:1,indexMax:15,level:{breakpoints:[{time:0,value:1,curve:"linear"},{time:.15,value:.3,curve:"exp"},{time:1,value:.3,curve:"linear"}],period:.35,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},levelMax:1.2}},opB:{freq:466,envelopes:{pitch:{breakpoints:[{time:0,value:.8,curve:"linear"},{time:.05,value:.5,curve:"sharp"},{time:1,value:.5,curve:"linear"}],period:.28,syncToTempo:!1,amount:.8,enabled:!0,loopMode:"cycle"},pitchRange:90,index:{breakpoints:[{time:0,value:.9,curve:"linear"},{time:.12,value:.15,curve:"exp"},{time:1,value:.15,curve:"linear"}],period:.32,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},indexMin:.5,indexMax:12,level:{breakpoints:[{time:0,value:1,curve:"linear"},{time:.18,value:.25,curve:"exp"},{time:1,value:.25,curve:"linear"}],period:.38,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},levelMax:1}},opC:{freq:82.5,envelopes:{pitch:{breakpoints:[{time:0,value:1,curve:"linear"},{time:.08,value:.5,curve:"punch"},{time:1,value:.5,curve:"linear"}],period:.22,syncToTempo:!1,amount:.9,enabled:!0,loopMode:"cycle"},pitchRange:60,index:{breakpoints:[{time:0,value:1,curve:"linear"},{time:.06,value:.1,curve:"punch"},{time:1,value:.1,curve:"linear"}],period:.2,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},indexMin:1,indexMax:20,level:{breakpoints:[{time:0,value:1,curve:"linear"},{time:.12,value:.2,curve:"exp"},{time:1,value:.2,curve:"linear"}],period:.25,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},levelMax:1.5}},ampEnv:{breakpoints:[{time:0,value:1,curve:"linear"},{time:.2,value:0,curve:"exp"},{time:1,value:0,curve:"linear"}],period:.4,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"}},morph:{carrierFreq:110,carrierPitchEnv:vn(3),carrierPitchRange:30,opA:{freq:220,envelopes:{pitch:vn(2.3),pitchRange:50,index:{breakpoints:[{time:0,value:.2,curve:"linear"},{time:.3,value:.8,curve:"swell"},{time:.6,value:.4,curve:"exp"},{time:1,value:.2,curve:"sharp"}],period:4.1,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},indexMin:1,indexMax:8,level:vn(5.7),levelMax:1}},opB:{freq:330,envelopes:{pitch:{breakpoints:[{time:0,value:.5,curve:"linear"},{time:.5,value:.7,curve:"swell"},{time:1,value:.5,curve:"exp"}],period:3.7,syncToTempo:!1,amount:.6,enabled:!0,loopMode:"cycle"},pitchRange:40,index:vn(2.9),indexMin:.5,indexMax:6,level:{breakpoints:[{time:0,value:.6,curve:"linear"},{time:.4,value:1,curve:"exp"},{time:.7,value:.3,curve:"sharp"},{time:1,value:.6,curve:"swell"}],period:6.3,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},levelMax:.9}},opC:{freq:165,envelopes:{pitch:vn(4.3),pitchRange:35,index:{breakpoints:[{time:0,value:.3,curve:"linear"},{time:.25,value:.9,curve:"punch"},{time:.5,value:.5,curve:"exp"},{time:.75,value:.1,curve:"sharp"},{time:1,value:.3,curve:"swell"}],period:3.1,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},indexMin:2,indexMax:12,level:vn(7.1),levelMax:1.2}},ampEnv:Ia(1,1),notchEnv:{breakpoints:[{time:0,value:.3,curve:"linear"},{time:.5,value:.8,curve:"swell"},{time:1,value:.3,curve:"exp"}],period:5.5,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},notchRange:800},chaos:{carrierFreq:165,carrierPitchEnv:{breakpoints:[{time:0,value:.5,curve:"linear"},{time:.1,value:.9,curve:"punch"},{time:.3,value:.2,curve:"sharp"},{time:.5,value:.7,curve:"exp"},{time:.7,value:.1,curve:"punch"},{time:1,value:.5,curve:"swell"}],period:.7,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},carrierPitchRange:150,opA:{freq:233,envelopes:{pitch:{breakpoints:[{time:0,value:.3,curve:"linear"},{time:.15,value:1,curve:"punch"},{time:.4,value:0,curve:"exp"},{time:.6,value:.8,curve:"sharp"},{time:1,value:.3,curve:"linear"}],period:.5,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},pitchRange:200,index:{breakpoints:[{time:0,value:.1,curve:"linear"},{time:.08,value:1,curve:"punch"},{time:.25,value:.3,curve:"exp"},{time:.5,value:.8,curve:"sharp"},{time:.75,value:.2,curve:"punch"},{time:1,value:.1,curve:"swell"}],period:.35,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},indexMin:0,indexMax:20,level:{breakpoints:[{time:0,value:.8,curve:"linear"},{time:.2,value:.2,curve:"punch"},{time:.5,value:1,curve:"swell"},{time:.8,value:.4,curve:"exp"},{time:1,value:.8,curve:"linear"}],period:.6,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},levelMax:1.5}},opB:{freq:448,envelopes:{pitch:{breakpoints:[{time:0,value:.7,curve:"linear"},{time:.2,value:0,curve:"sharp"},{time:.5,value:1,curve:"punch"},{time:.8,value:.3,curve:"exp"},{time:1,value:.7,curve:"swell"}],period:.45,syncToTempo:!1,amount:-.8,enabled:!0,loopMode:"cycle"},pitchRange:180,index:{breakpoints:[{time:0,value:.5,curve:"linear"},{time:.1,value:.9,curve:"punch"},{time:.3,value:.1,curve:"exp"},{time:.6,value:.7,curve:"sharp"},{time:1,value:.5,curve:"linear"}],period:.28,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},indexMin:0,indexMax:18,level:{breakpoints:[{time:0,value:.6,curve:"linear"},{time:.3,value:1,curve:"swell"},{time:.7,value:.2,curve:"punch"},{time:1,value:.6,curve:"exp"}],period:.55,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},levelMax:1.3}},opC:{freq:82.5,envelopes:{pitch:{breakpoints:[{time:0,value:.4,curve:"linear"},{time:.15,value:1,curve:"punch"},{time:.4,value:0,curve:"sharp"},{time:.7,value:.6,curve:"swell"},{time:1,value:.4,curve:"exp"}],period:.38,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},pitchRange:120,index:{breakpoints:[{time:0,value:.2,curve:"linear"},{time:.05,value:1,curve:"punch"},{time:.2,value:.4,curve:"exp"},{time:.5,value:.9,curve:"sharp"},{time:.8,value:.1,curve:"punch"},{time:1,value:.2,curve:"swell"}],period:.25,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},indexMin:1,indexMax:25,level:{breakpoints:[{time:0,value:1,curve:"linear"},{time:.25,value:.3,curve:"exp"},{time:.5,value:.9,curve:"punch"},{time:.75,value:.5,curve:"sharp"},{time:1,value:1,curve:"swell"}],period:.42,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},levelMax:1.8}},ampEnv:Ia(1,1),notchEnv:{breakpoints:[{time:0,value:.3,curve:"linear"},{time:.2,value:.9,curve:"punch"},{time:.5,value:.1,curve:"sharp"},{time:.8,value:.7,curve:"swell"},{time:1,value:.3,curve:"exp"}],period:.65,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},notchRange:1200,notchQ:18}};function xn(m,a){return{[`${a}Breakpoints`]:m.breakpoints.map(l=>({time:l.time,value:l.value,curve:l.curve})),[`${a}Period`]:m.period,[`${a}SyncToTempo`]:m.syncToTempo,[`${a}Amount`]:m.amount,[`${a}Enabled`]:m.enabled,[`${a}LoopMode`]:m.loopMode||"cycle"}}function Tc(m,a){const l=m.envelopes;return{[`${a}Freq`]:m.freq,...xn(l.pitch,`${a}Pitch`),[`${a}PitchRange`]:l.pitchRange,...xn(l.index,`${a}Index`),[`${a}IndexMin`]:l.indexMin,[`${a}IndexMax`]:l.indexMax,...xn(l.level,`${a}Level`),[`${a}LevelMax`]:l.levelMax}}function Si(m){return JSON.parse(JSON.stringify(m))}class Y0{ctx;output;workletNode=null;params;workletReady=!1;initPromise=null;constructor(a,l){this.ctx=a,this.params=Si(wc),this.output=a.createGain(),this.output.gain.value=this.params.gain,l?this.output.connect(l):this.output.connect(a.destination),this.initPromise=this.initWorklet()}async initWorklet(){try{await this.ctx.audioWorklet.addModule("/tQr4x/worklets/complex-morph-processor.js"),this.workletNode=new AudioWorkletNode(this.ctx,"complex-morph-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2]}),this.workletNode.connect(this.output),this.syncParamsToWorklet(),this.workletReady=!0}catch(a){console.error("Failed to initialize ComplexMorphVoice worklet:",a),this.workletReady=!1}}async ensureReady(){return this.workletReady?!0:(this.initPromise&&await this.initPromise,this.workletReady)}syncParamsToWorklet(){if(!this.workletNode)return;const a=this.params;this.workletNode.port.postMessage({type:"params",params:{carrierFreq:a.carrierFreq,...xn(a.carrierPitchEnv,"carrierPitch"),carrierPitchRange:a.carrierPitchRange,...Tc(a.opA,"opA"),...Tc(a.opB,"opB"),...Tc(a.opC,"opC"),...xn(a.ampEnv,"amp"),notchFreq:a.notchFreq,notchQ:a.notchQ,...xn(a.notchEnv,"notch"),notchRange:a.notchRange,outputLevel:a.outputLevel}})}async trigger(a,l=1,s){if(await this.ensureReady(),!this.workletNode){console.warn("ComplexMorphVoice: worklet not available");return}if(s){const u=Si(this.params),h=s;h.opA&&typeof h.opA=="object"&&(u.opA={...u.opA,...h.opA}),h.opB&&typeof h.opB=="object"&&(u.opB={...u.opB,...h.opB}),h.opC&&typeof h.opC=="object"&&(u.opC={...u.opC,...h.opC});for(const[f,g]of Object.entries(h))typeof g=="number"&&this.applyFlatParamLock(u,f,g);const p=this.params;this.params=u,this.syncParamsToWorklet(),this.params=p}this.workletNode.port.postMessage({type:"trigger",velocity:l})}applyFlatParamLock(a,l,s){l==="carrierFreq"||l==="complexCarrierFreq"?a.carrierFreq=s:l==="notchFreq"||l==="complexNotchFreq"?a.notchFreq=s:l==="notchQ"||l==="complexNotchQ"?a.notchQ=s:l==="outputLevel"||l==="complexOutputLevel"?a.outputLevel=s:l==="notchRange"||l==="complexNotchRange"?a.notchRange=s:l==="carrierPitchRange"||l==="complexCarrierPitchRange"?a.carrierPitchRange=s:l==="complexCarrierPitchPeriod"?a.carrierPitchEnv.period=s:l==="complexCarrierPitchAmount"?a.carrierPitchEnv.amount=s:l==="complexAmpPeriod"?a.ampEnv.period=s:l==="complexAmpAmount"?a.ampEnv.amount=s:l==="complexNotchEnvPeriod"?a.notchEnv.period=s:l==="complexNotchEnvAmount"?a.notchEnv.amount=s:l==="complexOpAPitchPeriod"?a.opA.envelopes.pitch.period=s:l==="complexOpAPitchAmount"?a.opA.envelopes.pitch.amount=s:l==="complexOpAPitchRange"?a.opA.envelopes.pitchRange=s:l==="complexOpAIndexPeriod"?a.opA.envelopes.index.period=s:l==="complexOpAIndexAmount"?a.opA.envelopes.index.amount=s:l==="complexOpAIndexMin"?a.opA.envelopes.indexMin=s:l==="complexOpAIndexMax"?a.opA.envelopes.indexMax=s:l==="complexOpALevelPeriod"?a.opA.envelopes.level.period=s:l==="complexOpALevelAmount"?a.opA.envelopes.level.amount=s:l==="complexOpALevelMax"?a.opA.envelopes.levelMax=s:l==="complexOpBPitchPeriod"?a.opB.envelopes.pitch.period=s:l==="complexOpBPitchAmount"?a.opB.envelopes.pitch.amount=s:l==="complexOpBPitchRange"?a.opB.envelopes.pitchRange=s:l==="complexOpBIndexPeriod"?a.opB.envelopes.index.period=s:l==="complexOpBIndexAmount"?a.opB.envelopes.index.amount=s:l==="complexOpBIndexMin"?a.opB.envelopes.indexMin=s:l==="complexOpBIndexMax"?a.opB.envelopes.indexMax=s:l==="complexOpBLevelPeriod"?a.opB.envelopes.level.period=s:l==="complexOpBLevelAmount"?a.opB.envelopes.level.amount=s:l==="complexOpBLevelMax"?a.opB.envelopes.levelMax=s:l==="complexOpCPitchPeriod"?a.opC.envelopes.pitch.period=s:l==="complexOpCPitchAmount"?a.opC.envelopes.pitch.amount=s:l==="complexOpCPitchRange"?a.opC.envelopes.pitchRange=s:l==="complexOpCIndexPeriod"?a.opC.envelopes.index.period=s:l==="complexOpCIndexAmount"?a.opC.envelopes.index.amount=s:l==="complexOpCIndexMin"?a.opC.envelopes.indexMin=s:l==="complexOpCIndexMax"?a.opC.envelopes.indexMax=s:l==="complexOpCLevelPeriod"?a.opC.envelopes.level.period=s:l==="complexOpCLevelAmount"?a.opC.envelopes.level.amount=s:l==="complexOpCLevelMax"&&(a.opC.envelopes.levelMax=s)}async release(){await this.ensureReady(),this.workletNode&&this.workletNode.port.postMessage({type:"release"})}get carrierFreq(){return this.params.carrierFreq}set carrierFreq(a){this.params.carrierFreq=Math.max(20,Math.min(2e3,a)),this.syncParamsToWorklet()}get opA(){return Si(this.params.opA)}set opA(a){a.envelopes&&(this.params.opA.envelopes={...this.params.opA.envelopes,...a.envelopes});const{envelopes:l,...s}=a;Object.assign(this.params.opA,s),this.syncParamsToWorklet()}get opB(){return Si(this.params.opB)}set opB(a){a.envelopes&&(this.params.opB.envelopes={...this.params.opB.envelopes,...a.envelopes});const{envelopes:l,...s}=a;Object.assign(this.params.opB,s),this.syncParamsToWorklet()}get opC(){return Si(this.params.opC)}set opC(a){a.envelopes&&(this.params.opC.envelopes={...this.params.opC.envelopes,...a.envelopes});const{envelopes:l,...s}=a;Object.assign(this.params.opC,s),this.syncParamsToWorklet()}get notchFreq(){return this.params.notchFreq}set notchFreq(a){this.params.notchFreq=Math.max(20,Math.min(2e4,a)),this.syncParamsToWorklet()}get notchQ(){return this.params.notchQ}set notchQ(a){this.params.notchQ=Math.max(1,Math.min(30,a)),this.syncParamsToWorklet()}get outputLevel(){return this.params.outputLevel}set outputLevel(a){this.params.outputLevel=Math.max(0,Math.min(1,a)),this.syncParamsToWorklet()}get gain(){return this.params.gain}set gain(a){this.params.gain=Math.max(0,Math.min(1,a)),this.output.gain.setValueAtTime(this.params.gain,this.ctx.currentTime)}getParams(){return Si(this.params)}setParams(a){if(a.opA){a.opA.envelopes&&(this.params.opA.envelopes={...this.params.opA.envelopes,...a.opA.envelopes});const{envelopes:p,...f}=a.opA;Object.assign(this.params.opA,f)}if(a.opB){a.opB.envelopes&&(this.params.opB.envelopes={...this.params.opB.envelopes,...a.opB.envelopes});const{envelopes:p,...f}=a.opB;Object.assign(this.params.opB,f)}if(a.opC){a.opC.envelopes&&(this.params.opC.envelopes={...this.params.opC.envelopes,...a.opC.envelopes});const{envelopes:p,...f}=a.opC;Object.assign(this.params.opC,f)}const{opA:l,opB:s,opC:u,...h}=a;Object.assign(this.params,h),a.gain!==void 0&&this.output.gain.setValueAtTime(this.params.gain,this.ctx.currentTime),this.syncParamsToWorklet()}loadPreset(a){const l=bn[a];l&&(this.params=Si(wc),this.setParams(l))}setOperator(a,l){l.envelopes&&(this.params[a].envelopes={...this.params[a].envelopes,...l.envelopes});const{envelopes:s,...u}=l;Object.assign(this.params[a],u),this.syncParamsToWorklet()}setOperatorEnvelope(a,l,s){Object.assign(this.params[a].envelopes[l],s),this.syncParamsToWorklet()}setCarrierPitchEnvelope(a){Object.assign(this.params.carrierPitchEnv,a),this.syncParamsToWorklet()}setAmpEnvelope(a){Object.assign(this.params.ampEnv,a),this.syncParamsToWorklet()}setNotchEnvelope(a){Object.assign(this.params.notchEnv,a),this.syncParamsToWorklet()}connect(a){this.output.connect(a)}disconnect(){this.output.disconnect()}getOutput(){return this.output}isReady(){return this.workletReady}dispose(){this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.output.disconnect(),this.workletReady=!1}}const X0={mode:"standard",startPoint:0,pitch:0,direction:"forward",attack:.001,decay:.1,sustain:1,release:.1,lpEnabled:!1,lpCutoff:2e4,lpResonance:0,hpEnabled:!1,hpCutoff:20,hpResonance:0,scanSpeed:1,grainLength:.05,grainDensity:20,spread:0,grainPan:0,gain:.8},yn={default:{mode:"standard",startPoint:0,pitch:0,direction:"forward",attack:.001,decay:.1,sustain:1,release:.1},oneShot:{mode:"standard",attack:.001,decay:.5,sustain:0,release:.01},pad:{mode:"standard",attack:.3,decay:.5,sustain:.7,release:.5,lpEnabled:!0,lpCutoff:3e3},granularFreeze:{mode:"granular",scanSpeed:0,grainLength:.1,grainDensity:30,spread:.2},granularTexture:{mode:"granular",scanSpeed:.5,grainLength:.05,grainDensity:50,spread:.5,grainPan:.7},granularStutter:{mode:"granular",scanSpeed:2,grainLength:.02,grainDensity:80,spread:.1},reverse:{mode:"standard",direction:"reverse",attack:.05,release:.3},filtered:{mode:"standard",lpEnabled:!0,lpCutoff:800,lpResonance:8,hpEnabled:!0,hpCutoff:200}};class Z0{ctx;output;params;sampleBuffer=null;reversedBuffer=null;granularWorklet=null;granularWorkletReady=!1;sampleName="";sampleDuration=0;constructor(a,l){this.ctx=a,this.params={...X0},this.output=a.createGain(),this.output.gain.value=this.params.gain,l?this.output.connect(l):this.output.connect(a.destination)}async initGranularWorklet(){if(!this.granularWorkletReady)try{await this.ctx.audioWorklet.addModule("/tQr4x/worklets/sample-processor.js"),this.granularWorklet=new AudioWorkletNode(this.ctx,"sample-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2]}),this.granularWorklet.connect(this.output),this.granularWorkletReady=!0,this.sampleBuffer&&this.sendSampleToWorklet()}catch(a){console.error("Failed to initialize granular worklet:",a)}}sendSampleToWorklet(){if(!this.granularWorklet||!this.sampleBuffer)return;const a=this.sampleBuffer.getChannelData(0);this.granularWorklet.port.postMessage({type:"loadSample",sampleData:a,sampleRate:this.sampleBuffer.sampleRate})}loadSample(a,l="sample"){this.sampleBuffer=a,this.sampleName=l,this.sampleDuration=a.duration,this.createReversedBuffer(),this.granularWorkletReady&&this.sendSampleToWorklet()}async loadSampleFromUrl(a){try{const s=await(await fetch(a)).arrayBuffer(),u=await this.ctx.decodeAudioData(s),h=a.split("/").pop()||"sample";this.loadSample(u,h),this.params.sampleUrl=a}catch(l){throw console.error("Failed to load sample from URL:",l),l}}async loadSampleFromFile(a){const l=await a.arrayBuffer(),s=this.arrayBufferToDataUrl(l,a.type||"audio/wav");this.params.sampleUrl=s;const u=await this.ctx.decodeAudioData(l);this.loadSample(u,a.name)}arrayBufferToDataUrl(a,l){const s=new Uint8Array(a);let u="";for(let h=0;h<s.byteLength;h++)u+=String.fromCharCode(s[h]);return`data:${l};base64,${btoa(u)}`}createReversedBuffer(){if(!this.sampleBuffer)return;const a=this.sampleBuffer.numberOfChannels,l=this.sampleBuffer.length;this.reversedBuffer=this.ctx.createBuffer(a,l,this.sampleBuffer.sampleRate);for(let s=0;s<a;s++){const u=this.sampleBuffer.getChannelData(s),h=this.reversedBuffer.getChannelData(s);for(let p=0;p<l;p++)h[p]=u[l-1-p]}}trigger(a,l=1,s){if(!this.sampleBuffer){this.triggerClick(a,l);return}const u=s?{...this.params,...s}:this.params;u.mode==="standard"?this.triggerStandard(a,l,u):this.triggerGranular(a,l,u)}triggerStandard(a,l,s){const u=s.direction==="reverse"?this.reversedBuffer:this.sampleBuffer;if(!u)return;const h=this.ctx.createBufferSource();h.buffer=u;const p=Math.pow(2,s.pitch/12);console.log("[SampleVoice] Trigger - pitch:",s.pitch,"playbackRate:",p,"buffer sampleRate:",u.sampleRate,"ctx sampleRate:",this.ctx.sampleRate),h.playbackRate.setValueAtTime(p,a);const f=s.startPoint*u.duration;let g=h;if(s.hpEnabled&&s.hpCutoff>20){const C=this.ctx.createBiquadFilter();C.type="highpass",C.frequency.setValueAtTime(s.hpCutoff,a),C.Q.setValueAtTime(s.hpResonance,a),g.connect(C),g=C}if(s.lpEnabled&&s.lpCutoff<2e4){const C=this.ctx.createBiquadFilter();C.type="lowpass",C.frequency.setValueAtTime(s.lpCutoff,a),C.Q.setValueAtTime(s.lpResonance,a),g.connect(C),g=C}const b=this.ctx.createGain();g.connect(b);const M=l,S=l*s.sustain;b.gain.setValueAtTime(0,a),b.gain.linearRampToValueAtTime(M,a+s.attack),b.gain.linearRampToValueAtTime(S,a+s.attack+s.decay);const y=(u.duration-f)/p,j=s.attack+s.decay+y;b.gain.setValueAtTime(S,a+j-s.release),b.gain.linearRampToValueAtTime(0,a+j),b.connect(this.output),h.start(a,f),h.stop(a+j+.1)}triggerGranular(a,l,s){if(!this.granularWorklet){this.initGranularWorklet().then(()=>{this.granularWorklet&&this.triggerGranular(a,l,s)});return}this.granularWorklet.port.postMessage({type:"trigger",time:a,velocity:l,params:{startPoint:s.startPoint,scanSpeed:s.scanSpeed,grainLength:s.grainLength,grainDensity:s.grainDensity,spread:s.spread,grainPan:s.grainPan}})}releaseGrains(){this.granularWorklet&&this.granularWorklet.port.postMessage({type:"release"})}triggerClick(a,l){const s=this.ctx.createOscillator(),u=this.ctx.createGain();s.type="sine",s.frequency.setValueAtTime(800,a),s.frequency.exponentialRampToValueAtTime(200,a+.02),u.gain.setValueAtTime(l*.3,a),u.gain.exponentialRampToValueAtTime(.001,a+.05),s.connect(u),u.connect(this.output),s.start(a),s.stop(a+.05)}get mode(){return this.params.mode}set mode(a){const l=this.params.mode;this.params.mode=a,a==="granular"&&!this.granularWorkletReady?this.initGranularWorklet():a==="standard"&&l==="granular"&&this.releaseGrains()}get startPoint(){return this.params.startPoint}set startPoint(a){this.params.startPoint=Math.max(0,Math.min(1,a))}get pitch(){return this.params.pitch}set pitch(a){this.params.pitch=Math.max(-24,Math.min(24,a))}get direction(){return this.params.direction}set direction(a){this.params.direction=a}get attack(){return this.params.attack}set attack(a){this.params.attack=Math.max(.001,Math.min(2,a))}get decay(){return this.params.decay}set decay(a){this.params.decay=Math.max(.001,Math.min(2,a))}get sustain(){return this.params.sustain}set sustain(a){this.params.sustain=Math.max(0,Math.min(1,a))}get release(){return this.params.release}set release(a){this.params.release=Math.max(.001,Math.min(5,a))}get lpEnabled(){return this.params.lpEnabled}set lpEnabled(a){this.params.lpEnabled=a}get lpCutoff(){return this.params.lpCutoff}set lpCutoff(a){this.params.lpCutoff=Math.max(20,Math.min(2e4,a))}get lpResonance(){return this.params.lpResonance}set lpResonance(a){this.params.lpResonance=Math.max(0,Math.min(20,a))}get hpEnabled(){return this.params.hpEnabled}set hpEnabled(a){this.params.hpEnabled=a}get hpCutoff(){return this.params.hpCutoff}set hpCutoff(a){this.params.hpCutoff=Math.max(20,Math.min(2e4,a))}get hpResonance(){return this.params.hpResonance}set hpResonance(a){this.params.hpResonance=Math.max(0,Math.min(20,a))}get scanSpeed(){return this.params.scanSpeed}set scanSpeed(a){this.params.scanSpeed=Math.max(0,Math.min(8,a))}get grainLength(){return this.params.grainLength}set grainLength(a){this.params.grainLength=Math.max(.001,Math.min(1,a))}get grainDensity(){return this.params.grainDensity}set grainDensity(a){this.params.grainDensity=Math.max(1,Math.min(100,a))}get spread(){return this.params.spread}set spread(a){this.params.spread=Math.max(0,Math.min(1,a))}get grainPan(){return this.params.grainPan}set grainPan(a){this.params.grainPan=Math.max(-1,Math.min(1,a))}get gain(){return this.params.gain}set gain(a){this.params.gain=Math.max(0,Math.min(1,a)),this.output.gain.setValueAtTime(this.params.gain,this.ctx.currentTime)}getSampleName(){return this.sampleName}getSampleDuration(){return this.sampleDuration}hasSample(){return this.sampleBuffer!==null}getWaveformData(a=200){if(!this.sampleBuffer)return null;const l=this.sampleBuffer.getChannelData(0),s=Math.floor(l.length/a),u=new Float32Array(a);for(let h=0;h<a;h++){const p=h*s;let f=0;for(let g=0;g<s;g++){const b=Math.abs(l[p+g]||0);b>f&&(f=b)}u[h]=f}return u}getParams(){return{...this.params}}setParams(a){const l=this.params.mode;Object.assign(this.params,a),a.gain!==void 0&&this.output.gain.setValueAtTime(this.params.gain,this.ctx.currentTime),a.mode==="granular"&&!this.granularWorkletReady?this.initGranularWorklet():a.mode==="standard"&&l==="granular"&&this.releaseGrains()}loadPreset(a){const l=yn[a];l&&this.setParams(l)}connect(a){this.output.connect(a)}disconnect(){this.output.disconnect(),this.granularWorklet&&this.granularWorklet.disconnect()}getOutput(){return this.output}dispose(){this.disconnect(),this.sampleBuffer=null,this.reversedBuffer=null,this.granularWorklet=null}}const K0={pitch:12,grainSize:100,density:100,position:50,spread:10,grainShape:"hanning",hpfFreq:20,lpfFreq:2e4,volume:80};class J0{ctx;output;params;sampleBuffer=null;reversedBuffer=null;sampleName="";sampleDuration=0;activeGrains=new Set;constructor(a,l){this.ctx=a,this.params={...K0},this.output=a.createGain(),this.output.gain.value=this.params.volume/100,l?this.output.connect(l):this.output.connect(a.destination)}loadSample(a,l="sample"){this.sampleBuffer=a,this.sampleName=l,this.sampleDuration=a.duration,this.createReversedBuffer()}async loadSampleFromUrl(a){try{const s=await(await fetch(a)).arrayBuffer(),u=await this.ctx.decodeAudioData(s),h=a.split("/").pop()||"sample";this.loadSample(u,h),this.params.sampleUrl=a}catch(l){throw console.error("Failed to load sample from URL:",l),l}}async loadSampleFromFile(a){const l=await a.arrayBuffer(),s=this.arrayBufferToDataUrl(l,a.type||"audio/wav");this.params.sampleUrl=s;const u=await this.ctx.decodeAudioData(l);this.loadSample(u,a.name)}arrayBufferToDataUrl(a,l){const s=new Uint8Array(a);let u="";for(let h=0;h<s.byteLength;h++)u+=String.fromCharCode(s[h]);return`data:${l};base64,${btoa(u)}`}createReversedBuffer(){if(!this.sampleBuffer)return;const a=this.sampleBuffer.numberOfChannels,l=this.sampleBuffer.length;this.reversedBuffer=this.ctx.createBuffer(a,l,this.sampleBuffer.sampleRate);for(let s=0;s<a;s++){const u=this.sampleBuffer.getChannelData(s),h=this.reversedBuffer.getChannelData(s);for(let p=0;p<l;p++)h[p]=u[l-1-p]}}trigger(a,l=1,s){if(!this.sampleBuffer){this.triggerClick(a,l);return}const u=s?{...this.params,...s}:this.params;this.scheduleGrains(a,l,u)}scheduleGrains(a,l,s){if(!this.sampleBuffer)return;const h=1/(s.density/100*10),f=Math.max(1,Math.floor(.125/h));for(let g=0;g<f;g++){const b=a+g*h;this.spawnGrain(b,l,s)}}spawnGrain(a,l,s){const u=s.pitch<0?this.reversedBuffer:this.sampleBuffer;if(!u)return;const h=Math.abs(s.pitch)-12,p=Math.pow(2,h/12),f=s.grainSize/1e3,g=s.position/100*u.duration,b=s.spread/100*u.duration,M=(Math.random()-.5)*2*b;let S=g+M;S=Math.max(0,Math.min(u.duration-f,S));const y=this.ctx.createBufferSource();y.buffer=u,y.playbackRate.value=p;const j=this.ctx.createBiquadFilter();j.type="highpass",j.frequency.setValueAtTime(s.hpfFreq,a),j.Q.value=.7;const C=this.ctx.createBiquadFilter();C.type="lowpass",C.frequency.setValueAtTime(s.lpfFreq,a),C.Q.value=.7;const B=this.ctx.createGain(),G=f/p,Z=l*(s.volume/100),W=Math.max(a,this.ctx.currentTime+.005);let I,Y;switch(s.grainShape){case"hanning":I=.5,Y=.5;break;case"trapezoid":I=.1,Y=.1;break;case"trapezium":I=.2,Y=.3;break;case"exponentialUp":I=.8,Y=.2;break;case"exponentialDown":I=.2,Y=.8;break;case"rectangle":default:I=.02,Y=.02;break}const te=W+G*I,O=W+G*(1-Y),w=W+G;B.gain.setValueAtTime(0,W),B.gain.linearRampToValueAtTime(Z,te),O>te+.001&&B.gain.setValueAtTime(Z,O),B.gain.linearRampToValueAtTime(0,w),y.connect(j),j.connect(C),C.connect(B),B.connect(this.output),this.activeGrains.add(y),y.onended=()=>{this.activeGrains.delete(y),y.disconnect(),j.disconnect(),C.disconnect(),B.disconnect()},y.start(W,S,f),y.stop(W+G+.01)}triggerClick(a,l){const s=this.ctx.createOscillator(),u=this.ctx.createGain();s.type="sine",s.frequency.setValueAtTime(400,a),s.frequency.exponentialRampToValueAtTime(100,a+.05),u.gain.setValueAtTime(l*.2,a),u.gain.exponentialRampToValueAtTime(.001,a+.1),s.connect(u),u.connect(this.output),s.start(a),s.stop(a+.1)}stopAllGrains(){for(const a of this.activeGrains)try{a.stop()}catch{}this.activeGrains.clear()}getSampleName(){return this.sampleName}getSampleDuration(){return this.sampleDuration}hasSample(){return this.sampleBuffer!==null}getWaveformData(a=200){if(!this.sampleBuffer)return null;const l=this.sampleBuffer.getChannelData(0),s=Math.floor(l.length/a),u=new Float32Array(a);for(let h=0;h<a;h++){const p=h*s;let f=0;for(let g=0;g<s;g++){const b=Math.abs(l[p+g]||0);b>f&&(f=b)}u[h]=f}return u}getParams(){return{...this.params}}setParams(a){Object.assign(this.params,a),a.volume!==void 0&&this.output.gain.setValueAtTime(this.params.volume/100,this.ctx.currentTime)}connect(a){this.output.connect(a)}disconnect(){this.output.disconnect(),this.stopAllGrains()}getOutput(){return this.output}dispose(){this.stopAllGrains(),this.disconnect(),this.sampleBuffer=null,this.reversedBuffer=null}}let Mi=null;const ie={VIRTUAL_ANALOG:0,WAVESHAPER:1,FM:2,FORMANT:3,ADDITIVE:4,WAVETABLE:5,CHORDS:6,SPEECH:7,GRAIN_CLOUD:8,FILTERED_NOISE:9,PARTICLE_NOISE:10,INHARMONIC_STRING:11,MODAL_RESONATOR:12,ANALOG_KICK:13,ANALOG_SNARE:14,ANALOG_HIHAT:15},_c={[ie.VIRTUAL_ANALOG]:{name:"Virtual Analog",description:"Detuned VA oscillators with variable waveforms",harmonicsLabel:"Detune",timbreLabel:"Square/Pulse",morphLabel:"Saw/Triangle",isPitched:!0},[ie.WAVESHAPER]:{name:"Waveshaper",description:"Triangle with waveshaper and folder",harmonicsLabel:"Waveform",timbreLabel:"Fold Amount",morphLabel:"Asymmetry",isPitched:!0},[ie.FM]:{name:"FM",description:"2-operator FM with variable feedback",harmonicsLabel:"Ratio",timbreLabel:"FM Index",morphLabel:"Feedback",isPitched:!0},[ie.FORMANT]:{name:"Formant",description:"Two formants (VOSIM, Pulsar, Grainlet)",harmonicsLabel:"Formant Ratio",timbreLabel:"Formant Freq",morphLabel:"Width/Shape",isPitched:!0},[ie.ADDITIVE]:{name:"Additive",description:"24-harmonic additive oscillator",harmonicsLabel:"Num Bumps",timbreLabel:"Peak Harmonic",morphLabel:"Bump Shape",isPitched:!0},[ie.WAVETABLE]:{name:"Wavetable",description:"4 banks of 8x8 wavetables",harmonicsLabel:"Bank",timbreLabel:"Row (Bright)",morphLabel:"Column",isPitched:!0},[ie.CHORDS]:{name:"Chords",description:"Chord generator with string/organ emulation",harmonicsLabel:"Chord Type",timbreLabel:"Inversion",morphLabel:"Waveform",isPitched:!0},[ie.SPEECH]:{name:"Speech",description:"Speech synthesis (formant, SAM, LPC)",harmonicsLabel:"Algorithm",timbreLabel:"Species",morphLabel:"Phoneme",isPitched:!0},[ie.GRAIN_CLOUD]:{name:"Grain Cloud",description:"Granular with variable pitch randomization",harmonicsLabel:"Pitch Random",timbreLabel:"Grain Density",morphLabel:"Grain Duration",isPitched:!1},[ie.FILTERED_NOISE]:{name:"Filtered Noise",description:"Clocked noise with resonant filter",harmonicsLabel:"Filter Type",timbreLabel:"Clock Freq",morphLabel:"Resonance",isPitched:!1},[ie.PARTICLE_NOISE]:{name:"Particle Noise",description:"8-layer dust with resonators",harmonicsLabel:"Freq Random",timbreLabel:"Density",morphLabel:"Filter Type",isPitched:!1},[ie.INHARMONIC_STRING]:{name:"Inharmonic String",description:"Karplus-Strong with burst excitation",harmonicsLabel:"Inharmonicity",timbreLabel:"Excitation",morphLabel:"Decay",isPitched:!1},[ie.MODAL_RESONATOR]:{name:"Modal Resonator",description:"Mallet/dust-excited modal synthesis",harmonicsLabel:"Material",timbreLabel:"Excitation",morphLabel:"Decay",isPitched:!1},[ie.ANALOG_KICK]:{name:"Analog Kick",description:"Analog kick drum emulation",harmonicsLabel:"Pitch Env",timbreLabel:"Brightness",morphLabel:"Decay",isPitched:!1},[ie.ANALOG_SNARE]:{name:"Analog Snare",description:"Analog snare drum emulation",harmonicsLabel:"Noise Mix",timbreLabel:"Snap",morphLabel:"Decay",isPitched:!1},[ie.ANALOG_HIHAT]:{name:"Analog Hi-Hat",description:"Analog hi-hat emulation",harmonicsLabel:"Noise Balance",timbreLabel:"HP Cutoff",morphLabel:"Decay",isPitched:!1}},$0={engine:ie.VIRTUAL_ANALOG,note:60,harmonics:.5,timbre:.5,morph:.5,fm:0,decay:.5,fade:0,volume:.8};class aa{ctx;output;params;activeVoices=new Map;static woscLoaded=!1;constructor(a,l){this.ctx=a,this.params={...$0},this.output=a.createGain(),this.output.gain.value=this.params.volume,l?this.output.connect(l):this.output.connect(a.destination)}static async loadWoscillators(a){if(!aa.woscLoaded)try{console.log("[Plaits] Getting woscillators from global...");const l=window.woscillators;if(!l)throw new Error("window.woscillators not found - ensure woscillators.js is loaded via script tag");if(Mi=l.wosc,!Mi)throw console.error("[Plaits] wosc not found on window.woscillators. Available keys:",Object.keys(l)),new Error("wosc not found on window.woscillators");console.log("[Plaits] wosc object found, calling loadOscillator..."),await Mi.loadOscillator(a),aa.woscLoaded=!0,console.log("[Plaits] Woscillators loaded successfully")}catch(l){throw console.error("[Plaits] Failed to load woscillators:",l),l}}static teardown(){aa.woscLoaded&&Mi&&(Mi.teardown(),aa.woscLoaded=!1)}static isLoaded(){return aa.woscLoaded}trigger(a,l=1,s){if(!aa.woscLoaded||!Mi){console.warn("Woscillators not loaded, cannot trigger");return}const u=a||this.ctx.currentTime,h=s?{...this.params,...s}:this.params,p=Number.isFinite(h.decay)?h.decay:.5,f=Math.min(Math.max(p,0),1),g=Math.max(f*2,.02);try{const b=Mi.createOscillator();b.engine=h.engine,b.note=h.note,b.harmonics=h.harmonics,b.timbre=h.timbre,b.morph=h.morph,b.frequencyModulationAmount=h.fm,b.decay=f,b.fade=h.fade,b.volume=h.volume*l,b.modTriggerPatched=!0,b.modTrigger=1,b.modLevelPatched=!0,b.modLevel=1;const M=this.ctx.createGain();M.gain.setValueAtTime(0,u),M.gain.linearRampToValueAtTime(1,u+.001),M.gain.setValueAtTime(1,u+g*.7),M.gain.linearRampToValueAtTime(0,u+g),b.connect(M),M.connect(this.output),b.start(u);const S=`${Date.now()}-${Math.random()}`;this.activeVoices.set(S,{osc:b,envGain:M,stopTime:u+g+.1}),setTimeout(()=>{this.cleanupVoice(S)},(g+.2)*1e3)}catch(b){console.error("Failed to create Plaits voice:",b)}}cleanupVoice(a){const l=this.activeVoices.get(a);if(l)try{l.osc.stop(),l.osc.dispose(),l.envGain.disconnect(),this.activeVoices.delete(a)}catch{}}get engine(){return this.params.engine}set engine(a){this.params.engine=Math.max(0,Math.min(15,a))}get note(){return this.params.note}set note(a){this.params.note=Math.max(0,Math.min(127,a))}get harmonics(){return this.params.harmonics}set harmonics(a){this.params.harmonics=Math.max(0,Math.min(1,a))}get timbre(){return this.params.timbre}set timbre(a){this.params.timbre=Math.max(0,Math.min(1,a))}get morph(){return this.params.morph}set morph(a){this.params.morph=Math.max(0,Math.min(1,a))}get fm(){return this.params.fm}set fm(a){this.params.fm=Math.max(0,Math.min(10,a))}get decay(){return this.params.decay}set decay(a){this.params.decay=Math.max(0,Math.min(1,a))}get fade(){return this.params.fade}set fade(a){this.params.fade=Math.max(0,Math.min(1,a))}get volume(){return this.params.volume}set volume(a){this.params.volume=Math.max(0,Math.min(1,a)),this.output.gain.setValueAtTime(this.params.volume,this.ctx.currentTime)}getParams(){return{...this.params}}setParams(a){Object.assign(this.params,a),a.volume!==void 0&&this.output.gain.setValueAtTime(this.params.volume,this.ctx.currentTime)}connect(a){this.output.connect(a)}disconnect(){this.output.disconnect()}getOutput(){return this.output}get activeVoiceCount(){return this.activeVoices.size}dispose(){for(const a of this.activeVoices.keys())this.cleanupVoice(a);this.output.disconnect()}}const W0={glideTime:.05,glideEnabled:!1},Ci={vaBasic:{engine:ie.VIRTUAL_ANALOG,harmonics:.5,timbre:.5,morph:.5,decay:.5,note:48},vaSaw:{engine:ie.VIRTUAL_ANALOG,harmonics:.3,timbre:.2,morph:.9,decay:.6,note:36},vaSquare:{engine:ie.VIRTUAL_ANALOG,harmonics:.4,timbre:.9,morph:.3,decay:.5,note:48},vaSync:{engine:ie.VIRTUAL_ANALOG,harmonics:.8,timbre:.7,morph:.4,decay:.4,note:60},wsBasic:{engine:ie.WAVESHAPER,harmonics:.5,timbre:.5,morph:.5,decay:.5,note:48},wsFolded:{engine:ie.WAVESHAPER,harmonics:.3,timbre:.8,morph:.6,decay:.6,note:36},wsAsym:{engine:ie.WAVESHAPER,harmonics:.6,timbre:.4,morph:.9,decay:.5,note:48},fmBasic:{engine:ie.FM,harmonics:.5,timbre:.5,morph:0,decay:.5,note:48},fmBass:{engine:ie.FM,harmonics:.3,timbre:.6,morph:.2,decay:.7,note:36},fmBell:{engine:ie.FM,harmonics:.7,timbre:.8,morph:.1,decay:.9,note:72},fmFeedback:{engine:ie.FM,harmonics:.5,timbre:.6,morph:.7,decay:.5,note:48},formantBasic:{engine:ie.FORMANT,harmonics:.5,timbre:.5,morph:.5,decay:.5,note:60},formantVowelA:{engine:ie.FORMANT,harmonics:.3,timbre:.2,morph:.4,decay:.6,note:48},formantVowelE:{engine:ie.FORMANT,harmonics:.4,timbre:.5,morph:.5,decay:.6,note:48},formantVowelO:{engine:ie.FORMANT,harmonics:.5,timbre:.3,morph:.6,decay:.6,note:48},additiveBasic:{engine:ie.ADDITIVE,harmonics:.5,timbre:.5,morph:.5,decay:.5,note:60},additiveOrgan:{engine:ie.ADDITIVE,harmonics:.3,timbre:.4,morph:.2,decay:.8,note:48},additiveBright:{engine:ie.ADDITIVE,harmonics:.7,timbre:.8,morph:.6,decay:.5,note:60},wtBasic:{engine:ie.WAVETABLE,harmonics:0,timbre:.5,morph:.5,decay:.5,note:48},wtSweep:{engine:ie.WAVETABLE,harmonics:.25,timbre:.5,morph:.5,decay:.6,note:48},wtDigital:{engine:ie.WAVETABLE,harmonics:.5,timbre:.8,morph:.3,decay:.5,note:60},wtWarm:{engine:ie.WAVETABLE,harmonics:.75,timbre:.3,morph:.6,decay:.7,note:36},chordBasic:{engine:ie.CHORDS,harmonics:.3,timbre:.5,morph:.5,decay:.5,note:48},chordMajor:{engine:ie.CHORDS,harmonics:.2,timbre:.5,morph:.3,decay:.6,note:48},chordMinor:{engine:ie.CHORDS,harmonics:.3,timbre:.5,morph:.3,decay:.6,note:48},chordOrgan:{engine:ie.CHORDS,harmonics:.5,timbre:.7,morph:.8,decay:.8,note:48},speechBasic:{engine:ie.SPEECH,harmonics:.3,timbre:.5,morph:.5,decay:.5,note:48},speechRobot:{engine:ie.SPEECH,harmonics:.1,timbre:.3,morph:.4,decay:.6,note:36},speechChipmunk:{engine:ie.SPEECH,harmonics:.2,timbre:.9,morph:.5,decay:.5,note:72},speechVocoder:{engine:ie.SPEECH,harmonics:.5,timbre:.5,morph:.7,decay:.7,note:48},acidBass:{engine:ie.VIRTUAL_ANALOG,harmonics:.4,timbre:.7,morph:.8,decay:.3,note:36,glideEnabled:!0,glideTime:.04}};class I0 extends aa{melodicParams;lastNote=60;constructor(a,l){super(a,l),this.melodicParams={...this.params,...W0}}triggerNote(a,l=1,s,u,h){const p=h?{...this.melodicParams,...h}:this.melodicParams,f=p.glideEnabled?this.lastNote:a;this.trigger(s,l,{...p,note:p.glideEnabled?this.interpolateNote(f,a,p.glideTime):a}),this.lastNote=a}interpolateNote(a,l,s){return l}trigger(a,l=1,s){const u=s?{...this.melodicParams,...s}:this.melodicParams;u.engine>7&&console.warn("PlaitsMelodicVoice should use engines 0-7"),super.trigger(a,l,u)}get glideTime(){return this.melodicParams.glideTime}set glideTime(a){this.melodicParams.glideTime=Math.max(0,Math.min(2,a))}get glideEnabled(){return this.melodicParams.glideEnabled}set glideEnabled(a){this.melodicParams.glideEnabled=a}getParams(){return{...this.melodicParams}}setParams(a){Object.assign(this.melodicParams,a),super.setParams(a)}loadPreset(a){const l=Ci[a];l&&this.setParams(l)}static getPresetNames(){return Object.keys(Ci)}static getPresetsForEngine(a){return Object.entries(Ci).filter(([l,s])=>s.engine===a).map(([l])=>l)}getEngineInfo(){return _c[this.melodicParams.engine]}}const Ri={grainBasic:{engine:ie.GRAIN_CLOUD,note:48,harmonics:.5,timbre:.5,morph:.5,decay:.7},grainDense:{engine:ie.GRAIN_CLOUD,note:60,harmonics:.8,timbre:.9,morph:.3,decay:.8},grainSparse:{engine:ie.GRAIN_CLOUD,note:48,harmonics:.2,timbre:.3,morph:.7,decay:.6},grainChaos:{engine:ie.GRAIN_CLOUD,note:60,harmonics:.9,timbre:.7,morph:.9,decay:.9},noiseBasic:{engine:ie.FILTERED_NOISE,note:60,harmonics:.5,timbre:.5,morph:.3,decay:.2},noiseHihat:{engine:ie.FILTERED_NOISE,note:80,harmonics:.8,timbre:.7,morph:.6,decay:.1},noiseSnare:{engine:ie.FILTERED_NOISE,note:60,harmonics:.3,timbre:.5,morph:.5,decay:.15},noiseCymbal:{engine:ie.FILTERED_NOISE,note:72,harmonics:.7,timbre:.6,morph:.4,decay:.5},particleBasic:{engine:ie.PARTICLE_NOISE,note:48,harmonics:.5,timbre:.5,morph:.5,decay:.6},particleDust:{engine:ie.PARTICLE_NOISE,note:60,harmonics:.8,timbre:.3,morph:.2,decay:.4},particleRain:{engine:ie.PARTICLE_NOISE,note:72,harmonics:.6,timbre:.7,morph:.4,decay:.5},particleCrackle:{engine:ie.PARTICLE_NOISE,note:48,harmonics:.9,timbre:.8,morph:.7,decay:.3},stringBasic:{engine:ie.INHARMONIC_STRING,note:36,harmonics:.5,timbre:.5,morph:.5,decay:.8},stringPluck:{engine:ie.INHARMONIC_STRING,note:48,harmonics:.3,timbre:.7,morph:.3,decay:.6},stringBow:{engine:ie.INHARMONIC_STRING,note:36,harmonics:.6,timbre:.4,morph:.8,decay:.9},stringInharmonic:{engine:ie.INHARMONIC_STRING,note:48,harmonics:.9,timbre:.6,morph:.5,decay:.7},modalBasic:{engine:ie.MODAL_RESONATOR,note:48,harmonics:.5,timbre:.5,morph:.5,decay:.7},modalMallet:{engine:ie.MODAL_RESONATOR,note:60,harmonics:.4,timbre:.6,morph:.3,decay:.6},modalBell:{engine:ie.MODAL_RESONATOR,note:72,harmonics:.7,timbre:.5,morph:.4,decay:.9},modalTom:{engine:ie.MODAL_RESONATOR,note:48,harmonics:.3,timbre:.4,morph:.6,decay:.5},modalPlate:{engine:ie.MODAL_RESONATOR,note:60,harmonics:.8,timbre:.7,morph:.5,decay:.8},kickBasic:{engine:ie.ANALOG_KICK,note:36,harmonics:.5,timbre:.3,morph:.5,decay:.5,volume:.9},kickDeep:{engine:ie.ANALOG_KICK,note:30,harmonics:.3,timbre:.2,morph:.7,decay:.6,volume:.9},kickPunchy:{engine:ie.ANALOG_KICK,note:40,harmonics:.7,timbre:.5,morph:.3,decay:.3,volume:.9},kick808:{engine:ie.ANALOG_KICK,note:36,harmonics:.4,timbre:.4,morph:.6,decay:.7,volume:.9},kick909:{engine:ie.ANALOG_KICK,note:42,harmonics:.6,timbre:.6,morph:.4,decay:.4,volume:.9},kickElectro:{engine:ie.ANALOG_KICK,note:38,harmonics:.8,timbre:.7,morph:.5,decay:.35,volume:.9},snareBasic:{engine:ie.ANALOG_SNARE,note:60,harmonics:.5,timbre:.6,morph:.7,decay:.15,volume:.9},snareTight:{engine:ie.ANALOG_SNARE,note:65,harmonics:.4,timbre:.7,morph:.5,decay:.1,volume:.9},snareLoose:{engine:ie.ANALOG_SNARE,note:55,harmonics:.6,timbre:.5,morph:.8,decay:.2,volume:.9},snare808:{engine:ie.ANALOG_SNARE,note:60,harmonics:.5,timbre:.5,morph:.6,decay:.18,volume:.9},snare909:{engine:ie.ANALOG_SNARE,note:62,harmonics:.6,timbre:.8,morph:.7,decay:.12,volume:.9},snareRim:{engine:ie.ANALOG_SNARE,note:70,harmonics:.3,timbre:.9,morph:.3,decay:.08,volume:.8},hihatBasic:{engine:ie.ANALOG_HIHAT,note:72,harmonics:.6,timbre:.5,morph:.8,decay:.08,volume:.8},hihatClosed:{engine:ie.ANALOG_HIHAT,note:75,harmonics:.5,timbre:.6,morph:.7,decay:.05,volume:.8},hihatOpen:{engine:ie.ANALOG_HIHAT,note:72,harmonics:.7,timbre:.5,morph:.9,decay:.25,volume:.8},hihat808:{engine:ie.ANALOG_HIHAT,note:72,harmonics:.5,timbre:.4,morph:.6,decay:.1,volume:.8},hihat909:{engine:ie.ANALOG_HIHAT,note:78,harmonics:.7,timbre:.7,morph:.8,decay:.06,volume:.8},hihatMetallic:{engine:ie.ANALOG_HIHAT,note:80,harmonics:.8,timbre:.8,morph:.6,decay:.12,volume:.75}};class ev extends aa{constructor(a,l){super(a,l),this.params.engine=ie.ANALOG_KICK}trigger(a,l=1,s){const u=s?{...this.params,...s}:this.params;u.engine<8&&console.warn("PlaitsPercVoice should use engines 8-15"),super.trigger(a,l,u)}loadPreset(a){const l=Ri[a];l&&this.setParams(l)}static getPresetNames(){return Object.keys(Ri)}static getPresetsForEngine(a){return Object.entries(Ri).filter(([l,s])=>s.engine===a).map(([l])=>l)}getEngineInfo(){return _c[this.params.engine]}}function Wp(m){return m.startsWith("plaits-")}function Zs(m){return["plaits-va","plaits-waveshaper","plaits-fm","plaits-formant","plaits-additive","plaits-wavetable","plaits-chords","plaits-speech"].includes(m)}function tv(m){return m==="plaits-string"||m==="plaits-modal"}function Qp(m){return m==="fm-melodic"||Zs(m)||tv(m)}function Yp(m){return{"plaits-va":0,"plaits-waveshaper":1,"plaits-fm":2,"plaits-formant":3,"plaits-additive":4,"plaits-wavetable":5,"plaits-chords":6,"plaits-speech":7,"plaits-grain":8,"plaits-noise":9,"plaits-particle":10,"plaits-string":11,"plaits-modal":12,"plaits-kick":13,"plaits-snare":14,"plaits-hihat":15}[m]??0}class av{ctx;masterOutput;trackVoices=new Map;mixer=null;modMatrix=null;baseChannelState=new Map;onTriggerFn;constructor(a,l,s){this.ctx=a,this.onTriggerFn=l,this.masterOutput=a.createGain(),this.masterOutput.gain.value=.8,s?this.masterOutput.connect(s):this.masterOutput.connect(a.destination)}setMixer(a){this.mixer=a;for(const[l,s]of this.trackVoices){s.voice.disconnect();const u=a.createChannel(l);s.voice.connect(u)}}setModMatrix(a){this.modMatrix=a}captureBaseChannelState(a){if(!this.mixer)return;const l=this.mixer.getChannelParams(a);if(!l)return;const s=l.filter?.type,u={filterType:s??"bypass",saturationDrive:l.saturation?.drive,saturationBias:l.saturation?.bias,saturationMix:l.saturation?.mix,sendDelay1:l.delaySend,sendDelay2:l.delaySend2,sendDelay3:l.delaySend3,sendDelay4:l.delaySend4,sendReverb:l.reverbSend,volume:l.volume,pan:l.pan};if(s&&s!=="bypass")switch(s){case"wasp":u.filterCutoff=l.filter?.wasp?.cutoff,u.filterResonance=l.filter?.wasp?.resonance;break;case"sem":u.filterCutoff=l.filter?.sem?.cutoff,u.filterResonance=l.filter?.sem?.resonance;break;case"moog":u.filterCutoff=l.filter?.moog?.cutoff,u.filterResonance=l.filter?.moog?.resonance;break;case"threeSisters":u.filterCutoff=l.filter?.threeSisters?.freq,u.filterResonance=l.filter?.threeSisters?.quality,u.filterSpan=l.filter?.threeSisters?.span;break}this.baseChannelState.set(a,u)}getBaseChannelState(a){return this.baseChannelState.get(a)??null}restoreToBaseState(a){if(!this.mixer)return;const l=this.baseChannelState.get(a);if(!l)return;const s=this.mixer.getChannelParams(a);s&&this.restoreBaseChannelState(a,l,s)}getDestinationForTrack(a){if(this.mixer){let l=this.mixer.getChannelInput(a);return l||(l=this.mixer.createChannel(a)),l}return this.masterOutput}assignVoice(a){this.removeVoice(a.trackId);const l=this.getDestinationForTrack(a.trackId);let s;switch(a.voiceType){case"fm-drum":s=new V0(this.ctx,l),a.preset&&a.preset in Sl&&s.loadPreset(a.preset),a.params&&s.setParams(a.params);break;case"fm-melodic":s=new F0(this.ctx,l),a.preset&&a.preset in Ml&&s.loadPreset(a.preset),a.params&&s.setParams(a.params);break;case"noise":s=new U0(this.ctx,l),a.preset&&a.preset in Tl&&s.loadPreset(a.preset),a.params&&s.setParams(a.params);break;case"complex-morph":s=new Y0(this.ctx,l),a.preset&&a.preset in bn&&s.loadPreset(a.preset),a.params&&s.setParams(a.params);break;case"sample":{if(s=new Z0(this.ctx,l),a.preset&&a.preset in yn&&s.loadPreset(a.preset),a.params){s.setParams(a.params);const h=a.params;h.sampleUrl&&s.loadSampleFromUrl(h.sampleUrl).catch(p=>{console.error("[VoiceManager] Failed to reload sample from URL:",p)})}break}case"ocean":{if(s=new J0(this.ctx,l),a.params){s.setParams(a.params);const h=a.params;h.sampleUrl&&s.loadSampleFromUrl(h.sampleUrl).catch(p=>{console.error("[VoiceManager] Failed to reload ocean sample from URL:",p)})}break}case"plaits-va":case"plaits-waveshaper":case"plaits-fm":case"plaits-formant":case"plaits-additive":case"plaits-wavetable":case"plaits-chords":case"plaits-speech":{const h=Yp(a.voiceType);s=new I0(this.ctx,l),s.setParams({engine:h,fm:0}),a.preset&&a.preset in Ci&&s.loadPreset(a.preset),a.params&&s.setParams(a.params);break}case"plaits-grain":case"plaits-noise":case"plaits-particle":case"plaits-string":case"plaits-modal":case"plaits-kick":case"plaits-snare":case"plaits-hihat":{const h=Yp(a.voiceType);s=new ev(this.ctx,l),s.setParams({engine:h,fm:0}),a.preset&&a.preset in Ri&&s.loadPreset(a.preset),a.params&&s.setParams(a.params);break}}const u=this.onTriggerFn(a.trackId,h=>{this.handleTrigger(a.trackId,h)});this.trackVoices.set(a.trackId,{config:a,voice:s,unsubscribe:u})}handleTrigger(a,l){const s=this.trackVoices.get(a);if(!s)return;const{voice:u,config:h}=s,f={...this.getModulatedParams(a,h.voiceType,l.time),...l.latchedParams,...l.paramLocks};switch(this.applyChannelPLocks(a,f),h.voiceType){case"fm-drum":u.trigger(l.time,l.velocity,f);break;case"fm-melodic":{const g=u,b=l.note??h.note??60;g.trigger(b,l.velocity,l.time,.2,f);break}case"noise":u.trigger(l.time,l.velocity,f);break;case"complex-morph":u.trigger(l.time,l.velocity,f);break;case"sample":u.trigger(l.time,l.velocity,f);break;case"ocean":u.trigger(l.time,l.velocity,f);break;case"plaits-va":case"plaits-waveshaper":case"plaits-fm":case"plaits-formant":case"plaits-additive":case"plaits-wavetable":case"plaits-chords":case"plaits-speech":{const g=u,b=l.note??h.note??60;g.triggerNote(b,l.velocity,l.time,.2,f);break}case"plaits-string":case"plaits-modal":{const g=l.note??h.note??48;u.trigger(l.time,l.velocity,{...f,note:g});break}case"plaits-grain":case"plaits-noise":case"plaits-particle":case"plaits-kick":case"plaits-snare":case"plaits-hihat":u.trigger(l.time,l.velocity,f);break}}applyChannelPLocks(a,l){if(!this.mixer)return;const s=["filterType","filterCutoff","filterResonance","filterSpan","saturationDrive","saturationBias","saturationMix","sendDelay1","sendDelay2","sendDelay3","sendDelay4","sendReverb","volume","pan"],u=s.some(M=>M in l),h=s.filter(M=>M in l);h.length>0&&console.log(`[VoiceManager] Channel p-locks for ${a}:`,h.map(M=>`${M}=${l[M]}`));const p=this.mixer.getChannelParams(a);if(!p)return;const f=this.baseChannelState.get(a);if(!u){f&&this.restoreBaseChannelState(a,f,p);return}const g={};if(l.filterType!==void 0||l.filterCutoff!==void 0||l.filterResonance!==void 0||l.filterSpan!==void 0){const M={0:"bypass",1:"wasp",2:"sem",3:"moog",4:"threeSisters"},S=l.filterType!==void 0?M[l.filterType]??"bypass":p.filter?.type;if(console.log(`[VoiceManager] Filter type for ${a}: ${S} (p-locked: ${l.filterType!==void 0}), p-locks:`,{type:l.filterType,cutoff:l.filterCutoff,resonance:l.filterResonance,span:l.filterSpan}),S&&S!=="bypass"){g.filter={...p.filter,type:S};const y=l.filterCutoff,j=l.filterResonance;switch(S){case"wasp":g.filter.wasp||(g.filter.wasp={...p.filter?.wasp}),y!==void 0&&y>=20&&(g.filter.wasp.cutoff=y),j!==void 0&&(g.filter.wasp.resonance=j);break;case"sem":g.filter.sem||(g.filter.sem={...p.filter?.sem}),y!==void 0&&y>=20&&(g.filter.sem.cutoff=y),j!==void 0&&(g.filter.sem.resonance=j);break;case"moog":g.filter.moog||(g.filter.moog={...p.filter?.moog}),y!==void 0&&y>=20&&(g.filter.moog.cutoff=y),j!==void 0&&(g.filter.moog.resonance=j);break;case"threeSisters":g.filter.threeSisters||(g.filter.threeSisters={...p.filter?.threeSisters}),y!==void 0&&y<=1&&(g.filter.threeSisters.freq=y),j!==void 0&&(g.filter.threeSisters.quality=j),l.filterSpan!==void 0&&(g.filter.threeSisters.span=l.filterSpan);break}}else S==="bypass"&&(g.filter={...p.filter,type:"bypass"})}(l.saturationDrive!==void 0||l.saturationBias!==void 0||l.saturationMix!==void 0)&&(g.saturation={...p.saturation},l.saturationDrive!==void 0&&(g.saturation.drive=l.saturationDrive),l.saturationBias!==void 0&&(g.saturation.bias=l.saturationBias),l.saturationMix!==void 0&&(g.saturation.mix=l.saturationMix)),l.sendDelay1!==void 0&&(g.delaySend=l.sendDelay1),l.sendDelay2!==void 0&&(g.delaySend2=l.sendDelay2),l.sendDelay3!==void 0&&(g.delaySend3=l.sendDelay3),l.sendDelay4!==void 0&&(g.delaySend4=l.sendDelay4),l.sendReverb!==void 0&&(g.reverbSend=l.sendReverb),l.volume!==void 0&&(g.volume=l.volume),l.pan!==void 0&&(g.pan=l.pan),Object.keys(g).length>0&&(console.log(`[VoiceManager] Applying channel updates for ${a}:`,g),this.mixer.updateChannel(a,g))}restoreBaseChannelState(a,l,s){if(!this.mixer||!s)return;const u={};if(l.filterType!==void 0&&(u.filter={...s.filter,type:l.filterType},l.filterType!=="bypass"))switch(l.filterType){case"wasp":u.filter.wasp={...s.filter?.wasp},l.filterCutoff!==void 0&&(u.filter.wasp.cutoff=l.filterCutoff),l.filterResonance!==void 0&&(u.filter.wasp.resonance=l.filterResonance);break;case"sem":u.filter.sem={...s.filter?.sem},l.filterCutoff!==void 0&&(u.filter.sem.cutoff=l.filterCutoff),l.filterResonance!==void 0&&(u.filter.sem.resonance=l.filterResonance);break;case"moog":u.filter.moog={...s.filter?.moog},l.filterCutoff!==void 0&&(u.filter.moog.cutoff=l.filterCutoff),l.filterResonance!==void 0&&(u.filter.moog.resonance=l.filterResonance);break;case"threeSisters":u.filter.threeSisters={...s.filter?.threeSisters},l.filterCutoff!==void 0&&(u.filter.threeSisters.freq=l.filterCutoff),l.filterResonance!==void 0&&(u.filter.threeSisters.quality=l.filterResonance),l.filterSpan!==void 0&&(u.filter.threeSisters.span=l.filterSpan);break}(l.saturationDrive!==void 0||l.saturationBias!==void 0||l.saturationMix!==void 0)&&(u.saturation={...s.saturation},l.saturationDrive!==void 0&&(u.saturation.drive=l.saturationDrive),l.saturationBias!==void 0&&(u.saturation.bias=l.saturationBias),l.saturationMix!==void 0&&(u.saturation.mix=l.saturationMix)),l.sendDelay1!==void 0&&(u.delaySend=l.sendDelay1),l.sendDelay2!==void 0&&(u.delaySend2=l.sendDelay2),l.sendDelay3!==void 0&&(u.delaySend3=l.sendDelay3),l.sendDelay4!==void 0&&(u.delaySend4=l.sendDelay4),l.sendReverb!==void 0&&(u.reverbSend=l.sendReverb),l.volume!==void 0&&(u.volume=l.volume),l.pan!==void 0&&(u.pan=l.pan),Object.keys(u).length>0&&this.mixer.updateChannel(a,u)}getModulatedParams(a,l,s){if(!this.modMatrix)return console.log("[VoiceManager] No modMatrix set"),{};const u={},h=this.trackVoices.get(a);if(!h)return u;const p=this.getVoiceBaseParams(h.voice,l),f=this.getDestinationMapping(l),b=this.modMatrix.getAllRoutes().filter(M=>{const S=M.trackTarget??"all";if(S==="all")return!0;const y=parseInt(a.replace("track-",""),10);return S===y});b.length>0&&console.log(`[VoiceManager] Found ${b.length} routes for ${a}:`,b.map(M=>`${M.source} -> ${M.destination} (depth: ${M.depth})`));for(const[M,S]of Object.entries(f)){const y=p[S];if(y!==void 0){const j=this.modMatrix.applyModulation(M,y,s,a);Math.abs(j-y)>1e-4&&(console.log(`[VoiceManager] Modulation applied: ${M} -> ${S}: ${y} -> ${j}`),u[S]=j)}}return this.applyChannelModulation(a,s,u),u}applyChannelModulation(a,l,s){if(!this.modMatrix||!this.mixer)return;const u=this.mixer.getChannelParams(a);if(!u)return;const h=[{dest:"filterCutoff",pLockName:"filterCutoff",getBase:()=>{const p=u.filter?.type;if(!(!p||p==="bypass"))switch(p){case"wasp":return u.filter?.wasp?.cutoff;case"sem":return u.filter?.sem?.cutoff;case"moog":return u.filter?.moog?.cutoff;case"threeSisters":return u.filter?.threeSisters?.freq;default:return}}},{dest:"filterResonance",pLockName:"filterResonance",getBase:()=>{const p=u.filter?.type;if(!(!p||p==="bypass"))switch(p){case"wasp":return u.filter?.wasp?.resonance;case"sem":return u.filter?.sem?.resonance;case"moog":return u.filter?.moog?.resonance;case"threeSisters":return u.filter?.threeSisters?.quality;default:return}}},{dest:"filterSpan",pLockName:"filterSpan",getBase:()=>u.filter?.threeSisters?.span},{dest:"filterDrive",pLockName:"filterDrive",getBase:()=>{switch(u.filter?.type){case"wasp":return u.filter?.wasp?.drive;case"sem":return u.filter?.sem?.drive;case"moog":return u.filter?.moog?.drive;default:return}}},{dest:"saturationDrive",pLockName:"saturationDrive",getBase:()=>u.saturation?.drive},{dest:"saturationBias",pLockName:"saturationBias",getBase:()=>u.saturation?.bias},{dest:"saturationMix",pLockName:"saturationMix",getBase:()=>u.saturation?.mix},{dest:"delaySend1",pLockName:"sendDelay1",getBase:()=>u.delaySend},{dest:"delaySend2",pLockName:"sendDelay2",getBase:()=>u.delaySend2},{dest:"delaySend3",pLockName:"sendDelay3",getBase:()=>u.delaySend3},{dest:"delaySend4",pLockName:"sendDelay4",getBase:()=>u.delaySend4},{dest:"reverbSend",pLockName:"sendReverb",getBase:()=>u.reverbSend},{dest:"volume",pLockName:"volume",getBase:()=>u.volume},{dest:"pan",pLockName:"pan",getBase:()=>u.pan}];for(const{dest:p,pLockName:f,getBase:g}of h){const b=g();if(b!==void 0){const M=this.modMatrix.applyModulation(p,b,l,a);Math.abs(M-b)>1e-4&&(s[f]=M)}}}getVoiceBaseParams(a,l){switch(l){case"fm-drum":return a.getParams();case"fm-melodic":return a.getParams();case"noise":return a.getParams();case"complex-morph":return a.getParams();case"sample":return a.getParams();case"ocean":return a.getParams();case"plaits-va":case"plaits-waveshaper":case"plaits-fm":case"plaits-formant":case"plaits-additive":case"plaits-wavetable":case"plaits-chords":case"plaits-speech":return a.getParams();case"plaits-grain":case"plaits-noise":case"plaits-particle":case"plaits-string":case"plaits-modal":case"plaits-kick":case"plaits-snare":case"plaits-hihat":return a.getParams()}}getDestinationMapping(a){switch(a){case"fm-drum":return{pitch:"pitch",pitchEnvAmount:"pitchEnvAmount",pitchEnvDecay:"pitchEnvDecay",op1Ratio:"op1Ratio",op1Index:"op1Index",op1Feedback:"op1Feedback",op2Ratio:"op2Ratio",op2Index:"op2Index",op2ToOp1:"op2ToOp1",ampAttack:"ampAttack",ampDecay:"ampDecay",noiseMix:"noiseMix",noiseDecay:"noiseDecay",noiseFilterFreq:"noiseFilterFreq"};case"fm-melodic":return{filterCutoff:"filterFreq",filterQ:"filterQ",filterEnvAmount:"filterEnvAmount",fmIndex:"op2Index",fmIndexEnvAmount:"indexEnvAmount",ampAttack:"ampAttack",ampDecay:"ampDecay",glideTime:"glideTime"};case"noise":return{decay:"decay",filterFreq:"filterFreq",filterQ:"filterQ",noiseFilterQ:"filterQ",metalAmount:"metallicGain",clickAmount:"clickGain"};case"complex-morph":return{pitch:"carrierFreq",complexCarrierFreq:"carrierFreq",filterFreq:"notchFreq",filterQ:"notchQ",complexNotchFreq:"notchFreq",complexNotchQ:"notchQ",complexOutputLevel:"outputLevel",complexCarrierPitchPeriod:"carrierPitchEnv.period",complexCarrierPitchAmount:"carrierPitchEnv.amount",complexCarrierPitchRange:"carrierPitchRange",complexOpAPitchPeriod:"opA.envelopes.pitch.period",complexOpAPitchAmount:"opA.envelopes.pitch.amount",complexOpAPitchRange:"opA.envelopes.pitchRange",complexOpAIndexPeriod:"opA.envelopes.index.period",complexOpAIndexAmount:"opA.envelopes.index.amount",complexOpAIndexMin:"opA.envelopes.indexMin",complexOpAIndexMax:"opA.envelopes.indexMax",complexOpALevelPeriod:"opA.envelopes.level.period",complexOpALevelAmount:"opA.envelopes.level.amount",complexOpALevelMax:"opA.envelopes.levelMax",complexOpBPitchPeriod:"opB.envelopes.pitch.period",complexOpBPitchAmount:"opB.envelopes.pitch.amount",complexOpBPitchRange:"opB.envelopes.pitchRange",complexOpBIndexPeriod:"opB.envelopes.index.period",complexOpBIndexAmount:"opB.envelopes.index.amount",complexOpBIndexMin:"opB.envelopes.indexMin",complexOpBIndexMax:"opB.envelopes.indexMax",complexOpBLevelPeriod:"opB.envelopes.level.period",complexOpBLevelAmount:"opB.envelopes.level.amount",complexOpBLevelMax:"opB.envelopes.levelMax",complexOpCPitchPeriod:"opC.envelopes.pitch.period",complexOpCPitchAmount:"opC.envelopes.pitch.amount",complexOpCPitchRange:"opC.envelopes.pitchRange",complexOpCIndexPeriod:"opC.envelopes.index.period",complexOpCIndexAmount:"opC.envelopes.index.amount",complexOpCIndexMin:"opC.envelopes.indexMin",complexOpCIndexMax:"opC.envelopes.indexMax",complexOpCLevelPeriod:"opC.envelopes.level.period",complexOpCLevelAmount:"opC.envelopes.level.amount",complexOpCLevelMax:"opC.envelopes.levelMax",complexAmpPeriod:"ampEnv.period",complexAmpAmount:"ampEnv.amount",complexNotchEnvPeriod:"notchEnv.period",complexNotchEnvAmount:"notchEnv.amount",complexNotchRange:"notchRange"};case"sample":return{samplePitch:"pitch",sampleStartPoint:"startPoint",filterCutoff:"lpCutoff",filterQ:"lpResonance",sampleLpCutoff:"lpCutoff",sampleLpResonance:"lpResonance",sampleHpCutoff:"hpCutoff",sampleHpResonance:"hpResonance",ampAttack:"attack",ampDecay:"decay",sampleSustain:"sustain",sampleRelease:"release",grainDensity:"grainDensity",grainLength:"grainLength",grainSpread:"spread",grainPan:"grainPan",sampleScanSpeed:"scanSpeed"};case"ocean":return{oceanPitch:"pitch",oceanGrainSize:"grainSize",oceanDensity:"density",oceanPosition:"position",oceanSpread:"spread",oceanHpfFreq:"hpfFreq",oceanLpfFreq:"lpfFreq",oceanVolume:"volume"};case"plaits-va":case"plaits-waveshaper":case"plaits-fm":case"plaits-formant":case"plaits-additive":case"plaits-wavetable":case"plaits-chords":case"plaits-speech":case"plaits-grain":case"plaits-noise":case"plaits-particle":case"plaits-string":case"plaits-modal":case"plaits-kick":case"plaits-snare":case"plaits-hihat":return{plaitsHarmonics:"harmonics",plaitsTimbre:"timbre",plaitsMorph:"morph",plaitsFM:"fm",plaitsDecay:"decay",plaitsFade:"fade",glideTime:"glideTime"}}}removeVoice(a){const l=this.trackVoices.get(a);l&&(l.unsubscribe(),l.voice.disconnect(),this.trackVoices.delete(a))}getVoice(a){return this.trackVoices.get(a)?.voice??null}getVoiceConfig(a){const l=this.trackVoices.get(a);if(!l)return null;let s;switch(l.config.voiceType){case"fm-drum":s=l.voice.getParams();break;case"fm-melodic":s=l.voice.getParams();break;case"noise":s=l.voice.getParams();break;case"complex-morph":s=l.voice.getParams();break;case"sample":s=l.voice.getParams();break;case"ocean":s=l.voice.getParams();break;case"plaits-va":case"plaits-waveshaper":case"plaits-fm":case"plaits-formant":case"plaits-additive":case"plaits-wavetable":case"plaits-chords":case"plaits-speech":s=l.voice.getParams();break;case"plaits-grain":case"plaits-noise":case"plaits-particle":case"plaits-string":case"plaits-modal":case"plaits-kick":case"plaits-snare":case"plaits-hihat":s=l.voice.getParams();break}return{...l.config,params:s}}updateVoiceParams(a,l){const s=this.trackVoices.get(a);if(s){switch(s.config.voiceType){case"fm-drum":s.voice.setParams(l);break;case"fm-melodic":s.voice.setParams(l);break;case"noise":s.voice.setParams(l);break;case"complex-morph":s.voice.setParams(l);break;case"sample":s.voice.setParams(l);break;case"ocean":s.voice.setParams(l);break;case"plaits-va":case"plaits-waveshaper":case"plaits-fm":case"plaits-formant":case"plaits-additive":case"plaits-wavetable":case"plaits-chords":case"plaits-speech":s.voice.setParams(l);break;case"plaits-grain":case"plaits-noise":case"plaits-particle":case"plaits-string":case"plaits-modal":case"plaits-kick":case"plaits-snare":case"plaits-hihat":s.voice.setParams(l);break}s.config.params={...s.config.params,...l}}}loadPreset(a,l){const s=this.trackVoices.get(a);if(s){switch(s.config.voiceType){case"fm-drum":l in Sl&&s.voice.loadPreset(l);break;case"fm-melodic":l in Ml&&s.voice.loadPreset(l);break;case"noise":l in Tl&&s.voice.loadPreset(l);break;case"complex-morph":l in bn&&s.voice.loadPreset(l);break;case"sample":l in yn&&s.voice.loadPreset(l);break;case"ocean":break;case"plaits-va":case"plaits-waveshaper":case"plaits-fm":case"plaits-formant":case"plaits-additive":case"plaits-wavetable":case"plaits-chords":case"plaits-speech":l in Ci&&s.voice.loadPreset(l);break;case"plaits-grain":case"plaits-noise":case"plaits-particle":case"plaits-string":case"plaits-modal":case"plaits-kick":case"plaits-snare":case"plaits-hihat":l in Ri&&s.voice.loadPreset(l);break}s.config.preset=l}}setTrackNote(a,l){const s=this.trackVoices.get(a);if(!s)return;const u=s.config.voiceType,h=u==="plaits-string"||u==="plaits-modal";(u==="fm-melodic"||Zs(u)||h)&&(s.config.note=l,h&&s.voice.setParams({note:l}))}getAllConfigs(){return Array.from(this.trackVoices.values()).map(a=>a.config)}getPresetsForType(a){switch(a){case"fm-drum":return Object.keys(Sl);case"fm-melodic":return Object.keys(Ml);case"noise":return Object.keys(Tl);case"complex-morph":return Object.keys(bn);case"sample":return Object.keys(yn);case"ocean":return[];case"plaits-va":case"plaits-waveshaper":case"plaits-fm":case"plaits-formant":case"plaits-additive":case"plaits-wavetable":case"plaits-chords":case"plaits-speech":return Object.keys(Ci);case"plaits-grain":case"plaits-noise":case"plaits-particle":case"plaits-string":case"plaits-modal":case"plaits-kick":case"plaits-snare":case"plaits-hihat":return Object.keys(Ri)}}getState(){const a=[];for(const[,l]of this.trackVoices){const s={...l.config};switch(s.voiceType){case"fm-drum":s.params=l.voice.getParams();break;case"fm-melodic":s.params=l.voice.getParams();break;case"noise":s.params=l.voice.getParams();break;case"complex-morph":s.params=l.voice.getParams();break;case"sample":s.params=l.voice.getParams();break;case"ocean":s.params=l.voice.getParams();break;case"plaits-va":case"plaits-waveshaper":case"plaits-fm":case"plaits-formant":case"plaits-additive":case"plaits-wavetable":case"plaits-chords":case"plaits-speech":s.params=l.voice.getParams();break;case"plaits-grain":case"plaits-noise":case"plaits-particle":case"plaits-string":case"plaits-modal":case"plaits-kick":case"plaits-snare":case"plaits-hihat":s.params=l.voice.getParams();break}a.push(s)}return{voices:a}}setState(a){for(const l of this.trackVoices.keys())this.removeVoice(l);for(const l of a.voices)this.assignVoice(l)}set masterGain(a){this.masterOutput.gain.setValueAtTime(Math.max(0,Math.min(1,a)),this.ctx.currentTime)}get masterGain(){return this.masterOutput.gain.value}getMasterOutput(){return this.masterOutput}dispose(){for(const a of this.trackVoices.keys())this.removeVoice(a);this.masterOutput.disconnect()}}const iv={zone:1,rate:.5,microRate:0,microRateFreq:2,skew:0,repeats:.3,color:.5,halo:0,mix:0,hold:!1,flip:!1,pingPong:!1,swap:!1},pt=[{min:.005,max:.05},{min:.05,max:.4},{min:.4,max:2},{min:2,max:10}];class Qs{ctx;params;node=null;inputGain;outputGain;isReady=!1;constructor(a,l){this.ctx=a,this.params={...iv},this.inputGain=a.createGain(),this.outputGain=a.createGain(),l&&this.outputGain.connect(l),this.initWorklet()}async initWorklet(){try{await this.ctx.audioWorklet.addModule(this.getProcessorURL()),this.node=new AudioWorkletNode(this.ctx,"mimeophon-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],processorOptions:{sampleRate:this.ctx.sampleRate}}),this.inputGain.connect(this.node),this.node.connect(this.outputGain),this.isReady=!0,this.updateParams()}catch(a){console.error("Failed to initialize Mimeophon:",a)}}getProcessorURL(){const a=`
// Mimeophon-Inspired Stereo Delay Processor
class MimeophonProcessor extends AudioWorkletProcessor {
    static get parameterDescriptors() {
        return [
            { name: 'zone', defaultValue: 1, minValue: 0, maxValue: 3 },
            { name: 'rate', defaultValue: 0.5, minValue: 0, maxValue: 1 },
            { name: 'microRate', defaultValue: 0, minValue: 0, maxValue: 1 },
            { name: 'microRateFreq', defaultValue: 2, minValue: 0.1, maxValue: 8 },
            { name: 'skew', defaultValue: 0, minValue: -1, maxValue: 1 },
            { name: 'repeats', defaultValue: 0.3, minValue: 0, maxValue: 1.2 },
            { name: 'color', defaultValue: 0.5, minValue: 0, maxValue: 1 },
            { name: 'halo', defaultValue: 0, minValue: 0, maxValue: 1 },
            { name: 'mix', defaultValue: 0.0, minValue: 0, maxValue: 1 },
            { name: 'hold', defaultValue: 0, minValue: 0, maxValue: 1 },
            { name: 'flip', defaultValue: 0, minValue: 0, maxValue: 1 },
            { name: 'pingPong', defaultValue: 0, minValue: 0, maxValue: 1 },
            { name: 'swap', defaultValue: 0, minValue: 0, maxValue: 1 }
        ];
    }

    constructor(options) {
        super();

        this.sampleRate = options.processorOptions?.sampleRate || 48000;

        const maxDelaySamples = Math.ceil(this.sampleRate * 10);
        this.bufferL = new Float32Array(maxDelaySamples);
        this.bufferR = new Float32Array(maxDelaySamples);
        this.writeIndex = 0;
        this.bufferSize = maxDelaySamples;

        this.zones = [
            { min: 0.005, max: 0.050 },
            { min: 0.050, max: 0.400 },
            { min: 0.400, max: 2.000 },
            { min: 2.000, max: 10.000 }
        ];

        this.delayTimeL = 0.1;
        this.delayTimeR = 0.1;
        this.targetDelayTimeL = 0.1;
        this.targetDelayTimeR = 0.1;
        this.lfoPhase = 0;

        this.filterStateL = this.createFilterState();
        this.filterStateR = this.createFilterState();
        this.haloStateL = this.createHaloState();
        this.haloStateR = this.createHaloState();

        this.feedbackL = 0;
        this.feedbackR = 0;
        this.holdActive = false;
        this.holdBufferL = new Float32Array(maxDelaySamples);
        this.holdBufferR = new Float32Array(maxDelaySamples);
        this.flipActive = false;
        this.crossfadeActive = false;
        this.crossfadeProgress = 0;
        this.crossfadeDuration = 0.02;
        this.prevZone = 1;
        this.prevRate = 0.5;
        this.pingPongPhase = 0;
    }

    createFilterState() {
        return {
            b1: { x1: 0, x2: 0, y1: 0, y2: 0 },
            b2: { x1: 0, x2: 0, y1: 0, y2: 0 },
            coefs1: { b0: 1, b1: 0, b2: 0, a1: 0, a2: 0 },
            coefs2: { b0: 1, b1: 0, b2: 0, a1: 0, a2: 0 }
        };
    }

    createHaloState() {
        return {
            buffers: [
                new Float32Array(1307),
                new Float32Array(1811),
                new Float32Array(2473),
                new Float32Array(3181)
            ],
            indices: [0, 0, 0, 0],
            g: [0.6, 0.55, 0.5, 0.45]
        };
    }

    getDelayTime(zone, rate) {
        const z = Math.floor(zone);
        const zoneData = this.zones[Math.min(z, 3)];
        return zoneData.min + rate * (zoneData.max - zoneData.min);
    }

    readBuffer(buffer, delaySamples) {
        const size = this.bufferSize;
        const readPos = (this.writeIndex - delaySamples + size) % size;
        const readIndex = Math.floor(readPos);
        const frac = readPos - readIndex;
        const idx1 = readIndex % size;
        const idx2 = (readIndex + 1) % size;
        return buffer[idx1] * (1 - frac) + buffer[idx2] * frac;
    }

    readBufferReverse(buffer, delaySamples) {
        const size = this.bufferSize;
        const readPos = (this.writeIndex + delaySamples) % size;
        const readIndex = Math.floor(readPos);
        const frac = readPos - readIndex;
        const idx1 = readIndex % size;
        const idx2 = (readIndex + 1) % size;
        return buffer[idx1] * (1 - frac) + buffer[idx2] * frac;
    }

    softSaturate(x) {
        if (x > 1) return 1 - Math.exp(-(x - 1));
        if (x < -1) return -1 + Math.exp(x + 1);
        return x;
    }

    asymmetricSaturate(x, bias = 0.3) {
        const shifted = x + bias;
        return Math.tanh(shifted * 1.5) - Math.tanh(bias * 1.5);
    }

    updateColorFilter(color, filterState) {
        if (color < 0.2) {
            const freq = 4000 + color * 5 * 7000;
            this.setLowpass(filterState.coefs1, freq, 0.707);
            this.setLowpass(filterState.coefs2, freq * 0.5, 0.707);
        } else if (color < 0.4) {
            const t = (color - 0.2) / 0.2;
            const freq = 4000 + t * 6000;
            this.setLowpass(filterState.coefs1, freq, 1.5);
            this.setBandpass(filterState.coefs2, 2000, 2);
        } else if (color < 0.6) {
            const t = (color - 0.4) / 0.2;
            const freq = 8000 - t * 2000;
            this.setHighShelf(filterState.coefs1, freq, -3, 0.707);
            this.setLowpass(filterState.coefs2, 12000, 0.707);
        } else if (color < 0.8) {
            const t = (color - 0.6) / 0.2;
            this.setHighShelf(filterState.coefs1, 8000, t * 2, 0.707);
            this.setAllpass(filterState.coefs2, 0);
        } else {
            const t = (color - 0.8) / 0.2;
            this.setHighShelf(filterState.coefs1, 6000, 3 + t * 2, 0.707);
            this.setPeaking(filterState.coefs2, 3000, 2, 1.5);
        }
    }

    setLowpass(coefs, freq, Q) {
        const w0 = 2 * Math.PI * freq / this.sampleRate;
        const cosw0 = Math.cos(w0);
        const sinw0 = Math.sin(w0);
        const alpha = sinw0 / (2 * Q);
        const b0 = (1 - cosw0) / 2;
        const b1 = 1 - cosw0;
        const b2 = (1 - cosw0) / 2;
        const a0 = 1 + alpha;
        const a1 = -2 * cosw0;
        const a2 = 1 - alpha;
        coefs.b0 = b0 / a0;
        coefs.b1 = b1 / a0;
        coefs.b2 = b2 / a0;
        coefs.a1 = a1 / a0;
        coefs.a2 = a2 / a0;
    }

    setHighShelf(coefs, freq, gainDB, Q) {
        const A = Math.pow(10, gainDB / 40);
        const w0 = 2 * Math.PI * freq / this.sampleRate;
        const cosw0 = Math.cos(w0);
        const sinw0 = Math.sin(w0);
        const alpha = sinw0 / (2 * Q);
        const b0 = A * ((A + 1) + (A - 1) * cosw0 + 2 * Math.sqrt(A) * alpha);
        const b1 = -2 * A * ((A - 1) + (A + 1) * cosw0);
        const b2 = A * ((A + 1) + (A - 1) * cosw0 - 2 * Math.sqrt(A) * alpha);
        const a0 = (A + 1) - (A - 1) * cosw0 + 2 * Math.sqrt(A) * alpha;
        const a1 = 2 * ((A - 1) - (A + 1) * cosw0);
        const a2 = (A + 1) - (A - 1) * cosw0 - 2 * Math.sqrt(A) * alpha;
        coefs.b0 = b0 / a0;
        coefs.b1 = b1 / a0;
        coefs.b2 = b2 / a0;
        coefs.a1 = a1 / a0;
        coefs.a2 = a2 / a0;
    }

    setBandpass(coefs, freq, Q) {
        const w0 = 2 * Math.PI * freq / this.sampleRate;
        const cosw0 = Math.cos(w0);
        const sinw0 = Math.sin(w0);
        const alpha = sinw0 / (2 * Q);
        const b0 = alpha;
        const b1 = 0;
        const b2 = -alpha;
        const a0 = 1 + alpha;
        const a1 = -2 * cosw0;
        const a2 = 1 - alpha;
        coefs.b0 = b0 / a0;
        coefs.b1 = b1 / a0;
        coefs.b2 = b2 / a0;
        coefs.a1 = a1 / a0;
        coefs.a2 = a2 / a0;
    }

    setPeaking(coefs, freq, gainDB, Q) {
        const A = Math.pow(10, gainDB / 40);
        const w0 = 2 * Math.PI * freq / this.sampleRate;
        const cosw0 = Math.cos(w0);
        const sinw0 = Math.sin(w0);
        const alpha = sinw0 / (2 * Q);
        const b0 = 1 + alpha * A;
        const b1 = -2 * cosw0;
        const b2 = 1 - alpha * A;
        const a0 = 1 + alpha / A;
        const a1 = -2 * cosw0;
        const a2 = 1 - alpha / A;
        coefs.b0 = b0 / a0;
        coefs.b1 = b1 / a0;
        coefs.b2 = b2 / a0;
        coefs.a1 = a1 / a0;
        coefs.a2 = a2 / a0;
    }

    setAllpass(coefs, freq) {
        if (freq === 0) {
            coefs.b0 = 1;
            coefs.b1 = 0;
            coefs.b2 = 0;
            coefs.a1 = 0;
            coefs.a2 = 0;
        } else {
            const w0 = 2 * Math.PI * freq / this.sampleRate;
            const cosw0 = Math.cos(w0);
            const sinw0 = Math.sin(w0);
            const alpha = sinw0 / 2;
            const b0 = 1 - alpha;
            const b1 = -2 * cosw0;
            const b2 = 1 + alpha;
            const a0 = 1 + alpha;
            const a1 = -2 * cosw0;
            const a2 = 1 - alpha;
            coefs.b0 = b0 / a0;
            coefs.b1 = b1 / a0;
            coefs.b2 = b2 / a0;
            coefs.a1 = a1 / a0;
            coefs.a2 = a2 / a0;
        }
    }

    processBiquad(input, state, coefs) {
        const output = coefs.b0 * input +
                      coefs.b1 * state.x1 +
                      coefs.b2 * state.x2 -
                      coefs.a1 * state.y1 -
                      coefs.a2 * state.y2;
        state.x2 = state.x1;
        state.x1 = input;
        state.y2 = state.y1;
        state.y1 = output;
        return output;
    }

    processHalo(input, haloState, amount) {
        if (amount < 0.001) return input;
        let signal = input;
        for (let i = 0; i < 4; i++) {
            const buffer = haloState.buffers[i];
            const index = haloState.indices[i];
            const g = haloState.g[i] * amount;
            const delayed = buffer[index];
            const output = -g * signal + delayed;
            buffer[index] = signal + g * output;
            haloState.indices[i] = (index + 1) % buffer.length;
            signal = output;
        }
        const wetMix = 0.5 + amount * 0.4;
        const dryMix = 1.0 - wetMix;
        return signal * wetMix + input * dryMix;
    }

    process(inputs, outputs, parameters) {
        const input = inputs[0];
        const output = outputs[0];

        if (!input || !output || !input[0]) {
            return true;
        }

        const inputL = input[0];
        const inputR = input[1] || input[0];
        const outputL = output[0];
        const outputR = output[1] || output[0];
        const blockSize = outputL.length;

        const getParam = (param, index) => {
            return param.length > 1 ? param[index] : param[0];
        };

        for (let i = 0; i < blockSize; i++) {
            const zone = getParam(parameters.zone, i);
            const rate = getParam(parameters.rate, i);
            const microRate = getParam(parameters.microRate, i);
            const microRateFreq = getParam(parameters.microRateFreq, i);
            const skew = getParam(parameters.skew, i);
            const repeats = getParam(parameters.repeats, i);
            const color = getParam(parameters.color, i);
            const halo = getParam(parameters.halo, i);
            const mix = getParam(parameters.mix, i);
            const hold = getParam(parameters.hold, i);
            const flip = getParam(parameters.flip, i);
            const pingPong = getParam(parameters.pingPong, i);
            const swap = getParam(parameters.swap, i);

            const holdNow = hold > 0.5;
            if (holdNow && !this.holdActive) {
                this.holdBufferL.set(this.bufferL);
                this.holdBufferR.set(this.bufferR);
                this.holdActive = true;
            } else if (!holdNow && this.holdActive) {
                this.holdActive = false;
            }

            this.flipActive = flip > 0.5;

            const baseDelayTime = this.getDelayTime(zone, rate);

            this.lfoPhase += 2 * Math.PI * microRateFreq / this.sampleRate;
            if (this.lfoPhase > 2 * Math.PI) this.lfoPhase -= 2 * Math.PI;
            const lfoValue = Math.sin(this.lfoPhase);
            const microRateOffset = lfoValue * microRate * 0.015;

            const skewAmount = skew * baseDelayTime * 0.5;
            this.targetDelayTimeL = baseDelayTime - skewAmount + microRateOffset;
            this.targetDelayTimeR = baseDelayTime + skewAmount + microRateOffset;

            if (swap > 0.5) {
                [this.targetDelayTimeL, this.targetDelayTimeR] =
                    [this.targetDelayTimeR, this.targetDelayTimeL];
            }

            const smoothingCoef = 0.999;
            this.delayTimeL = this.delayTimeL * smoothingCoef +
                             this.targetDelayTimeL * (1 - smoothingCoef);
            this.delayTimeR = this.delayTimeR * smoothingCoef +
                             this.targetDelayTimeR * (1 - smoothingCoef);

            const delayL = Math.max(0.001, this.delayTimeL) * this.sampleRate;
            const delayR = Math.max(0.001, this.delayTimeR) * this.sampleRate;

            let delayedL, delayedR;

            if (this.holdActive) {
                if (this.flipActive) {
                    delayedL = this.readBufferReverse(this.holdBufferL, delayL);
                    delayedR = this.readBufferReverse(this.holdBufferR, delayR);
                } else {
                    delayedL = this.readBuffer(this.holdBufferL, delayL);
                    delayedR = this.readBuffer(this.holdBufferR, delayR);
                }
            } else {
                if (this.flipActive) {
                    delayedL = this.readBufferReverse(this.bufferL, delayL);
                    delayedR = this.readBufferReverse(this.bufferR, delayR);
                } else {
                    delayedL = this.readBuffer(this.bufferL, delayL);
                    delayedR = this.readBuffer(this.bufferR, delayR);
                }
            }

            if (pingPong > 0.5) {
                const temp = delayedL;
                delayedL = this.feedbackR;
                delayedR = this.feedbackL;
            }

            this.updateColorFilter(color, this.filterStateL);
            this.updateColorFilter(color, this.filterStateR);

            let coloredL = this.processBiquad(delayedL, this.filterStateL.b1,
                                             this.filterStateL.coefs1);
            coloredL = this.processBiquad(coloredL, this.filterStateL.b2,
                                         this.filterStateL.coefs2);

            let coloredR = this.processBiquad(delayedR, this.filterStateR.b1,
                                             this.filterStateR.coefs1);
            coloredR = this.processBiquad(coloredR, this.filterStateR.b2,
                                         this.filterStateR.coefs2);

            const haloedL = this.processHalo(coloredL, this.haloStateL, halo);
            const haloedR = this.processHalo(coloredR, this.haloStateR, halo);

            let saturatedL, saturatedR;
            if (color < 0.6) {
                saturatedL = this.asymmetricSaturate(haloedL * 1.5, 0.2);
                saturatedR = this.asymmetricSaturate(haloedR * 1.5, 0.2);
            } else {
                saturatedL = this.softSaturate(haloedL * 1.2);
                saturatedR = this.softSaturate(haloedR * 1.2);
            }

            const feedbackAmount = Math.min(1.1, repeats);
            this.feedbackL = saturatedL * feedbackAmount;
            this.feedbackR = saturatedR * feedbackAmount;

            if (!this.holdActive) {
                this.bufferL[this.writeIndex] = inputL[i] + this.feedbackL * 0.9;
                this.bufferR[this.writeIndex] = inputR[i] + this.feedbackR * 0.9;
                this.writeIndex = (this.writeIndex + 1) % this.bufferSize;
            }

            outputL[i] = inputL[i] * (1 - mix) + saturatedL * mix;
            outputR[i] = inputR[i] * (1 - mix) + saturatedR * mix;
        }

        return true;
    }
}

registerProcessor('mimeophon-processor', MimeophonProcessor);
    `,l=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(l)}updateParams(){if(!this.isReady||!this.node)return;const a=this.ctx.currentTime,l=this.node.parameters;l.get("zone")?.setValueAtTime(this.params.zone,a),l.get("rate")?.setValueAtTime(this.params.rate,a),l.get("microRate")?.setValueAtTime(this.params.microRate,a),l.get("microRateFreq")?.setValueAtTime(this.params.microRateFreq,a),l.get("skew")?.setValueAtTime(this.params.skew,a),l.get("repeats")?.setValueAtTime(this.params.repeats,a),l.get("color")?.setValueAtTime(this.params.color,a),l.get("halo")?.setValueAtTime(this.params.halo,a),l.get("mix")?.setValueAtTime(this.params.mix,a),l.get("hold")?.setValueAtTime(this.params.hold?1:0,a),l.get("flip")?.setValueAtTime(this.params.flip?1:0,a),l.get("pingPong")?.setValueAtTime(this.params.pingPong?1:0,a),l.get("swap")?.setValueAtTime(this.params.swap?1:0,a)}get input(){return this.inputGain}get output(){return this.outputGain}getParams(){return{...this.params}}setParams(a){this.params={...this.params,...a},this.updateParams()}setZone(a){this.params.zone=Math.max(0,Math.min(3,Math.floor(a))),this.updateParams()}setRate(a){this.params.rate=Math.max(0,Math.min(1,a)),this.updateParams()}setDelayTime(a){let l,s;a<pt[0].max?(l=0,s=(a-pt[0].min)/(pt[0].max-pt[0].min)):a<pt[1].max?(l=1,s=(a-pt[1].min)/(pt[1].max-pt[1].min)):a<pt[2].max?(l=2,s=(a-pt[2].min)/(pt[2].max-pt[2].min)):(l=3,s=(a-pt[3].min)/(pt[3].max-pt[3].min)),this.params.zone=l,this.params.rate=Math.max(0,Math.min(1,s)),this.updateParams()}getDelayTime(){const a=pt[Math.min(Math.floor(this.params.zone),3)];return a.min+this.params.rate*(a.max-a.min)}setMicroRate(a){this.params.microRate=Math.max(0,Math.min(1,a)),this.updateParams()}setMicroRateFreq(a){this.params.microRateFreq=Math.max(.1,Math.min(8,a)),this.updateParams()}setSkew(a){this.params.skew=Math.max(-1,Math.min(1,a)),this.updateParams()}setRepeats(a){this.params.repeats=Math.max(0,Math.min(1.2,a)),this.updateParams()}setColor(a){this.params.color=Math.max(0,Math.min(1,a)),this.updateParams()}setHalo(a){this.params.halo=Math.max(0,Math.min(1,a)),this.updateParams()}setMix(a){this.params.mix=Math.max(0,Math.min(1,a)),this.updateParams()}setHold(a){this.params.hold=a,this.updateParams()}setFlip(a){this.params.flip=a,this.updateParams()}setPingPong(a){this.params.pingPong=a,this.updateParams()}setSwap(a){this.params.swap=a,this.updateParams()}connect(a){this.outputGain.connect(a)}disconnect(){this.outputGain.disconnect()}dispose(){this.inputGain.disconnect(),this.outputGain.disconnect(),this.node&&(this.node.disconnect(),this.node=null),this.isReady=!1}}const Cc={karplus:{zone:0,rate:.8,microRate:0,skew:0,repeats:.85,color:.3,halo:0,mix:.5},flange:{zone:0,rate:.3,microRate:.8,microRateFreq:.3,skew:.5,repeats:.7,color:.5,halo:.3,mix:.5},chorus:{zone:1,rate:.2,microRate:.6,microRateFreq:1.5,skew:.3,repeats:.3,color:.6,halo:.5,mix:.4},slapback:{zone:1,rate:.4,microRate:0,skew:0,repeats:.3,color:.4,halo:.2,mix:.3},dubEcho:{zone:2,rate:.5,microRate:.1,skew:.2,repeats:.6,color:.3,halo:.6,mix:.5},tapeDelay:{zone:2,rate:.6,microRate:.2,microRateFreq:.5,skew:0,repeats:.5,color:.45,halo:.4,mix:.4},ambient:{zone:3,rate:.5,microRate:.3,microRateFreq:.2,skew:.4,repeats:.8,color:.7,halo:.8,mix:.6},shimmer:{zone:3,rate:.7,microRate:.4,microRateFreq:2,skew:.6,repeats:.9,color:.85,halo:1,mix:.7},pingPongSend:{zone:1,rate:.5,microRate:0,skew:0,repeats:.45,color:.4,halo:.2,mix:1,pingPong:!0},dubSend:{zone:2,rate:.5,microRate:.1,skew:.2,repeats:.6,color:.3,halo:.5,mix:1},ambientSend:{zone:3,rate:.4,microRate:.2,microRateFreq:.3,skew:.3,repeats:.75,color:.6,halo:.7,mix:1}},nv={size:.5,decay:.5,wetLevel:1,dryLevel:0};class lv{ctx;params;workletReady=!1;inputGain;outputGain;workletNode=null;constructor(a,l){this.ctx=a,this.params={...nv},this.inputGain=a.createGain(),this.outputGain=a.createGain(),this.buildInitialGraph(),this.initWorklet(),l&&this.outputGain.connect(l)}buildInitialGraph(){this.inputGain.connect(this.outputGain)}async initWorklet(){try{await this.ctx.audioWorklet.addModule("/tQr4x/worklets/zita-reverb-processor.js"),this.workletNode=new AudioWorkletNode(this.ctx,"zita-reverb-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"}),this.inputGain.disconnect(),this.inputGain.connect(this.workletNode),this.workletNode.connect(this.outputGain),this.workletReady=!0,this.updateParams()}catch(a){console.error("Failed to load Zita reverb worklet:",a),this.inputGain.connect(this.outputGain)}}updateParams(){const a=this.ctx.currentTime;if(this.workletNode&&this.workletReady){const l=this.workletNode.parameters.get("size");l&&l.setTargetAtTime(this.params.size,a,.05);const s=this.workletNode.parameters.get("decay");s&&s.setTargetAtTime(this.params.decay,a,.05);const u=this.workletNode.parameters.get("wetLevel");u&&u.setTargetAtTime(this.params.wetLevel,a,.05);const h=this.workletNode.parameters.get("dryLevel");h&&h.setTargetAtTime(this.params.dryLevel,a,.05)}}get input(){return this.inputGain}get output(){return this.outputGain}getParams(){return{...this.params}}setParams(a){this.params={...this.params,...a},this.updateParams()}connect(a){this.outputGain.connect(a)}disconnect(){this.outputGain.disconnect()}dispose(){this.inputGain.disconnect(),this.outputGain.disconnect(),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null)}}const Rc={room:{size:.2,decay:.3,wetLevel:1,dryLevel:0},hall:{size:.5,decay:.5,wetLevel:1,dryLevel:0},plate:{size:.15,decay:.45,wetLevel:1,dryLevel:0},cathedral:{size:.9,decay:.8,wetLevel:1,dryLevel:0},bright:{size:.1,decay:.35,wetLevel:1,dryLevel:0},dark:{size:.6,decay:.55,wetLevel:1,dryLevel:0},ambient:{size:.7,decay:.75,wetLevel:1,dryLevel:0},tight:{size:.1,decay:.15,wetLevel:1,dryLevel:0},infinite:{size:.85,decay:.95,wetLevel:1,dryLevel:0},aeLong:{size:.8,decay:.85,wetLevel:1,dryLevel:0}},sv={inputGain:0,outputGain:0,saturationAmount:.3,saturationDrive:3,highShelf:0,highShelfFreq:6e3,limiterEnabled:!0,limiterThreshold:-.5};class ov{ctx;params;inputGainNode;outputGainNode;driveGain;makeupGain;highShelfFilter;waveshaper;limiter;constructor(a,l){this.ctx=a,this.params={...sv},this.inputGainNode=a.createGain(),this.outputGainNode=a.createGain(),this.driveGain=a.createGain(),this.makeupGain=a.createGain(),this.highShelfFilter=a.createBiquadFilter(),this.highShelfFilter.type="highshelf",this.highShelfFilter.frequency.value=this.params.highShelfFreq,this.highShelfFilter.gain.value=this.params.highShelf,this.waveshaper=a.createWaveShaper(),this.waveshaper.oversample="2x",this.updateSaturationCurve(),this.limiter=a.createDynamicsCompressor(),this.limiter.threshold.value=this.params.limiterThreshold,this.limiter.knee.value=0,this.limiter.ratio.value=20,this.limiter.attack.value=.001,this.limiter.release.value=.05,this.buildGraph(),this.updateParams(),l&&this.outputGainNode.connect(l)}buildGraph(){this.inputGainNode.connect(this.driveGain),this.driveGain.connect(this.waveshaper),this.waveshaper.connect(this.makeupGain),this.makeupGain.connect(this.highShelfFilter),this.highShelfFilter.connect(this.limiter),this.limiter.connect(this.outputGainNode)}updateSaturationCurve(){const l=new Float32Array(8192),s=this.params.saturationAmount;for(let u=0;u<8192;u++){const h=u/8191*2-1;if(s<=0)l[u]=h;else{const p=s*3,f=Math.tanh(h*(1+p))/Math.tanh(1+p);l[u]=h*(1-s)+f*s}}this.waveshaper.curve=l}dbToLinear(a){return Math.pow(10,a/20)}updateParams(){const a=this.ctx.currentTime;this.inputGainNode.gain.setTargetAtTime(this.dbToLinear(this.params.inputGain),a,.02),this.driveGain.gain.setTargetAtTime(this.dbToLinear(this.params.saturationDrive),a,.02);const l=-this.params.saturationDrive*.6;this.makeupGain.gain.setTargetAtTime(this.dbToLinear(l),a,.02),this.highShelfFilter.frequency.setTargetAtTime(this.params.highShelfFreq,a,.02),this.highShelfFilter.gain.setTargetAtTime(this.params.highShelf,a,.02),this.limiter.threshold.setTargetAtTime(this.params.limiterThreshold,a,.02),this.outputGainNode.gain.setTargetAtTime(this.dbToLinear(this.params.outputGain),a,.02),this.updateSaturationCurve()}get input(){return this.inputGainNode}get output(){return this.outputGainNode}getParams(){return{...this.params}}setParams(a){this.params={...this.params,...a},this.updateParams()}getGainReduction(){return this.limiter.reduction}connect(a){this.outputGainNode.connect(a)}disconnect(){this.outputGainNode.disconnect()}setSaturationEnabled(a){a?this.setParams({saturationAmount:this.params.saturationAmount||.3}):this.setParams({saturationAmount:0})}setLimiterEnabled(a){this.params.limiterEnabled=a,a?this.limiter.threshold.setTargetAtTime(this.params.limiterThreshold,this.ctx.currentTime,.02):this.limiter.threshold.setTargetAtTime(0,this.ctx.currentTime,.02)}dispose(){this.inputGainNode.disconnect(),this.outputGainNode.disconnect(),this.driveGain.disconnect(),this.makeupGain.disconnect(),this.highShelfFilter.disconnect(),this.waveshaper.disconnect(),this.limiter.disconnect()}}const Ac={clean:{inputGain:0,saturationAmount:0,saturationDrive:0,highShelf:0,outputGain:0},warm:{inputGain:0,saturationAmount:.3,saturationDrive:3,highShelf:-1,outputGain:0},punchy:{inputGain:2,saturationAmount:.4,saturationDrive:6,highShelf:1,outputGain:-1},loud:{inputGain:3,saturationAmount:.5,saturationDrive:9,highShelf:0,limiterThreshold:-1,outputGain:-.5},vintage:{inputGain:1,saturationAmount:.6,saturationDrive:4,highShelf:-2,highShelfFreq:8e3,outputGain:0}},rv={mode:"tape",drive:0,bias:0,mix:0,harmonics:"even"};class cv{ctx;input;output;inputGain;shaper;outputGain;dryGain;wetGain;mode="tape";drive=0;bias=0;mix=1;harmonics="even";constructor(a,l={}){this.ctx=a,this.input=a.createGain(),this.input.gain.value=1,this.mode=l.mode||"tape",this.drive=l.drive!==void 0?l.drive:0,this.bias=l.bias!==void 0?l.bias:0,this.mix=l.mix!==void 0?l.mix:1,this.harmonics=l.harmonics||"even",this.inputGain=a.createGain(),this.inputGain.gain.value=1,this.shaper=a.createWaveShaper(),this.shaper.oversample="4x",this.outputGain=a.createGain(),this.outputGain.gain.value=1,this.dryGain=a.createGain(),this.dryGain.gain.value=0,this.wetGain=a.createGain(),this.wetGain.gain.value=1,this.output=a.createGain(),this.output.gain.value=1,this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.inputGain),this.inputGain.connect(this.shaper),this.shaper.connect(this.outputGain),this.outputGain.connect(this.wetGain),this.wetGain.connect(this.output),this.updateCurve()}setMode(a){["tape","triode","pentode","transformer"].includes(a)||(console.warn(`Invalid saturation mode: ${a}. Using 'tape'.`),a="tape"),this.mode=a,this.updateCurve()}setDrive(a){this.drive=Math.max(0,Math.min(1,a)),this.updateCurve()}setBias(a){this.bias=Math.max(-1,Math.min(1,a)),this.updateCurve()}setMix(a){this.mix=Math.max(0,Math.min(1,a)),this.updateMix()}setHarmonics(a){["even","odd","both"].includes(a)||(console.warn(`Invalid harmonics: ${a}. Using 'even'.`),a="even"),this.harmonics=a,this.updateCurve()}setParams(a){a.mode!==void 0&&(this.mode=a.mode),a.drive!==void 0&&(this.drive=Math.max(0,Math.min(1,a.drive))),a.bias!==void 0&&(this.bias=Math.max(-1,Math.min(1,a.bias))),a.mix!==void 0&&(this.mix=Math.max(0,Math.min(1,a.mix))),a.harmonics!==void 0&&(this.harmonics=a.harmonics),this.updateCurve()}getParams(){return{mode:this.mode,drive:this.drive,bias:this.bias,mix:this.mix,harmonics:this.harmonics}}updateCurve(){const l=new Float32Array(2048),s=1+this.drive*19;for(let u=0;u<2048;u++){let h=u*2/2047-1;h+=this.bias*.3,h*=s;let p;switch(this.mode){case"tape":p=this.tapeFormula(h);break;case"triode":p=this.triodeFormula(h);break;case"pentode":p=this.pentodeFormula(h);break;case"transformer":p=this.transformerFormula(h);break;default:p=h}p-=this.bias*.2,p=Math.tanh(p),l[u]=p}this.shaper.curve=l,this.updateMix()}updateMix(){const a=this.ctx.currentTime;this.wetGain.gain.setTargetAtTime(this.mix,a,.01),this.dryGain.gain.setTargetAtTime(1-this.mix,a,.01);const l=1/(1+this.drive*.3);this.outputGain.gain.setTargetAtTime(l,a,.01)}tapeFormula(a){let l=2/Math.PI*Math.atan(a*1.5);return this.harmonics==="even"?l=Math.sign(l)*Math.pow(Math.abs(l),.8):this.harmonics==="odd"&&(l=Math.pow(l,3)*.7+l*.3),l}triodeFormula(a){let l;return a>0?l=1.2*a/(1+Math.abs(a*1.2)):l=1.5*a/(1+Math.abs(a*1.5)),this.harmonics==="even"&&(l=Math.sign(l)*Math.pow(Math.abs(l),.75)),l*.9}pentodeFormula(a){let l=1.8*a/(1+Math.pow(Math.abs(a),1.5));return this.harmonics==="odd"&&(l=l*.7+Math.pow(l,3)*.3),l}transformerFormula(a){let s;return Math.abs(a)<.5?s=a:s=Math.sign(a)*(.5+(Math.abs(a)-.5)/(1+Math.pow((Math.abs(a)-.5)*2,2))),this.harmonics==="both"&&(s=s*.6+Math.pow(s,2)*Math.sign(s)*.2+Math.pow(s,3)*.2),s}reset(){this.setMode("tape"),this.setDrive(0),this.setBias(0),this.setMix(1),this.setHarmonics("even")}destroy(){this.input.disconnect(),this.inputGain.disconnect(),this.shaper.disconnect(),this.outputGain.disconnect(),this.dryGain.disconnect(),this.wetGain.disconnect(),this.output.disconnect()}}const Vc=[{mode:"tape",label:"Tape",description:"Gentle, musical compression"},{mode:"triode",label:"Triode",description:"Warm, asymmetric tube"},{mode:"pentode",label:"Pentode",description:"Brighter, aggressive tube"},{mode:"transformer",label:"Transformer",description:"Thick, symmetric compression"}],Ip={freq:.5,span:.5,quality:.5,mode:0,output:"all"},ed={cutoff:1e3,resonance:.5,mode:0,drive:.5,chaos:.3},td={cutoff:1e3,resonance:0,morph:0,drive:1},ad={cutoff:1e3,resonance:0,drive:0,warmth:1},id={type:"bypass",threeSisters:{...Ip},wasp:{...ed},sem:{...td},moog:{...ad}},uv=[{type:"bypass",label:"Bypass",description:"No filtering"},{type:"threeSisters",label:"Three Sisters",description:"Mannequins multi-mode SVF"},{type:"wasp",label:"Wasp",description:"EDP Wasp dirty CMOS filter"},{type:"sem",label:"SEM",description:"Oberheim SEM state-variable"},{type:"moog",label:"Moog",description:"Moog 24dB ladder filter"}],mv=[{value:"low",label:"Low"},{value:"centre",label:"Centre"},{value:"high",label:"High"},{value:"all",label:"All"}],hv=[{value:0,label:"LP"},{value:1,label:"BP"},{value:2,label:"HP"},{value:3,label:"Notch"}];class pv{ctx;input;output;threeSistersNode=null;waspNode=null;semNode=null;moogNode=null;bypassGain;params;currentType="bypass";workletsInitialized=!1;constructor(a,l={}){this.ctx=a,this.params={type:l.type??"bypass",threeSisters:{...Ip,...l.threeSisters},wasp:{...ed,...l.wasp},sem:{...td,...l.sem},moog:{...ad,...l.moog}},this.input=a.createGain(),this.input.gain.value=1,this.output=a.createGain(),this.output.gain.value=1,this.bypassGain=a.createGain(),this.bypassGain.gain.value=1,this.input.connect(this.bypassGain),this.bypassGain.connect(this.output),this.currentType=this.params.type}async initWorklets(){if(!this.workletsInitialized)try{this.threeSistersNode=new AudioWorkletNode(this.ctx,"three-sisters-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[4],channelCount:1,channelCountMode:"explicit"}),this.waspNode=new AudioWorkletNode(this.ctx,"wasp-processor",{numberOfInputs:1,numberOfOutputs:1,channelCount:1,channelCountMode:"explicit"}),this.semNode=new AudioWorkletNode(this.ctx,"sem-filter-processor",{numberOfInputs:1,numberOfOutputs:1,channelCount:2,channelCountMode:"clamped-max"}),this.moogNode=new AudioWorkletNode(this.ctx,"moog-ladder-processor",{numberOfInputs:1,numberOfOutputs:1,channelCount:2,channelCountMode:"clamped-max"}),this.workletsInitialized=!0,this.updateThreeSistersParams(this.params.threeSisters),this.updateWaspParams(this.params.wasp),this.updateSEMParams(this.params.sem),this.updateMoogParams(this.params.moog),this.setType(this.params.type)}catch(a){console.error("[FilterEffect] Failed to initialize worklets:",a),this.workletsInitialized=!1}}setType(a){this.currentType!==a&&(this.disconnectAll(),this.currentType=a,this.params.type=a,this.connectForType(a))}disconnectAll(){try{this.input.disconnect()}catch{}try{this.bypassGain.disconnect()}catch{}try{this.threeSistersNode?.disconnect()}catch{}try{this.waspNode?.disconnect()}catch{}try{this.semNode?.disconnect()}catch{}try{this.moogNode?.disconnect()}catch{}}connectForType(a){switch(a){case"bypass":this.input.connect(this.bypassGain),this.bypassGain.connect(this.output);break;case"threeSisters":this.threeSistersNode&&this.workletsInitialized?(this.input.connect(this.threeSistersNode),this.connectThreeSistersOutput()):(this.input.connect(this.bypassGain),this.bypassGain.connect(this.output));break;case"wasp":this.waspNode&&this.workletsInitialized?(this.input.connect(this.waspNode),this.waspNode.connect(this.output)):(this.input.connect(this.bypassGain),this.bypassGain.connect(this.output));break;case"sem":this.semNode&&this.workletsInitialized?(this.input.connect(this.semNode),this.semNode.connect(this.output)):(this.input.connect(this.bypassGain),this.bypassGain.connect(this.output));break;case"moog":this.moogNode&&this.workletsInitialized?(this.input.connect(this.moogNode),this.moogNode.connect(this.output)):(this.input.connect(this.bypassGain),this.bypassGain.connect(this.output));break}}connectThreeSistersOutput(){if(!this.threeSistersNode)return;try{this.threeSistersNode.disconnect()}catch{}const a=this.getThreeSistersOutputIndex(),l=this.ctx.createChannelSplitter(4);this.threeSistersNode.connect(l),l.connect(this.output,a)}getThreeSistersOutputIndex(){switch(this.params.threeSisters.output){case"low":return 0;case"centre":return 1;case"high":return 2;case"all":return 3;default:return 3}}updateThreeSistersParams(a){if(!this.threeSistersNode)return;const l=this.threeSistersNode.parameters;a.freq!==void 0&&l.get("freq")?.setValueAtTime(a.freq,this.ctx.currentTime),a.span!==void 0&&l.get("span")?.setValueAtTime(a.span,this.ctx.currentTime),a.quality!==void 0&&l.get("quality")?.setValueAtTime(a.quality,this.ctx.currentTime),a.mode!==void 0&&l.get("mode")?.setValueAtTime(a.mode,this.ctx.currentTime),a.output!==void 0&&this.currentType==="threeSisters"&&(this.disconnectAll(),this.connectForType("threeSisters"))}updateWaspParams(a){if(!this.waspNode)return;const l=this.waspNode.parameters;a.cutoff!==void 0&&l.get("cutoff")?.setValueAtTime(a.cutoff,this.ctx.currentTime),a.resonance!==void 0&&l.get("resonance")?.setValueAtTime(a.resonance,this.ctx.currentTime),a.mode!==void 0&&l.get("mode")?.setValueAtTime(a.mode,this.ctx.currentTime),a.drive!==void 0&&l.get("drive")?.setValueAtTime(a.drive,this.ctx.currentTime),a.chaos!==void 0&&l.get("chaos")?.setValueAtTime(a.chaos,this.ctx.currentTime)}updateSEMParams(a){if(!this.semNode)return;const l=this.semNode.parameters;a.cutoff!==void 0&&l.get("cutoff")?.setValueAtTime(a.cutoff,this.ctx.currentTime),a.resonance!==void 0&&l.get("resonance")?.setValueAtTime(a.resonance,this.ctx.currentTime),a.morph!==void 0&&l.get("morph")?.setValueAtTime(a.morph,this.ctx.currentTime),a.drive!==void 0&&l.get("drive")?.setValueAtTime(a.drive,this.ctx.currentTime)}updateMoogParams(a){if(!this.moogNode)return;const l=this.moogNode.parameters;a.cutoff!==void 0&&l.get("cutoff")?.setValueAtTime(a.cutoff,this.ctx.currentTime),a.resonance!==void 0&&l.get("resonance")?.setValueAtTime(a.resonance,this.ctx.currentTime),a.drive!==void 0&&l.get("drive")?.setValueAtTime(a.drive,this.ctx.currentTime),a.warmth!==void 0&&l.get("warmth")?.setValueAtTime(a.warmth,this.ctx.currentTime)}setParams(a){a.type!==void 0&&a.type!==this.currentType&&this.setType(a.type),a.threeSisters&&(this.params.threeSisters={...this.params.threeSisters,...a.threeSisters},this.updateThreeSistersParams(a.threeSisters)),a.wasp&&(this.params.wasp={...this.params.wasp,...a.wasp},this.updateWaspParams(a.wasp)),a.sem&&(this.params.sem={...this.params.sem,...a.sem},this.updateSEMParams(a.sem)),a.moog&&(this.params.moog={...this.params.moog,...a.moog},this.updateMoogParams(a.moog))}getParams(){return{type:this.params.type,threeSisters:{...this.params.threeSisters},wasp:{...this.params.wasp},sem:{...this.params.sem},moog:{...this.params.moog}}}getType(){return this.currentType}isInitialized(){return this.workletsInitialized}reset(){this.setParams(id)}destroy(){this.disconnectAll(),this.input.disconnect(),this.output.disconnect(),this.bypassGain.disconnect(),this.threeSistersNode?.disconnect(),this.waspNode?.disconnect(),this.semNode?.disconnect(),this.moogNode?.disconnect()}}const dv={volume:.8,pan:0,mute:!1,delaySend:0,delaySend2:0,delaySend3:0,delaySend4:0,reverbSend:0,filter:{...id},saturation:{...rv}},Gc={mim1ToMim2:0,mim1ToMim3:0,mim1ToMim4:0,mim1ToReverb:0,mim2ToMim1:0,mim2ToMim3:0,mim2ToMim4:0,mim2ToReverb:0,mim3ToMim1:0,mim3ToMim2:0,mim3ToMim4:0,mim3ToReverb:0,mim4ToMim1:0,mim4ToMim2:0,mim4ToMim3:0,mim4ToReverb:0,reverbToMim1:0,reverbToMim2:0,reverbToMim3:0,reverbToMim4:0};class fv{ctx;channels=new Map;mimeophonSendBus;mimeophonSendBus2;mimeophonSendBus3;mimeophonSendBus4;reverbSendBus;mimeophon;mimeophon2;mimeophon3;mimeophon4;reverb;mimeophonReturn;mimeophonReturn2;mimeophonReturn3;mimeophonReturn4;reverbReturn;mimeophonReturnLevel=1;mimeophonReturnLevel2=1;mimeophonReturnLevel3=1;mimeophonReturnLevel4=1;reverbReturnLevel=1;masterBus;preEffectBus;recordingTap;filterWorkletsRegistered=!1;fxCrossSends={...Gc};mim1ToMim2Send;mim1ToMim3Send;mim1ToMim4Send;mim1ToReverbSend;mim2ToMim1Send;mim2ToMim3Send;mim2ToMim4Send;mim2ToReverbSend;mim3ToMim1Send;mim3ToMim2Send;mim3ToMim4Send;mim3ToReverbSend;mim4ToMim1Send;mim4ToMim2Send;mim4ToMim3Send;mim4ToReverbSend;reverbToMim1Send;reverbToMim2Send;reverbToMim3Send;reverbToMim4Send;constructor(a){this.ctx=a,this.mimeophonSendBus=a.createGain(),this.mimeophonSendBus2=a.createGain(),this.mimeophonSendBus3=a.createGain(),this.mimeophonSendBus4=a.createGain(),this.reverbSendBus=a.createGain(),this.mimeophon=new Qs(a),this.mimeophon.setParams({mix:1}),this.mimeophon2=new Qs(a),this.mimeophon2.setParams({mix:1}),this.mimeophon3=new Qs(a),this.mimeophon3.setParams({mix:1}),this.mimeophon4=new Qs(a),this.mimeophon4.setParams({mix:1}),this.reverb=new lv(a),this.reverb.setParams({dryLevel:0,wetLevel:1}),this.mimeophonReturn=a.createGain(),this.mimeophonReturn.gain.value=this.mimeophonReturnLevel,this.mimeophonReturn2=a.createGain(),this.mimeophonReturn2.gain.value=this.mimeophonReturnLevel2,this.mimeophonReturn3=a.createGain(),this.mimeophonReturn3.gain.value=this.mimeophonReturnLevel3,this.mimeophonReturn4=a.createGain(),this.mimeophonReturn4.gain.value=this.mimeophonReturnLevel4,this.reverbReturn=a.createGain(),this.reverbReturn.gain.value=this.reverbReturnLevel,this.preEffectBus=a.createGain(),this.recordingTap=a.createGain(),this.recordingTap.gain.value=1,this.masterBus=new ov(a),this.masterBus.output.connect(this.recordingTap),this.recordingTap.connect(a.destination),this.mim1ToMim2Send=a.createGain(),this.mim1ToMim2Send.gain.value=0,this.mim1ToMim3Send=a.createGain(),this.mim1ToMim3Send.gain.value=0,this.mim1ToMim4Send=a.createGain(),this.mim1ToMim4Send.gain.value=0,this.mim1ToReverbSend=a.createGain(),this.mim1ToReverbSend.gain.value=0,this.mim2ToMim1Send=a.createGain(),this.mim2ToMim1Send.gain.value=0,this.mim2ToMim3Send=a.createGain(),this.mim2ToMim3Send.gain.value=0,this.mim2ToMim4Send=a.createGain(),this.mim2ToMim4Send.gain.value=0,this.mim2ToReverbSend=a.createGain(),this.mim2ToReverbSend.gain.value=0,this.mim3ToMim1Send=a.createGain(),this.mim3ToMim1Send.gain.value=0,this.mim3ToMim2Send=a.createGain(),this.mim3ToMim2Send.gain.value=0,this.mim3ToMim4Send=a.createGain(),this.mim3ToMim4Send.gain.value=0,this.mim3ToReverbSend=a.createGain(),this.mim3ToReverbSend.gain.value=0,this.mim4ToMim1Send=a.createGain(),this.mim4ToMim1Send.gain.value=0,this.mim4ToMim2Send=a.createGain(),this.mim4ToMim2Send.gain.value=0,this.mim4ToMim3Send=a.createGain(),this.mim4ToMim3Send.gain.value=0,this.mim4ToReverbSend=a.createGain(),this.mim4ToReverbSend.gain.value=0,this.reverbToMim1Send=a.createGain(),this.reverbToMim1Send.gain.value=0,this.reverbToMim2Send=a.createGain(),this.reverbToMim2Send.gain.value=0,this.reverbToMim3Send=a.createGain(),this.reverbToMim3Send.gain.value=0,this.reverbToMim4Send=a.createGain(),this.reverbToMim4Send.gain.value=0,this.buildGraph()}buildGraph(){this.mimeophonSendBus.connect(this.mimeophon.input),this.mimeophonSendBus2.connect(this.mimeophon2.input),this.mimeophonSendBus3.connect(this.mimeophon3.input),this.mimeophonSendBus4.connect(this.mimeophon4.input),this.reverbSendBus.connect(this.reverb.input),this.mimeophon.output.connect(this.mimeophonReturn),this.mimeophon2.output.connect(this.mimeophonReturn2),this.mimeophon3.output.connect(this.mimeophonReturn3),this.mimeophon4.output.connect(this.mimeophonReturn4),this.reverb.output.connect(this.reverbReturn),this.mimeophon.output.connect(this.mim1ToMim2Send),this.mim1ToMim2Send.connect(this.mimeophon2.input),this.mimeophon.output.connect(this.mim1ToMim3Send),this.mim1ToMim3Send.connect(this.mimeophon3.input),this.mimeophon.output.connect(this.mim1ToMim4Send),this.mim1ToMim4Send.connect(this.mimeophon4.input),this.mimeophon.output.connect(this.mim1ToReverbSend),this.mim1ToReverbSend.connect(this.reverb.input),this.mimeophon2.output.connect(this.mim2ToMim1Send),this.mim2ToMim1Send.connect(this.mimeophon.input),this.mimeophon2.output.connect(this.mim2ToMim3Send),this.mim2ToMim3Send.connect(this.mimeophon3.input),this.mimeophon2.output.connect(this.mim2ToMim4Send),this.mim2ToMim4Send.connect(this.mimeophon4.input),this.mimeophon2.output.connect(this.mim2ToReverbSend),this.mim2ToReverbSend.connect(this.reverb.input),this.mimeophon3.output.connect(this.mim3ToMim1Send),this.mim3ToMim1Send.connect(this.mimeophon.input),this.mimeophon3.output.connect(this.mim3ToMim2Send),this.mim3ToMim2Send.connect(this.mimeophon2.input),this.mimeophon3.output.connect(this.mim3ToMim4Send),this.mim3ToMim4Send.connect(this.mimeophon4.input),this.mimeophon3.output.connect(this.mim3ToReverbSend),this.mim3ToReverbSend.connect(this.reverb.input),this.mimeophon4.output.connect(this.mim4ToMim1Send),this.mim4ToMim1Send.connect(this.mimeophon.input),this.mimeophon4.output.connect(this.mim4ToMim2Send),this.mim4ToMim2Send.connect(this.mimeophon2.input),this.mimeophon4.output.connect(this.mim4ToMim3Send),this.mim4ToMim3Send.connect(this.mimeophon3.input),this.mimeophon4.output.connect(this.mim4ToReverbSend),this.mim4ToReverbSend.connect(this.reverb.input),this.reverb.output.connect(this.reverbToMim1Send),this.reverbToMim1Send.connect(this.mimeophon.input),this.reverb.output.connect(this.reverbToMim2Send),this.reverbToMim2Send.connect(this.mimeophon2.input),this.reverb.output.connect(this.reverbToMim3Send),this.reverbToMim3Send.connect(this.mimeophon3.input),this.reverb.output.connect(this.reverbToMim4Send),this.reverbToMim4Send.connect(this.mimeophon4.input),this.mimeophonReturn.connect(this.masterBus.input),this.mimeophonReturn2.connect(this.masterBus.input),this.mimeophonReturn3.connect(this.masterBus.input),this.mimeophonReturn4.connect(this.masterBus.input),this.reverbReturn.connect(this.masterBus.input),this.preEffectBus.connect(this.masterBus.input)}async initFilterWorklets(){if(this.filterWorkletsRegistered)return;const a=[];for(const l of this.channels.values())a.push(l.filterEffect.initWorklets());await Promise.all(a),this.filterWorkletsRegistered=!0}createChannel(a,l){this.channels.has(a)&&this.removeChannel(a);const s={...dv,...l},u=this.ctx.createGain(),h=new pv(this.ctx,s.filter),p=new cv(this.ctx,s.saturation),f=this.ctx.createGain(),g=this.ctx.createStereoPanner(),b=this.ctx.createGain(),M=this.ctx.createGain(),S=this.ctx.createGain(),y=this.ctx.createGain(),j=this.ctx.createGain();b.gain.value=0,M.gain.value=0,S.gain.value=0,y.gain.value=0,j.gain.value=0,u.connect(h.input),h.output.connect(p.input),p.output.connect(f),f.connect(g),g.connect(this.preEffectBus),f.connect(b),f.connect(M),f.connect(S),f.connect(y),f.connect(j),b.connect(this.mimeophonSendBus),M.connect(this.mimeophonSendBus2),S.connect(this.mimeophonSendBus3),y.connect(this.mimeophonSendBus4),j.connect(this.reverbSendBus);const C={id:a,params:s,inputNode:u,filterEffect:h,saturationEffect:p,volumeNode:f,panNode:g,delaySendNode:b,delaySendNode2:M,delaySendNode3:S,delaySendNode4:y,reverbSendNode:j};return this.channels.set(a,C),this.filterWorkletsRegistered&&h.initWorklets().catch(B=>{console.error(`[Mixer] Failed to init filter worklets for channel ${a}:`,B)}),this.updateChannel(a,s),u}getChannelInput(a){return this.channels.get(a)?.inputNode??null}updateChannel(a,l){const s=this.channels.get(a);if(!s)return;const u={...s.params,...l};l.filter&&(u.filter={...s.params.filter,...l.filter}),l.saturation&&(u.saturation={...s.params.saturation,...l.saturation}),s.params=u;const h=this.ctx.currentTime,p=.002,f=s.params.mute?0:s.params.volume;s.volumeNode.gain.setTargetAtTime(f,h,p),s.panNode.pan.setTargetAtTime(s.params.pan,h,p),s.delaySendNode.gain.setTargetAtTime(s.params.delaySend,h,p),s.delaySendNode2.gain.setTargetAtTime(s.params.delaySend2,h,p),s.delaySendNode3.gain.setTargetAtTime(s.params.delaySend3,h,p),s.delaySendNode4.gain.setTargetAtTime(s.params.delaySend4,h,p),s.reverbSendNode.gain.setTargetAtTime(s.params.reverbSend,h,p),l.filter&&s.filterEffect.setParams(s.params.filter),l.saturation&&s.saturationEffect.setParams(s.params.saturation)}getChannelParams(a){return this.channels.get(a)?.params??null}removeChannel(a){const l=this.channels.get(a);l&&(l.inputNode.disconnect(),l.filterEffect.destroy(),l.saturationEffect.destroy(),l.volumeNode.disconnect(),l.panNode.disconnect(),l.delaySendNode.disconnect(),l.delaySendNode2.disconnect(),l.delaySendNode3.disconnect(),l.delaySendNode4.disconnect(),l.reverbSendNode.disconnect(),this.channels.delete(a))}setMimeophonReturnLevel(a){this.mimeophonReturnLevel=Math.max(0,Math.min(1,a)),this.mimeophonReturn.gain.setTargetAtTime(this.mimeophonReturnLevel,this.ctx.currentTime,.02)}setMimeophonReturnLevel2(a){this.mimeophonReturnLevel2=Math.max(0,Math.min(1,a)),this.mimeophonReturn2.gain.setTargetAtTime(this.mimeophonReturnLevel2,this.ctx.currentTime,.02)}setMimeophonReturnLevel3(a){this.mimeophonReturnLevel3=Math.max(0,Math.min(1,a)),this.mimeophonReturn3.gain.setTargetAtTime(this.mimeophonReturnLevel3,this.ctx.currentTime,.02)}setMimeophonReturnLevel4(a){this.mimeophonReturnLevel4=Math.max(0,Math.min(1,a)),this.mimeophonReturn4.gain.setTargetAtTime(this.mimeophonReturnLevel4,this.ctx.currentTime,.02)}setReverbReturnLevel(a){this.reverbReturnLevel=Math.max(0,Math.min(1,a)),this.reverbReturn.gain.setTargetAtTime(this.reverbReturnLevel,this.ctx.currentTime,.02)}getMimeophonReturnLevel(){return this.mimeophonReturnLevel}getMimeophonReturnLevel2(){return this.mimeophonReturnLevel2}getMimeophonReturnLevel3(){return this.mimeophonReturnLevel3}getMimeophonReturnLevel4(){return this.mimeophonReturnLevel4}getReverbReturnLevel(){return this.reverbReturnLevel}getMimeophon(){return this.mimeophon}getMimeophon2(){return this.mimeophon2}getMimeophon3(){return this.mimeophon3}getMimeophon4(){return this.mimeophon4}getReverb(){return this.reverb}getMasterBus(){return this.masterBus}getRecordingTap(){return this.recordingTap}setMimeophonParams(a){this.mimeophon.setParams(a)}setMimeophonParams2(a){this.mimeophon2.setParams(a)}setMimeophonParams3(a){this.mimeophon3.setParams(a)}setMimeophonParams4(a){this.mimeophon4.setParams(a)}setReverbParams(a){this.reverb.setParams(a)}setMasterParams(a){this.masterBus.setParams(a)}setBpm(a){}setFXCrossSends(a){const l=this.ctx.currentTime;this.fxCrossSends={...this.fxCrossSends,...a},a.mim1ToMim2!==void 0&&this.mim1ToMim2Send.gain.setTargetAtTime(a.mim1ToMim2,l,.02),a.mim1ToMim3!==void 0&&this.mim1ToMim3Send.gain.setTargetAtTime(a.mim1ToMim3,l,.02),a.mim1ToMim4!==void 0&&this.mim1ToMim4Send.gain.setTargetAtTime(a.mim1ToMim4,l,.02),a.mim1ToReverb!==void 0&&this.mim1ToReverbSend.gain.setTargetAtTime(a.mim1ToReverb,l,.02),a.mim2ToMim1!==void 0&&this.mim2ToMim1Send.gain.setTargetAtTime(a.mim2ToMim1,l,.02),a.mim2ToMim3!==void 0&&this.mim2ToMim3Send.gain.setTargetAtTime(a.mim2ToMim3,l,.02),a.mim2ToMim4!==void 0&&this.mim2ToMim4Send.gain.setTargetAtTime(a.mim2ToMim4,l,.02),a.mim2ToReverb!==void 0&&this.mim2ToReverbSend.gain.setTargetAtTime(a.mim2ToReverb,l,.02),a.mim3ToMim1!==void 0&&this.mim3ToMim1Send.gain.setTargetAtTime(a.mim3ToMim1,l,.02),a.mim3ToMim2!==void 0&&this.mim3ToMim2Send.gain.setTargetAtTime(a.mim3ToMim2,l,.02),a.mim3ToMim4!==void 0&&this.mim3ToMim4Send.gain.setTargetAtTime(a.mim3ToMim4,l,.02),a.mim3ToReverb!==void 0&&this.mim3ToReverbSend.gain.setTargetAtTime(a.mim3ToReverb,l,.02),a.mim4ToMim1!==void 0&&this.mim4ToMim1Send.gain.setTargetAtTime(a.mim4ToMim1,l,.02),a.mim4ToMim2!==void 0&&this.mim4ToMim2Send.gain.setTargetAtTime(a.mim4ToMim2,l,.02),a.mim4ToMim3!==void 0&&this.mim4ToMim3Send.gain.setTargetAtTime(a.mim4ToMim3,l,.02),a.mim4ToReverb!==void 0&&this.mim4ToReverbSend.gain.setTargetAtTime(a.mim4ToReverb,l,.02),a.reverbToMim1!==void 0&&this.reverbToMim1Send.gain.setTargetAtTime(a.reverbToMim1,l,.02),a.reverbToMim2!==void 0&&this.reverbToMim2Send.gain.setTargetAtTime(a.reverbToMim2,l,.02),a.reverbToMim3!==void 0&&this.reverbToMim3Send.gain.setTargetAtTime(a.reverbToMim3,l,.02),a.reverbToMim4!==void 0&&this.reverbToMim4Send.gain.setTargetAtTime(a.reverbToMim4,l,.02)}getFXCrossSends(){return{...this.fxCrossSends}}getChannelIds(){return Array.from(this.channels.keys())}getState(){const a={};for(const[l,s]of this.channels)a[l]={...s.params};return{channels:a,mimeophon:this.mimeophon.getParams(),mimeophon2:this.mimeophon2.getParams(),mimeophon3:this.mimeophon3.getParams(),mimeophon4:this.mimeophon4.getParams(),reverb:this.reverb.getParams(),master:this.masterBus.getParams(),mimeophonReturnLevel:this.mimeophonReturnLevel,mimeophonReturnLevel2:this.mimeophonReturnLevel2,mimeophonReturnLevel3:this.mimeophonReturnLevel3,mimeophonReturnLevel4:this.mimeophonReturnLevel4,reverbReturnLevel:this.reverbReturnLevel,fxCrossSends:{...this.fxCrossSends}}}setState(a){if(a.channels)for(const[l,s]of Object.entries(a.channels))this.channels.has(l)&&this.updateChannel(l,s);a.mimeophon&&this.mimeophon.setParams(a.mimeophon),a.mimeophon2&&this.mimeophon2.setParams(a.mimeophon2),a.mimeophon3&&this.mimeophon3.setParams(a.mimeophon3),a.mimeophon4&&this.mimeophon4.setParams(a.mimeophon4),a.reverb&&this.reverb.setParams(a.reverb),a.master&&this.masterBus.setParams(a.master),a.mimeophonReturnLevel!==void 0&&this.setMimeophonReturnLevel(a.mimeophonReturnLevel),a.mimeophonReturnLevel2!==void 0&&this.setMimeophonReturnLevel2(a.mimeophonReturnLevel2),a.mimeophonReturnLevel3!==void 0&&this.setMimeophonReturnLevel3(a.mimeophonReturnLevel3),a.mimeophonReturnLevel4!==void 0&&this.setMimeophonReturnLevel4(a.mimeophonReturnLevel4),a.reverbReturnLevel!==void 0&&this.setReverbReturnLevel(a.reverbReturnLevel),a.fxCrossSends&&this.setFXCrossSends(a.fxCrossSends)}getLimiterGainReduction(){return this.masterBus.getGainReduction()}dispose(){for(const a of this.channels.keys())this.removeChannel(a);this.mimeophonSendBus.disconnect(),this.mimeophonSendBus2.disconnect(),this.mimeophonSendBus3.disconnect(),this.mimeophonSendBus4.disconnect(),this.reverbSendBus.disconnect(),this.mimeophonReturn.disconnect(),this.mimeophonReturn2.disconnect(),this.mimeophonReturn3.disconnect(),this.mimeophonReturn4.disconnect(),this.reverbReturn.disconnect(),this.preEffectBus.disconnect(),this.recordingTap.disconnect(),this.mim1ToMim2Send.disconnect(),this.mim1ToMim3Send.disconnect(),this.mim1ToMim4Send.disconnect(),this.mim1ToReverbSend.disconnect(),this.mim2ToMim1Send.disconnect(),this.mim2ToMim3Send.disconnect(),this.mim2ToMim4Send.disconnect(),this.mim2ToReverbSend.disconnect(),this.mim3ToMim1Send.disconnect(),this.mim3ToMim2Send.disconnect(),this.mim3ToMim4Send.disconnect(),this.mim3ToReverbSend.disconnect(),this.mim4ToMim1Send.disconnect(),this.mim4ToMim2Send.disconnect(),this.mim4ToMim3Send.disconnect(),this.mim4ToReverbSend.disconnect(),this.reverbToMim1Send.disconnect(),this.reverbToMim2Send.disconnect(),this.reverbToMim3Send.disconnect(),this.reverbToMim4Send.disconnect(),this.mimeophon.dispose(),this.mimeophon2.dispose(),this.mimeophon3.dispose(),this.mimeophon4.dispose(),this.reverb.dispose(),this.masterBus.dispose()}}const Ca={fourOnFloor:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],syncopated:[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0],driving8th:[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],driving16th:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],minimal:[1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],acidClassic:[1,0,1,1,0,1,0,1,1,0,1,0,0,1,0,1],acidRun:[1,1,1,0,1,1,0,1,1,1,0,1,0,1,1,0]},Fc={classic:[1,.6,.8,.6,1,.6,.8,.6,1,.6,.8,.6,1,.6,.8,.6],acid:[1,.5,.7,1,.5,.8,.5,1,.6,.5,.9,.5,1,.5,.7,.6]};function vv(m){const{style:a,scaleConfig:l,patternLength:s,octaveRange:u=2,velocityVariation:h=.2,accentBeats:p=!0}=m,f=Cl(l,u);if(f.length===0)return{steps:gv(s),style:a};const g=l.root+l.octave*12,b=f.map((y,j)=>({note:y,idx:j})).filter(({note:y})=>y%12===l.root).map(({idx:y})=>y),M=b.filter(y=>f[y]>=g+12);let S;switch(a){case"root":S=bv(f,b,s,h,p);break;case"octave":S=xv(f,b,M,s,h);break;case"walking":S=yv(f,b,s,h);break;case"acid":S=Sv(f,b,M,s,h);break;case"acidRun":S=Mv(f,b,s,h);break;case"syncopated":S=Tv(f,b,s,h);break;case"minimal":S=Cv(f,b,s,h);break;case"driving":S=Rv(f,b,M,s,h);break;case"random":default:S=Av(f,s,h);break}return{steps:S,style:a}}function gv(m){return Array(m).fill(null).map(()=>({trigger:!1,velocity:.8,microTime:0,probability:1,ratchets:0}))}function Ra(m,a,l){return{trigger:m,velocity:Math.max(0,Math.min(1,a)),microTime:0,probability:1,ratchets:0,note:l}}function bv(m,a,l,s,u){const h=ei(Ca.fourOnFloor,l),p=Fc.classic,f=a[0]??0,g=m[f];return h.map((b,M)=>{const y=.7+(u?p[M%16]:1)*.3+(Math.random()-.5)*s;return Ra(b===1,y,g)})}function xv(m,a,l,s,u){const h=ei(Ca.driving8th,s),p=m[a[0]??0],f=l.length>0?m[l[0]]:p;return h.map((g,b)=>{const S=b%4===2||Math.random()<.2?f:p,y=.7+(b%4===0?.2:0)+(Math.random()-.5)*u;return Ra(g===1,y,S)})}function yv(m,a,l,s){const u=ei(Ca.driving8th,l);let h=a[0]??0;const p=[];for(let f=0;f<l;f++){const g=u[f]===1;if(f%16===0&&Math.random()<.7)h=a[0]??0;else if(g){const M=Math.random()<.6?1:-1,S=Math.random()<.7?1:2;h=Math.max(0,Math.min(m.length-1,h+M*S))}const b=.65+(f%4===0?.2:.1)+(Math.random()-.5)*s;p.push(Ra(g,b,m[h]))}return p}function Sv(m,a,l,s,u){const h=ei(Ca.acidClassic,s),p=Fc.acid,f=a[0]??0,g=m[f],b=l.length>0?m[l[0]]:g,M=Math.min(f+4,m.length-1),S=m[M],y=[];let j=g;for(let C=0;C<s;C++){const B=h[C]===1,G=p[C%16];let Z;const W=Math.random();C%16===0?Z=g:W<.3?Z=j:W<.5?Z=j===b?g:b:W<.7?Z=S:Z=m[Math.floor(Math.random()*m.length)];const I=.5+G*.4+(Math.random()-.5)*u;y.push(Ra(B,I,Z)),B&&(j=Z)}return y}function Mv(m,a,l,s){const u=ei(Ca.acidRun,l),h=Fc.acid;let p=a[0]??0,f=1,g=0;const b=4+Math.floor(Math.random()*4),M=[];for(let S=0;S<l;S++){const y=u[S]===1,j=h[S%16];S%16===0&&Math.random()<.5&&(p=a[0]??0,f=Math.random()<.5?1:-1,g=0),y&&(g++,(g>=b||p>=m.length-1||p<=0)&&(f=-f,g=0),p=Math.max(0,Math.min(m.length-1,p+f)));const C=.5+j*.4+(Math.random()-.5)*s;M.push(Ra(y,C,m[p]))}return M}function Tv(m,a,l,s){const u=ei(Ca.syncopated,l),h=a[0]??0,p=m[h],f=m[Math.max(0,h-1)],g=m[Math.min(m.length-1,h+1)];return u.map((b,M)=>{let S;const y=M%16;y===0||y===8?S=p:y%2===1?S=Math.random()<.4?g:p:S=Math.random()<.3?f:p;const j=.6+(y%4!==0?.2:.1)+(Math.random()-.5)*s;return Ra(b===1,j,S)})}function Cv(m,a,l,s){const u=ei(Ca.minimal,l),h=a[0]??0,p=m[h],f=[...u];for(let g=0;g<l;g++)f[g]===0&&Math.random()<.1&&(f[g]=1);return f.map((g,b)=>{const M=Math.random()<.85?p:m[Math.min(h+4,m.length-1)],S=.75+(b%8===0?.15:0)+(Math.random()-.5)*s;return Ra(g===1,S,M)})}function Rv(m,a,l,s,u){const h=Math.random()<.4,p=ei(h?Ca.driving16th:Ca.driving8th,s),f=a[0]??0,g=m[f],b=l.length>0?m[l[0]]:g,M=m[Math.min(f+4,m.length-1)];return p.map((S,y)=>{let j;if(Math.floor(y/16)%2===0)j=y%8===4?Math.random()<.5?b:M:g;else{const G=Math.random();G<.5?j=g:G<.75?j=M:j=b}const B=.65+(y%4===0?.2:.1)+(Math.random()-.5)*u;return Ra(S===1,B,j)})}function Av(m,a,l){const s=.4+Math.random()*.4;return Array(a).fill(null).map(()=>{const u=Math.random()<s,h=m[Math.floor(Math.random()*m.length)],p=.5+Math.random()*.4+(Math.random()-.5)*l;return Ra(u,p,h)})}function ei(m,a){const l=[];for(let s=0;s<a;s++)l.push(m[s%m.length]);return l}function kv(){return[{style:"root",label:"Root",description:"Simple root note pattern"},{style:"octave",label:"Octave",description:"Root with octave jumps"},{style:"walking",label:"Walking",description:"Walking bass movement"},{style:"acid",label:"Acid",description:"303-style acid pattern"},{style:"acidRun",label:"Acid Run",description:"Acid with scale runs"},{style:"syncopated",label:"Syncopated",description:"Off-beat emphasis"},{style:"minimal",label:"Minimal",description:"Sparse, spacious"},{style:"driving",label:"Driving",description:"Steady rhythmic bass"},{style:"random",label:"Random",description:"Fully random"}]}const Ev={shape:"sine",rate:1,sync:"1/4",tempoSync:!1,phase:0,depth:1,bipolar:!0,smoothing:0},jv={free:0,"8bars":32,"4bars":16,"2bars":8,"1bar":4,"1/2":2,"1/4":1,"1/8":.5,"1/16":.25,"1/32":.125,"1/2d":3,"1/4d":1.5,"1/8d":.75,"1/16d":.375,"1/2t":4/3,"1/4t":2/3,"1/8t":1/3,"1/16t":1/6};class gn{params;phase=0;sampleHoldValue=0;lastSampleHoldPhase=0;smoothedValue=0;bpm=120;randomTarget=0;randomCurrent=0;randomChangeTime=0;constructor(a){this.params={...Ev,...a},this.phase=this.params.phase}getValue(a){const l=this.getFrequency();this.phase=(a*l+this.params.phase)%1;let s;switch(this.params.shape){case"sine":s=Math.sin(this.phase*Math.PI*2);break;case"triangle":s=this.phase<.5?this.phase*4-1:3-this.phase*4;break;case"square":s=this.phase<.5?1:-1;break;case"sawtooth":s=this.phase*2-1;break;case"sampleHold":if(this.phase<this.lastSampleHoldPhase&&(this.sampleHoldValue=Math.random()*2-1),this.lastSampleHoldPhase=this.phase,this.params.smoothing>0){const u=1-this.params.smoothing;this.smoothedValue=this.smoothedValue+(this.sampleHoldValue-this.smoothedValue)*u*.1,s=this.smoothedValue}else s=this.sampleHoldValue;break;case"random":s=this.getRandomWalkValue(a,l);break;default:s=0}return s*=this.params.depth,this.params.bipolar||(s=(s+1)/2),s}getRandomWalkValue(a,l){const s=1/l;a-this.randomChangeTime>s&&(this.randomTarget=Math.random()*2-1,this.randomChangeTime=a);const u=.02*(1-this.params.smoothing*.9);return this.randomCurrent=this.randomCurrent+(this.randomTarget-this.randomCurrent)*u,this.randomCurrent}getFrequency(){if(!this.params.tempoSync||this.params.sync==="free")return this.params.rate;const a=jv[this.params.sync];return this.bpm/60/a}setBpm(a){this.bpm=a}reset(){this.phase=this.params.phase,this.sampleHoldValue=0,this.lastSampleHoldPhase=0,this.smoothedValue=0,this.randomTarget=0,this.randomCurrent=0,this.randomChangeTime=0}getParams(){return{...this.params}}setParams(a){this.params={...this.params,...a}}get shape(){return this.params.shape}set shape(a){this.params.shape=a}get rate(){return this.params.rate}set rate(a){this.params.rate=Math.max(.01,Math.min(30,a))}get sync(){return this.params.sync}set sync(a){this.params.sync=a}get tempoSync(){return this.params.tempoSync}set tempoSync(a){this.params.tempoSync=a}get phaseOffset(){return this.params.phase}set phaseOffset(a){this.params.phase=a%1}get depth(){return this.params.depth}set depth(a){this.params.depth=Math.max(0,Math.min(1,a))}get bipolar(){return this.params.bipolar}set bipolar(a){this.params.bipolar=a}get smoothing(){return this.params.smoothing}set smoothing(a){this.params.smoothing=Math.max(0,Math.min(1,a))}}class Nv{lfos=[];slowRandom1;slowRandom2;_bpm=120;constructor(){this.lfos=[new gn({shape:"sine",rate:1,depth:1,bipolar:!0}),new gn({shape:"triangle",rate:.5,depth:1,bipolar:!0}),new gn({shape:"square",rate:2,depth:1,bipolar:!0}),new gn({shape:"sampleHold",rate:4,depth:1,bipolar:!0})],this.slowRandom1=new gn({shape:"random",rate:.1,depth:1,bipolar:!0,smoothing:.8}),this.slowRandom2=new gn({shape:"random",rate:.07,depth:1,bipolar:!0,smoothing:.9})}getLFO(a){return this.lfos[a]??null}getSlowRandom(a){return a===1?this.slowRandom1:this.slowRandom2}getValue(a,l){const s=this.lfos[a];return s?s.getValue(l):0}getSlowRandomValue(a,l){return(a===1?this.slowRandom1:this.slowRandom2).getValue(l)}getAllValues(a){return{lfo1:this.lfos[0].getValue(a),lfo2:this.lfos[1].getValue(a),lfo3:this.lfos[2].getValue(a),lfo4:this.lfos[3].getValue(a),random1:this.slowRandom1.getValue(a),random2:this.slowRandom2.getValue(a)}}setBpm(a){this._bpm=a;for(const l of this.lfos)l.setBpm(a);this.slowRandom1.setBpm(a),this.slowRandom2.setBpm(a)}getBpm(){return this._bpm}reset(){for(const a of this.lfos)a.reset();this.slowRandom1.reset(),this.slowRandom2.reset()}getState(){return{lfos:this.lfos.map(a=>a.getParams()),slowRandom:{rate1:this.slowRandom1.rate,rate2:this.slowRandom2.rate,smoothing1:this.slowRandom1.smoothing,smoothing2:this.slowRandom2.smoothing}}}setState(a){a.lfos.forEach((l,s)=>{this.lfos[s]&&this.lfos[s].setParams(l)}),this.slowRandom1.rate=a.slowRandom.rate1,this.slowRandom2.rate=a.slowRandom.rate2,this.slowRandom1.smoothing=a.slowRandom.smoothing1,this.slowRandom2.smoothing=a.slowRandom.smoothing2}setLFOParams(a,l){const s=this.lfos[a];s&&s.setParams(l)}setSlowRandomParams(a,l,s){const u=a===1?this.slowRandom1:this.slowRandom2;u.rate=l,u.smoothing=s}}const Xp={slowSweep:{shape:"sine",rate:.1,depth:1,bipolar:!0},fastWobble:{shape:"sine",rate:6,depth:.5,bipolar:!0},tremolo:{shape:"sine",rate:8,depth:1,bipolar:!1},gate:{shape:"square",sync:"1/8",tempoSync:!0,depth:1,bipolar:!1},ramp:{shape:"sawtooth",sync:"1/4",tempoSync:!0,depth:1,bipolar:!0},randomSteps:{shape:"sampleHold",sync:"1/16",tempoSync:!0,depth:1,bipolar:!0,smoothing:0},smoothRandom:{shape:"sampleHold",rate:2,depth:1,bipolar:!0,smoothing:.7},drift:{shape:"random",rate:.05,depth:.3,bipolar:!0,smoothing:.95}};function v(m,a,l="linear"){return{time:m,value:a,curve:l}}const Ov=[{id:"flat",name:"Flat",category:"Basic",breakpoints:[v(0,.5),v(1,.5)],defaultPeriod:1,description:"No movement"},{id:"attack-decay",name:"Attack-Decay",category:"Basic",breakpoints:[v(0,0,"linear"),v(.15,1,"exp"),v(1,0,"exp")],defaultPeriod:.5,description:"Classic AD envelope"},{id:"attack-decay-sharp",name:"AD Sharp",category:"Basic",breakpoints:[v(0,0),v(.05,1,"punch"),v(1,0,"exp")],defaultPeriod:.3,description:"Sharp attack AD"},{id:"attack-decay-slow",name:"AD Slow",category:"Basic",breakpoints:[v(0,0),v(.4,1,"swell"),v(1,0,"exp")],defaultPeriod:2,description:"Slow attack AD"},{id:"ramp-up",name:"Ramp Up",category:"Basic",breakpoints:[v(0,0),v(1,1,"linear")],defaultPeriod:1,description:"Linear ascending ramp"},{id:"ramp-down",name:"Ramp Down",category:"Basic",breakpoints:[v(0,1),v(1,0,"linear")],defaultPeriod:1,description:"Linear descending ramp"},{id:"triangle",name:"Triangle",category:"Basic",breakpoints:[v(0,0),v(.5,1,"linear"),v(1,0,"linear")],defaultPeriod:1,description:"Triangle wave shape"},{id:"decay-only",name:"Decay Only",category:"Basic",breakpoints:[v(0,1),v(1,0,"exp")],defaultPeriod:.5,description:"Start high, decay down"},{id:"hold-decay",name:"Hold + Decay",category:"Basic",breakpoints:[v(0,1),v(.3,1,"linear"),v(1,0,"exp")],defaultPeriod:1,description:"Hold then decay"},{id:"delay-attack",name:"Delayed Attack",category:"Basic",breakpoints:[v(0,0),v(.3,0,"linear"),v(.5,1,"exp"),v(1,0,"exp")],defaultPeriod:1,description:"Delayed then attack"}],Pv=[{id:"exp-attack",name:"Exp Attack",category:"Exponential",breakpoints:[v(0,0),v(1,1,"exp")],defaultPeriod:1,description:"Exponential rise"},{id:"exp-decay",name:"Exp Decay",category:"Exponential",breakpoints:[v(0,1),v(1,0,"exp")],defaultPeriod:1,description:"Exponential fall"},{id:"log-attack",name:"Log Attack",category:"Exponential",breakpoints:[v(0,0),v(1,1,"sharp")],defaultPeriod:1,description:"Logarithmic rise (fast start)"},{id:"punch-decay",name:"Punch Decay",category:"Exponential",breakpoints:[v(0,1),v(1,0,"punch")],defaultPeriod:.3,description:"Punch curve decay"},{id:"swell",name:"Swell",category:"Exponential",breakpoints:[v(0,0),v(.8,1,"swell"),v(1,.8,"linear")],defaultPeriod:2,description:"Slow swell rise"},{id:"exp-bump",name:"Exp Bump",category:"Exponential",breakpoints:[v(0,.3),v(.3,1,"exp"),v(.7,.6,"exp"),v(1,.3,"exp")],defaultPeriod:1,description:"Exponential bump shape"},{id:"reverse-swell",name:"Reverse Swell",category:"Exponential",breakpoints:[v(0,1),v(.2,.8,"linear"),v(1,0,"swell")],defaultPeriod:1,description:"Accelerating decay"},{id:"double-exp",name:"Double Exp",category:"Exponential",breakpoints:[v(0,0),v(.3,1,"exp"),v(.5,.4,"exp"),v(.8,.9,"exp"),v(1,0,"exp")],defaultPeriod:1,description:"Two exponential peaks"}],Dv=[{id:"double-peak",name:"Double Peak",category:"Multi-Stage",breakpoints:[v(0,0),v(.2,1,"exp"),v(.4,.3,"exp"),v(.6,.9,"exp"),v(1,0,"exp")],defaultPeriod:1,description:"Two peaks"},{id:"triple-peak",name:"Triple Peak",category:"Multi-Stage",breakpoints:[v(0,0),v(.15,1,"exp"),v(.25,.2,"exp"),v(.45,.85,"exp"),v(.55,.15,"exp"),v(.75,.7,"exp"),v(1,0,"exp")],defaultPeriod:1,description:"Three peaks"},{id:"staircase-up",name:"Staircase Up",category:"Multi-Stage",breakpoints:[v(0,0),v(.2,.25,"step"),v(.4,.5,"step"),v(.6,.75,"step"),v(.8,1,"step"),v(1,.25,"step")],defaultPeriod:1,description:"Ascending steps"},{id:"staircase-down",name:"Staircase Down",category:"Multi-Stage",breakpoints:[v(0,1),v(.2,.75,"step"),v(.4,.5,"step"),v(.6,.25,"step"),v(.8,0,"step"),v(1,.75,"step")],defaultPeriod:1,description:"Descending steps"},{id:"bumpy-decay",name:"Bumpy Decay",category:"Multi-Stage",breakpoints:[v(0,1),v(.15,.6,"exp"),v(.25,.8,"exp"),v(.4,.4,"exp"),v(.55,.55,"exp"),v(.7,.2,"exp"),v(1,0,"exp")],defaultPeriod:1,description:"Decay with bumps"},{id:"attack-sustain-decay",name:"ASD",category:"Multi-Stage",breakpoints:[v(0,0),v(.1,1,"exp"),v(.6,.7,"linear"),v(1,0,"exp")],defaultPeriod:1,description:"Attack-Sustain-Decay"},{id:"plateau",name:"Plateau",category:"Multi-Stage",breakpoints:[v(0,0),v(.1,1,"exp"),v(.9,1,"linear"),v(1,0,"exp")],defaultPeriod:1,description:"Attack, hold, quick release"},{id:"valley",name:"Valley",category:"Multi-Stage",breakpoints:[v(0,1),v(.3,.2,"exp"),v(.7,.2,"linear"),v(1,1,"exp")],defaultPeriod:1,description:"Inverted plateau"},{id:"bounce",name:"Bounce",category:"Multi-Stage",breakpoints:[v(0,1),v(.2,.1,"exp"),v(.35,.6,"exp"),v(.5,.1,"exp"),v(.65,.35,"exp"),v(.8,.1,"exp"),v(1,.15,"exp")],defaultPeriod:.8,description:"Bouncing ball decay"},{id:"wave-decay",name:"Wave Decay",category:"Multi-Stage",breakpoints:[v(0,1),v(.1,.5,"exp"),v(.2,.9,"exp"),v(.35,.35,"exp"),v(.5,.7,"exp"),v(.7,.2,"exp"),v(.85,.4,"exp"),v(1,0,"exp")],defaultPeriod:1,description:"Damped oscillation"}],Lv=[{id:"sine",name:"Sine",category:"LFO",breakpoints:[v(0,.5),v(.25,1,"exp"),v(.5,.5,"exp"),v(.75,0,"exp"),v(1,.5,"exp")],defaultPeriod:1,description:"Sine wave"},{id:"square",name:"Square",category:"LFO",breakpoints:[v(0,1),v(.5,0,"step"),v(1,1,"step")],defaultPeriod:1,description:"Square wave"},{id:"saw-up",name:"Saw Up",category:"LFO",breakpoints:[v(0,0),v(.99,1,"linear"),v(1,0,"step")],defaultPeriod:1,description:"Ascending sawtooth"},{id:"saw-down",name:"Saw Down",category:"LFO",breakpoints:[v(0,1),v(.99,0,"linear"),v(1,1,"step")],defaultPeriod:1,description:"Descending sawtooth"},{id:"pulse-narrow",name:"Pulse Narrow",category:"LFO",breakpoints:[v(0,1),v(.1,1,"linear"),v(.11,0,"step"),v(1,0,"linear")],defaultPeriod:1,description:"Narrow pulse (10% duty)"},{id:"pulse-wide",name:"Pulse Wide",category:"LFO",breakpoints:[v(0,1),v(.75,1,"linear"),v(.76,0,"step"),v(1,0,"linear")],defaultPeriod:1,description:"Wide pulse (75% duty)"},{id:"tremolo-fast",name:"Tremolo Fast",category:"LFO",breakpoints:[v(0,.3),v(.125,1,"exp"),v(.25,.3,"exp"),v(.375,1,"exp"),v(.5,.3,"exp"),v(.625,1,"exp"),v(.75,.3,"exp"),v(.875,1,"exp"),v(1,.3,"exp")],defaultPeriod:.5,description:"Fast 4x tremolo"},{id:"wobble",name:"Wobble",category:"LFO",breakpoints:[v(0,0),v(.15,.8,"exp"),v(.35,.2,"exp"),v(.5,.9,"exp"),v(.65,.3,"exp"),v(.85,.7,"exp"),v(1,0,"exp")],defaultPeriod:1,description:"Wobbling shape"},{id:"stepped-4",name:"4 Steps",category:"LFO",breakpoints:[v(0,.2),v(.25,.8,"step"),v(.5,.4,"step"),v(.75,1,"step"),v(1,.2,"step")],defaultPeriod:1,description:"4-step sequence"},{id:"stepped-8",name:"8 Steps",category:"LFO",breakpoints:[v(0,.1),v(.125,.6,"step"),v(.25,.3,"step"),v(.375,.9,"step"),v(.5,.2,"step"),v(.625,.7,"step"),v(.75,.5,"step"),v(.875,1,"step"),v(1,.1,"step")],defaultPeriod:1,description:"8-step sequence"}],wv=[{id:"breath",name:"Breath",category:"Organic",breakpoints:[v(0,.1),v(.2,.5,"swell"),v(.4,.85,"swell"),v(.6,.75,"exp"),v(.8,.3,"exp"),v(1,.1,"exp")],defaultPeriod:3,description:"Natural breathing shape"},{id:"drift",name:"Drift",category:"Organic",breakpoints:[v(0,.5),v(.2,.65,"exp"),v(.35,.4,"exp"),v(.55,.7,"exp"),v(.7,.55,"exp"),v(.85,.6,"exp"),v(1,.5,"exp")],defaultPeriod:4,description:"Gentle drifting"},{id:"sigh",name:"Sigh",category:"Organic",breakpoints:[v(0,0),v(.15,.7,"swell"),v(.25,.9,"exp"),v(.4,.6,"exp"),v(.6,.4,"exp"),v(.8,.15,"exp"),v(1,0,"exp")],defaultPeriod:2,description:"Sigh-like release"},{id:"ripple",name:"Ripple",category:"Organic",breakpoints:[v(0,.5),v(.1,.75,"exp"),v(.2,.45,"exp"),v(.3,.65,"exp"),v(.45,.5,"exp"),v(.6,.58,"exp"),v(.75,.48,"exp"),v(.9,.52,"exp"),v(1,.5,"exp")],defaultPeriod:2,description:"Water ripple decay"},{id:"wave-rise",name:"Wave Rise",category:"Organic",breakpoints:[v(0,0),v(.2,.2,"swell"),v(.35,.35,"exp"),v(.5,.55,"swell"),v(.65,.7,"exp"),v(.85,.9,"swell"),v(1,1,"exp")],defaultPeriod:4,description:"Organic wave rising"},{id:"flutter",name:"Flutter",category:"Organic",breakpoints:[v(0,.5),v(.05,.7,"exp"),v(.1,.45,"exp"),v(.18,.8,"exp"),v(.26,.4,"exp"),v(.35,.65,"exp"),v(.5,.5,"exp"),v(.7,.55,"exp"),v(1,.5,"exp")],defaultPeriod:.8,description:"Flutter effect"},{id:"morph-slow",name:"Morph Slow",category:"Organic",breakpoints:[v(0,.3),v(.15,.5,"swell"),v(.3,.8,"exp"),v(.45,.55,"exp"),v(.6,.75,"swell"),v(.8,.45,"exp"),v(1,.3,"exp")],defaultPeriod:6,description:"Slow morphing"},{id:"wind",name:"Wind",category:"Organic",breakpoints:[v(0,.2),v(.12,.5,"swell"),v(.2,.3,"exp"),v(.35,.7,"swell"),v(.45,.45,"exp"),v(.6,.8,"swell"),v(.75,.55,"exp"),v(.9,.4,"exp"),v(1,.2,"exp")],defaultPeriod:5,description:"Wind gusts"}],qv=[{id:"glitch-random",name:"Glitch Random",category:"Glitch",breakpoints:[v(0,.2),v(.1,.9,"step"),v(.15,.1,"step"),v(.25,.7,"step"),v(.3,.3,"step"),v(.45,1,"step"),v(.5,0,"step"),v(.6,.6,"step"),v(.75,.4,"step"),v(.85,.8,"step"),v(1,.2,"step")],defaultPeriod:.5,description:"Random stepped"},{id:"glitch-burst",name:"Glitch Burst",category:"Glitch",breakpoints:[v(0,0),v(.02,1,"step"),v(.05,0,"step"),v(.08,.8,"step"),v(.12,.2,"step"),v(.18,.9,"step"),v(.22,0,"step"),v(.5,0,"linear"),v(1,0,"linear")],defaultPeriod:.3,description:"Burst of glitches"},{id:"digital-decay",name:"Digital Decay",category:"Glitch",breakpoints:[v(0,1),v(.1,.8,"step"),v(.2,.65,"step"),v(.3,.5,"step"),v(.45,.35,"step"),v(.6,.2,"step"),v(.8,.1,"step"),v(1,0,"step")],defaultPeriod:.5,description:"Stepped digital decay"},{id:"bitcrush",name:"Bitcrush",category:"Glitch",breakpoints:[v(0,0),v(.125,.5,"step"),v(.25,.25,"step"),v(.375,.75,"step"),v(.5,0,"step"),v(.625,1,"step"),v(.75,.5,"step"),v(.875,.125,"step"),v(1,0,"step")],defaultPeriod:.25,description:"Low-bit pattern"},{id:"sample-hold",name:"Sample & Hold",category:"Glitch",breakpoints:[v(0,.35),v(.1,.7,"step"),v(.2,.15,"step"),v(.3,.9,"step"),v(.4,.45,"step"),v(.5,.8,"step"),v(.6,.25,"step"),v(.7,.6,"step"),v(.8,.1,"step"),v(.9,.55,"step"),v(1,.35,"step")],defaultPeriod:.8,description:"Classic S&H"},{id:"stutter",name:"Stutter",category:"Glitch",breakpoints:[v(0,1),v(.05,0,"step"),v(.1,1,"step"),v(.15,0,"step"),v(.2,1,"step"),v(.25,0,"step"),v(.35,.7,"step"),v(.4,0,"step"),v(.5,.5,"step"),v(1,0,"exp")],defaultPeriod:.4,description:"Stuttering effect"},{id:"corrupt",name:"Corrupt",category:"Glitch",breakpoints:[v(0,.5),v(.03,1,"step"),v(.08,.1,"step"),v(.15,.8,"exp"),v(.22,.2,"step"),v(.35,.95,"step"),v(.4,.05,"step"),v(.55,.6,"exp"),v(.7,.7,"step"),v(.85,.3,"step"),v(1,.5,"step")],defaultPeriod:.6,description:"Corrupted data"},{id:"binary",name:"Binary",category:"Glitch",breakpoints:[v(0,1),v(.125,0,"step"),v(.25,1,"step"),v(.375,1,"step"),v(.5,0,"step"),v(.625,1,"step"),v(.75,0,"step"),v(.875,0,"step"),v(1,1,"step")],defaultPeriod:.5,description:"Binary pattern"}],zv=[{id:"kick",name:"Kick",category:"Percussion",breakpoints:[v(0,1),v(.02,.7,"punch"),v(.15,.2,"exp"),v(1,0,"exp")],defaultPeriod:.3,description:"Kick drum shape"},{id:"snare",name:"Snare",category:"Percussion",breakpoints:[v(0,1),v(.03,.8,"punch"),v(.08,.6,"exp"),v(.2,.3,"exp"),v(1,0,"exp")],defaultPeriod:.25,description:"Snare drum shape"},{id:"hihat-closed",name:"Hi-Hat Closed",category:"Percussion",breakpoints:[v(0,1),v(.03,.4,"punch"),v(.1,0,"exp"),v(1,0,"linear")],defaultPeriod:.1,description:"Closed hi-hat"},{id:"hihat-open",name:"Hi-Hat Open",category:"Percussion",breakpoints:[v(0,1),v(.05,.7,"punch"),v(.4,.2,"exp"),v(1,0,"exp")],defaultPeriod:.5,description:"Open hi-hat"},{id:"clap",name:"Clap",category:"Percussion",breakpoints:[v(0,.8),v(.02,.3,"punch"),v(.04,.9,"punch"),v(.06,.4,"punch"),v(.08,1,"punch"),v(.15,.5,"exp"),v(1,0,"exp")],defaultPeriod:.3,description:"Hand clap"},{id:"tom",name:"Tom",category:"Percussion",breakpoints:[v(0,1),v(.05,.75,"punch"),v(.25,.35,"exp"),v(1,0,"exp")],defaultPeriod:.4,description:"Tom drum"},{id:"rim",name:"Rimshot",category:"Percussion",breakpoints:[v(0,1),v(.01,.6,"punch"),v(.05,0,"exp"),v(1,0,"linear")],defaultPeriod:.08,description:"Rimshot snap"},{id:"click",name:"Click",category:"Percussion",breakpoints:[v(0,1),v(.005,0,"punch"),v(1,0,"linear")],defaultPeriod:.05,description:"Pure click"},{id:"zap",name:"Zap",category:"Percussion",breakpoints:[v(0,1),v(.03,.1,"punch"),v(.08,0,"exp"),v(1,0,"linear")],defaultPeriod:.1,description:"Electronic zap"},{id:"noise-burst",name:"Noise Burst",category:"Percussion",breakpoints:[v(0,0),v(.01,1,"punch"),v(.08,.6,"exp"),v(.2,.2,"exp"),v(1,0,"exp")],defaultPeriod:.2,description:"Noise burst"}],Bv=[{id:"complex-a",name:"Complex A",category:"Complex",breakpoints:[v(0,0),v(.08,1,"punch"),v(.15,.4,"exp"),v(.25,.7,"exp"),v(.35,.3,"sharp"),v(.5,.6,"swell"),v(.65,.25,"exp"),v(.8,.45,"exp"),v(1,0,"exp")],defaultPeriod:1.5,description:"Complex evolution"},{id:"complex-b",name:"Complex B",category:"Complex",breakpoints:[v(0,.5),v(.1,.9,"exp"),v(.18,.3,"sharp"),v(.3,.75,"swell"),v(.4,.55,"exp"),v(.55,.85,"punch"),v(.7,.2,"exp"),v(.85,.6,"swell"),v(1,.5,"exp")],defaultPeriod:2,description:"Complex morphing"},{id:"gate-sequence",name:"Gate Sequence",category:"Complex",breakpoints:[v(0,0),v(.05,1,"punch"),v(.15,0,"step"),v(.2,0,"linear"),v(.25,1,"punch"),v(.35,0,"step"),v(.4,0,"linear"),v(.45,.6,"punch"),v(.55,0,"step"),v(.75,0,"linear"),v(.8,1,"punch"),v(.9,0,"step"),v(1,0,"linear")],defaultPeriod:.5,description:"Gated rhythm"},{id:"trapezoid",name:"Trapezoid",category:"Complex",breakpoints:[v(0,0),v(.15,1,"linear"),v(.35,1,"linear"),v(.5,0,"linear"),v(.65,0,"linear"),v(.8,.7,"linear"),v(1,0,"linear")],defaultPeriod:1,description:"Trapezoid shape"},{id:"harmonic",name:"Harmonic",category:"Complex",breakpoints:[v(0,.5),v(.0833,1,"exp"),v(.1667,.5,"exp"),v(.25,0,"exp"),v(.3333,.5,"exp"),v(.4167,.85,"exp"),v(.5,.5,"exp"),v(.5833,.15,"exp"),v(.6667,.5,"exp"),v(.75,.75,"exp"),v(.8333,.5,"exp"),v(.9167,.25,"exp"),v(1,.5,"exp")],defaultPeriod:1,description:"Harmonic series"},{id:"ratchet",name:"Ratchet",category:"Complex",breakpoints:[v(0,1),v(.08,.1,"exp"),v(.12,.85,"punch"),v(.22,.08,"exp"),v(.28,.7,"punch"),v(.4,.06,"exp"),v(.48,.55,"punch"),v(.65,.04,"exp"),v(.75,.4,"punch"),v(1,0,"exp")],defaultPeriod:.4,description:"Ratcheting decay"},{id:"granular",name:"Granular",category:"Complex",breakpoints:[v(0,0),v(.02,.7,"punch"),v(.05,.1,"exp"),v(.1,.5,"punch"),v(.15,.15,"exp"),v(.22,.8,"punch"),v(.27,.2,"exp"),v(.35,.6,"punch"),v(.42,.1,"exp"),v(.52,.4,"punch"),v(.6,.05,"exp"),v(1,0,"linear")],defaultPeriod:.3,description:"Granular texture"},{id:"feedback",name:"Feedback",category:"Complex",breakpoints:[v(0,.2),v(.1,.6,"exp"),v(.15,.25,"exp"),v(.25,.75,"exp"),v(.32,.3,"exp"),v(.45,.85,"exp"),v(.55,.35,"exp"),v(.7,.9,"exp"),v(.82,.4,"exp"),v(.95,.7,"exp"),v(1,.2,"exp")],defaultPeriod:2,description:"Feedback buildup"}],Mn=[...Ov,...Pv,...Dv,...Lv,...wv,...qv,...zv,...Bv],_v=new Map(Mn.map(m=>[m.id,m]));function Vv(m){return Mn.filter(a=>a.category===m)}function nd(){const m=new Set(Mn.map(a=>a.category));return Array.from(m)}const Gv={presetId:"attack-decay",period:1,sync:"1bar",tempoSync:!1,phase:0,depth:1,bipolar:!0,loopMode:"cycle",retrigger:!1},Fv={free:0,"8bars":32,"4bars":16,"2bars":8,"1bar":4,"1/2":2,"1/4":1,"1/8":.5,"1/16":.25,"1/32":.125,"1/2d":3,"1/4d":1.5,"1/8d":.75,"1/16d":.375,"1/2t":4/3,"1/4t":2/3,"1/8t":1/3,"1/16t":1/6};function Hv(m,a,l,s){const u=a-m;switch(s){case"linear":return m+u*l;case"exp":return u>=0?m+u*(1-Math.pow(1-l,3)):m+u*Math.pow(l,3);case"sharp":return m+u*(1-Math.pow(1-l,.5));case"punch":return m+u*(1-Math.pow(1-l,4));case"swell":return m+u*Math.pow(l,2);case"step":return l>=1?a:m;default:return m+u*l}}class Uv{params;currentPreset=null;bpm=120;startTime=0;hasCompleted=!1;constructor(a){this.params={...Gv,...a},this.loadPreset(this.params.presetId)}loadPreset(a){const l=_v.get(a);return l?(this.currentPreset=l,this.params.presetId=a,!0):!1}getValue(a){if(!this.currentPreset)return 0;const l=this.getPeriod(),s=a-this.startTime;let u;if(this.params.loopMode==="cycle")u=(s/l+this.params.phase)%1;else{const p=s/l+this.params.phase;if(p>=1)if(this.hasCompleted=!0,this.params.loopMode==="oneshot-hold")u=.9999;else return this.getUnipolarValue(this.currentPreset.breakpoints[0].value);else u=p}const h=this.evaluateEnvelope(u);return this.getUnipolarValue(h)}evaluateEnvelope(a){if(!this.currentPreset)return .5;const l=this.currentPreset.breakpoints;if(l.length===0)return .5;if(l.length===1)return l[0].value;let s=l[0],u=l[l.length-1];for(let f=0;f<l.length-1;f++)if(a>=l[f].time&&a<l[f+1].time){s=l[f],u=l[f+1];break}if(a>=l[l.length-1].time)return l[l.length-1].value;const h=u.time-s.time;if(h<=0)return s.value;const p=(a-s.time)/h;return Hv(s.value,u.value,p,u.curve)}getUnipolarValue(a){let l=a;return this.params.bipolar&&(l=l*2-1),l*=this.params.depth,l}getPeriod(){if(!this.params.tempoSync||this.params.sync==="free")return this.params.period;const a=Fv[this.params.sync];return 1/(this.bpm/60/a)}getFrequency(){return 1/this.getPeriod()}setBpm(a){this.bpm=a}reset(a=0){this.startTime=a,this.hasCompleted=!1}trigger(a){this.reset(a)}isComplete(){return this.hasCompleted}getParams(){return{...this.params}}setParams(a){a.presetId&&a.presetId!==this.params.presetId&&this.loadPreset(a.presetId),this.params={...this.params,...a}}getPreset(){return this.currentPreset}get presetId(){return this.params.presetId}set presetId(a){this.loadPreset(a)}get period(){return this.params.period}set period(a){this.params.period=Math.max(.01,Math.min(60,a))}get sync(){return this.params.sync}set sync(a){this.params.sync=a}get tempoSync(){return this.params.tempoSync}set tempoSync(a){this.params.tempoSync=a}get phase(){return this.params.phase}set phase(a){this.params.phase=a%1}get depth(){return this.params.depth}set depth(a){this.params.depth=Math.max(0,Math.min(1,a))}get bipolar(){return this.params.bipolar}set bipolar(a){this.params.bipolar=a}get loopMode(){return this.params.loopMode}set loopMode(a){this.params.loopMode=a}get retrigger(){return this.params.retrigger}set retrigger(a){this.params.retrigger=a}}class Qv{envelopes=[];_bpm=120;constructor(){const a=["attack-decay","swell","bounce","sine","breath","complex-a"];for(let l=0;l<6;l++)this.envelopes.push(new Uv({presetId:a[l],period:1,tempoSync:!1,depth:1,bipolar:!0,loopMode:"cycle"}))}getEnvelope(a){return this.envelopes[a]??null}getValue(a,l){const s=this.envelopes[a];return s?s.getValue(l):0}getAllValues(a){return{env1:this.envelopes[0].getValue(a),env2:this.envelopes[1].getValue(a),env3:this.envelopes[2].getValue(a),env4:this.envelopes[3].getValue(a),env5:this.envelopes[4].getValue(a),env6:this.envelopes[5].getValue(a)}}setBpm(a){this._bpm=a;for(const l of this.envelopes)l.setBpm(a)}getBpm(){return this._bpm}reset(a=0){for(const l of this.envelopes)l.reset(a)}trigger(a){for(const l of this.envelopes)(l.retrigger||l.loopMode!=="cycle")&&l.trigger(a)}getState(){return{envelopes:this.envelopes.map(a=>a.getParams())}}setState(a){a.envelopes.forEach((l,s)=>{this.envelopes[s]&&this.envelopes[s].setParams(l)})}setEnvelopeParams(a,l){const s=this.envelopes[a];s&&s.setParams(l)}}const Zp={percussive:{presetId:"kick",period:.3,tempoSync:!1,loopMode:"oneshot",bipolar:!1},slowSwell:{presetId:"swell",sync:"2bars",tempoSync:!0,loopMode:"cycle",bipolar:!0},rhythmicGate:{presetId:"square",sync:"1/8",tempoSync:!0,loopMode:"cycle",bipolar:!1},organicBreath:{presetId:"breath",period:3,tempoSync:!1,loopMode:"cycle",bipolar:!0},glitchy:{presetId:"glitch-random",sync:"1/4",tempoSync:!0,loopMode:"cycle",bipolar:!0},complexMorph:{presetId:"complex-a",sync:"1bar",tempoSync:!0,loopMode:"cycle",bipolar:!0},bounce:{presetId:"bounce",period:.8,tempoSync:!1,loopMode:"cycle",bipolar:!1},ratchet:{presetId:"ratchet",sync:"1/4",tempoSync:!0,loopMode:"cycle",bipolar:!1}},Yv={"Voice - Pitch/Tune":["pitch","pitchEnvAmount","pitchEnvDecay"],"Voice - FM":["op1Ratio","op1Index","op1Feedback","op2Ratio","op2Index","op2ToOp1","fmIndex","fmIndexEnvAmount"],"Voice - Amp":["ampAttack","ampDecay"],"Voice - Noise":["noiseMix","noiseDecay","noiseFilterFreq","noiseFilterQ","decay","metalAmount","clickAmount"],"Voice - Sample":["samplePitch","sampleStartPoint","sampleLpCutoff","sampleLpResonance","sampleHpCutoff","sampleHpResonance","sampleSustain","sampleRelease","sampleScanSpeed"],"Voice - Granular":["grainDensity","grainLength","grainSpread","grainPan"],"Voice - Ocean":["oceanPitch","oceanGrainSize","oceanDensity","oceanPosition","oceanSpread","oceanHpfFreq","oceanLpfFreq","oceanVolume"],"Voice - Complex Morph":["complexCarrierFreq","complexNotchFreq","complexNotchQ","complexOutputLevel"],"Voice - Complex Morph Envelopes":["complexCarrierPitchPeriod","complexCarrierPitchAmount","complexCarrierPitchRange","complexOpAPitchPeriod","complexOpAPitchAmount","complexOpAPitchRange","complexOpAIndexPeriod","complexOpAIndexAmount","complexOpAIndexMin","complexOpAIndexMax","complexOpALevelPeriod","complexOpALevelAmount","complexOpALevelMax","complexOpBPitchPeriod","complexOpBPitchAmount","complexOpBPitchRange","complexOpBIndexPeriod","complexOpBIndexAmount","complexOpBIndexMin","complexOpBIndexMax","complexOpBLevelPeriod","complexOpBLevelAmount","complexOpBLevelMax","complexOpCPitchPeriod","complexOpCPitchAmount","complexOpCPitchRange","complexOpCIndexPeriod","complexOpCIndexAmount","complexOpCIndexMin","complexOpCIndexMax","complexOpCLevelPeriod","complexOpCLevelAmount","complexOpCLevelMax","complexAmpPeriod","complexAmpAmount","complexNotchEnvPeriod","complexNotchEnvAmount","complexNotchRange"],"Voice - Other":["glideTime"],"Voice - Plaits":["plaitsHarmonics","plaitsTimbre","plaitsMorph","plaitsFM","plaitsDecay","plaitsFade"],"Channel - Filter":["filterCutoff","filterResonance","filterSpan","filterDrive","filterMorph","filterChaos","filterWarmth"],"Channel - Saturation":["saturationDrive","saturationBias","saturationMix"],"Channel - Sends":["delaySend1","delaySend2","delaySend3","delaySend4","reverbSend"],"Channel - Mix":["volume","pan"],Note:["note"],"FX - Mimeophon 1":["mim1Time","mim1Feedback","mim1Mix","mim1Color","mim1Halo"],"FX - Mimeophon 2":["mim2Time","mim2Feedback","mim2Mix","mim2Color","mim2Halo"],"FX - Mimeophon 3":["mim3Time","mim3Feedback","mim3Mix","mim3Color","mim3Halo"],"FX - Mimeophon 4":["mim4Time","mim4Feedback","mim4Mix","mim4Color","mim4Halo"],"FX - Reverb":["reverbSize","reverbDamping","reverbWidth","reverbWetLevel"],"FX - Master":["masterSaturation","masterTone"],"Mod - LFO 1":["lfo1Rate","lfo1Depth","lfo1Phase"],"Mod - LFO 2":["lfo2Rate","lfo2Depth","lfo2Phase"],"Mod - LFO 3":["lfo3Rate","lfo3Depth","lfo3Phase"],"Mod - LFO 4":["lfo4Rate","lfo4Depth","lfo4Phase"],"Mod - Random":["random1Rate","random1Smoothing","random2Rate","random2Smoothing"],"Mod - Env 1":["env1Period","env1Depth","env1Phase"],"Mod - Env 2":["env2Period","env2Depth","env2Phase"],"Mod - Env 3":["env3Period","env3Depth","env3Phase"],"Mod - Env 4":["env4Period","env4Depth","env4Phase"],"Mod - Env 5":["env5Period","env5Depth","env5Phase"],"Mod - Env 6":["env6Period","env6Depth","env6Phase"]},kc={pitch:[20,2e3,100],pitchEnvAmount:[1,16,4],pitchEnvDecay:[.001,1,.05],op1Ratio:[.1,16,1],op1Index:[0,20,3],op1Feedback:[0,1,0],op2Ratio:[.1,16,1],op2Index:[0,20,1],op2ToOp1:[0,1,.5],fmIndex:[0,20,3],fmIndexEnvAmount:[0,1,.5],ampAttack:[.001,.5,.001],ampDecay:[.01,5,.3],noiseMix:[0,1,0],noiseDecay:[.01,2,.1],noiseFilterFreq:[100,1e4,2e3],noiseFilterQ:[.1,10,1],decay:[.001,2,.1],metalAmount:[0,1,0],clickAmount:[0,1,0],glideTime:[0,1,0],samplePitch:[-24,24,0],sampleStartPoint:[0,1,0],sampleLpCutoff:[20,2e4,2e4],sampleLpResonance:[0,20,0],sampleHpCutoff:[20,2e4,20],sampleHpResonance:[0,20,0],sampleSustain:[0,1,1],sampleRelease:[.001,5,.1],sampleScanSpeed:[0,8,1],grainDensity:[1,100,20],grainLength:[.001,1,.05],grainSpread:[0,1,0],grainPan:[-1,1,0],complexCarrierFreq:[20,2e3,100],complexNotchFreq:[20,15e3,1e3],complexNotchQ:[.1,20,1],complexOutputLevel:[0,1,.8],complexCarrierPitchPeriod:[.01,10,1],complexCarrierPitchAmount:[-1,1,1],complexCarrierPitchRange:[0,500,50],complexOpAPitchPeriod:[.01,10,1],complexOpAPitchAmount:[-1,1,1],complexOpAPitchRange:[0,500,100],complexOpAIndexPeriod:[.01,10,1],complexOpAIndexAmount:[-1,1,1],complexOpAIndexMin:[0,20,0],complexOpAIndexMax:[0,30,10],complexOpALevelPeriod:[.01,10,1],complexOpALevelAmount:[-1,1,1],complexOpALevelMax:[0,2,1],complexOpBPitchPeriod:[.01,10,1],complexOpBPitchAmount:[-1,1,1],complexOpBPitchRange:[0,500,100],complexOpBIndexPeriod:[.01,10,1],complexOpBIndexAmount:[-1,1,1],complexOpBIndexMin:[0,20,0],complexOpBIndexMax:[0,30,10],complexOpBLevelPeriod:[.01,10,1],complexOpBLevelAmount:[-1,1,1],complexOpBLevelMax:[0,2,1],complexOpCPitchPeriod:[.01,10,1],complexOpCPitchAmount:[-1,1,1],complexOpCPitchRange:[0,500,100],complexOpCIndexPeriod:[.01,10,1],complexOpCIndexAmount:[-1,1,1],complexOpCIndexMin:[0,20,0],complexOpCIndexMax:[0,30,10],complexOpCLevelPeriod:[.01,10,1],complexOpCLevelAmount:[-1,1,1],complexOpCLevelMax:[0,2,1],complexAmpPeriod:[.01,10,1],complexAmpAmount:[-1,1,1],complexNotchEnvPeriod:[.01,10,1],complexNotchEnvAmount:[-1,1,1],complexNotchRange:[0,2e3,600],oceanPitch:[-24,24,0],oceanGrainSize:[10,4e3,100],oceanDensity:[0,200,100],oceanPosition:[0,100,50],oceanSpread:[0,100,10],oceanHpfFreq:[20,2e4,20],oceanLpfFreq:[20,2e4,2e4],oceanVolume:[0,100,80],plaitsHarmonics:[0,1,.5],plaitsTimbre:[0,1,.5],plaitsMorph:[0,1,.5],plaitsFM:[0,10,0],plaitsDecay:[0,1,.5],plaitsFade:[0,1,0],filterCutoff:[20,2e4,1e3],filterResonance:[0,1,.5],filterSpan:[0,1,.5],filterDrive:[0,1,.5],filterMorph:[-1,1,0],filterChaos:[0,1,.3],filterWarmth:[0,1,.5],saturationDrive:[0,1,0],saturationBias:[-1,1,0],saturationMix:[0,1,0],delaySend1:[0,1,0],delaySend2:[0,1,0],delaySend3:[0,1,0],delaySend4:[0,1,0],reverbSend:[0,1,0],volume:[0,1,.8],pan:[-1,1,0],note:[-24,24,0],mim1Time:[0,1,.5],mim1Feedback:[0,1,.4],mim1Mix:[0,1,1],mim1Color:[0,1,.5],mim1Halo:[0,1,0],mim2Time:[0,1,.5],mim2Feedback:[0,1,.4],mim2Mix:[0,1,1],mim2Color:[0,1,.5],mim2Halo:[0,1,0],mim3Time:[0,1,.5],mim3Feedback:[0,1,.4],mim3Mix:[0,1,1],mim3Color:[0,1,.5],mim3Halo:[0,1,0],mim4Time:[0,1,.5],mim4Feedback:[0,1,.4],mim4Mix:[0,1,1],mim4Color:[0,1,.5],mim4Halo:[0,1,0],reverbSize:[0,1,.5],reverbDamping:[0,1,.5],reverbWidth:[0,1,1],reverbWetLevel:[0,1,.3],masterSaturation:[0,1,0],masterTone:[-10,10,0],lfo1Rate:[.01,30,1],lfo1Depth:[0,1,1],lfo1Phase:[0,1,0],lfo2Rate:[.01,30,.5],lfo2Depth:[0,1,1],lfo2Phase:[0,1,0],lfo3Rate:[.01,30,2],lfo3Depth:[0,1,1],lfo3Phase:[0,1,0],lfo4Rate:[.01,30,4],lfo4Depth:[0,1,1],lfo4Phase:[0,1,0],random1Rate:[.01,1,.1],random1Smoothing:[0,1,.8],random2Rate:[.01,1,.07],random2Smoothing:[0,1,.9],env1Period:[.01,60,1],env1Depth:[0,1,1],env1Phase:[0,1,0],env2Period:[.01,60,1],env2Depth:[0,1,1],env2Phase:[0,1,0],env3Period:[.01,60,1],env3Depth:[0,1,1],env3Phase:[0,1,0],env4Period:[.01,60,1],env4Depth:[0,1,1],env4Phase:[0,1,0],env5Period:[.01,60,1],env5Depth:[0,1,1],env5Phase:[0,1,0],env6Period:[0,60,1],env6Depth:[0,1,1],env6Phase:[0,1,0]};function Xv(m,a){if(!m.trackTarget&&!m.trackId)return!0;if(m.trackId)return m.trackId===a;if(m.trackTarget==="all")return!0;const l=parseInt(a.replace(/^track-?/,""),10);return m.trackTarget===l}class Zv{routes=new Map;globalDepth=1;enabled=!0;nextRouteId=1;lfoManager=null;envelopeManager=null;constructor(a,l){this.lfoManager=a??null,this.envelopeManager=l??null}setLFOManager(a){this.lfoManager=a}setEnvelopeManager(a){this.envelopeManager=a}addRoute(a){const l=`route_${this.nextRouteId++}`;return this.routes.set(l,{...a,id:l}),l}removeRoute(a){return this.routes.delete(a)}updateRoute(a,l){const s=this.routes.get(a);return s?(Object.assign(s,l),!0):!1}getAllRoutes(){return Array.from(this.routes.values())}getRoutesForDestination(a,l){return this.getAllRoutes().filter(s=>!(s.destination!==a||l&&!Xv(s,l)))}getRoutesFromSource(a){return this.getAllRoutes().filter(l=>l.source===a)}getSourceValue(a,l){let s=0;switch(a){case"lfo1":s=this.lfoManager?.getValue(0,l)??0;break;case"lfo2":s=this.lfoManager?.getValue(1,l)??0;break;case"lfo3":s=this.lfoManager?.getValue(2,l)??0;break;case"lfo4":s=this.lfoManager?.getValue(3,l)??0;break;case"random1":s=this.lfoManager?.getSlowRandomValue(1,l)??0;break;case"random2":s=this.lfoManager?.getSlowRandomValue(2,l)??0;break;case"env1":s=this.envelopeManager?.getValue(0,l)??0,this.envelopeManager||console.log("[ModMatrix] No envelope manager!");break;case"env2":s=this.envelopeManager?.getValue(1,l)??0;break;case"env3":s=this.envelopeManager?.getValue(2,l)??0;break;case"env4":s=this.envelopeManager?.getValue(3,l)??0;break;case"env5":s=this.envelopeManager?.getValue(4,l)??0;break;case"env6":s=this.envelopeManager?.getValue(5,l)??0;break;case"velocity":case"aftertouch":case"modWheel":s=0;break;default:s=0}return s}getModulationValue(a,l,s,u){if(!this.enabled)return 0;const h=this.getRoutesForDestination(a,s);if(h.length===0)return 0;const p=kc[a];if(!p)return 0;const[f,g]=p,b=g-f;let M=0;for(const S of h){const y=this.getSourceValue(S.source,l),j=y*S.depth*this.globalDepth;M+=j,S.source.startsWith("env")&&a==="oceanPosition"&&console.log(`[ModMatrix] ${S.source} -> ${a}: sourceValue=${y.toFixed(3)}, depth=${S.depth}, contribution=${j.toFixed(3)}`)}return M*b*.5}applyModulation(a,l,s,u){const h=kc[a];if(!h)return l;const p=this.getModulationValue(a,s,u,l),[f,g]=h;return Math.max(f,Math.min(g,l+p))}getModulatedParams(a,l,s){const u={...a};for(const h of Object.keys(a)){const p=h;kc[p]&&this.getRoutesForDestination(p,s).length>0&&(u[h]=this.applyModulation(p,a[h],l,s))}return u}setGlobalDepth(a){this.globalDepth=Math.max(0,Math.min(2,a))}getGlobalDepth(){return this.globalDepth}setEnabled(a){this.enabled=a}isEnabled(){return this.enabled}clearAllRoutes(){this.routes.clear(),this.nextRouteId=1}clearTrackRoutes(a){for(const[l,s]of this.routes)s.trackId===a&&this.routes.delete(l)}getState(){return{routes:this.getAllRoutes(),globalDepth:this.globalDepth,enabled:this.enabled}}setState(a){this.routes.clear(),this.nextRouteId=1;for(const l of a.routes){this.routes.set(l.id,l);const s=parseInt(l.id.replace("route_",""),10);!isNaN(s)&&s>=this.nextRouteId&&(this.nextRouteId=s+1)}this.globalDepth=a.globalDepth,this.enabled=a.enabled}}const ld={subtleWobble:[{source:"lfo1",destination:"pitch",depth:.02},{source:"lfo2",destination:"filterCutoff",depth:.1}],tremoloFilter:[{source:"lfo1",destination:"filterCutoff",depth:.3},{source:"random1",destination:"filterCutoff",depth:.1}],fmSweep:[{source:"lfo1",destination:"op1Index",depth:.4},{source:"lfo2",destination:"op2Index",depth:.3}],chaosFilter:[{source:"lfo3",destination:"filterCutoff",depth:.5},{source:"random1",destination:"filterResonance",depth:.3},{source:"random2",destination:"filterCutoff",depth:.2}],spaceDrift:[{source:"random1",destination:"reverbSize",depth:.2},{source:"random2",destination:"mim1Feedback",depth:.15},{source:"lfo1",destination:"pan",depth:.3}],rhythmicGate:[{source:"lfo4",destination:"volume",depth:.8}],organicMovement:[{source:"random1",destination:"pitch",depth:.01},{source:"random2",destination:"op1Index",depth:.15},{source:"lfo1",destination:"filterCutoff",depth:.2}],metaModulation:[{source:"env1",destination:"lfo1Rate",depth:.5},{source:"random1",destination:"lfo2Depth",depth:.3}],sendSweep:[{source:"lfo1",destination:"delaySend1",depth:.4},{source:"lfo2",destination:"delaySend2",depth:.3},{source:"env1",destination:"reverbSend",depth:.5}],saturationPulse:[{source:"lfo3",destination:"saturationDrive",depth:.6},{source:"random1",destination:"saturationBias",depth:.2}],mimeophonDrift:[{source:"random1",destination:"mim1Time",depth:.1},{source:"random2",destination:"mim1Color",depth:.2},{source:"lfo1",destination:"mim1Halo",depth:.3}]};class Kv{seed;constructor(a){this.seed=a??Math.floor(Math.random()*2147483647)}getSeed(){return this.seed}setSeed(a){this.seed=a}random(){let a=this.seed+=1831565813;return a=Math.imul(a^a>>>15,a|1),a^=a+Math.imul(a^a>>>7,a|61),((a^a>>>14)>>>0)/4294967296}range(a,l){return a+this.random()*(l-a)}rangeInt(a,l){return Math.floor(this.range(a,l+1))}gaussian(a=0,l=1){const s=this.random(),u=this.random();return Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*u)*l+a}pick(a){return a[this.rangeInt(0,a.length-1)]}shuffle(a){const l=[...a];for(let s=l.length-1;s>0;s--){const u=this.rangeInt(0,s);[l[s],l[u]]=[l[u],l[s]]}return l}}const Kp={pitch:{min:20,max:2e3,subtle:[.95,1.05],moderate:[.7,1.4],extreme:[.3,3]},pitchEnvAmount:{min:1,max:16,subtle:[.9,1.1],moderate:[.5,2],extreme:[.25,4]},pitchEnvDecay:{min:.001,max:1,subtle:[.9,1.1],moderate:[.5,2],extreme:[.2,5]},op1Ratio:{min:.1,max:16,subtle:[.98,1.02],moderate:[.8,1.25],extreme:[.5,2]},op1Index:{min:0,max:20,subtle:[.9,1.1],moderate:[.6,1.5],extreme:[.2,3]},op1Feedback:{min:0,max:1,subtle:[.95,1.05],moderate:[.7,1.4],extreme:[0,2]},op2Ratio:{min:.1,max:16,subtle:[.98,1.02],moderate:[.8,1.25],extreme:[.5,2]},op2Index:{min:0,max:20,subtle:[.9,1.1],moderate:[.6,1.5],extreme:[.2,3]},op2ToOp1:{min:0,max:1,subtle:[.95,1.05],moderate:[.7,1.4],extreme:[0,2]},ampAttack:{min:.001,max:.5,subtle:[.9,1.1],moderate:[.5,2],extreme:[.2,5]},ampDecay:{min:.01,max:5,subtle:[.9,1.1],moderate:[.6,1.6],extreme:[.3,3]},ampCurve:{min:0,max:2,subtle:[1,1],moderate:[1,1],extreme:[0,3]},noiseMix:{min:0,max:1,subtle:[.95,1.05],moderate:[.7,1.4],extreme:[0,2]},noiseDecay:{min:.01,max:2,subtle:[.9,1.1],moderate:[.6,1.6],extreme:[.3,3]},noiseFilterFreq:{min:100,max:1e4,subtle:[.95,1.05],moderate:[.7,1.4],extreme:[.3,3]},gain:{min:0,max:1,subtle:[.95,1.05],moderate:[.8,1.2],extreme:[.5,1.5]}},Jv={op1Ratio:{min:.1,max:16,subtle:[.98,1.02],moderate:[.8,1.25],extreme:[.5,2]},op2Ratio:{min:.1,max:16,subtle:[.98,1.02],moderate:[.8,1.25],extreme:[.5,2]},op3Ratio:{min:.1,max:16,subtle:[.98,1.02],moderate:[.8,1.25],extreme:[.5,2]},op2Index:{min:0,max:20,subtle:[.9,1.1],moderate:[.6,1.5],extreme:[.2,3]},op3Index:{min:0,max:20,subtle:[.9,1.1],moderate:[.6,1.5],extreme:[.2,3]},ampAttack:{min:.001,max:2,subtle:[.9,1.1],moderate:[.5,2],extreme:[.2,5]},ampDecay:{min:.01,max:3,subtle:[.9,1.1],moderate:[.6,1.6],extreme:[.3,3]},ampSustain:{min:0,max:1,subtle:[.95,1.05],moderate:[.8,1.2],extreme:[.5,1.5]},ampRelease:{min:.01,max:5,subtle:[.9,1.1],moderate:[.6,1.6],extreme:[.3,3]},filterFreq:{min:20,max:2e4,subtle:[.95,1.05],moderate:[.7,1.4],extreme:[.3,3]},filterQ:{min:.1,max:30,subtle:[.95,1.05],moderate:[.7,1.4],extreme:[.3,3]},filterEnvAmount:{min:0,max:1,subtle:[.9,1.1],moderate:[.6,1.5],extreme:[0,2]},indexEnvAmount:{min:0,max:1,subtle:[.9,1.1],moderate:[.6,1.5],extreme:[0,2]},glideTime:{min:0,max:1,subtle:[.95,1.05],moderate:[.7,1.4],extreme:[0,2]},gain:{min:0,max:1,subtle:[.95,1.05],moderate:[.8,1.2],extreme:[.5,1.5]}},$v={attack:{min:.001,max:.1,subtle:[.9,1.1],moderate:[.5,2],extreme:[.2,5]},decay:{min:.001,max:2,subtle:[.9,1.1],moderate:[.6,1.6],extreme:[.3,3]},filterFreq:{min:100,max:15e3,subtle:[.95,1.05],moderate:[.7,1.4],extreme:[.3,3]},filterQ:{min:.1,max:20,subtle:[.95,1.05],moderate:[.7,1.4],extreme:[.3,3]},metallicRatio1:{min:.5,max:5,subtle:[.95,1.05],moderate:[.7,1.4],extreme:[.3,3]},metallicRatio2:{min:.5,max:5,subtle:[.95,1.05],moderate:[.7,1.4],extreme:[.3,3]},metallicIndex:{min:0,max:10,subtle:[.9,1.1],moderate:[.6,1.5],extreme:[.2,3]},metallicGain:{min:0,max:1,subtle:[.95,1.05],moderate:[.7,1.4],extreme:[0,2]},clickFreq:{min:100,max:5e3,subtle:[.95,1.05],moderate:[.7,1.4],extreme:[.3,3]},clickDecay:{min:.001,max:.02,subtle:[.9,1.1],moderate:[.6,1.6],extreme:[.3,3]},gain:{min:0,max:1,subtle:[.95,1.05],moderate:[.8,1.2],extreme:[.5,1.5]}},Wv={enabled:!1,amount:.02,rateHz:20,parameters:["pitch","op1Index","op2Index","filterCutoff"]};class Iv{rng;microJitter;jitterValues=new Map;lastJitterUpdate=0;constructor(a){this.rng=new Kv(a),this.microJitter={...Wv}}get seed(){return this.rng.getSeed()}set seed(a){this.rng.setSeed(a)}newSeed(){const a=Math.floor(Math.random()*2147483647);return this.rng.setSeed(a),a}setMicroJitter(a){this.microJitter={...this.microJitter,...a}}getMicroJitter(){return{...this.microJitter}}updateJitter(a){if(!this.microJitter.enabled)return;const l=1/this.microJitter.rateHz;if(!(a-this.lastJitterUpdate<l)){this.lastJitterUpdate=a;for(const s of this.microJitter.parameters){const u=this.rng.gaussian(0,this.microJitter.amount);this.jitterValues.set(s,u)}}}getJitter(a){return this.microJitter.enabled?this.jitterValues.get(a)??0:0}applyJitter(a,l){const s=this.getJitter(a);return l*(1+s)}mutateFMDrum(a,l="moderate",s=[]){const u={...a};for(const[h,p]of Object.entries(Kp)){if(s.includes(h))continue;const f=h,g=a[f];if(typeof g!="number")continue;const[b,M]=p[l],S=this.rng.range(b,M);let y=g*S;y=Math.max(p.min,Math.min(p.max,y)),u[f]=y}return u}mutateFMMelodic(a,l="moderate",s=[]){const u={...a};for(const[h,p]of Object.entries(Jv)){if(!p||s.includes(h))continue;const f=h,g=a[f];if(typeof g!="number")continue;const[b,M]=p[l],S=this.rng.range(b,M);let y=g*S;y=Math.max(p.min,Math.min(p.max,y)),u[f]=y}return u}mutateNoiseVoice(a,l="moderate",s=[]){const u={...a};for(const[h,p]of Object.entries($v)){if(!p||s.includes(h))continue;const f=h,g=a[f];if(typeof g!="number")continue;const[b,M]=p[l],S=this.rng.range(b,M);let y=g*S;y=Math.max(p.min,Math.min(p.max,y)),u[f]=y}return u}randomFMDrum(a="moderate"){const l={};for(const[s,u]of Object.entries(Kp)){const[h,p]=u[a],f=(u.min+u.max)/2,g=f*h,b=f*p;let M=this.rng.range(g,b);M=Math.max(u.min,Math.min(u.max,M)),l[s]=M}return l}randomizeScene(a,l,s="moderate"){const u=new Map;for(const[h,p]of a){const f=l.get(h);let g;switch(f){case"fm-drum":g=this.mutateFMDrum(p,s);break;case"fm-melodic":g=this.mutateFMMelodic(p,s);break;case"noise":g=this.mutateNoiseVoice(p,s);break;default:g=p}u.set(h,g)}return u}randomizeStepProbabilities(a,l=.5,s=.3){const u=[];for(let h=0;h<a;h++){let p=l+this.rng.gaussian(0,s);p=Math.max(0,Math.min(1,p)),u.push(p)}return u}randomizePattern(a,l=.5,s={}){const u=[],{emphasizeDownbeats:h=!0,maxConsecutive:p=4,minGap:f=0}=s;let g=0,b=f;for(let M=0;M<a;M++){let S=l;h&&M%4===0&&(S*=1.5),g>=p&&(S*=.2),b<f&&(S=0,b++);const y=this.rng.random()<S;y?(g++,b=0):(g=0,b++),u.push(y)}return u}getState(){return{seed:this.rng.getSeed(),microJitter:{...this.microJitter}}}setState(a){this.rng.setSeed(a.seed),this.microJitter={...a.microJitter}}}class Jp{audioContext;sourceNode;processorNode=null;recordedChunks=[];recordedChunksRight=[];_isRecording=!1;startTime=0;sampleRate;stateListeners=new Set;constructor(a,l){this.audioContext=a,this.sourceNode=l,this.sampleRate=a.sampleRate}get isRecording(){return this._isRecording}get duration(){return this._isRecording?this.audioContext.currentTime-this.startTime:0}get sampleCount(){return this.recordedChunks.reduce((a,l)=>a+l.length,0)}start(){if(this._isRecording)return;this.recordedChunks=[],this.recordedChunksRight=[];const a=4096;this.processorNode=this.audioContext.createScriptProcessor(a,2,2),this.sourceNode.connect(this.processorNode),this.processorNode.connect(this.audioContext.destination),this.processorNode.onaudioprocess=l=>{if(!this._isRecording)return;const s=l.inputBuffer.getChannelData(0),u=l.inputBuffer.getChannelData(1);this.recordedChunks.push(new Float32Array(s)),this.recordedChunksRight.push(new Float32Array(u)),this.notifyListeners()},this._isRecording=!0,this.startTime=this.audioContext.currentTime,this.notifyListeners()}stop(){if(!this._isRecording)return null;if(this._isRecording=!1,this.processorNode&&(this.sourceNode.disconnect(this.processorNode),this.processorNode.disconnect(),this.processorNode=null),this.recordedChunks.length===0)return this.notifyListeners(),null;const a=this.sampleCount,l=new Float32Array(a),s=new Float32Array(a);let u=0;for(let p=0;p<this.recordedChunks.length;p++)l.set(this.recordedChunks[p],u),s.set(this.recordedChunksRight[p],u),u+=this.recordedChunks[p].length;const h=this.encodeWAV(l,s);return this.notifyListeners(),h}cancel(){this._isRecording&&(this._isRecording=!1,this.processorNode&&(this.sourceNode.disconnect(this.processorNode),this.processorNode.disconnect(),this.processorNode=null),this.recordedChunks=[],this.recordedChunksRight=[],this.notifyListeners())}onStateChange(a){return this.stateListeners.add(a),()=>this.stateListeners.delete(a)}notifyListeners(){const a={isRecording:this._isRecording,duration:this.duration,sampleCount:this.sampleCount};for(const l of this.stateListeners)l(a)}encodeWAV(a,l){const u=this.sampleRate,h=16,f=2*(h/8),g=u*f,b=a.length,M=b*f,S=new ArrayBuffer(44+M),y=new DataView(S);this.writeString(y,0,"RIFF"),y.setUint32(4,36+M,!0),this.writeString(y,8,"WAVE"),this.writeString(y,12,"fmt "),y.setUint32(16,16,!0),y.setUint16(20,1,!0),y.setUint16(22,2,!0),y.setUint32(24,u,!0),y.setUint32(28,g,!0),y.setUint16(32,f,!0),y.setUint16(34,h,!0),this.writeString(y,36,"data"),y.setUint32(40,M,!0);let j=44;for(let C=0;C<b;C++){const B=Math.max(-1,Math.min(1,a[C])),G=Math.max(-1,Math.min(1,l[C]));y.setInt16(j,B<0?B*32768:B*32767,!0),y.setInt16(j+2,G<0?G*32768:G*32767,!0),j+=4}return new Blob([S],{type:"audio/wav"})}writeString(a,l,s){for(let u=0;u<s.length;u++)a.setUint8(l+u,s.charCodeAt(u))}static downloadWAV(a,l){const s=l??`tQr4x-recording-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.wav`,u=URL.createObjectURL(a),h=document.createElement("a");h.href=u,h.download=s,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(u)}dispose(){this.cancel(),this.stateListeners.clear()}}const eg="1.0.0";function tg(m,a){const l=Bc[m.root],s=m.scale,u=new Date().toISOString().slice(0,19).replace(/[T:]/g,"-");return`${l}_${s}_${a}bpm_${u}`}function ag(m){if(typeof m!="object"||m===null)return!1;const a=m;return!(typeof a.version!="string"||typeof a.name!="string"||typeof a.bpm!="number"||typeof a.swing!="number"||!Array.isArray(a.tracks)||!Array.isArray(a.voiceConfigs)||!Array.isArray(a.channelParams)||!Array.isArray(a.lfoParams)||!Array.isArray(a.modRoutes))}function ig(m){const a=JSON.stringify(m,null,2),l=new Blob([a],{type:"application/json"}),s=URL.createObjectURL(l),u=document.createElement("a");u.href=s,u.download=`${m.name}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(s)}function ng(m){return new Promise((a,l)=>{const s=new FileReader;s.onload=u=>{try{const h=u.target?.result,p=JSON.parse(h);if(!ag(p)){l(new Error("Invalid preset file format"));return}a(p)}catch(h){l(new Error(`Failed to parse preset file: ${h}`))}},s.onerror=()=>{l(new Error("Failed to read preset file"))},s.readAsText(m)})}function lg(){return{...Gc}}function sg(){return{rate1:.1,rate2:.07,smoothing1:.8,smoothing2:.9}}class og{audioContext=null;clock=null;sequencer=null;voiceManager=null;mixer=null;_state="uninitialized";_bpm=120;_swing=0;_ppqn=96;isManualPatternSwitch=!1;clickGain=null;lfoManager=null;envelopeManager=null;modMatrix=null;randomizer=null;recorder=null;recorderListeners=new Set;stepClipboard=null;clipboardListeners=new Set;stateListeners=new Set;tickListeners=new Set;get state(){return this._state}get bpm(){return this._bpm}set bpm(a){this._bpm=Math.max(20,Math.min(300,a)),this.clock&&(this.clock.bpm=this._bpm),this.mixer&&this.mixer.setBpm(this._bpm),this.lfoManager&&this.lfoManager.setBpm(this._bpm),this.envelopeManager&&this.envelopeManager.setBpm(this._bpm)}get swing(){return this._swing}set swing(a){this._swing=Math.max(0,Math.min(1,a)),this.clock&&(this.clock.swing=this._swing)}get currentTime(){return this.audioContext?.currentTime??0}async init(){if(!(this._state==="ready"||this._state==="running"||this._state==="stopped")&&this._state!=="initializing"){this.setEngineState("initializing");try{this.audioContext=new AudioContext,this.clickGain=this.audioContext.createGain(),this.clickGain.gain.value=.3,this.clickGain.connect(this.audioContext.destination),this.clock=new N0(this.audioContext),await this.clock.init(),this.clock.bpm=this._bpm,this.clock.swing=this._swing,this.clock.onTick(l=>{for(const s of this.tickListeners)s(l)}),this.sequencer=new w0(this.clock),this.sequencer.onPatternSlotChange(l=>{this.isManualPatternSwitch||(this.captureCurrentSlotState(),this.applySlotState(l))}),this.mixer=new fv(this.audioContext),this.mixer.setBpm(this._bpm);const a="/tQr4x/";try{await this.audioContext.audioWorklet.addModule(`${a}filter-processors.js`),console.log("[Engine] Filter worklet processors registered"),await this.mixer.initFilterWorklets()}catch(l){console.error("[Engine] Failed to register filter worklet processors:",l)}this.voiceManager=new av(this.audioContext,(l,s)=>this.onTrigger(l,s),this.audioContext.destination),this.voiceManager.setMixer(this.mixer),this.lfoManager=new Nv,this.lfoManager.setBpm(this._bpm),this.envelopeManager=new Qv,this.envelopeManager.setBpm(this._bpm),this.modMatrix=new Zv(this.lfoManager,this.envelopeManager),this.randomizer=new Iv,this.voiceManager.setModMatrix(this.modMatrix);try{await aa.loadWoscillators(this.audioContext),console.log("[Engine] Plaits woscillators initialized")}catch(l){console.warn("[Engine] Failed to initialize Plaits woscillators:",l)}this.setEngineState("ready")}catch(a){throw this.setEngineState("uninitialized"),a}}}setEngineState(a){this._state=a;for(const l of this.stateListeners)l(a)}onStateChange(a){return this.stateListeners.add(a),()=>this.stateListeners.delete(a)}onTick(a){return this.tickListeners.add(a),()=>this.tickListeners.delete(a)}async start(){if(this._state==="uninitialized"&&await this.init(),this._state!=="ready"&&this._state!=="stopped")throw new Error(`Cannot start from state: ${this._state}`);this.audioContext?.state==="suspended"&&await this.audioContext.resume(),this.sequencer?.start(),this.clock?.start(),this.setEngineState("running")}stop(){this._state==="running"&&(this.clock?.stop(),this.sequencer?.stop(),ta.clearAllLatchedParams(),this.setEngineState("stopped"))}pause(){this._state==="running"&&(this.clock?.pause(),this.setEngineState("stopped"))}resume(){this._state==="stopped"&&(this.clock?.resume(),this.setEngineState("running"))}createTrack(a,l){return this.sequencer?.createTrack(a,l)??null}getTrack(a){return this.sequencer?.getTrack(a)}getAllTracks(){return this.sequencer?.getAllTracks()??[]}deleteTrack(a){this.sequencer?.deleteTrack(a)}setTrackStep(a,l,s){return this.sequencer?.setStep(a,l,s)??!1}getTrackStep(a,l){return this.sequencer?.getStep(a,l)??null}toggleTrackStep(a,l){return this.sequencer?.toggleStep(a,l)??!1}enterParamLockEditMode(a,l){ta.enterEditMode(a,l);const s=this.getTrackStep(a,l);s&&!s.paramLocks&&this.setTrackStep(a,l,{paramLocks:{},hasParamLocks:!1})}exitParamLockEditMode(){ta.exitEditMode()}toggleParamLockEditMode(a,l){return ta.toggleEditMode(a,l)}getParamLockEditState(){return ta.getEditState()}isStepInParamLockEditMode(a,l){return ta.isEditing(a,l)}onParamLockEditStateChange(a){return ta.onEditStateChange(a)}setStepParamLock(a,l,s,u){const h=this.getTrackStep(a,l);if(!h)return!1;const p={...h.paramLocks??{},[s]:u},f=Object.keys(p).length>0;return this.setTrackStep(a,l,{paramLocks:p,hasParamLocks:f})}removeStepParamLock(a,l,s){const u=this.getTrackStep(a,l);if(!u||!u.paramLocks)return!1;const h={...u.paramLocks};delete h[s];const p=Object.keys(h).length>0;return this.setTrackStep(a,l,{paramLocks:p?h:void 0,hasParamLocks:p})}clearStepParamLocks(a,l){return this.setTrackStep(a,l,{paramLocks:void 0,hasParamLocks:!1})}getStepParamLocks(a,l){return this.getTrackStep(a,l)?.paramLocks??null}stepHasParamLocks(a,l){return this.getTrackStep(a,l)?.hasParamLocks===!0}updateParameterWithPLockRouting(a,l,s,u){const h=ta.getEditState();h.isActive&&h.trackId===a?this.setStepParamLock(a,h.stepIndex,l,s):u()}triggerParamLockAudition(){const a=ta.getEditState();if(!a.isActive)return;const l=this.getTrackStep(a.trackId,a.stepIndex);if(!l)return;const s=this.currentTime+.01,u={trackId:a.trackId,time:s,velocity:l.velocity,step:a.stepIndex,isRatchet:!1,ratchetIndex:0,note:l.note,paramLocks:l.paramLocks,latchedParams:l.paramLocks},h=this.sequencer?.triggerCallbacks?.get(a.trackId);if(h)for(const p of h)p(u)}copyStep(a,l){const s=this.getTrackStep(a,l);if(!s)return!1;this.stepClipboard={...s,paramLocks:s.paramLocks?{...s.paramLocks}:void 0,condition:s.condition?{...s.condition}:void 0};for(const u of this.clipboardListeners)u(!0);return!0}pasteStep(a,l){if(!this.stepClipboard)return!1;const s={trigger:this.stepClipboard.trigger,velocity:this.stepClipboard.velocity,microTime:this.stepClipboard.microTime,probability:this.stepClipboard.probability,ratchets:this.stepClipboard.ratchets,note:this.stepClipboard.note,condition:this.stepClipboard.condition?{...this.stepClipboard.condition}:void 0,paramLocks:this.stepClipboard.paramLocks?{...this.stepClipboard.paramLocks}:void 0,hasParamLocks:this.stepClipboard.hasParamLocks};return this.setTrackStep(a,l,s)}hasStepInClipboard(){return this.stepClipboard!==null}getClipboardStep(){return this.stepClipboard?{...this.stepClipboard,paramLocks:this.stepClipboard.paramLocks?{...this.stepClipboard.paramLocks}:void 0,condition:this.stepClipboard.condition?{...this.stepClipboard.condition}:void 0}:null}clearClipboard(){this.stepClipboard=null;for(const a of this.clipboardListeners)a(!1)}onClipboardChange(a){return this.clipboardListeners.add(a),a(this.stepClipboard!==null),()=>this.clipboardListeners.delete(a)}getCurrentPattern(a){return this.sequencer?.getCurrentPattern(a)??null}setPatternLength(a,l){return this.sequencer?.setPatternLength(a,l)??!1}setPatternDivision(a,l){return this.sequencer?.setPatternDivision(a,l)??!1}getTrackStepPosition(a){return this.sequencer?.getTrackStepPosition(a)??0}getActivePatternSlot(){return this.sequencer?.getActivePatternSlot()??1}setActivePatternSlot(a){if(!this.sequencer)return!1;const l=this.sequencer.getActivePatternSlot();if(a===l)return!0;this.captureCurrentSlotState(),this.isManualPatternSwitch=!0;const s=this.sequencer.setActivePatternSlot(a);return this.isManualPatternSwitch=!1,s?(this.applySlotState(a),!0):!1}captureCurrentSlotState(){if(!this.sequencer||!this.voiceManager||!this.mixer)return;const a=this.sequencer.getActivePatternSlot(),l=this.sequencer.getAllTracks();for(const s of l){const u=this.voiceManager.getVoiceConfig(s.id);u&&this.sequencer.setSlotVoiceConfig(a,s.id,{voiceType:u.voiceType,preset:u.preset,params:u.params,note:u.note});const h=this.mixer.getChannelParams(s.id);h&&this.sequencer.setSlotChannelConfig(a,s.id,{filter:h.filter,saturation:h.saturation,delaySend:h.delaySend,delaySend2:h.delaySend2,delaySend3:h.delaySend3,delaySend4:h.delaySend4,reverbSend:h.reverbSend,volume:h.volume,pan:h.pan}),this.sequencer.setSlotPerformanceConfig(a,s.id,{performance:{...s.performance},clockConfig:{...s.clockConfig}})}this.captureSlotFXConfig(a)}applySlotState(a){if(!this.sequencer||!this.voiceManager||!this.mixer)return;const l=this.sequencer.getAllTracks();if(!this.sequencer.slotHasVoiceConfigs(a)){this.captureSlotStateFromCurrent(a);return}for(const s of l){const u=this.sequencer.getSlotVoiceConfig(a,s.id);u&&(this.voiceManager.assignVoice({trackId:s.id,voiceType:u.voiceType,preset:u.preset,params:u.params}),u.note!==void 0&&this.voiceManager.setTrackNote(s.id,u.note));const h=this.sequencer.getSlotChannelConfig(a,s.id);h&&this.mixer.updateChannel(s.id,{filter:h.filter,saturation:h.saturation,delaySend:h.delaySend,delaySend2:h.delaySend2,delaySend3:h.delaySend3,delaySend4:h.delaySend4,reverbSend:h.reverbSend,volume:h.volume,pan:h.pan});const p=this.sequencer.getSlotPerformanceConfig(a,s.id);p&&(this.sequencer.setTrackDrift(s.id,p.performance.drift),this.sequencer.setTrackFill(s.id,p.performance.fill),p.performance.octaveRange!==void 0&&this.sequencer.setTrackOctave(s.id,p.performance.octaveRange),this.sequencer.setTrackClockConfig(s.id,p.clockConfig))}this.applySlotFXConfig(a)}applySlotFXConfig(a){if(!this.sequencer||!this.mixer)return;const l=this.sequencer.getSlotFXConfig(a);l&&(this.mixer.setMimeophonParams(l.mimeophon1),this.mixer.setMimeophonParams2(l.mimeophon2),this.mixer.setMimeophonParams3(l.mimeophon3),this.mixer.setMimeophonParams4(l.mimeophon4),this.mixer.setReverbParams(l.reverb),this.mixer.setMasterParams(l.master),this.mixer.setMimeophonReturnLevel(l.returnLevels.mimeophon1),this.mixer.setMimeophonReturnLevel2(l.returnLevels.mimeophon2),this.mixer.setMimeophonReturnLevel3(l.returnLevels.mimeophon3),this.mixer.setMimeophonReturnLevel4(l.returnLevels.mimeophon4),this.mixer.setReverbReturnLevel(l.returnLevels.reverb),this.mixer.setFXCrossSends(l.crossSends))}captureSlotStateFromCurrent(a){if(!this.sequencer||!this.voiceManager||!this.mixer)return;const l=this.sequencer.getAllTracks();for(const s of l){const u=this.voiceManager.getVoiceConfig(s.id);u&&this.sequencer.setSlotVoiceConfig(a,s.id,{voiceType:u.voiceType,preset:u.preset,params:u.params,note:u.note});const h=this.mixer.getChannelParams(s.id);h&&this.sequencer.setSlotChannelConfig(a,s.id,{filter:h.filter,saturation:h.saturation,delaySend:h.delaySend,delaySend2:h.delaySend2,delaySend3:h.delaySend3,delaySend4:h.delaySend4,reverbSend:h.reverbSend,volume:h.volume,pan:h.pan}),this.sequencer.setSlotPerformanceConfig(a,s.id,{performance:{...s.performance},clockConfig:{...s.clockConfig}})}this.captureSlotFXConfig(a)}captureSlotFXConfig(a){if(!this.sequencer||!this.mixer)return;const l=this.mixer.getMimeophon().getParams(),s=this.mixer.getMimeophon2().getParams(),u=this.mixer.getMimeophon3().getParams(),h=this.mixer.getMimeophon4().getParams(),p=this.mixer.getReverb().getParams(),f=this.mixer.getMasterBus().getParams(),g=this.mixer.getFXCrossSends(),b={mimeophon1:{...l},mimeophon2:{...s},mimeophon3:{...u},mimeophon4:{...h},reverb:{...p},master:{...f},returnLevels:{mimeophon1:this.mixer.getMimeophonReturnLevel(),mimeophon2:this.mixer.getMimeophonReturnLevel2(),mimeophon3:this.mixer.getMimeophonReturnLevel3(),mimeophon4:this.mixer.getMimeophonReturnLevel4(),reverb:this.mixer.getReverbReturnLevel()},crossSends:{...g}};this.sequencer.setSlotFXConfig(a,b)}onPatternSlotChange(a){return this.sequencer?.onPatternSlotChange(a)??(()=>{})}isPatternSlotEmpty(a){return this.sequencer?.isPatternSlotEmpty(a)??!0}clearPatternSlot(a){return this.sequencer?.clearPatternSlot(a)??!1}copyPatternSlot(a,l){if(!this.sequencer)return!1;const s=this.sequencer.getActivePatternSlot(),u=p=>{if(a===s){const f=this.voiceManager?.getVoiceConfig(p);return f?{voiceType:f.voiceType,preset:f.preset,params:f.params,note:f.note}:null}else{const f=this.sequencer.getSlotVoiceConfig(a,p);if(!f){const g=this.voiceManager?.getVoiceConfig(p);return g?{voiceType:g.voiceType,preset:g.preset,params:g.params,note:g.note}:null}return f}},h=p=>{if(a===s){const f=this.mixer?.getChannelParams(p);return f?{filter:f.filter,saturation:f.saturation,delaySend:f.delaySend,delaySend2:f.delaySend2,delaySend3:f.delaySend3,delaySend4:f.delaySend4,reverbSend:f.reverbSend,volume:f.volume,pan:f.pan}:null}else{const f=this.sequencer.getSlotChannelConfig(a,p);if(!f){const g=this.mixer?.getChannelParams(p);return g?{filter:g.filter,saturation:g.saturation,delaySend:g.delaySend,delaySend2:g.delaySend2,delaySend3:g.delaySend3,delaySend4:g.delaySend4,reverbSend:g.reverbSend,volume:g.volume,pan:g.pan}:null}return f}};return this.sequencer.copyPatternSlot(a,l,u,h)}pastePatternSlot(a){if(!this.sequencer)return!1;const l=this.sequencer.getActivePatternSlot(),s=a===l;return this.sequencer.pastePatternSlot(a,(h,p)=>{this.sequencer.setSlotVoiceConfig(a,h,{voiceType:p.voiceType,preset:p.preset,params:p.params,note:p.note}),s&&(this.voiceManager?.assignVoice({trackId:h,voiceType:p.voiceType,preset:p.preset,params:p.params}),p.note!==void 0&&this.voiceManager?.setTrackNote(h,p.note))},(h,p)=>{this.sequencer.setSlotChannelConfig(a,h,{filter:p.filter,saturation:p.saturation,delaySend:p.delaySend,delaySend2:p.delaySend2,delaySend3:p.delaySend3,delaySend4:p.delaySend4,reverbSend:p.reverbSend,volume:p.volume,pan:p.pan}),s&&this.mixer?.updateChannel(h,{filter:p.filter,saturation:p.saturation,delaySend:p.delaySend,delaySend2:p.delaySend2,delaySend3:p.delaySend3,delaySend4:p.delaySend4,reverbSend:p.reverbSend,volume:p.volume,pan:p.pan})})}hasPatternClipboard(){return this.sequencer?.hasPatternClipboard()??!1}getPatternClipboardMode(){return this.sequencer?.getPatternClipboardMode()??null}clearPatternClipboard(){this.sequencer?.clearPatternClipboard()}getPatternForSlot(a,l){return this.sequencer?.getPatternForSlot(a,l)??null}setPatternSequencerEnabled(a){this.sequencer?.setPatternSequencerEnabled(a)}isPatternSequencerEnabled(){return this.sequencer?.isPatternSequencerEnabled()??!1}setPatternSequencerCell(a,l,s=1){return this.sequencer?.setPatternSequencerCell(a,l,s)??!1}clearPatternSequencerCell(a){return this.sequencer?.clearPatternSequencerCell(a)??!1}getPatternSequencerCell(a){return this.sequencer?.getPatternSequencerCell(a)??null}getPatternSequencerCells(){return this.sequencer?.getPatternSequencerCells()??[]}getPatternSequencerState(){return this.sequencer?.getPatternSequencerState()??{enabled:!1,cells:Array(16).fill(null).map(()=>({patternSlot:null,cycles:1})),currentCell:0,cyclesRemaining:0}}onPatternSequencerChange(a){return this.sequencer?.onPatternSequencerChange(a)??(()=>{})}resetPatternSequencer(){this.sequencer?.resetPatternSequencer()}clearPatternSequencer(){this.sequencer?.clearPatternSequencer()}onTrigger(a,l){return this.sequencer?.onTrigger(a,l)??(()=>{})}assignVoice(a){this.voiceManager?.assignVoice(a),this.saveVoiceConfigToCurrentSlot(a.trackId)}removeVoice(a){this.voiceManager?.removeVoice(a)}getVoiceConfig(a){return this.voiceManager?.getVoiceConfig(a)??null}getVoice(a){return this.voiceManager?.getVoice(a)??null}updateVoiceParams(a,l){this.voiceManager?.updateVoiceParams(a,l),this.saveVoiceConfigToCurrentSlot(a)}loadVoicePreset(a,l){this.voiceManager?.loadPreset(a,l),this.saveVoiceConfigToCurrentSlot(a)}setTrackNote(a,l){this.voiceManager?.setTrackNote(a,l),this.saveVoiceConfigToCurrentSlot(a)}getVoicePresets(a){return this.voiceManager?.getPresetsForType(a)??[]}saveVoiceConfigToCurrentSlot(a){if(!this.sequencer||!this.voiceManager)return;const l=this.sequencer.getActivePatternSlot(),s=this.voiceManager.getVoiceConfig(a);s&&this.sequencer.setSlotVoiceConfig(l,a,{voiceType:s.voiceType,preset:s.preset,params:s.params,note:s.note})}setTrackDrift(a,l){this.sequencer?.setTrackDrift(a,l)}setTrackFill(a,l){this.sequencer?.setTrackFill(a,l)}setTrackOctave(a,l){this.sequencer?.setTrackOctave(a,l)}getTrackOctave(a){return this.sequencer?.getTrackOctave(a)}setTrackScale(a,l){this.sequencer?.setTrackScale(a,l)}setGlobalScale(a){this.sequencer?.setGlobalScale(a)}getTrackPerformance(a){return this.sequencer?.getTrackPerformance(a)??null}getTrackScale(a){return this.sequencer?.getTrackScale(a)}getGlobalScale(){return this.sequencer?.getGlobalScale()}setTrackClockConfig(a,l){this.sequencer?.setTrackClockConfig(a,l)}getTrackClockConfig(a){return this.sequencer?.getTrackClockConfig(a)??null}resyncTrack(a){this.sequencer?.resyncTrack(a)}resyncAllTracks(){this.sequencer?.resyncAllTracks()}getChannelParams(a){return this.mixer?.getChannelParams(a)??null}updateChannelParams(a,l){this.mixer?.updateChannel(a,l),this.saveChannelConfigToCurrentSlot(a),this.voiceManager?.captureBaseChannelState(a)}saveChannelConfigToCurrentSlot(a){if(!this.sequencer||!this.mixer)return;const l=this.sequencer.getActivePatternSlot(),s=this.mixer.getChannelParams(a);s&&this.sequencer.setSlotChannelConfig(l,a,{filter:s.filter,saturation:s.saturation,delaySend:s.delaySend,delaySend2:s.delaySend2,delaySend3:s.delaySend3,delaySend4:s.delaySend4,reverbSend:s.reverbSend,volume:s.volume,pan:s.pan})}captureBaseChannelState(a){this.voiceManager?.captureBaseChannelState(a)}restoreToBaseChannelState(a){this.voiceManager?.restoreToBaseState(a)}getBaseFilterType(a){return this.voiceManager?.getBaseChannelState(a)?.filterType??"bypass"}getMimeophonParams(){return this.mixer?.getMimeophon().getParams()??null}getMimeophonParams2(){return this.mixer?.getMimeophon2().getParams()??null}getMimeophonParams3(){return this.mixer?.getMimeophon3().getParams()??null}getMimeophonParams4(){return this.mixer?.getMimeophon4().getParams()??null}setMimeophonParams(a){this.mixer?.setMimeophonParams(a)}setMimeophonParams2(a){this.mixer?.setMimeophonParams2(a)}setMimeophonParams3(a){this.mixer?.setMimeophonParams3(a)}setMimeophonParams4(a){this.mixer?.setMimeophonParams4(a)}getReverbParams(){return this.mixer?.getReverb().getParams()??null}setReverbParams(a){this.mixer?.setReverbParams(a)}getMasterParams(){return this.mixer?.getMasterBus().getParams()??null}setMasterParams(a){this.mixer?.setMasterParams(a)}getMimeophonReturnLevel(){return this.mixer?.getMimeophonReturnLevel()??1}getMimeophonReturnLevel2(){return this.mixer?.getMimeophonReturnLevel2()??1}getMimeophonReturnLevel3(){return this.mixer?.getMimeophonReturnLevel3()??1}getMimeophonReturnLevel4(){return this.mixer?.getMimeophonReturnLevel4()??1}setMimeophonReturnLevel(a){this.mixer?.setMimeophonReturnLevel(a)}setMimeophonReturnLevel2(a){this.mixer?.setMimeophonReturnLevel2(a)}setMimeophonReturnLevel3(a){this.mixer?.setMimeophonReturnLevel3(a)}setMimeophonReturnLevel4(a){this.mixer?.setMimeophonReturnLevel4(a)}getReverbReturnLevel(){return this.mixer?.getReverbReturnLevel()??1}setReverbReturnLevel(a){this.mixer?.setReverbReturnLevel(a)}getFXCrossSends(){return this.mixer?.getFXCrossSends()??{mim1ToMim2:0,mim1ToMim3:0,mim1ToMim4:0,mim1ToReverb:0,mim2ToMim1:0,mim2ToMim3:0,mim2ToMim4:0,mim2ToReverb:0,mim3ToMim1:0,mim3ToMim2:0,mim3ToMim4:0,mim3ToReverb:0,mim4ToMim1:0,mim4ToMim2:0,mim4ToMim3:0,mim4ToReverb:0,reverbToMim1:0,reverbToMim2:0,reverbToMim3:0,reverbToMim4:0}}setFXCrossSends(a){this.mixer?.setFXCrossSends(a)}getLimiterGainReduction(){return this.mixer?.getLimiterGainReduction()??0}getLFOParams(){return this.lfoManager?this.lfoManager.getState().lfos:[]}getLFOParam(a){return this.lfoManager?.getLFO(a)?.getParams()??null}setLFOParams(a,l){this.lfoManager?.setLFOParams(a,l)}getSlowRandomParams(){return this.lfoManager?this.lfoManager.getState().slowRandom:{rate1:.1,rate2:.07,smoothing1:.8,smoothing2:.9}}setSlowRandomParams(a,l,s){this.lfoManager?.setSlowRandomParams(a,l,s)}getEnvModParams(){return this.envelopeManager?this.envelopeManager.getState().envelopes:[]}getEnvModParam(a){return this.envelopeManager?.getEnvelope(a)?.getParams()??null}setEnvModParams(a,l){this.envelopeManager?.setEnvelopeParams(a,l)}getModRoutes(){return this.modMatrix?.getAllRoutes()??[]}addModRoute(a){return this.modMatrix?.addRoute(a)??""}updateModRoute(a,l){return this.modMatrix?.updateRoute(a,l)??!1}removeModRoute(a){return this.modMatrix?.removeRoute(a)??!1}loadModPreset(a){const l=ld[a];if(!(!l||!this.modMatrix)){this.modMatrix.clearAllRoutes();for(const s of l)this.modMatrix.addRoute(s)}}getGlobalModDepth(){return this.modMatrix?.getGlobalDepth()??1}setGlobalModDepth(a){this.modMatrix?.setGlobalDepth(a)}isModEnabled(){return this.modMatrix?.isEnabled()??!1}setModEnabled(a){this.modMatrix?.setEnabled(a)}getModState(){return!this.lfoManager||!this.modMatrix?null:{lfos:this.lfoManager.getState(),matrix:this.modMatrix.getState()}}setModState(a){this.lfoManager?.setState(a.lfos),this.modMatrix?.setState(a.matrix)}getLFOValues(){return!this.lfoManager||!this.audioContext?{lfo1:0,lfo2:0,lfo3:0,lfo4:0,random1:0,random2:0}:this.lfoManager.getAllValues(this.audioContext.currentTime)}mutateTrack(a,l){if(!this.randomizer||!this.voiceManager)return;const s=this.voiceManager.getVoiceConfig(a);if(!s||!s.params)return;let u;switch(s.voiceType){case"fm-drum":u=this.randomizer.mutateFMDrum(s.params,l);break;case"fm-melodic":u=this.randomizer.mutateFMMelodic(s.params,l);break;case"noise":u=this.randomizer.mutateNoiseVoice(s.params,l);break;default:return}this.voiceManager.updateVoiceParams(a,u)}randomizeScene(a){if(!this.randomizer||!this.voiceManager)return;const l=this.getAllTracks();for(const s of l)this.mutateTrack(s.id,a)}getMicroJitter(){return this.randomizer?.getMicroJitter()??{enabled:!1,amount:.02,rateHz:20,parameters:["pitch","op1Index","op2Index","filterCutoff"]}}setMicroJitter(a){this.randomizer?.setMicroJitter(a)}getRandomSeed(){return this.randomizer?.seed??0}setRandomSeed(a){this.randomizer&&(this.randomizer.seed=a)}newRandomSeed(){return this.randomizer?.newSeed()??Math.floor(Math.random()*2147483647)}generateTrackBassline(a,l){if(!this.sequencer)return null;const s=this.getCurrentPattern(a);if(!s)return null;const u=this.getTrackScale(a);if(!u)return null;const h={style:l,scaleConfig:u,patternLength:s.length},p=vv(h);for(let f=0;f<p.steps.length;f++)this.setTrackStep(a,f,p.steps[f]);return p}getBasslineStyles(){return kv()}playClick(a){if(!this.audioContext||!this.clickGain)return;const l=a??this.audioContext.currentTime,s=this.audioContext.createOscillator(),u=this.audioContext.createGain();s.frequency.value=1e3,s.type="sine",u.gain.setValueAtTime(1,l),u.gain.exponentialRampToValueAtTime(.001,l+.05),s.connect(u),u.connect(this.clickGain),s.start(l),s.stop(l+.05)}createClickTrack(){this.createTrack("click","Click")&&(this.setTrackStep("click",0,{trigger:!0,velocity:1}),this.setTrackStep("click",4,{trigger:!0,velocity:.8}),this.setTrackStep("click",8,{trigger:!0,velocity:.8}),this.setTrackStep("click",12,{trigger:!0,velocity:.8}),this.onTrigger("click",l=>{this.playClick(l.time)}))}setTrackMuted(a,l){this.sequencer?.setMuted(a,l)}setTrackSolo(a,l){this.sequencer?.setSolo(a,l)}getState(){return{config:{bpm:this._bpm,swing:this._swing,ppqn:this._ppqn},sequencer:this.sequencer?.getState()??{tracks:[]},voices:this.voiceManager?.getState()??{voices:[]},mixer:this.mixer?.getState()??{channels:{},mimeophon:{},mimeophon2:{},mimeophon3:{},mimeophon4:{},reverb:{},master:{},mimeophonReturnLevel:1,mimeophonReturnLevel2:1,mimeophonReturnLevel3:1,mimeophonReturnLevel4:1,reverbReturnLevel:1,fxCrossSends:{mim1ToMim2:0,mim1ToMim3:0,mim1ToMim4:0,mim1ToReverb:0,mim2ToMim1:0,mim2ToMim3:0,mim2ToMim4:0,mim2ToReverb:0,mim3ToMim1:0,mim3ToMim2:0,mim3ToMim4:0,mim3ToReverb:0,mim4ToMim1:0,mim4ToMim2:0,mim4ToMim3:0,mim4ToReverb:0,reverbToMim1:0,reverbToMim2:0,reverbToMim3:0,reverbToMim4:0}},modulation:this.getModState()??void 0}}setState(a){this._bpm=a.config.bpm,this._swing=a.config.swing,this._ppqn=a.config.ppqn,this.clock&&(this.clock.bpm=this._bpm,this.clock.swing=this._swing),this.mixer&&this.mixer.setBpm(this._bpm),this.lfoManager&&this.lfoManager.setBpm(this._bpm),this.sequencer?.setState(a.sequencer),a.voices&&this.voiceManager?.setState(a.voices),a.mixer&&this.mixer?.setState(a.mixer),a.modulation&&this.setModState(a.modulation)}startRecording(){if(!this.audioContext||!this.mixer)return console.warn("[Engine] Cannot start recording: engine not initialized"),!1;if(this.recorder?.isRecording)return console.warn("[Engine] Recording already in progress"),!1;const a=this.mixer.getRecordingTap();return this.recorder=new Jp(this.audioContext,a),this.recorder.onStateChange(l=>{for(const s of this.recorderListeners)s(l)}),this.recorder.start(),console.log("[Engine] Recording started"),!0}stopRecording(){if(!this.recorder)return console.warn("[Engine] No active recording"),null;const a=this.recorder.stop();return console.log("[Engine] Recording stopped, blob size:",a?.size??0),a}cancelRecording(){this.recorder&&(this.recorder.cancel(),console.log("[Engine] Recording cancelled"))}get isRecording(){return this.recorder?.isRecording??!1}get recordingDuration(){return this.recorder?.duration??0}onRecordingStateChange(a){return this.recorderListeners.add(a),()=>this.recorderListeners.delete(a)}downloadRecording(a,l){Jp.downloadWAV(a,l)}exportPreset(a,l,s,u,h,p,f,g,b,M,S,y,j,C,B,G,Z,W,I,Y,te,O){const w=this.getGlobalScale()??{root:0,scale:"minor",octave:3},ne=this.getAllTracks().map(P=>{const ee=[];return P.patterns.forEach((ge,F)=>{ee.push({id:ge.id,name:ge.name,length:ge.length,division:ge.division,steps:ge.steps.map($=>({...$}))})}),{id:P.id,name:P.name,muted:P.muted,solo:P.solo,currentPatternId:P.currentPatternId,patterns:ee,performance:{...P.performance},clockConfig:{...P.clockConfig},scale:P.scale?{...P.scale}:void 0}}),Me=[];a.forEach((P,ee)=>{Me.push({trackId:ee,voiceType:P.voiceType,preset:P.preset,params:P.params?{...P.params}:void 0,note:P.note})});const Be=[];l.forEach((P,ee)=>{Be.push({trackId:ee,params:JSON.parse(JSON.stringify(P))})});const qe=tg(w,this._bpm);return{version:eg,name:qe,createdAt:new Date().toISOString(),description:"",bpm:this._bpm,swing:this._swing,scale:w,tracks:ne,voiceConfigs:Me,channelParams:Be,mimeophonParams:s?{...s}:null,mimeophonParams2:u?{...u}:null,mimeophonParams3:h?{...h}:null,mimeophonParams4:p?{...p}:null,reverbParams:f?{...f}:null,masterParams:g?{...g}:null,mimeophonReturnLevel:b,mimeophonReturnLevel2:M,mimeophonReturnLevel3:S,mimeophonReturnLevel4:y,reverbReturnLevel:j,fxCrossSends:{...C},lfoParams:B.map(P=>({...P})),envModParams:G.map(P=>({...P})),slowRandomParams:{...Z},modRoutes:W.map(P=>({...P})),globalModDepth:I,modEnabled:Y,microJitterEnabled:te,microJitterAmount:O,activePatternSlot:this.getActivePatternSlot(),slotConfigs:this.sequencer?.exportSlotConfigs()}}importPreset(a){if(this.bpm=a.bpm,this.swing=a.swing,a.scale&&this.setGlobalScale(a.scale),this.sequencer)for(const u of a.tracks){const h=this.sequencer.getTrack(u.id);if(h){h.muted=u.muted,h.solo=u.solo,h.currentPatternId=u.currentPatternId,h.performance={...u.performance},h.clockConfig={...u.clockConfig},u.scale&&(h.scale={...u.scale}),h.patterns.clear();for(const p of u.patterns){const f={id:p.id,name:p.name,length:p.length,division:p.division,steps:p.steps.map(g=>({...g}))};h.patterns.set(f.id,f)}}}const l=new Map;for(const u of a.voiceConfigs){const h={trackId:u.trackId,voiceType:u.voiceType,preset:u.preset,params:u.params,note:u.note};l.set(u.trackId,h),this.assignVoice(h),u.params&&this.updateVoiceParams(u.trackId,u.params),u.note!==void 0&&this.setTrackNote(u.trackId,u.note)}const s=new Map;for(const u of a.channelParams)s.set(u.trackId,u.params),this.mixer&&this.mixer.updateChannel(u.trackId,u.params);if(a.mimeophonParams&&this.mixer&&this.mixer.setMimeophonParams(a.mimeophonParams),a.mimeophonParams2&&this.mixer&&this.mixer.setMimeophonParams2(a.mimeophonParams2),a.mimeophonParams3&&this.mixer&&this.mixer.setMimeophonParams3(a.mimeophonParams3),a.mimeophonParams4&&this.mixer&&this.mixer.setMimeophonParams4(a.mimeophonParams4),a.reverbParams&&this.mixer&&this.mixer.setReverbParams(a.reverbParams),a.masterParams&&this.mixer&&this.mixer.setMasterParams(a.masterParams),this.mixer&&(this.mixer.setMimeophonReturnLevel(a.mimeophonReturnLevel),this.mixer.setMimeophonReturnLevel2(a.mimeophonReturnLevel2),this.mixer.setMimeophonReturnLevel3(a.mimeophonReturnLevel3),this.mixer.setMimeophonReturnLevel4(a.mimeophonReturnLevel4),this.mixer.setReverbReturnLevel(a.reverbReturnLevel)),this.lfoManager)for(let u=0;u<a.lfoParams.length&&u<4;u++)this.lfoManager.setLFOParams(u,a.lfoParams[u]);if(this.envelopeManager)for(let u=0;u<a.envModParams.length&&u<6;u++)this.envelopeManager.setEnvelopeParams(u,a.envModParams[u]);if(this.lfoManager&&a.slowRandomParams&&(this.lfoManager.setSlowRandomParams(1,a.slowRandomParams.rate1,a.slowRandomParams.smoothing1),this.lfoManager.setSlowRandomParams(2,a.slowRandomParams.rate2,a.slowRandomParams.smoothing2)),this.modMatrix){this.modMatrix.clearAllRoutes();for(const u of a.modRoutes)this.modMatrix.addRoute(u);this.modMatrix.setGlobalDepth(a.globalModDepth),this.modMatrix.setEnabled(a.modEnabled)}return this.randomizer&&this.randomizer.setMicroJitter({enabled:a.microJitterEnabled,amount:a.microJitterAmount}),a.slotConfigs&&this.sequencer&&this.sequencer.importSlotConfigs(a.slotConfigs),a.activePatternSlot&&this.sequencer&&(this.sequencer.setActivePatternSlot(a.activePatternSlot),this.applySlotState(a.activePatternSlot)),{voiceConfigs:l,channelParams:s,mimeophonParams:a.mimeophonParams,mimeophonParams2:a.mimeophonParams2,mimeophonParams3:a.mimeophonParams3,mimeophonParams4:a.mimeophonParams4,reverbParams:a.reverbParams,masterParams:a.masterParams,mimeophonReturnLevel:a.mimeophonReturnLevel,mimeophonReturnLevel2:a.mimeophonReturnLevel2,mimeophonReturnLevel3:a.mimeophonReturnLevel3,mimeophonReturnLevel4:a.mimeophonReturnLevel4,reverbReturnLevel:a.reverbReturnLevel,fxCrossSends:a.fxCrossSends??lg(),lfoParams:a.lfoParams,envModParams:a.envModParams,slowRandomParams:a.slowRandomParams??sg(),modRoutes:a.modRoutes,globalModDepth:a.globalModDepth,modEnabled:a.modEnabled,microJitterEnabled:a.microJitterEnabled,microJitterAmount:a.microJitterAmount}}dispose(){this.stop(),this.recorder?.dispose(),this.voiceManager?.dispose(),this.mixer?.dispose(),this.clock?.dispose(),this.audioContext?.close(),this.clock=null,this.audioContext=null,this.sequencer=null,this.voiceManager=null,this.mixer=null,this.lfoManager=null,this.modMatrix=null,this.randomizer=null,this.recorder=null,this.setEngineState("uninitialized")}}const R=new og,rg=Object.keys($p);function cg({onSavePreset:m,onLoadPreset:a,mixerOpen:l,onMixerToggle:s}){const[u,h]=T.useState("uninitialized"),[p,f]=T.useState(R.bpm),[g,b]=T.useState(R.swing),[M,S]=T.useState(0),[y,j]=T.useState({root:0,scale:"minor",octave:3}),[C,B]=T.useState(!1),[G,Z]=T.useState(0),[W,I]=T.useState(null),Y=T.useRef(null),te=T.useRef(null);T.useEffect(()=>{const k=R.onStateChange(h),_=R.onTick(ce=>{S(ce.step%16)}),ae=R.getGlobalScale();return ae&&j(ae),()=>{k(),_()}},[]);const O=T.useCallback(async()=>{try{await R.start()}catch(k){console.error("Failed to start engine:",k)}},[]),w=T.useCallback(()=>{R.stop(),S(0)},[]),L=T.useCallback(k=>{const _=parseInt(k.target.value,10);isNaN(_)||(f(_),R.bpm=_)},[]),ne=T.useCallback(k=>{const _=parseFloat(k.target.value);isNaN(_)||(b(_),R.swing=_)},[]),Me=T.useCallback(k=>{const _=Math.max(20,Math.min(300,p+k));f(_),R.bpm=_},[p]),Be=T.useCallback(k=>{const _={...y,root:k};j(_),R.setGlobalScale(_)},[y]),qe=T.useCallback(k=>{const _={...y,scale:k};j(_),R.setGlobalScale(_)},[y]),P=T.useCallback(k=>{const _={...y,octave:k};j(_),R.setGlobalScale(_)},[y]),ee=T.useCallback(()=>{R.resyncAllTracks()},[]),ge=T.useCallback(()=>{R.startRecording()&&(B(!0),Z(0),I(null),Y.current=window.setInterval(()=>{Z(R.recordingDuration)},100))},[]),F=T.useCallback(()=>{Y.current&&(clearInterval(Y.current),Y.current=null);const k=R.stopRecording();B(!1),k&&I(k)},[]),$=T.useCallback(()=>{W&&R.downloadRecording(W)},[W]),le=k=>{const _=Math.floor(k/60),ae=Math.floor(k%60);return`${_.toString().padStart(2,"0")}:${ae.toString().padStart(2,"0")}`};T.useEffect(()=>()=>{Y.current&&clearInterval(Y.current)},[]);const me=T.useCallback(()=>{if(m){const k=m();k&&ig(k)}},[m]),fe=T.useCallback(()=>{te.current?.click()},[]),E=T.useCallback(async k=>{const _=k.target.files?.[0];if(!(!_||!a)){try{const ae=await ng(_);a(ae),f(R.bpm),b(R.swing);const ce=R.getGlobalScale();ce&&j(ce)}catch(ae){console.error("Failed to load preset:",ae),alert(`Failed to load preset: ${ae instanceof Error?ae.message:"Unknown error"}`)}k.target.value=""}},[a]),U=u==="running",se=u==="ready"||u==="stopped"||u==="uninitialized";return o.jsxs("div",{className:"transport",children:[o.jsxs("div",{className:"transport-controls",children:[o.jsx("button",{className:`transport-btn ${U?"active":""}`,onClick:U?w:O,disabled:!se&&!U,children:U?"STOP":"PLAY"}),o.jsx("button",{className:"transport-btn resync-all-btn",onClick:ee,title:"Restart all tracks from step 1 (hard reset)",children:"RESET"})]}),o.jsx("div",{className:"transport-tempo",children:o.jsxs("label",{children:[o.jsx("span",{children:"BPM"}),o.jsxs("div",{className:"tempo-controls",children:[o.jsx("button",{onClick:()=>Me(-1),children:"-"}),o.jsx("input",{type:"number",min:"20",max:"300",value:p,onChange:L}),o.jsx("button",{onClick:()=>Me(1),children:"+"})]})]})}),o.jsx("div",{className:"transport-swing",children:o.jsxs("label",{children:[o.jsxs("span",{children:["SWING ",Math.round(g*100),"%"]}),o.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:g,onChange:ne})]})}),o.jsxs("div",{className:"transport-scale",children:[o.jsx("span",{className:"scale-label",children:"SCALE"}),o.jsxs("div",{className:"scale-selectors",children:[o.jsx("select",{value:y.root,onChange:k=>Be(parseInt(k.target.value,10)),className:"root-select",children:Bc.map((k,_)=>o.jsx("option",{value:_,children:k},_))}),o.jsx("select",{value:y.scale,onChange:k=>qe(k.target.value),className:"scale-select",children:rg.map(k=>o.jsx("option",{value:k,children:k},k))}),o.jsx("select",{value:y.octave,onChange:k=>P(parseInt(k.target.value,10)),className:"octave-select",children:[1,2,3,4,5].map(k=>o.jsxs("option",{value:k,children:["Oct ",k]},k))})]})]}),o.jsx("div",{className:"transport-position",children:o.jsx("div",{className:"step-display",children:Array.from({length:16},(k,_)=>o.jsx("div",{className:`step-indicator ${_===M&&U?"active":""} ${_%4===0?"beat":""}`},_))})}),o.jsxs("div",{className:"transport-recording",children:[C?o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"transport-btn record-btn recording",onClick:F,title:"Stop recording",children:"STOP REC"}),o.jsx("span",{className:"recording-duration",children:le(G)})]}):o.jsx("button",{className:"transport-btn record-btn",onClick:ge,title:"Start recording",children:"REC"}),W&&!C&&o.jsx("button",{className:"transport-btn download-btn",onClick:$,title:"Download recording as WAV",children:"DOWNLOAD"})]}),s&&o.jsx("div",{className:"transport-mixer",children:o.jsx("button",{className:`transport-btn mixer-btn ${l?"active":""}`,onClick:s,title:l?"Close mixer":"Open mixer",children:l?"CLOSE MIXER":"MIXER"})}),o.jsxs("div",{className:"transport-preset",children:[o.jsx("input",{ref:te,type:"file",accept:".json",style:{display:"none"},onChange:E}),o.jsx("button",{className:"transport-btn preset-btn",onClick:me,disabled:!m,title:"Save preset to file",children:"SAVE"}),o.jsx("button",{className:"transport-btn preset-btn",onClick:fe,disabled:!a,title:"Load preset from file",children:"LOAD"})]}),o.jsx("div",{className:"transport-state",children:u})]})}const qc=[{label:"---",value:null},{label:"1:2",value:{a:1,b:2}},{label:"2:2",value:{a:2,b:2}},{label:"1:3",value:{a:1,b:3}},{label:"2:3",value:{a:2,b:3}},{label:"3:3",value:{a:3,b:3}},{label:"1:4",value:{a:1,b:4}},{label:"2:4",value:{a:2,b:4}},{label:"3:4",value:{a:3,b:4}},{label:"4:4",value:{a:4,b:4}},{label:"1:5",value:{a:1,b:5}},{label:"2:5",value:{a:2,b:5}},{label:"3:5",value:{a:3,b:5}},{label:"4:5",value:{a:4,b:5}},{label:"5:5",value:{a:5,b:5}},{label:"1:6",value:{a:1,b:6}},{label:"2:6",value:{a:2,b:6}},{label:"3:6",value:{a:3,b:6}},{label:"4:6",value:{a:4,b:6}},{label:"5:6",value:{a:5,b:6}},{label:"6:6",value:{a:6,b:6}},{label:"1:7",value:{a:1,b:7}},{label:"2:7",value:{a:2,b:7}},{label:"3:7",value:{a:3,b:7}},{label:"4:7",value:{a:4,b:7}},{label:"5:7",value:{a:5,b:7}},{label:"6:7",value:{a:6,b:7}},{label:"7:7",value:{a:7,b:7}},{label:"1:8",value:{a:1,b:8}},{label:"2:8",value:{a:2,b:8}},{label:"3:8",value:{a:3,b:8}},{label:"4:8",value:{a:4,b:8}},{label:"5:8",value:{a:5,b:8}},{label:"6:8",value:{a:6,b:8}},{label:"7:8",value:{a:7,b:8}},{label:"8:8",value:{a:8,b:8}}];function ug(m){if(!m)return 0;const a=qc.findIndex(l=>l.value?.a===m.a&&l.value?.b===m.b);return a>=0?a:0}function mg(m){return m?`${m.a}:${m.b}`:""}function hg({trackId:m,trackName:a,isMelodic:l=!1}){const[s,u]=T.useState([]),[h,p]=T.useState(16),[f,g]=T.useState(-1),[b,M]=T.useState(null),[S,y]=T.useState(null),[j,C]=T.useState(void 0),[B,G]=T.useState("acid"),[Z,W]=T.useState({isActive:!1,trackId:"",stepIndex:-1}),[I,Y]=T.useState(!1),te=T.useMemo(()=>R.getBasslineStyles(),[]),O=T.useMemo(()=>{if(!S)return Cl({root:0,scale:"minor",octave:2},2);const k=j!==void 0?j:S.octave;return Cl({...S,octave:k},2)},[S,j]),w=T.useCallback(()=>{const k=R.getCurrentPattern(m);if(k&&(u([...k.steps]),p(k.length)),l){const _=R.getTrackScale(m);y(_??null);const ae=R.getTrackOctave(m);C(ae)}},[m,l]);T.useEffect(()=>{w();let k=0;const _=3,ae=()=>{const ue=R.getCurrentPattern(m);ue&&ue.steps.length>0?(u([...ue.steps]),p(ue.length)):k<_&&(k++,setTimeout(ae,50))},ce=setTimeout(ae,50);return()=>clearTimeout(ce)},[m,w]),T.useEffect(()=>{const k=R.onTick(()=>{const Te=R.getTrackStepPosition(m);g(Te)}),_=R.onStateChange(Te=>{Te==="stopped"&&g(-1)}),ae=R.onParamLockEditStateChange(Te=>{W(Te)}),ce=R.onClipboardChange(Te=>{Y(Te)}),ue=R.onPatternSlotChange(()=>{w(),M(null)});return()=>{k(),_(),ae(),ce(),ue()}},[m,w]),T.useEffect(()=>{if(!l)return;const k=()=>{const ae=R.getTrackScale(m),ce=R.getTrackOctave(m);C(ce),ae&&y(ue=>{if(!ue||ue.root!==ae.root||ue.scale!==ae.scale||ue.octave!==ae.octave){if(ue&&ue.octave!==ae.octave&&ce===void 0){const Te=(ae.octave-ue.octave)*12,Rt=R.getCurrentPattern(m);Rt&&(Rt.steps.forEach((Qt,ia)=>{if(Qt.note!==void 0){const Aa=Math.max(0,Math.min(127,Qt.note+Te));R.setTrackStep(m,ia,{note:Aa})}}),u([...Rt.steps]))}return ae}return ue})};k();const _=setInterval(k,100);return()=>clearInterval(_)},[m,l]);const L=T.useCallback(k=>{R.toggleTrackStep(m,k);const _=R.getCurrentPattern(m);_&&u([..._.steps])},[m]),ne=T.useCallback((k,_)=>{k.preventDefault(),M(b===_?null:_)},[b]),Me=T.useCallback((k,_)=>{R.setTrackStep(m,k,{velocity:_})&&u(ce=>{const ue=[...ce];return ue[k]={...ue[k],velocity:_},ue})},[m]),Be=T.useCallback((k,_)=>{R.setTrackStep(m,k,{probability:_})&&u(ce=>{const ue=[...ce];return ue[k]={...ue[k],probability:_},ue})},[m]),qe=T.useCallback((k,_)=>{R.setTrackStep(m,k,{ratchets:_})&&u(ce=>{const ue=[...ce];return ue[k]={...ue[k],ratchets:_},ue})},[m]),P=T.useCallback(k=>{R.setPatternLength(m,k),w()},[m,w]),ee=T.useCallback((k,_)=>{R.setTrackStep(m,k,{note:_})&&u(ce=>{const ue=[...ce];return ue[k]={...ue[k],note:_},ue})},[m]),ge=T.useCallback(()=>{const k=R.generateTrackBassline(m,B);k&&u([...k.steps])},[m,B]),F=T.useCallback((k,_)=>{const ae=qc[_].value??void 0;R.setTrackStep(m,k,{condition:ae})&&u(ue=>{const Te=[...ue];return Te[k]={...Te[k],condition:ae},Te})},[m]),$=T.useCallback(k=>{if(R.toggleParamLockEditMode(m,k)){const ae=s[k];ae&&!ae.paramLocks&&R.setTrackStep(m,k,{paramLocks:{},hasParamLocks:!1})}},[m,s]),le=T.useCallback(k=>{R.clearStepParamLocks(m,k);const _=R.getCurrentPattern(m);_&&u([..._.steps])},[m]),me=T.useCallback(()=>{R.triggerParamLockAudition()},[]),fe=T.useCallback(k=>Z.isActive&&Z.trackId===m&&Z.stepIndex===k,[Z,m]),E=T.useCallback(k=>{R.copyStep(m,k)},[m]),U=T.useCallback(k=>{if(R.pasteStep(m,k)){const ae=R.getCurrentPattern(m);ae&&u([...ae.steps])}},[m]);T.useEffect(()=>{const k=_=>{if(b===null)return;const ce=navigator.platform.toUpperCase().indexOf("MAC")>=0?_.metaKey:_.ctrlKey;ce&&_.key==="c"?(_.preventDefault(),E(b)):ce&&_.key==="v"&&(_.preventDefault(),U(b))};return document.addEventListener("keydown",k),()=>document.removeEventListener("keydown",k)},[b,E,U]);const se=T.useCallback(k=>{if(k.note===void 0||O.length===0)return 0;const _=O.indexOf(k.note);if(_>=0)return _;let ae=0,ce=Math.abs(O[0]-k.note);for(let ue=1;ue<O.length;ue++){const Te=Math.abs(O[ue]-k.note);Te<ce&&(ce=Te,ae=ue)}return ae},[O]);return o.jsxs("div",{className:"pattern-grid",children:[o.jsxs("div",{className:"pattern-header",children:[o.jsx("span",{className:"track-name",children:a}),o.jsxs("div",{className:"pattern-controls",children:[l&&o.jsxs("div",{className:"bassline-generator",children:[o.jsx("select",{className:"bassline-style",value:B,onChange:k=>G(k.target.value),title:"Bassline style",children:te.map(({style:k,label:_})=>o.jsx("option",{value:k,children:_},k))}),o.jsx("button",{className:"generate-btn",onClick:ge,title:"Generate bassline",children:"GEN"})]}),o.jsx("div",{className:"pattern-length",children:o.jsxs("label",{children:["LEN",o.jsx("select",{value:h,onChange:k=>P(parseInt(k.target.value,10)),children:[4,8,12,16,24,32,48,64].map(k=>o.jsx("option",{value:k,children:k},k))})]})})]})]}),l&&o.jsx("div",{className:"note-selectors-container",children:s.slice(0,h).map((k,_)=>o.jsxs("div",{className:`note-selector ${_%4===0?"beat-start":""}`,children:[o.jsx("input",{type:"range",className:"note-knob",min:0,max:O.length-1,value:se(k),onChange:ae=>ee(_,O[parseInt(ae.target.value)]),title:k.note!==void 0?bl(k.note):bl(O[0])}),o.jsx("span",{className:"note-label",children:k.note!==void 0?bl(k.note):bl(O[0])})]},_))}),o.jsx("div",{className:"steps-container",children:s.slice(0,h).map((k,_)=>o.jsxs("div",{className:`step ${k.trigger?"active":""} ${_===f?"current":""} ${_%4===0?"beat-start":""} ${b===_?"selected":""} ${k.hasParamLocks?"has-plocks":""} ${fe(_)?"plock-editing":""}`,onClick:()=>L(_),onContextMenu:ae=>ne(ae,_),children:[o.jsx("div",{className:"step-velocity",style:{height:`${k.velocity*100}%`}}),k.probability<1&&o.jsx("div",{className:"step-probability",children:Math.round(k.probability*100)}),k.ratchets>0&&o.jsx("div",{className:"step-ratchets",children:k.ratchets+1}),k.condition&&o.jsx("div",{className:"step-condition",children:mg(k.condition)}),k.hasParamLocks&&o.jsx("div",{className:"step-plock-indicator",children:"P"})]},_))}),b!==null&&s[b]&&o.jsxs("div",{className:"step-editor",children:[o.jsxs("div",{className:"step-editor-header",children:["Step ",b+1,o.jsx("button",{onClick:()=>M(null),children:"X"})]}),o.jsxs("div",{className:"step-copy-paste",children:[o.jsx("button",{className:"copy-btn",onClick:()=>E(b),title:"Copy step (Cmd/Ctrl+C)",children:"COPY"}),o.jsx("button",{className:"paste-btn",onClick:()=>U(b),disabled:!I,title:I?"Paste step (Cmd/Ctrl+V)":"Nothing to paste",children:"PASTE"})]}),o.jsx("div",{className:"step-param",children:o.jsxs("label",{children:["VEL",o.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s[b].velocity,onChange:k=>Me(b,parseFloat(k.target.value))}),o.jsx("span",{children:Math.round(s[b].velocity*100)})]})}),o.jsx("div",{className:"step-param",children:o.jsxs("label",{children:["PROB",o.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s[b].probability,onChange:k=>Be(b,parseFloat(k.target.value))}),o.jsxs("span",{children:[Math.round(s[b].probability*100),"%"]})]})}),o.jsx("div",{className:"step-param",children:o.jsxs("label",{children:["RATCHETS",o.jsxs("select",{value:s[b].ratchets,onChange:k=>qe(b,parseInt(k.target.value,10)),children:[o.jsx("option",{value:"0",children:"Off"}),o.jsx("option",{value:"1",children:"2x"}),o.jsx("option",{value:"2",children:"3x"}),o.jsx("option",{value:"3",children:"4x"})]})]})}),o.jsx("div",{className:"step-param",children:o.jsxs("label",{children:["COND",o.jsx("select",{value:ug(s[b].condition),onChange:k=>F(b,parseInt(k.target.value,10)),title:"Conditional trig: triggers on Ath cycle of every B pattern repeats",children:qc.map((k,_)=>o.jsx("option",{value:_,children:k.label},_))})]})}),l&&o.jsx("div",{className:"step-param",children:o.jsxs("label",{children:["NOTE",o.jsx("select",{value:se(s[b]),onChange:k=>ee(b,O[parseInt(k.target.value)]),children:O.map((k,_)=>o.jsx("option",{value:_,children:bl(k)},_))})]})}),o.jsxs("div",{className:"plock-section",children:[o.jsx("div",{className:"plock-header",children:"PARAMETER LOCKS"}),o.jsxs("div",{className:"plock-controls",children:[o.jsx("button",{className:`plock-edit-toggle ${fe(b)?"active":""}`,onClick:()=>$(b),title:fe(b)?"Exit P-Lock Edit Mode":"Enter P-Lock Edit Mode - parameter changes will be stored on this step",children:fe(b)?"EXIT P-LOCK EDIT":"EDIT P-LOCKS"}),fe(b)&&o.jsx("button",{className:"plock-audition-btn",onClick:me,title:"Audition this step with its p-locks",children:"AUDITION"}),s[b].hasParamLocks&&o.jsx("button",{className:"plock-clear-btn",onClick:()=>le(b),title:"Clear all parameter locks from this step",children:"CLEAR P-LOCKS"})]}),fe(b)&&o.jsxs("div",{className:"plock-status",children:[o.jsx("span",{className:"plock-status-indicator"}),"P-Lock Edit Mode Active - Adjust parameters in the panels below to lock them to this step"]}),s[b].hasParamLocks&&s[b].paramLocks&&o.jsxs("div",{className:"plock-list",children:[o.jsx("div",{className:"plock-list-header",children:"Locked Parameters:"}),Object.entries(s[b].paramLocks).map(([k,_])=>o.jsxs("div",{className:"plock-item",children:[o.jsx("span",{className:"plock-param-name",children:k}),o.jsx("span",{className:"plock-param-value",children:typeof _=="number"?_.toFixed(2):_})]},k))]})]})]})]})}function pg({onVoiceConfigsRefresh:m,onChannelParamsRefresh:a,onFXParamsRefresh:l}){const[s,u]=T.useState(1),[h,p]=T.useState(Array(Ht).fill(!0)),[f,g]=T.useState(!1),[b,M]=T.useState(null),[S,y]=T.useState({visible:!1,x:0,y:0,slot:0});T.useEffect(()=>{u(R.getActivePatternSlot());const te=[];for(let w=1;w<=Ht;w++)te.push(R.isPatternSlotEmpty(w));return p(te),R.onPatternSlotChange(w=>{u(w),m?.(),a?.(),l?.()})},[m,a,l]);const j=T.useCallback(()=>{const te=[];for(let O=1;O<=Ht;O++)te.push(R.isPatternSlotEmpty(O));p(te),g(R.hasPatternClipboard()),M(R.getPatternClipboardMode())},[]),C=T.useCallback(te=>{const O=R.getActivePatternSlot();R.setActivePatternSlot(te),u(te),y(w=>({...w,visible:!1})),te!==O&&(m?.(),a?.(),l?.())},[m,a,l]),B=T.useCallback((te,O)=>{te.preventDefault(),y({visible:!0,x:te.clientX,y:te.clientY,slot:O})},[]);T.useEffect(()=>{const te=()=>{y(O=>({...O,visible:!1}))};if(S.visible)return document.addEventListener("click",te),()=>document.removeEventListener("click",te)},[S.visible]);const G=T.useCallback(()=>{R.copyPatternSlot(S.slot,"engines"),j(),y(te=>({...te,visible:!1}))},[S.slot,j]),Z=T.useCallback(()=>{R.copyPatternSlot(S.slot,"all"),j(),y(te=>({...te,visible:!1}))},[S.slot,j]),W=T.useCallback(()=>{R.pastePatternSlot(S.slot),j(),y(te=>({...te,visible:!1})),m?.(),a?.(),l?.()},[S.slot,j,m,a,l]),I=T.useCallback(()=>{R.clearPatternSlot(S.slot),j(),y(te=>({...te,visible:!1}))},[S.slot,j]),Y=[];for(let te=1;te<=Ht;te++){const O=h[te-1],w=s===te;Y.push(o.jsx("button",{className:`pattern-slot ${w?"active":""} ${O?"empty":"has-data"}`,onClick:()=>C(te),onContextMenu:L=>B(L,te),title:`Pattern ${te}${O?" (empty)":""}`,children:te},te))}return o.jsxs("div",{className:"pattern-bank",children:[o.jsxs("div",{className:"pattern-bank-header",children:[o.jsx("span",{className:"pattern-bank-title",children:"Patterns"}),o.jsxs("span",{className:"pattern-bank-active",children:["P",s]})]}),o.jsx("div",{className:"pattern-bank-grid",children:Y}),S.visible&&o.jsxs("div",{className:"pattern-context-menu",style:{left:S.x,top:S.y},children:[o.jsx("button",{onClick:G,children:"Copy Engines"}),o.jsx("button",{onClick:Z,children:"Copy All"}),f&&o.jsxs("button",{onClick:W,children:["Paste ",b==="engines"?"(Engines)":"(All)"]}),o.jsx("button",{onClick:I,className:"danger",children:"Clear Pattern"})]}),f&&o.jsxs("div",{className:"pattern-clipboard-indicator",children:["Clipboard: ",b==="engines"?"Engines":"All"]})]})}const dg={enabled:!1,cells:Array(16).fill(null).map(()=>({patternSlot:null,cycles:1})),currentCell:0,cyclesRemaining:0};function fg(){const[m,a]=T.useState(dg),[l,s]=T.useState(!1),[u,h]=T.useState({visible:!1,x:0,y:0,cellIndex:0}),[p,f]=T.useState(null),[g,b]=T.useState(1),[M,S]=T.useState(1);T.useEffect(()=>(a(R.getPatternSequencerState()),R.onPatternSequencerChange(L=>{a(L)})),[]),T.useEffect(()=>{const w=()=>{h(L=>({...L,visible:!1}))};if(u.visible)return document.addEventListener("click",w),()=>document.removeEventListener("click",w)},[u.visible]);const y=T.useCallback(()=>{R.setPatternSequencerEnabled(!m.enabled)},[m.enabled]),j=T.useCallback(w=>{const L=m.cells[w];f(w),b(L.patternSlot??1),S(L.cycles)},[m.cells]),C=T.useCallback((w,L)=>{w.preventDefault(),h({visible:!0,x:w.clientX,y:w.clientY,cellIndex:L})},[]),B=T.useCallback(()=>{R.clearPatternSequencerCell(u.cellIndex),h(w=>({...w,visible:!1}))},[u.cellIndex]),G=T.useCallback(()=>{p!==null&&(R.setPatternSequencerCell(p,g,M),f(null))},[p,g,M]),Z=T.useCallback(()=>{f(null)},[]),W=T.useCallback(()=>{p!==null&&(R.clearPatternSequencerCell(p),f(null))},[p]),I=T.useCallback(()=>{R.resetPatternSequencer()},[]),Y=T.useCallback(()=>{R.clearPatternSequencer()},[]),te=m.cells.filter(w=>w.patternSlot!==null).length,O=(w,L)=>{const ne=m.enabled&&m.currentCell===L,Me=w.patternSlot===null,Be=p===L;return o.jsxs("div",{className:`seq-cell ${ne?"active":""} ${Me?"empty":"filled"} ${Be?"editing":""}`,onClick:()=>j(L),onContextMenu:qe=>C(qe,L),title:Me?`Cell ${L+1} (empty)`:`Cell ${L+1}: P${w.patternSlot} x${w.cycles}`,children:[Me?o.jsx("span",{className:"cell-index",children:L+1}):o.jsxs(o.Fragment,{children:[o.jsxs("span",{className:"cell-pattern",children:["P",w.patternSlot]}),w.cycles>1&&o.jsxs("span",{className:"cell-cycles",children:["x",w.cycles]})]}),ne&&m.cyclesRemaining>0&&o.jsx("span",{className:"cell-remaining",children:m.cyclesRemaining})]},L)};return o.jsxs("div",{className:`pattern-sequencer ${l?"expanded":"collapsed"}`,children:[o.jsxs("div",{className:"seq-header",children:[o.jsx("button",{className:"seq-expand-toggle",onClick:()=>s(!l),title:l?"Collapse":"Expand",children:l?"":"+"}),o.jsx("span",{className:"seq-title",children:"Arranger"}),o.jsx("span",{className:"seq-summary",children:te>0?`${te} cells`:"empty"}),o.jsx("button",{className:`seq-enable-btn ${m.enabled?"enabled":""}`,onClick:y,title:m.enabled?"Disable Arranger":"Enable Arranger",children:m.enabled?"ON":"OFF"})]}),l&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"seq-grid",children:m.cells.map((w,L)=>O(w,L))}),o.jsxs("div",{className:"seq-controls",children:[o.jsx("button",{onClick:I,title:"Reset to beginning",children:"Reset"}),o.jsx("button",{onClick:Y,className:"danger",title:"Clear all cells",children:"Clear All"})]}),p!==null&&o.jsx("div",{className:"seq-edit-modal",onClick:Z,children:o.jsxs("div",{className:"seq-edit-content",onClick:w=>w.stopPropagation(),children:[o.jsxs("h4",{children:["Cell ",p+1]}),o.jsxs("div",{className:"seq-edit-field",children:[o.jsx("label",{children:"Pattern:"}),o.jsx("select",{value:g,onChange:w=>b(parseInt(w.target.value)),children:Array.from({length:Ht},(w,L)=>L+1).map(w=>o.jsxs("option",{value:w,children:["P",w]},w))})]}),o.jsxs("div",{className:"seq-edit-field",children:[o.jsx("label",{children:"Cycles:"}),o.jsx("select",{value:M,onChange:w=>S(parseInt(w.target.value)),children:Array.from({length:16},(w,L)=>L+1).map(w=>o.jsx("option",{value:w,children:w},w))})]}),o.jsxs("div",{className:"seq-edit-actions",children:[o.jsx("button",{onClick:G,className:"primary",children:"Save"}),o.jsx("button",{onClick:W,className:"danger",children:"Clear"}),o.jsx("button",{onClick:Z,children:"Cancel"})]})]})})]}),u.visible&&o.jsxs("div",{className:"seq-context-menu",style:{left:u.x,top:u.y},children:[o.jsx("button",{onClick:()=>{j(u.cellIndex),h(w=>({...w,visible:!1}))},children:"Edit Cell"}),o.jsx("button",{onClick:B,className:"danger",children:"Clear Cell"})]})]})}function dt({label:m,value:a,min:l,max:s,step:u=.01,unit:h="",displayValue:p,onChange:f}){return o.jsxs("div",{className:"filter-param",children:[o.jsx("span",{className:"filter-param-label",children:m}),o.jsx("input",{type:"range",min:l,max:s,step:u,value:a,onChange:g=>f(parseFloat(g.target.value))}),o.jsx("span",{className:"filter-param-value",children:p??`${a.toFixed(2)}${h}`})]})}function vg({params:m,onChange:a}){return o.jsxs("div",{className:"filter-controls",children:[o.jsxs("div",{className:"filter-param-group",children:[o.jsx("h6",{children:"Frequency"}),o.jsx(dt,{label:"Freq",value:m.freq,min:0,max:1,displayValue:`${Math.round(m.freq*100)}%`,onChange:l=>a({freq:l})}),o.jsx(dt,{label:"Span",value:m.span,min:0,max:1,displayValue:`${Math.round(m.span*100)}%`,onChange:l=>a({span:l})})]}),o.jsxs("div",{className:"filter-param-group",children:[o.jsx("h6",{children:"Character"}),o.jsx(dt,{label:"Quality",value:m.quality,min:0,max:1,displayValue:m.quality<.5?`Anti ${Math.round((.5-m.quality)*200)}%`:m.quality>.5?`Res ${Math.round((m.quality-.5)*200)}%`:"Flat",onChange:l=>a({quality:l})}),o.jsx(dt,{label:"Mode",value:m.mode,min:0,max:1,displayValue:m.mode<.5?"Crossover":"Formant",onChange:l=>a({mode:l})})]}),o.jsxs("div",{className:"filter-param-group",children:[o.jsx("h6",{children:"Output"}),o.jsx("div",{className:"filter-output-buttons",children:mv.map(({value:l,label:s})=>o.jsx("button",{className:`filter-output-btn ${m.output===l?"active":""}`,onClick:()=>a({output:l}),children:s},l))})]})]})}function gg({params:m,onChange:a}){return o.jsxs("div",{className:"filter-controls",children:[o.jsxs("div",{className:"filter-param-group",children:[o.jsx("h6",{children:"Filter"}),o.jsx(dt,{label:"Cutoff",value:m.cutoff,min:20,max:2e4,step:1,displayValue:m.cutoff>=1e3?`${(m.cutoff/1e3).toFixed(1)}kHz`:`${Math.round(m.cutoff)}Hz`,onChange:l=>a({cutoff:l})}),o.jsx(dt,{label:"Resonance",value:m.resonance,min:0,max:1,displayValue:`${Math.round(m.resonance*100)}%`,onChange:l=>a({resonance:l})})]}),o.jsxs("div",{className:"filter-param-group",children:[o.jsx("h6",{children:"Mode"}),o.jsx("div",{className:"filter-mode-buttons",children:hv.map(({value:l,label:s})=>o.jsx("button",{className:`filter-mode-btn ${m.mode===l?"active":""}`,onClick:()=>a({mode:l}),children:s},l))})]}),o.jsxs("div",{className:"filter-param-group",children:[o.jsx("h6",{children:"Character"}),o.jsx(dt,{label:"Drive",value:m.drive,min:0,max:1,displayValue:`${Math.round(m.drive*100)}%`,onChange:l=>a({drive:l})}),o.jsx(dt,{label:"Chaos",value:m.chaos,min:0,max:1,displayValue:`${Math.round(m.chaos*100)}%`,onChange:l=>a({chaos:l})})]})]})}function bg({params:m,onChange:a}){return o.jsxs("div",{className:"filter-controls",children:[o.jsxs("div",{className:"filter-param-group",children:[o.jsx("h6",{children:"Filter"}),o.jsx(dt,{label:"Cutoff",value:m.cutoff,min:20,max:2e4,step:1,displayValue:m.cutoff>=1e3?`${(m.cutoff/1e3).toFixed(1)}kHz`:`${Math.round(m.cutoff)}Hz`,onChange:l=>a({cutoff:l})}),o.jsx(dt,{label:"Resonance",value:m.resonance,min:0,max:1,displayValue:`${Math.round(m.resonance*100)}%`,onChange:l=>a({resonance:l})})]}),o.jsxs("div",{className:"filter-param-group",children:[o.jsx("h6",{children:"Morph"}),o.jsx(dt,{label:"LP/HP",value:m.morph,min:-1,max:1,displayValue:m.morph<-.3?"LP":m.morph>.3?"HP":"Notch",onChange:l=>a({morph:l})}),o.jsx(dt,{label:"Drive",value:m.drive,min:.1,max:10,step:.1,displayValue:`${m.drive.toFixed(1)}x`,onChange:l=>a({drive:l})})]})]})}function xg({params:m,onChange:a}){return o.jsxs("div",{className:"filter-controls",children:[o.jsxs("div",{className:"filter-param-group",children:[o.jsx("h6",{children:"Filter"}),o.jsx(dt,{label:"Cutoff",value:m.cutoff,min:20,max:2e4,step:1,displayValue:m.cutoff>=1e3?`${(m.cutoff/1e3).toFixed(1)}kHz`:`${Math.round(m.cutoff)}Hz`,onChange:l=>a({cutoff:l})}),o.jsx(dt,{label:"Resonance",value:m.resonance,min:0,max:1,displayValue:`${Math.round(m.resonance*100)}%`,onChange:l=>a({resonance:l})})]}),o.jsxs("div",{className:"filter-param-group",children:[o.jsx("h6",{children:"Character"}),o.jsx(dt,{label:"Drive",value:m.drive,min:0,max:1,displayValue:`${Math.round(m.drive*100)}%`,onChange:l=>a({drive:l})}),o.jsx(dt,{label:"Warmth",value:m.warmth,min:0,max:1,displayValue:`${Math.round(m.warmth*100)}%`,onChange:l=>a({warmth:l})})]})]})}function Hc({params:m,onChange:a}){const l=T.useCallback(f=>{a({type:f})},[a]),s=T.useCallback(f=>{a({threeSisters:{...m.threeSisters,...f}})},[a,m.threeSisters]),u=T.useCallback(f=>{a({wasp:{...m.wasp,...f}})},[a,m.wasp]),h=T.useCallback(f=>{a({sem:{...m.sem,...f}})},[a,m.sem]),p=T.useCallback(f=>{a({moog:{...m.moog,...f}})},[a,m.moog]);return o.jsxs("div",{className:"filter-panel",children:[o.jsx("h5",{children:"Filter"}),o.jsx("div",{className:"filter-type-selector",children:uv.map(({type:f,label:g,description:b})=>o.jsx("button",{className:`filter-type-btn ${m.type===f?"active":""}`,onClick:()=>l(f),title:b,children:g},f))}),m.type==="threeSisters"&&m.threeSisters&&o.jsx(vg,{params:m.threeSisters,onChange:s}),m.type==="wasp"&&m.wasp&&o.jsx(gg,{params:m.wasp,onChange:u}),m.type==="sem"&&m.sem&&o.jsx(bg,{params:m.sem,onChange:h}),m.type==="moog"&&m.moog&&o.jsx(xg,{params:m.moog,onChange:p}),m.type==="bypass"&&o.jsx("div",{className:"filter-bypass-message",children:"Filter bypassed - signal passes through unprocessed"})]})}const Ec=[{value:"fm-drum",label:"FM Drum"},{value:"fm-melodic",label:"FM Melodic"},{value:"noise",label:"Noise/Hat"},{value:"complex-morph",label:"Complex Morph"},{value:"sample",label:"Sample"},{value:"ocean",label:"Ocean"},{value:"plaits-va",label:"Virtual Analog",group:"Plaits Melodic"},{value:"plaits-waveshaper",label:"Waveshaper",group:"Plaits Melodic"},{value:"plaits-fm",label:"FM",group:"Plaits Melodic"},{value:"plaits-formant",label:"Formant",group:"Plaits Melodic"},{value:"plaits-additive",label:"Additive",group:"Plaits Melodic"},{value:"plaits-wavetable",label:"Wavetable",group:"Plaits Melodic"},{value:"plaits-chords",label:"Chords",group:"Plaits Melodic"},{value:"plaits-speech",label:"Speech",group:"Plaits Melodic"},{value:"plaits-grain",label:"Grain Cloud",group:"Plaits Perc"},{value:"plaits-noise",label:"Filtered Noise",group:"Plaits Perc"},{value:"plaits-particle",label:"Particle Noise",group:"Plaits Perc"},{value:"plaits-string",label:"Inharmonic String",group:"Plaits Perc"},{value:"plaits-modal",label:"Modal Resonator",group:"Plaits Perc"},{value:"plaits-kick",label:"Analog Kick",group:"Plaits Perc"},{value:"plaits-snare",label:"Analog Snare",group:"Plaits Perc"},{value:"plaits-hihat",label:"Analog Hi-Hat",group:"Plaits Perc"}];function yg(m){return{"plaits-va":0,"plaits-waveshaper":1,"plaits-fm":2,"plaits-formant":3,"plaits-additive":4,"plaits-wavetable":5,"plaits-chords":6,"plaits-speech":7,"plaits-grain":8,"plaits-noise":9,"plaits-particle":10,"plaits-string":11,"plaits-modal":12,"plaits-kick":13,"plaits-snare":14,"plaits-hihat":15}[m]??0}function Sg(m){return m==="plaits-string"||m==="plaits-modal"}function Mg(m){switch(m){case"fm-drum":return Object.keys(Sl);case"fm-melodic":return Object.keys(Ml);case"noise":return Object.keys(Tl);case"complex-morph":return Object.keys(bn);case"sample":return Object.keys(yn);case"ocean":return[];default:return Zs(m)?Object.keys(Ci):Wp(m)?Object.keys(Ri):[]}}function xe({label:m,value:a,min:l,max:s,step:u=.01,onChange:h}){return o.jsx("div",{className:"param-control",children:o.jsxs("label",{children:[o.jsx("span",{className:"param-label",children:m}),o.jsx("input",{type:"range",min:l,max:s,step:u,value:a,onChange:p=>h(parseFloat(p.target.value))}),o.jsx("span",{className:"param-value",children:a.toFixed(2)})]})})}function Tg({params:m,onChange:a}){return o.jsxs("div",{className:"voice-params",children:[o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Pitch"}),o.jsx(xe,{label:"Pitch",value:m.pitch??55,min:20,max:500,step:1,onChange:l=>a({pitch:l})}),o.jsx(xe,{label:"Pitch Env",value:m.pitchEnvAmount??4,min:1,max:16,onChange:l=>a({pitchEnvAmount:l})}),o.jsx(xe,{label:"Pitch Decay",value:m.pitchEnvDecay??.05,min:.001,max:.3,onChange:l=>a({pitchEnvDecay:l})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"FM"}),o.jsx(xe,{label:"Op1 Ratio",value:m.op1Ratio??1.5,min:.1,max:8,onChange:l=>a({op1Ratio:l})}),o.jsx(xe,{label:"Op1 Index",value:m.op1Index??3,min:0,max:20,onChange:l=>a({op1Index:l})}),o.jsx(xe,{label:"Op2 Ratio",value:m.op2Ratio??3,min:.1,max:8,onChange:l=>a({op2Ratio:l})}),o.jsx(xe,{label:"Op2 Index",value:m.op2Index??1,min:0,max:20,onChange:l=>a({op2Index:l})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Amplitude"}),o.jsx(xe,{label:"Attack",value:m.ampAttack??.001,min:.001,max:.1,onChange:l=>a({ampAttack:l})}),o.jsx(xe,{label:"Decay",value:m.ampDecay??.3,min:.01,max:2,onChange:l=>a({ampDecay:l})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Noise"}),o.jsx(xe,{label:"Noise Mix",value:m.noiseMix??0,min:0,max:1,onChange:l=>a({noiseMix:l})}),o.jsx(xe,{label:"Noise Decay",value:m.noiseDecay??.1,min:.01,max:.5,onChange:l=>a({noiseDecay:l})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Output"}),o.jsx(xe,{label:"Gain",value:m.gain??.8,min:0,max:1,onChange:l=>a({gain:l})})]})]})}function Cg({params:m,note:a,onChange:l,onNoteChange:s}){return o.jsxs("div",{className:"voice-params",children:[o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Note"}),o.jsx(xe,{label:"MIDI Note",value:a,min:24,max:96,step:1,onChange:s})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"FM"}),o.jsx(xe,{label:"Op2 Ratio",value:m.op2Ratio??2,min:.1,max:8,onChange:u=>l({op2Ratio:u})}),o.jsx(xe,{label:"Op2 Index",value:m.op2Index??2,min:0,max:20,onChange:u=>l({op2Index:u})}),o.jsx(xe,{label:"Op3 Ratio",value:m.op3Ratio??3,min:.1,max:8,onChange:u=>l({op3Ratio:u})}),o.jsx(xe,{label:"Op3 Index",value:m.op3Index??1,min:0,max:20,onChange:u=>l({op3Index:u})}),o.jsx(xe,{label:"Feedback",value:m.op2Feedback??0,min:0,max:1,onChange:u=>l({op2Feedback:u})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Filter"}),o.jsx("div",{className:"param-toggle",children:o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:m.filterEnabled??!1,onChange:u=>l({filterEnabled:u.target.checked})}),o.jsx("span",{children:"Enable"})]})}),o.jsx(xe,{label:"Cutoff",value:m.filterFreq??2e3,min:20,max:15e3,step:10,onChange:u=>l({filterFreq:u})}),o.jsx(xe,{label:"Resonance",value:m.filterQ??1,min:.1,max:20,onChange:u=>l({filterQ:u})}),o.jsx(xe,{label:"Env Amt",value:m.filterEnvAmount??0,min:0,max:1e4,step:50,onChange:u=>l({filterEnvAmount:u})}),o.jsx(xe,{label:"Env Decay",value:m.filterEnvDecay??.3,min:.01,max:2,onChange:u=>l({filterEnvDecay:u})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Envelope"}),o.jsx(xe,{label:"Attack",value:m.ampAttack??.01,min:.001,max:1,onChange:u=>l({ampAttack:u})}),o.jsx(xe,{label:"Decay",value:m.ampDecay??.2,min:.001,max:2,onChange:u=>l({ampDecay:u})}),o.jsx(xe,{label:"Sustain",value:m.ampSustain??.6,min:0,max:1,onChange:u=>l({ampSustain:u})}),o.jsx(xe,{label:"Release",value:m.ampRelease??.3,min:.001,max:2,onChange:u=>l({ampRelease:u})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Glide"}),o.jsx("div",{className:"param-toggle",children:o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:m.glideEnabled??!1,onChange:u=>l({glideEnabled:u.target.checked})}),o.jsx("span",{children:"Enable"})]})}),o.jsx(xe,{label:"Time",value:m.glideTime??.05,min:.01,max:.5,onChange:u=>l({glideTime:u})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Output"}),o.jsx(xe,{label:"Gain",value:m.gain??.7,min:0,max:1,onChange:u=>l({gain:u})})]})]})}function Rg({params:m,onChange:a}){return o.jsxs("div",{className:"voice-params",children:[o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Filter"}),o.jsx(xe,{label:"Frequency",value:m.filterFreq??8e3,min:100,max:15e3,step:100,onChange:l=>a({filterFreq:l})}),o.jsx(xe,{label:"Resonance",value:m.filterQ??1,min:.1,max:10,onChange:l=>a({filterQ:l})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Envelope"}),o.jsx(xe,{label:"Attack",value:m.attack??.001,min:1e-4,max:.1,onChange:l=>a({attack:l})}),o.jsx(xe,{label:"Decay",value:m.decay??.08,min:.01,max:2,onChange:l=>a({decay:l})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Metallic"}),o.jsx("div",{className:"param-toggle",children:o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:m.metallicEnabled??!1,onChange:l=>a({metallicEnabled:l.target.checked})}),o.jsx("span",{children:"Enable"})]})}),o.jsx(xe,{label:"Gain",value:m.metallicGain??.5,min:0,max:1,onChange:l=>a({metallicGain:l})}),o.jsx(xe,{label:"Index",value:m.metallicIndex??2,min:0,max:10,onChange:l=>a({metallicIndex:l})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Click"}),o.jsx("div",{className:"param-toggle",children:o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:m.clickEnabled??!1,onChange:l=>a({clickEnabled:l.target.checked})}),o.jsx("span",{children:"Enable"})]})}),o.jsx(xe,{label:"Frequency",value:m.clickFreq??1500,min:100,max:5e3,step:100,onChange:l=>a({clickFreq:l})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Output"}),o.jsx(xe,{label:"Gain",value:m.gain??.8,min:0,max:1,onChange:l=>a({gain:l})})]})]})}function Ag({params:m,voiceType:a,note:l,onChange:s,onNoteChange:u}){const h=yg(a),p=_c[h],f=Zs(a),g=Sg(a),b=f||g;return o.jsxs("div",{className:"voice-params",children:[o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:p?.name??"Plaits"}),o.jsx("p",{className:"engine-description",children:p?.description??""})]}),b&&o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Pitch"}),o.jsx(xe,{label:"MIDI Note",value:l,min:24,max:96,step:1,onChange:u}),g&&o.jsx(xe,{label:"Note (param)",value:m.note??48,min:24,max:96,step:1,onChange:M=>s({note:M})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Macro Controls"}),o.jsx(xe,{label:p?.harmonicsLabel??"Harmonics",value:m.harmonics??.5,min:0,max:1,onChange:M=>s({harmonics:M})}),o.jsx(xe,{label:p?.timbreLabel??"Timbre",value:m.timbre??.5,min:0,max:1,onChange:M=>s({timbre:M})}),o.jsx(xe,{label:p?.morphLabel??"Morph",value:m.morph??.5,min:0,max:1,onChange:M=>s({morph:M})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Internal LPG"}),o.jsx(xe,{label:"Decay",value:m.decay??.5,min:0,max:1,onChange:M=>s({decay:M})}),o.jsx(xe,{label:"Fade (Aux Mix)",value:m.fade??0,min:0,max:1,onChange:M=>s({fade:M})})]}),f&&o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Glide"}),o.jsx("div",{className:"param-toggle",children:o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:m.glideEnabled??!1,onChange:M=>s({glideEnabled:M.target.checked})}),o.jsx("span",{children:"Enable"})]})}),o.jsx(xe,{label:"Time",value:m.glideTime??.05,min:.01,max:2,onChange:M=>s({glideTime:M})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Output"}),o.jsx(xe,{label:"Volume",value:m.volume??.8,min:0,max:1,onChange:M=>s({volume:M})})]})]})}function kg({trackId:m,config:a,onVoiceChange:l,onParamChange:s,onPresetChange:u,onNoteChange:h,channelParams:p,onChannelChange:f}){const[g,b]=T.useState(!0),[M,S]=T.useState(a?.note??60),y=a?.voiceType??"fm-drum",j=a?.preset??"",C=a?.params??{},B=Mg(y);T.useEffect(()=>{a?.note!==void 0&&S(a.note)},[a?.note]);const G=T.useCallback(Y=>{l(m,Y.target.value)},[m,l]),Z=T.useCallback(Y=>{u(m,Y.target.value)},[m,u]),W=T.useCallback(Y=>{s(m,Y)},[m,s]),I=T.useCallback(Y=>{S(Y),h?.(m,Y)},[m,h]);return o.jsxs("div",{className:"voice-panel",children:[o.jsxs("div",{className:"voice-panel-header",onClick:()=>b(!g),children:[o.jsx("span",{className:"expand-icon",children:g?"":""}),o.jsx("span",{className:"voice-type-label",children:y}),j&&o.jsx("span",{className:"preset-label",children:j})]}),g&&o.jsxs("div",{className:"voice-panel-content",children:[o.jsxs("div",{className:"voice-selectors",children:[o.jsxs("div",{className:"selector-group",children:[o.jsx("label",{children:"Voice Type"}),o.jsxs("select",{value:y,onChange:G,children:[Ec.filter(Y=>!Y.group).map(Y=>o.jsx("option",{value:Y.value,children:Y.label},Y.value)),o.jsx("optgroup",{label:"Plaits Melodic",children:Ec.filter(Y=>Y.group==="Plaits Melodic").map(Y=>o.jsx("option",{value:Y.value,children:Y.label},Y.value))}),o.jsx("optgroup",{label:"Plaits Percussion",children:Ec.filter(Y=>Y.group==="Plaits Perc").map(Y=>o.jsx("option",{value:Y.value,children:Y.label},Y.value))})]})]}),o.jsxs("div",{className:"selector-group",children:[o.jsx("label",{children:"Preset"}),o.jsxs("select",{value:j,onChange:Z,children:[o.jsx("option",{value:"",children:"Custom"}),B.map(Y=>o.jsx("option",{value:Y,children:Y},Y))]})]})]}),y==="fm-drum"&&o.jsx(Tg,{params:C,onChange:W}),y==="fm-melodic"&&o.jsx(Cg,{params:C,note:M,onChange:W,onNoteChange:I}),y==="noise"&&o.jsx(Rg,{params:C,onChange:W}),Wp(y)&&o.jsx(Ag,{params:C,voiceType:y,note:M,onChange:W,onNoteChange:I}),p&&f&&o.jsx(Hc,{params:p.filter,onChange:Y=>f(m,{filter:{...p.filter,...Y}})}),p&&f&&o.jsxs("div",{className:"voice-saturation-section",children:[o.jsx("h4",{children:"Saturation"}),o.jsx("div",{className:"saturation-mode-selector",children:Vc.map(({mode:Y,label:te,description:O})=>o.jsx("button",{className:`saturation-mode-btn ${p.saturation.mode===Y?"active":""}`,onClick:()=>f(m,{saturation:{...p.saturation,mode:Y}}),title:O,children:te},Y))}),o.jsx(xe,{label:"Drive",value:p.saturation.drive,min:0,max:1,onChange:Y=>f(m,{saturation:{...p.saturation,drive:Y}})}),o.jsx(xe,{label:"Mix",value:p.saturation.mix,min:0,max:1,onChange:Y=>f(m,{saturation:{...p.saturation,mix:Y}})}),o.jsxs("div",{className:"saturation-advanced",children:[o.jsx(xe,{label:"Bias",value:p.saturation.bias,min:-1,max:1,onChange:Y=>f(m,{saturation:{...p.saturation,bias:Y}})}),o.jsxs("div",{className:"harmonics-selector",children:[o.jsx("span",{className:"param-label",children:"Harmonics"}),o.jsx("div",{className:"harmonics-buttons",children:["even","odd","both"].map(Y=>o.jsx("button",{className:`harmonics-btn ${p.saturation.harmonics===Y?"active":""}`,onClick:()=>f(m,{saturation:{...p.saturation,harmonics:Y}}),children:Y.charAt(0).toUpperCase()+Y.slice(1)},Y))})]})]})]})]})]})}const Eg=[{value:"1/8",label:"1/8 (8x slower)"},{value:"1/4",label:"1/4 (4x slower)"},{value:"1/2",label:"1/2 (2x slower)"},{value:"1/1",label:"1/1 (normal)"},{value:"2/1",label:"2/1 (2x faster)"},{value:"4/1",label:"4/1 (4x faster)"},{value:"8/1",label:"8/1 (8x faster)"}],jg=[0,1,2,3,4,5,6];function Ng({trackId:m,isMelodic:a,onOctaveChange:l}){const[s,u]=T.useState({drift:0,fill:0}),[h,p]=T.useState({useGlobalClock:!0,division:"1/1"}),[f,g]=T.useState(void 0);T.useEffect(()=>{const G=R.getTrackPerformance(m);G&&u(G);const Z=R.getTrackClockConfig(m);Z&&p(Z);const W=R.getTrackOctave(m);g(W)},[m]);const b=T.useCallback(G=>{u(Z=>({...Z,drift:G})),R.setTrackDrift(m,G)},[m]),M=T.useCallback(G=>{u(Z=>({...Z,fill:G})),R.setTrackFill(m,G)},[m]),S=T.useCallback(G=>{p(Z=>({...Z,useGlobalClock:G})),R.setTrackClockConfig(m,{useGlobalClock:G})},[m]),y=T.useCallback(G=>{p(Z=>({...Z,division:G})),R.setTrackClockConfig(m,{division:G})},[m]),j=T.useCallback(()=>{R.resyncTrack(m)},[m]),C=T.useCallback(G=>{g(G),R.setTrackOctave(m,G),l?.(G)},[m,l]),B=s.fill===0?"0":s.fill>0?`+${Math.round(s.fill*100)}%`:`${Math.round(s.fill*100)}%`;return o.jsxs("div",{className:"track-controls",children:[o.jsx("div",{className:"control-group",children:o.jsxs("div",{className:"control-item",children:[o.jsxs("label",{children:[o.jsx("span",{className:"control-label",children:"FILL"}),o.jsx("input",{type:"range",min:"-1",max:"1",step:"0.01",value:s.fill,onChange:G=>M(parseFloat(G.target.value)),className:"fill-slider"}),o.jsx("span",{className:"control-value",children:B})]}),o.jsx("div",{className:"control-hint",children:"Trigger density (left = thin, center = as sequenced, right = fill)"})]})}),a&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"control-group",children:o.jsxs("div",{className:"control-item",children:[o.jsxs("label",{children:[o.jsx("span",{className:"control-label",children:"OCTAVE"}),o.jsxs("select",{value:f??"",onChange:G=>C(parseInt(G.target.value,10)),className:"octave-select",children:[o.jsx("option",{value:"",disabled:!0,children:"Global"}),jg.map(G=>o.jsxs("option",{value:G,children:["Oct ",G]},G))]}),o.jsx("span",{className:"control-value",children:f!==void 0?`C${f}`:"Global"})]}),o.jsx("div",{className:"control-hint",children:"Per-track octave range (overrides global octave)"})]})}),o.jsx("div",{className:"control-group",children:o.jsxs("div",{className:"control-item",children:[o.jsxs("label",{children:[o.jsx("span",{className:"control-label",children:"DRIFT"}),o.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s.drift,onChange:G=>b(parseFloat(G.target.value))}),o.jsxs("span",{className:"control-value",children:[Math.round(s.drift*100),"%"]})]}),o.jsx("div",{className:"control-hint",children:"Note variation (0% = exact, 100% = random from scale)"})]})})]}),o.jsx("div",{className:"control-group clock-division-group",children:o.jsxs("div",{className:"control-item",children:[o.jsxs("div",{className:"clock-header",children:[o.jsx("span",{className:"control-label",children:"CLOCK DIVISION"}),o.jsxs("label",{className:"global-clock-toggle",children:[o.jsx("input",{type:"checkbox",checked:h.useGlobalClock,onChange:G=>S(G.target.checked)}),o.jsx("span",{children:"Use Global"})]})]}),o.jsxs("div",{className:"clock-controls",children:[o.jsx("select",{value:h.division,onChange:G=>y(G.target.value),disabled:h.useGlobalClock,className:"division-select",children:Eg.map(G=>o.jsx("option",{value:G.value,children:G.label},G.value))}),o.jsx("button",{onClick:j,className:"resync-btn",title:"Align track to master clock position (respects clock division)",children:"SYNC"})]}),o.jsx("div",{className:"control-hint",children:h.useGlobalClock?"Track follows global clock":`Track runs at ${h.division} speed (${Dc[h.division]}x)`})]})})]})}const Og=[{name:"A",range:"5-50ms",desc:"Karplus/Flange"},{name:"B",range:"50-400ms",desc:"Chorus/Slapback"},{name:"C",range:"0.4-2s",desc:"Standard Delay"},{name:"D",range:"2-10s",desc:"Ambient/Loop"}];function Pg(m){return m<.2?"Dark":m<.4?"BBD":m<.6?"Tape":m<.8?"Bright":"Crisp"}function Ae({label:m,value:a,min:l,max:s,step:u=.01,unit:h="",displayValue:p,onChange:f}){return o.jsxs("div",{className:"fx-param",children:[o.jsx("span",{className:"fx-param-label",children:m}),o.jsx("input",{type:"range",min:l,max:s,step:u,value:a,onChange:g=>f(parseFloat(g.target.value))}),o.jsx("span",{className:"fx-param-value",children:p??`${a.toFixed(2)}${h}`})]})}function xl({label:m,checked:a,onChange:l}){return o.jsx("div",{className:"fx-toggle",children:o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a,onChange:s=>l(s.target.checked)}),o.jsx("span",{children:m})]})})}function Ys({title:m,isExpanded:a,onToggle:l,params:s,returnLevel:u,onChange:h,onReturnChange:p}){return o.jsxs("div",{className:"fx-section",children:[o.jsxs("div",{className:"fx-section-header",onClick:l,children:[o.jsx("span",{className:"fx-expand-icon",children:a?"":""}),o.jsx("span",{className:"fx-section-title",children:m})]}),a&&o.jsxs("div",{className:"fx-section-content",children:[o.jsxs("div",{className:"fx-presets",children:[o.jsx("label",{children:"Preset"}),o.jsxs("select",{value:"",onChange:f=>{f.target.value&&f.target.value in Cc&&h(Cc[f.target.value])},children:[o.jsx("option",{value:"",children:"Select..."}),Object.keys(Cc).map(f=>o.jsx("option",{value:f,children:f},f))]})]}),o.jsxs("div",{className:"fx-params-grid",children:[o.jsxs("div",{className:"fx-param-group",children:[o.jsx("h5",{children:"Zone & Time"}),o.jsx("div",{className:"mimeophon-zones",children:Og.map((f,g)=>o.jsxs("button",{className:`zone-btn ${Math.floor(s.zone)===g?"active":""}`,onClick:()=>h({zone:g}),title:`${f.range} - ${f.desc}`,children:[o.jsx("span",{className:"zone-letter",children:f.name}),o.jsx("span",{className:"zone-range",children:f.range})]},f.name))}),o.jsx(Ae,{label:"Rate",value:s.rate,min:0,max:1,displayValue:`${Math.round(s.rate*100)}%`,onChange:f=>h({rate:f})}),o.jsx(Ae,{label:"Skew",value:s.skew,min:-1,max:1,displayValue:s.skew>0?`R${Math.round(s.skew*100)}`:s.skew<0?`L${Math.round(Math.abs(s.skew)*100)}`:"0",onChange:f=>h({skew:f})})]}),o.jsxs("div",{className:"fx-param-group",children:[o.jsx("h5",{children:"Rate (LFO)"}),o.jsx(Ae,{label:"Amount",value:s.microRate,min:0,max:1,displayValue:`${Math.round(s.microRate*100)}%`,onChange:f=>h({microRate:f})}),o.jsx(Ae,{label:"Freq",value:s.microRateFreq,min:.1,max:8,step:.1,displayValue:`${s.microRateFreq.toFixed(1)} Hz`,onChange:f=>h({microRateFreq:f})})]}),o.jsxs("div",{className:"fx-param-group",children:[o.jsx("h5",{children:"Feedback"}),o.jsx(Ae,{label:"Repeats",value:s.repeats,min:0,max:1.2,displayValue:`${Math.round(s.repeats*100)}%`,onChange:f=>h({repeats:f})}),o.jsx(Ae,{label:"Color",value:s.color,min:0,max:1,displayValue:Pg(s.color),onChange:f=>h({color:f})}),o.jsx(Ae,{label:"Halo",value:s.halo,min:0,max:1,displayValue:`${Math.round(s.halo*100)}%`,onChange:f=>h({halo:f})})]}),o.jsxs("div",{className:"fx-param-group",children:[o.jsx("h5",{children:"Special"}),o.jsxs("div",{className:"mimeophon-toggles",children:[o.jsx(xl,{label:"Hold",checked:s.hold,onChange:f=>h({hold:f})}),o.jsx(xl,{label:"Flip",checked:s.flip,onChange:f=>h({flip:f})}),o.jsx(xl,{label:"Ping-Pong",checked:s.pingPong,onChange:f=>h({pingPong:f})}),o.jsx(xl,{label:"Swap L/R",checked:s.swap,onChange:f=>h({swap:f})})]}),o.jsx(Ae,{label:"Return",value:u,min:0,max:1,displayValue:`${Math.round(u*100)}%`,onChange:p})]})]})]})]})}function Dg(m){const a=[];return m.mim1ToMim2>0&&m.mim2ToMim1>0&&a.push("Mim1 <-> Mim2"),m.mim1ToMim3>0&&m.mim3ToMim1>0&&a.push("Mim1 <-> Mim3"),m.mim1ToMim4>0&&m.mim4ToMim1>0&&a.push("Mim1 <-> Mim4"),m.mim2ToMim3>0&&m.mim3ToMim2>0&&a.push("Mim2 <-> Mim3"),m.mim2ToMim4>0&&m.mim4ToMim2>0&&a.push("Mim2 <-> Mim4"),m.mim3ToMim4>0&&m.mim4ToMim3>0&&a.push("Mim3 <-> Mim4"),m.mim1ToReverb>0&&m.reverbToMim1>0&&a.push("Mim1 <-> Reverb"),m.mim2ToReverb>0&&m.reverbToMim2>0&&a.push("Mim2 <-> Reverb"),m.mim3ToReverb>0&&m.reverbToMim3>0&&a.push("Mim3 <-> Reverb"),m.mim4ToReverb>0&&m.reverbToMim4>0&&a.push("Mim4 <-> Reverb"),m.mim1ToMim2>0&&m.mim2ToMim3>0&&m.mim3ToMim1>0&&a.push("Mim1 -> Mim2 -> Mim3 -> Mim1"),m.mim1ToMim3>0&&m.mim3ToMim2>0&&m.mim2ToMim1>0&&a.push("Mim1 -> Mim3 -> Mim2 -> Mim1"),m.mim1ToMim2>0&&m.mim2ToMim4>0&&m.mim4ToMim1>0&&a.push("Mim1 -> Mim2 -> Mim4 -> Mim1"),m.mim1ToMim4>0&&m.mim4ToMim2>0&&m.mim2ToMim1>0&&a.push("Mim1 -> Mim4 -> Mim2 -> Mim1"),a}function Lg({mimeophonParams:m,mimeophonParams2:a,mimeophonParams3:l,mimeophonParams4:s,reverbParams:u,masterParams:h,onMimeophonChange:p,onMimeophonChange2:f,onMimeophonChange3:g,onMimeophonChange4:b,onReverbChange:M,onMasterChange:S,mimeophonReturnLevel:y,mimeophonReturnLevel2:j,mimeophonReturnLevel3:C,mimeophonReturnLevel4:B,reverbReturnLevel:G,onMimeophonReturnChange:Z,onMimeophonReturnChange2:W,onMimeophonReturnChange3:I,onMimeophonReturnChange4:Y,onReverbReturnChange:te,fxCrossSends:O,onFXCrossSendsChange:w}){const[L,ne]=T.useState("mimeophon"),Me=T.useCallback(P=>{ne(ee=>ee===P?null:P)},[]),Be=T.useMemo(()=>Dg(O),[O]),qe=Be.length>0;return o.jsxs("div",{className:"fx-panel",children:[o.jsx(Ys,{title:"MIMEOPHON 1",sectionKey:"mimeophon",isExpanded:L==="mimeophon",onToggle:()=>Me("mimeophon"),params:m,returnLevel:y,onChange:p,onReturnChange:Z}),o.jsx(Ys,{title:"MIMEOPHON 2",sectionKey:"mimeophon2",isExpanded:L==="mimeophon2",onToggle:()=>Me("mimeophon2"),params:a,returnLevel:j,onChange:f,onReturnChange:W}),o.jsx(Ys,{title:"MIMEOPHON 3",sectionKey:"mimeophon3",isExpanded:L==="mimeophon3",onToggle:()=>Me("mimeophon3"),params:l,returnLevel:C,onChange:g,onReturnChange:I}),o.jsx(Ys,{title:"MIMEOPHON 4",sectionKey:"mimeophon4",isExpanded:L==="mimeophon4",onToggle:()=>Me("mimeophon4"),params:s,returnLevel:B,onChange:b,onReturnChange:Y}),o.jsxs("div",{className:"fx-section",children:[o.jsxs("div",{className:"fx-section-header",onClick:()=>Me("reverb"),children:[o.jsx("span",{className:"fx-expand-icon",children:L==="reverb"?"":""}),o.jsx("span",{className:"fx-section-title",children:"REVERB (ZITA)"})]}),L==="reverb"&&o.jsxs("div",{className:"fx-section-content",children:[o.jsxs("div",{className:"fx-presets",children:[o.jsx("label",{children:"Preset"}),o.jsxs("select",{value:"",onChange:P=>{P.target.value&&P.target.value in Rc&&M(Rc[P.target.value])},children:[o.jsx("option",{value:"",children:"Select..."}),Object.keys(Rc).map(P=>o.jsx("option",{value:P,children:P},P))]})]}),o.jsxs("div",{className:"fx-params-grid",children:[o.jsxs("div",{className:"fx-param-group",children:[o.jsx("h5",{children:"Space"}),o.jsx(Ae,{label:"Size",value:u.size,min:0,max:1,displayValue:`${Math.round(u.size*100)}%`,onChange:P=>M({size:P})}),o.jsx(Ae,{label:"Decay",value:u.decay,min:0,max:1,displayValue:`${Math.round(u.decay*100)}%`,onChange:P=>M({decay:P})})]}),o.jsxs("div",{className:"fx-param-group",children:[o.jsx("h5",{children:"Mix"}),o.jsx(Ae,{label:"Return",value:G,min:0,max:1,displayValue:`${Math.round(G*100)}%`,onChange:te})]})]})]})]}),o.jsxs("div",{className:"fx-section",children:[o.jsxs("div",{className:"fx-section-header",onClick:()=>Me("routing"),children:[o.jsx("span",{className:"fx-expand-icon",children:L==="routing"?"":""}),o.jsx("span",{className:"fx-section-title",children:"FX ROUTING"}),qe&&o.jsx("span",{className:"fx-warning-badge",children:"!"})]}),L==="routing"&&o.jsxs("div",{className:"fx-section-content",children:[qe&&o.jsxs("div",{className:"fx-feedback-warning",children:[o.jsx("strong",{children:"Feedback Loop Warning!"}),o.jsx("p",{children:"The following routing combinations may cause audio feedback:"}),o.jsx("ul",{children:Be.map((P,ee)=>o.jsx("li",{children:P},ee))}),o.jsx("p",{children:"High send levels with feedback loops can cause loud or distorted audio. Use with caution."})]}),o.jsxs("div",{className:"fx-routing-group",children:[o.jsx("h5",{children:"Mimeophon 1 Sends To"}),o.jsxs("div",{className:"fx-routing-row",children:[o.jsx(Ae,{label:"Mim 2",value:O.mim1ToMim2,min:0,max:1,displayValue:`${Math.round(O.mim1ToMim2*100)}%`,onChange:P=>w({mim1ToMim2:P})}),o.jsx(Ae,{label:"Mim 3",value:O.mim1ToMim3,min:0,max:1,displayValue:`${Math.round(O.mim1ToMim3*100)}%`,onChange:P=>w({mim1ToMim3:P})}),o.jsx(Ae,{label:"Mim 4",value:O.mim1ToMim4,min:0,max:1,displayValue:`${Math.round(O.mim1ToMim4*100)}%`,onChange:P=>w({mim1ToMim4:P})}),o.jsx(Ae,{label:"Reverb",value:O.mim1ToReverb,min:0,max:1,displayValue:`${Math.round(O.mim1ToReverb*100)}%`,onChange:P=>w({mim1ToReverb:P})})]})]}),o.jsxs("div",{className:"fx-routing-group",children:[o.jsx("h5",{children:"Mimeophon 2 Sends To"}),o.jsxs("div",{className:"fx-routing-row",children:[o.jsx(Ae,{label:"Mim 1",value:O.mim2ToMim1,min:0,max:1,displayValue:`${Math.round(O.mim2ToMim1*100)}%`,onChange:P=>w({mim2ToMim1:P})}),o.jsx(Ae,{label:"Mim 3",value:O.mim2ToMim3,min:0,max:1,displayValue:`${Math.round(O.mim2ToMim3*100)}%`,onChange:P=>w({mim2ToMim3:P})}),o.jsx(Ae,{label:"Mim 4",value:O.mim2ToMim4,min:0,max:1,displayValue:`${Math.round(O.mim2ToMim4*100)}%`,onChange:P=>w({mim2ToMim4:P})}),o.jsx(Ae,{label:"Reverb",value:O.mim2ToReverb,min:0,max:1,displayValue:`${Math.round(O.mim2ToReverb*100)}%`,onChange:P=>w({mim2ToReverb:P})})]})]}),o.jsxs("div",{className:"fx-routing-group",children:[o.jsx("h5",{children:"Mimeophon 3 Sends To"}),o.jsxs("div",{className:"fx-routing-row",children:[o.jsx(Ae,{label:"Mim 1",value:O.mim3ToMim1,min:0,max:1,displayValue:`${Math.round(O.mim3ToMim1*100)}%`,onChange:P=>w({mim3ToMim1:P})}),o.jsx(Ae,{label:"Mim 2",value:O.mim3ToMim2,min:0,max:1,displayValue:`${Math.round(O.mim3ToMim2*100)}%`,onChange:P=>w({mim3ToMim2:P})}),o.jsx(Ae,{label:"Mim 4",value:O.mim3ToMim4,min:0,max:1,displayValue:`${Math.round(O.mim3ToMim4*100)}%`,onChange:P=>w({mim3ToMim4:P})}),o.jsx(Ae,{label:"Reverb",value:O.mim3ToReverb,min:0,max:1,displayValue:`${Math.round(O.mim3ToReverb*100)}%`,onChange:P=>w({mim3ToReverb:P})})]})]}),o.jsxs("div",{className:"fx-routing-group",children:[o.jsx("h5",{children:"Mimeophon 4 Sends To"}),o.jsxs("div",{className:"fx-routing-row",children:[o.jsx(Ae,{label:"Mim 1",value:O.mim4ToMim1,min:0,max:1,displayValue:`${Math.round(O.mim4ToMim1*100)}%`,onChange:P=>w({mim4ToMim1:P})}),o.jsx(Ae,{label:"Mim 2",value:O.mim4ToMim2,min:0,max:1,displayValue:`${Math.round(O.mim4ToMim2*100)}%`,onChange:P=>w({mim4ToMim2:P})}),o.jsx(Ae,{label:"Mim 3",value:O.mim4ToMim3,min:0,max:1,displayValue:`${Math.round(O.mim4ToMim3*100)}%`,onChange:P=>w({mim4ToMim3:P})}),o.jsx(Ae,{label:"Reverb",value:O.mim4ToReverb,min:0,max:1,displayValue:`${Math.round(O.mim4ToReverb*100)}%`,onChange:P=>w({mim4ToReverb:P})})]})]}),o.jsxs("div",{className:"fx-routing-group",children:[o.jsx("h5",{children:"Reverb Sends To"}),o.jsxs("div",{className:"fx-routing-row",children:[o.jsx(Ae,{label:"Mim 1",value:O.reverbToMim1,min:0,max:1,displayValue:`${Math.round(O.reverbToMim1*100)}%`,onChange:P=>w({reverbToMim1:P})}),o.jsx(Ae,{label:"Mim 2",value:O.reverbToMim2,min:0,max:1,displayValue:`${Math.round(O.reverbToMim2*100)}%`,onChange:P=>w({reverbToMim2:P})}),o.jsx(Ae,{label:"Mim 3",value:O.reverbToMim3,min:0,max:1,displayValue:`${Math.round(O.reverbToMim3*100)}%`,onChange:P=>w({reverbToMim3:P})}),o.jsx(Ae,{label:"Mim 4",value:O.reverbToMim4,min:0,max:1,displayValue:`${Math.round(O.reverbToMim4*100)}%`,onChange:P=>w({reverbToMim4:P})})]})]})]})]}),o.jsxs("div",{className:"fx-section",children:[o.jsxs("div",{className:"fx-section-header",onClick:()=>Me("master"),children:[o.jsx("span",{className:"fx-expand-icon",children:L==="master"?"":""}),o.jsx("span",{className:"fx-section-title",children:"MASTER"})]}),L==="master"&&o.jsxs("div",{className:"fx-section-content",children:[o.jsxs("div",{className:"fx-presets",children:[o.jsx("label",{children:"Preset"}),o.jsxs("select",{value:"",onChange:P=>{P.target.value&&P.target.value in Ac&&S(Ac[P.target.value])},children:[o.jsx("option",{value:"",children:"Select..."}),Object.keys(Ac).map(P=>o.jsx("option",{value:P,children:P},P))]})]}),o.jsxs("div",{className:"fx-params-grid",children:[o.jsxs("div",{className:"fx-param-group",children:[o.jsx("h5",{children:"Gain"}),o.jsx(Ae,{label:"Input",value:h.inputGain,min:-12,max:12,step:.5,unit:"dB",onChange:P=>S({inputGain:P})}),o.jsx(Ae,{label:"Output",value:h.outputGain,min:-24,max:0,step:.5,unit:"dB",onChange:P=>S({outputGain:P})})]}),o.jsxs("div",{className:"fx-param-group",children:[o.jsx("h5",{children:"Saturation"}),o.jsx(Ae,{label:"Amount",value:h.saturationAmount,min:0,max:1,onChange:P=>S({saturationAmount:P})}),o.jsx(Ae,{label:"Drive",value:h.saturationDrive,min:0,max:18,step:.5,unit:"dB",onChange:P=>S({saturationDrive:P})})]}),o.jsxs("div",{className:"fx-param-group",children:[o.jsx("h5",{children:"Tone"}),o.jsx(Ae,{label:"High Shelf",value:h.highShelf,min:-6,max:6,step:.5,unit:"dB",onChange:P=>S({highShelf:P})}),o.jsx(Ae,{label:"Shelf Freq",value:h.highShelfFreq,min:2e3,max:12e3,step:100,unit:"Hz",onChange:P=>S({highShelfFreq:P})})]}),o.jsxs("div",{className:"fx-param-group",children:[o.jsx("h5",{children:"Limiter"}),o.jsx(xl,{label:"Enabled",checked:h.limiterEnabled,onChange:P=>S({limiterEnabled:P})}),o.jsx(Ae,{label:"Threshold",value:h.limiterThreshold,min:-6,max:0,step:.1,unit:"dB",onChange:P=>S({limiterThreshold:P})})]})]})]})]})]})}const wg=[{value:"sine",label:"Sine"},{value:"triangle",label:"Triangle"},{value:"square",label:"Square"},{value:"sawtooth",label:"Sawtooth"},{value:"sampleHold",label:"S&H"},{value:"random",label:"Random"}],sd=[{value:"free",label:"Free"},{value:"8bars",label:"8 Bars"},{value:"4bars",label:"4 Bars"},{value:"2bars",label:"2 Bars"},{value:"1bar",label:"1 Bar"},{value:"1/2",label:"1/2"},{value:"1/4",label:"1/4"},{value:"1/8",label:"1/8"},{value:"1/16",label:"1/16"},{value:"1/32",label:"1/32"},{value:"1/4d",label:"1/4."},{value:"1/8d",label:"1/8."},{value:"1/4t",label:"1/4t"},{value:"1/8t",label:"1/8t"}];function qg({index:m,params:a,onParamChange:l}){const s=T.useCallback(u=>{l(m,u)},[m,l]);return o.jsxs("div",{className:"lfo-control",children:[o.jsxs("div",{className:"lfo-header",children:[o.jsxs("span",{className:"lfo-label",children:["LFO ",m+1]}),o.jsxs("select",{className:"lfo-preset",onChange:u=>{const h=Xp[u.target.value];h&&s(h)},children:[o.jsx("option",{value:"",children:"Preset..."}),Object.keys(Xp).map(u=>o.jsx("option",{value:u,children:u},u))]})]}),o.jsxs("div",{className:"lfo-params",children:[o.jsxs("div",{className:"lfo-row",children:[o.jsxs("label",{className:"lfo-param",children:[o.jsx("span",{children:"Shape"}),o.jsx("select",{value:a.shape,onChange:u=>s({shape:u.target.value}),children:wg.map(u=>o.jsx("option",{value:u.value,children:u.label},u.value))})]}),o.jsxs("label",{className:"lfo-param",children:[o.jsx("span",{children:"Sync"}),o.jsx("select",{value:a.sync,onChange:u=>s({sync:u.target.value,tempoSync:u.target.value!=="free"}),children:sd.map(u=>o.jsx("option",{value:u.value,children:u.label},u.value))})]})]}),o.jsx("div",{className:"lfo-row",children:o.jsxs("label",{className:"lfo-param",children:[o.jsx("span",{children:"Rate"}),o.jsx("input",{type:"range",min:.01,max:20,step:.01,value:a.rate,onChange:u=>s({rate:parseFloat(u.target.value)}),disabled:a.tempoSync}),o.jsxs("span",{className:"lfo-value",children:[a.rate.toFixed(2)," Hz"]})]})}),o.jsx("div",{className:"lfo-row",children:o.jsxs("label",{className:"lfo-param",children:[o.jsx("span",{children:"Depth"}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:a.depth,onChange:u=>s({depth:parseFloat(u.target.value)})}),o.jsxs("span",{className:"lfo-value",children:[(a.depth*100).toFixed(0),"%"]})]})}),o.jsx("div",{className:"lfo-row",children:o.jsxs("label",{className:"lfo-param",children:[o.jsx("span",{children:"Phase"}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:a.phase,onChange:u=>s({phase:parseFloat(u.target.value)})}),o.jsxs("span",{className:"lfo-value",children:[(a.phase*360).toFixed(0),""]})]})}),o.jsxs("div",{className:"lfo-toggles",children:[o.jsxs("label",{className:"lfo-toggle",children:[o.jsx("input",{type:"checkbox",checked:a.bipolar,onChange:u=>s({bipolar:u.target.checked})}),o.jsx("span",{children:"Bipolar"})]}),(a.shape==="sampleHold"||a.shape==="random")&&o.jsxs("label",{className:"lfo-param smooth-param",children:[o.jsx("span",{children:"Smooth"}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:a.smoothing,onChange:u=>s({smoothing:parseFloat(u.target.value)})})]})]})]})]})}const zg=[{value:"cycle",label:"Cycle"},{value:"oneshot",label:"One-shot"},{value:"oneshot-hold",label:"One-shot Hold"}],Bg=nd();function _g({index:m,params:a,onParamChange:l}){const s=T.useCallback(h=>{l(m,h)},[m,l]),u=Mn.find(h=>h.id===a.presetId);return o.jsxs("div",{className:"env-mod-control",children:[o.jsxs("div",{className:"env-mod-header",children:[o.jsxs("span",{className:"env-mod-label",children:["Env ",m+1]}),o.jsxs("select",{className:"env-mod-preset-quick",onChange:h=>{const p=Zp[h.target.value];p&&s(p)},children:[o.jsx("option",{value:"",children:"Quick Preset..."}),Object.keys(Zp).map(h=>o.jsx("option",{value:h,children:h},h))]})]}),o.jsxs("div",{className:"env-mod-params",children:[o.jsx("div",{className:"env-mod-row",children:o.jsxs("label",{className:"env-mod-param",children:[o.jsx("span",{children:"Shape"}),o.jsx("select",{value:a.presetId,onChange:h=>s({presetId:h.target.value}),title:u?.description,children:Bg.map(h=>o.jsx("optgroup",{label:h,children:Mn.filter(p=>p.category===h).map(p=>o.jsx("option",{value:p.id,children:p.name},p.id))},h))})]})}),o.jsxs("div",{className:"env-mod-row",children:[o.jsxs("label",{className:"env-mod-param",children:[o.jsx("span",{children:"Sync"}),o.jsx("select",{value:a.sync,onChange:h=>s({sync:h.target.value,tempoSync:h.target.value!=="free"}),children:sd.map(h=>o.jsx("option",{value:h.value,children:h.label},h.value))})]}),o.jsxs("label",{className:"env-mod-param",children:[o.jsx("span",{children:"Mode"}),o.jsx("select",{value:a.loopMode,onChange:h=>s({loopMode:h.target.value}),children:zg.map(h=>o.jsx("option",{value:h.value,children:h.label},h.value))})]})]}),o.jsx("div",{className:"env-mod-row",children:o.jsxs("label",{className:"env-mod-param",children:[o.jsx("span",{children:"Period"}),o.jsx("input",{type:"range",min:.01,max:10,step:.01,value:a.period,onChange:h=>s({period:parseFloat(h.target.value)}),disabled:a.tempoSync}),o.jsxs("span",{className:"env-mod-value",children:[a.period.toFixed(2),"s"]})]})}),o.jsx("div",{className:"env-mod-row",children:o.jsxs("label",{className:"env-mod-param",children:[o.jsx("span",{children:"Depth"}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:a.depth,onChange:h=>s({depth:parseFloat(h.target.value)})}),o.jsxs("span",{className:"env-mod-value",children:[(a.depth*100).toFixed(0),"%"]})]})}),o.jsx("div",{className:"env-mod-row",children:o.jsxs("label",{className:"env-mod-param",children:[o.jsx("span",{children:"Phase"}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:a.phase,onChange:h=>s({phase:parseFloat(h.target.value)})}),o.jsxs("span",{className:"env-mod-value",children:[(a.phase*360).toFixed(0),""]})]})}),o.jsxs("div",{className:"env-mod-toggles",children:[o.jsxs("label",{className:"env-mod-toggle",children:[o.jsx("input",{type:"checkbox",checked:a.bipolar,onChange:h=>s({bipolar:h.target.checked})}),o.jsx("span",{children:"Bipolar"})]}),o.jsxs("label",{className:"env-mod-toggle",children:[o.jsx("input",{type:"checkbox",checked:a.retrigger,onChange:h=>s({retrigger:h.target.checked})}),o.jsx("span",{children:"Retrigger"})]})]})]})]})}const Vg=[{value:"all",label:"All Tracks"},{value:1,label:"Track 1"},{value:2,label:"Track 2"},{value:3,label:"Track 3"},{value:4,label:"Track 4"},{value:5,label:"Track 5"},{value:6,label:"Track 6"},{value:7,label:"Track 7"},{value:8,label:"Track 8"},{value:9,label:"Track 9"},{value:10,label:"Track 10"},{value:11,label:"Track 11"},{value:12,label:"Track 12"}],Gg=[{value:"lfo1",label:"LFO 1",group:"LFOs"},{value:"lfo2",label:"LFO 2",group:"LFOs"},{value:"lfo3",label:"LFO 3",group:"LFOs"},{value:"lfo4",label:"LFO 4",group:"LFOs"},{value:"env1",label:"Env 1",group:"Envelopes"},{value:"env2",label:"Env 2",group:"Envelopes"},{value:"env3",label:"Env 3",group:"Envelopes"},{value:"env4",label:"Env 4",group:"Envelopes"},{value:"env5",label:"Env 5",group:"Envelopes"},{value:"env6",label:"Env 6",group:"Envelopes"},{value:"random1",label:"Random 1",group:"Random"},{value:"random2",label:"Random 2",group:"Random"},{value:"velocity",label:"Velocity",group:"MIDI"},{value:"modWheel",label:"Mod Wheel",group:"MIDI"}],Fg=Gg.reduce((m,a)=>{const l=a.group||"Other";return m[l]||(m[l]=[]),m[l].push(a),m},{});function Hg({route:m,onUpdate:a,onRemove:l}){const s=m.trackTarget??"all";return o.jsxs("div",{className:"mod-route",children:[o.jsx("select",{className:"mod-track",value:s,onChange:u=>{const h=u.target.value,p=h==="all"?"all":parseInt(h,10);a(m.id,{trackTarget:p,trackId:void 0})},title:"Target track",children:Vg.map(u=>o.jsx("option",{value:u.value,children:u.label},String(u.value)))}),o.jsx("select",{className:"mod-source",value:m.source,onChange:u=>a(m.id,{source:u.target.value}),children:Object.entries(Fg).map(([u,h])=>o.jsx("optgroup",{label:u,children:h.map(p=>o.jsx("option",{value:p.value,children:p.label},p.value))},u))}),o.jsx("span",{className:"mod-arrow",children:""}),o.jsx("select",{className:"mod-destination",value:m.destination,onChange:u=>a(m.id,{destination:u.target.value}),children:Object.entries(Yv).map(([u,h])=>o.jsx("optgroup",{label:u,children:h.map(p=>o.jsx("option",{value:p,children:p},p))},u))}),o.jsxs("div",{className:"mod-depth-control",children:[o.jsx("input",{type:"range",min:-1,max:1,step:.01,value:m.depth,onChange:u=>a(m.id,{depth:parseFloat(u.target.value)})}),o.jsxs("span",{className:"mod-depth-value",children:[(m.depth*100).toFixed(0),"%"]})]}),o.jsx("button",{className:"mod-remove",onClick:()=>l(m.id),children:""})]})}function Ug({lfoParams:m,onLFOChange:a,envModParams:l,onEnvModChange:s,slowRandomParams:u,onSlowRandomChange:h,routes:p,onAddRoute:f,onUpdateRoute:g,onRemoveRoute:b,onLoadModPreset:M,globalDepth:S,onGlobalDepthChange:y,modEnabled:j,onModEnabledChange:C,onMutate:B,onRandomizeScene:G,microJitterEnabled:Z,microJitterAmount:W,onMicroJitterChange:I}){const[Y,te]=T.useState(!1),[O,w]=T.useState("lfos"),L=T.useCallback(()=>{f({source:"lfo1",destination:"filterCutoff",depth:.5})},[f]);return o.jsxs("div",{className:"modulation-panel",children:[o.jsxs("div",{className:"mod-panel-header",onClick:()=>te(!Y),children:[o.jsx("span",{className:"expand-icon",children:Y?"":""}),o.jsx("span",{className:"mod-panel-title",children:"MODULATION"}),o.jsxs("label",{className:"mod-enable",onClick:ne=>ne.stopPropagation(),children:[o.jsx("input",{type:"checkbox",checked:j,onChange:ne=>C(ne.target.checked)}),o.jsx("span",{children:"Enable"})]})]}),Y&&o.jsxs("div",{className:"mod-panel-content",children:[o.jsxs("div",{className:"mod-tabs",children:[o.jsx("button",{className:`mod-tab ${O==="lfos"?"active":""}`,onClick:()=>w("lfos"),children:"LFOs"}),o.jsx("button",{className:`mod-tab ${O==="envelopes"?"active":""}`,onClick:()=>w("envelopes"),children:"Envelopes"}),o.jsx("button",{className:`mod-tab ${O==="matrix"?"active":""}`,onClick:()=>w("matrix"),children:"Mod Matrix"}),o.jsx("button",{className:`mod-tab ${O==="random"?"active":""}`,onClick:()=>w("random"),children:"Randomize"})]}),O==="lfos"&&o.jsxs("div",{className:"lfos-section",children:[o.jsx("div",{className:"lfos-grid",children:m.map((ne,Me)=>o.jsx(qg,{index:Me,params:ne,onParamChange:a},Me))}),o.jsxs("div",{className:"slow-random-section",children:[o.jsx("h4",{children:"Slow Random Modulators"}),o.jsxs("div",{className:"slow-random-controls",children:[o.jsxs("div",{className:"slow-random-control",children:[o.jsx("span",{className:"slow-random-label",children:"Random 1"}),o.jsxs("label",{className:"slow-random-param",children:[o.jsx("span",{children:"Rate"}),o.jsx("input",{type:"range",min:.01,max:.5,step:.01,value:u.rate1,onChange:ne=>h(1,parseFloat(ne.target.value),u.smoothing1)}),o.jsxs("span",{className:"slow-random-value",children:[u.rate1.toFixed(2)," Hz"]})]}),o.jsxs("label",{className:"slow-random-param",children:[o.jsx("span",{children:"Smooth"}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:u.smoothing1,onChange:ne=>h(1,u.rate1,parseFloat(ne.target.value))})]})]}),o.jsxs("div",{className:"slow-random-control",children:[o.jsx("span",{className:"slow-random-label",children:"Random 2"}),o.jsxs("label",{className:"slow-random-param",children:[o.jsx("span",{children:"Rate"}),o.jsx("input",{type:"range",min:.01,max:.5,step:.01,value:u.rate2,onChange:ne=>h(2,parseFloat(ne.target.value),u.smoothing2)}),o.jsxs("span",{className:"slow-random-value",children:[u.rate2.toFixed(2)," Hz"]})]}),o.jsxs("label",{className:"slow-random-param",children:[o.jsx("span",{children:"Smooth"}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:u.smoothing2,onChange:ne=>h(2,u.rate2,parseFloat(ne.target.value))})]})]})]})]})]}),O==="envelopes"&&o.jsx("div",{className:"envelopes-section",children:o.jsx("div",{className:"envelopes-grid",children:l.map((ne,Me)=>o.jsx(_g,{index:Me,params:ne,onParamChange:s},Me))})}),O==="matrix"&&o.jsxs("div",{className:"matrix-section",children:[o.jsx("div",{className:"matrix-header",children:o.jsxs("div",{className:"matrix-controls",children:[o.jsxs("label",{className:"global-depth",children:[o.jsx("span",{children:"Global Depth"}),o.jsx("input",{type:"range",min:0,max:2,step:.01,value:S,onChange:ne=>y(parseFloat(ne.target.value))}),o.jsxs("span",{className:"global-depth-value",children:[(S*100).toFixed(0),"%"]})]}),o.jsxs("select",{className:"mod-preset-select",onChange:ne=>{ne.target.value&&(M(ne.target.value),ne.target.value="")},children:[o.jsx("option",{value:"",children:"Load Preset..."}),Object.keys(ld).map(ne=>o.jsx("option",{value:ne,children:ne},ne))]}),o.jsx("button",{className:"add-route-btn",onClick:L,children:"+ Add Route"})]})}),o.jsx("div",{className:"mod-routes",children:p.length===0?o.jsx("div",{className:"no-routes",children:'No modulation routes. Click "+ Add Route" to create one.'}):p.map(ne=>o.jsx(Hg,{route:ne,onUpdate:g,onRemove:b},ne.id))})]}),O==="random"&&o.jsxs("div",{className:"random-section",children:[o.jsxs("div",{className:"random-group",children:[o.jsx("h4",{children:"Mutate Current Track"}),o.jsx("p",{className:"random-desc",children:"Apply random variations to the current track's voice parameters"}),o.jsxs("div",{className:"random-buttons",children:[o.jsx("button",{onClick:()=>B("subtle"),children:"Subtle"}),o.jsx("button",{onClick:()=>B("moderate"),children:"Moderate"}),o.jsx("button",{onClick:()=>B("extreme"),children:"Extreme"})]})]}),o.jsxs("div",{className:"random-group",children:[o.jsx("h4",{children:"Randomize Scene"}),o.jsx("p",{className:"random-desc",children:"Apply random variations to all tracks"}),o.jsxs("div",{className:"random-buttons",children:[o.jsx("button",{onClick:()=>G("subtle"),children:"Subtle"}),o.jsx("button",{onClick:()=>G("moderate"),children:"Moderate"}),o.jsx("button",{onClick:()=>G("extreme"),children:"Extreme"})]})]}),o.jsxs("div",{className:"random-group",children:[o.jsx("h4",{children:"Micro Jitter"}),o.jsx("p",{className:"random-desc",children:"Continuous subtle variations for organic feel"}),o.jsxs("div",{className:"jitter-controls",children:[o.jsxs("label",{className:"jitter-enable",children:[o.jsx("input",{type:"checkbox",checked:Z,onChange:ne=>I(ne.target.checked,W)}),o.jsx("span",{children:"Enable"})]}),o.jsxs("label",{className:"jitter-amount",children:[o.jsx("span",{children:"Amount"}),o.jsx("input",{type:"range",min:0,max:.1,step:.001,value:W,onChange:ne=>I(Z,parseFloat(ne.target.value))}),o.jsxs("span",{className:"jitter-value",children:[(W*100).toFixed(1),"%"]})]})]})]})]})]})]})}const Qg=["linear","exp","sharp","punch","swell","step"],Yg=[{value:"cycle",label:"Cycle"},{value:"oneshot",label:"One-Shot"},{value:"oneshot-hold",label:"One-Shot Hold"}],Xg=16,Zg=2;function Kg(m,a,l,s){const u=l-a;switch(s){case"linear":return a+u*m;case"exp":return u>=0?a+u*(1-Math.pow(1-m,2.5)):a+u*Math.pow(m,2.5);case"sharp":return a+u*Math.pow(m,.4);case"punch":return a+u*Math.pow(m,.15);case"swell":return a+u*Math.pow(m,2.5);case"step":return m>=1?l:a;default:return a+u*m}}function Sn({envelope:m,onChange:a,label:l,color:s="#00ff88",height:u=80}){const h=T.useRef(null),p=T.useRef(null),[f,g]=T.useState(null),[b,M]=T.useState(null),[S,y]=T.useState(!1),[j,C]=T.useState(!1),[B,G]=T.useState(null),Z=280,W=T.useCallback((P,ee)=>({time:Math.max(0,Math.min(1,P/Z)),value:Math.max(0,Math.min(1,1-ee/u))}),[Z,u]),I=T.useCallback((P,ee)=>({x:P*Z,y:(1-ee)*u}),[Z,u]),Y=T.useCallback((P,ee,ge=10)=>{for(let F=0;F<m.breakpoints.length;F++){const $=m.breakpoints[F],le=I($.time,$.value);if(Math.sqrt(Math.pow(P-le.x,2)+Math.pow(ee-le.y,2))<ge)return F}return-1},[m.breakpoints,I]);T.useEffect(()=>{const P=h.current;if(!P)return;const ee=P.getContext("2d");if(!ee)return;ee.fillStyle="#1a1a1a",ee.fillRect(0,0,Z,u),ee.strokeStyle="#333",ee.lineWidth=1;for(let $=0;$<=4;$++){const le=$/4*u;ee.beginPath(),ee.moveTo(0,le),ee.lineTo(Z,le),ee.stroke()}for(let $=0;$<=4;$++){const le=$/4*Z;ee.beginPath(),ee.moveTo(le,0),ee.lineTo(le,u),ee.stroke()}ee.strokeStyle="#444",ee.beginPath(),ee.moveTo(0,u/2),ee.lineTo(Z,u/2),ee.stroke();const ge=m.breakpoints;if(ge.length<2)return;ee.strokeStyle=s,ee.lineWidth=2,ee.beginPath();const F=200;for(let $=0;$<=F;$++){const le=$/F;let me=ge[0],fe=ge[1];for(let ue=1;ue<ge.length;ue++){if(ge[ue].time>=le){fe=ge[ue],me=ge[ue-1];break}ue===ge.length-1&&(me=ge[ue],fe=ge[0])}let E=fe.time-me.time;E<=0&&(E=1-me.time+fe.time);let U=0;le>=me.time&&le<fe.time&&E>0&&(U=(le-me.time)/E),U=Math.max(0,Math.min(1,U));const _=.5+(Kg(U,me.value,fe.value,fe.curve)-.5)*m.amount,ae=Math.max(0,Math.min(1,_)),ce=I(le,ae);$===0?ee.moveTo(ce.x,ce.y):ee.lineTo(ce.x,ce.y)}ee.stroke();for(let $=0;$<ge.length;$++){const le=ge[$],me=I(le.time,le.value);ee.fillStyle=$===f?"#fff":s,ee.beginPath(),ee.arc(me.x,me.y,6,0,Math.PI*2),ee.fill(),ee.fillStyle="#1a1a1a",ee.beginPath(),ee.arc(me.x,me.y,3,0,Math.PI*2),ee.fill(),$>0&&(ee.fillStyle="#888",ee.font="8px monospace",ee.fillText(le.curve.charAt(0).toUpperCase(),me.x-3,me.y-10))}},[m,Z,u,s,I,f]);const te=T.useCallback(P=>{const ee=h.current?.getBoundingClientRect();if(!ee)return;const ge=P.clientX-ee.left,F=P.clientY-ee.top;if(P.button===2){P.preventDefault();const le=Y(ge,F);le>=0&&M({x:P.clientX,y:P.clientY,index:le});return}const $=Y(ge,F);if($>=0){g($);return}if(m.breakpoints.length<Xg){const{time:le,value:me}=W(ge,F),fe=[...m.breakpoints];let E=fe.findIndex(se=>se.time>le);E===-1&&(E=fe.length);const U={time:le,value:me,curve:"linear"};fe.splice(E,0,U),a({breakpoints:fe})}},[m.breakpoints,Y,W,a]),O=T.useCallback(P=>{if(f===null)return;const ee=h.current?.getBoundingClientRect();if(!ee)return;const ge=P.clientX-ee.left,F=P.clientY-ee.top,{time:$,value:le}=W(ge,F),me=[...m.breakpoints];if(f===0)me[0]={...me[0],time:0,value:le};else if(f===me.length-1)me[f]={...me[f],time:1,value:le};else{const fe=me[f-1].time,E=me[f+1].time,U=Math.max(fe+.01,Math.min(E-.01,$));me[f]={...me[f],time:U,value:le}}a({breakpoints:me})},[f,m.breakpoints,W,a]),w=T.useCallback(()=>{g(null)},[]),L=T.useCallback(P=>{P.preventDefault()},[]),ne=T.useCallback(()=>{if(b===null)return;if(m.breakpoints.length<=Zg){M(null);return}if(b.index===0||b.index===m.breakpoints.length-1){M(null);return}const P=m.breakpoints.filter((ee,ge)=>ge!==b.index);a({breakpoints:P}),M(null)},[b,m.breakpoints,a]),Me=T.useCallback(P=>{if(b===null)return;const ee=[...m.breakpoints];ee[b.index]={...ee[b.index],curve:P},a({breakpoints:ee}),M(null)},[b,m.breakpoints,a]);T.useEffect(()=>{const P=()=>M(null);if(b)return document.addEventListener("click",P),()=>document.removeEventListener("click",P)},[b]),T.useEffect(()=>{const P=ee=>{const ge=ee.target;!ge.closest(".ee-preset-menu")&&!ge.closest(".ee-preset-btn")&&(C(!1),G(null))};if(j)return document.addEventListener("click",P),()=>document.removeEventListener("click",P)},[j]);const Be=T.useCallback(P=>{const ee=Mn.find(ge=>ge.id===P);ee&&(a({breakpoints:[...ee.breakpoints],period:ee.defaultPeriod}),C(!1),G(null))},[a]),qe=nd();return o.jsxs("div",{className:"envelope-editor",ref:p,children:[o.jsxs("div",{className:"ee-header",onClick:()=>y(!S),children:[o.jsx("span",{className:"ee-expand",children:S?"":"+"}),o.jsx("span",{className:"ee-label",children:l}),o.jsxs("span",{className:"ee-summary",style:{color:s},children:[m.breakpoints.length," pts | ",m.period.toFixed(2),"s"]})]}),S&&o.jsxs("div",{className:"ee-content",children:[o.jsx("canvas",{ref:h,width:Z,height:u,className:"ee-canvas",onMouseDown:te,onMouseMove:O,onMouseUp:w,onMouseLeave:w,onContextMenu:L}),o.jsxs("div",{className:"ee-preset-row",children:[o.jsxs("div",{className:"ee-preset-container",children:[o.jsx("button",{className:"ee-preset-btn",onClick:P=>{P.stopPropagation(),C(!j)},children:"Presets "}),j&&o.jsx("div",{className:"ee-preset-menu",children:B===null?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"ee-menu-section",children:"Categories"}),qe.map(P=>o.jsxs("div",{className:"ee-menu-item",onClick:ee=>{ee.stopPropagation(),G(P)},children:[P," "]},P))]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"ee-menu-item ee-back",onClick:P=>{P.stopPropagation(),G(null)},children:" Back"}),o.jsx("div",{className:"ee-menu-section",children:B}),Vv(B).map(P=>o.jsx("div",{className:"ee-menu-item",onClick:ee=>{ee.stopPropagation(),Be(P.id)},title:P.description,children:P.name},P.id))]})})]}),o.jsxs("div",{className:"ee-loop-mode",children:[o.jsx("label",{children:"Mode:"}),o.jsx("select",{value:m.loopMode||"cycle",onChange:P=>a({loopMode:P.target.value}),children:Yg.map(P=>o.jsx("option",{value:P.value,children:P.label},P.value))})]})]}),o.jsxs("div",{className:"ee-controls",children:[o.jsxs("div",{className:"ee-control",children:[o.jsx("label",{children:"Period"}),o.jsx("input",{type:"range",min:.05,max:10,step:.01,value:m.period,onChange:P=>a({period:parseFloat(P.target.value)})}),o.jsxs("span",{children:[m.period.toFixed(2),"s"]})]}),o.jsxs("div",{className:"ee-control",children:[o.jsx("label",{children:"Amount"}),o.jsx("input",{type:"range",min:-1,max:1,step:.01,value:m.amount,onChange:P=>a({amount:parseFloat(P.target.value)})}),o.jsxs("span",{children:[m.amount>0?"+":"",m.amount.toFixed(2)]})]}),o.jsxs("div",{className:"ee-control",children:[o.jsx("label",{children:"Enabled"}),o.jsx("input",{type:"checkbox",checked:m.enabled,onChange:P=>a({enabled:P.target.checked})})]})]}),o.jsx("div",{className:"ee-help",children:"Click to add point | Drag to move | Right-click for options"})]}),b&&o.jsxs("div",{className:"ee-context-menu",style:{left:b.x,top:b.y},children:[o.jsx("div",{className:"ee-menu-section",children:"Curve Type"}),Qg.map(P=>o.jsx("div",{className:`ee-menu-item ${m.breakpoints[b.index]?.curve===P?"active":""}`,onClick:()=>Me(P),children:P},P)),o.jsx("div",{className:"ee-menu-divider"}),o.jsx("div",{className:`ee-menu-item delete ${b.index===0||b.index===m.breakpoints.length-1?"disabled":""}`,onClick:ne,children:"Delete Point"})]})]})}const Jg=[{value:"fm-drum",label:"FM Drum"},{value:"fm-melodic",label:"FM Melodic"},{value:"noise",label:"Noise/Hat"},{value:"complex-morph",label:"Complex Morph"},{value:"sample",label:"Sample"},{value:"ocean",label:"Ocean"}];function Ut({label:m,value:a,min:l,max:s,step:u=.01,unit:h="",logarithmic:p=!1,onChange:f}){const g=a??l,b=C=>p&&l>0?Math.log(Math.max(C,l)/l)/Math.log(s/l):(C-l)/(s-l),M=C=>p&&l>0?l*Math.pow(s/l,C):l+C*(s-l),S=b(g),y=C=>{const B=parseFloat(C.target.value);f(M(B))},j=C=>{if(C==null||isNaN(C))return"";const B=Math.abs(C);return B>=1e3?`${(C/1e3).toFixed(1)}k${h}`:B>=100?`${Math.round(C)}${h}`:B>=10?`${C.toFixed(1)}${h}`:`${C.toFixed(2)}${h}`};return o.jsxs("div",{className:"cm-param",children:[o.jsx("span",{className:"cm-param-label",children:m}),o.jsx("input",{type:"range",min:0,max:1,step:.001,value:S,onChange:y}),o.jsx("span",{className:"cm-param-value",children:j(g)})]})}function jc({name:m,color:a,operator:l,onFreqChange:s,onEnvelopeChange:u}){const[h,p]=T.useState(!0),f=l.envelopes;return o.jsxs("div",{className:"cm-operator-panel",style:{borderColor:a},children:[o.jsxs("div",{className:"cm-operator-header",onClick:()=>p(!h),style:{color:a},children:[o.jsx("span",{className:"cm-expand",children:h?"":""}),o.jsx("span",{children:m}),o.jsxs("span",{className:"cm-op-freq",children:[l.freq.toFixed(1)," Hz"]})]}),h&&o.jsxs("div",{className:"cm-operator-content",children:[o.jsx("div",{className:"cm-op-row",children:o.jsx(Ut,{label:"Base Freq",value:l.freq,min:20,max:2e3,logarithmic:!0,unit:"Hz",onChange:s})}),o.jsx(Sn,{label:"Pitch Envelope",color:a,envelope:f.pitch,onChange:g=>u("pitch",g)}),o.jsx("div",{className:"cm-range-row",children:o.jsx(Ut,{label:"Pitch Range",value:f.pitchRange,min:0,max:500,unit:"Hz",onChange:g=>u("pitchRange",g)})}),o.jsx(Sn,{label:"Index Envelope",color:a,envelope:f.index,onChange:g=>u("index",g)}),o.jsxs("div",{className:"cm-range-row",children:[o.jsx(Ut,{label:"Index Min",value:f.indexMin,min:0,max:20,onChange:g=>u("indexMin",g)}),o.jsx(Ut,{label:"Index Max",value:f.indexMax,min:0,max:30,onChange:g=>u("indexMax",g)})]}),o.jsx(Sn,{label:"Level Envelope",color:a,envelope:f.level,onChange:g=>u("level",g)}),o.jsx("div",{className:"cm-range-row",children:o.jsx(Ut,{label:"Level Max",value:f.levelMax,min:0,max:2,onChange:g=>u("levelMax",g)})})]})]})}const Xs={breakpoints:[{time:0,value:.5,curve:"linear"},{time:1,value:.5,curve:"linear"}],period:1,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},od={breakpoints:[{time:0,value:1,curve:"linear"},{time:1,value:1,curve:"linear"}],period:1,syncToTempo:!1,amount:1,enabled:!0,loopMode:"cycle"},$g={pitch:{...Xs},pitchRange:100,index:{...Xs},indexMin:0,indexMax:10,level:{...od},levelMax:1},Nc={freq:220,envelopes:{...$g}};function Wg({trackId:m,params:a,preset:l,onParamChange:s,onPresetChange:u,onVoiceChange:h}){const[p,f]=T.useState(!0),g=Object.keys(bn),b=T.useCallback(C=>{h?.(m,C.target.value)},[m,h]),M=a??{carrierFreq:110,carrierPitchEnv:{...Xs},carrierPitchRange:50,opA:{...Nc,freq:220},opB:{...Nc,freq:330},opC:{...Nc,freq:165},ampEnv:{...od},notchFreq:800,notchQ:12,notchEnv:{...Xs},notchRange:600,outputLevel:.7,gain:.8},S=T.useCallback(C=>{u(m,C.target.value)},[m,u]),y=T.useCallback((C,B)=>{const Z={...M[C],freq:B};s(m,{[C]:Z})},[m,M,s]),j=T.useCallback((C,B,G)=>{const Z=M[C],W=Z.envelopes;let I;B==="pitch"||B==="index"||B==="level"?I={...W,[B]:{...W[B],...G}}:I={...W,[B]:G};const Y={...Z,envelopes:I};s(m,{[C]:Y})},[m,M,s]);return o.jsxs("div",{className:"complex-morph-panel",children:[o.jsxs("div",{className:"cm-header",onClick:()=>f(!p),children:[o.jsx("span",{className:"cm-expand-icon",children:p?"":""}),o.jsx("span",{className:"cm-title",children:"THE STRUCTURALIST"}),o.jsx("span",{className:"cm-subtitle",children:"Complex Morph FM"}),l&&o.jsx("span",{className:"cm-preset-badge",children:l})]}),p&&o.jsxs("div",{className:"cm-content",children:[o.jsxs("div",{className:"cm-preset-row",children:[o.jsx("label",{children:"Voice"}),o.jsx("select",{value:"complex-morph",onChange:b,children:Jg.map(C=>o.jsx("option",{value:C.value,children:C.label},C.value))}),o.jsx("label",{children:"Preset"}),o.jsxs("select",{value:l,onChange:S,children:[o.jsx("option",{value:"",children:"Custom"}),g.map(C=>o.jsx("option",{value:C,children:C},C))]})]}),o.jsxs("div",{className:"cm-carrier-section",children:[o.jsx("div",{className:"cm-section-title",children:"CARRIER"}),o.jsx(Ut,{label:"Frequency",value:M.carrierFreq,min:20,max:2e3,logarithmic:!0,unit:"Hz",onChange:C=>s(m,{carrierFreq:C})}),o.jsx(Sn,{label:"Carrier Pitch Env",color:"#ffaa00",envelope:M.carrierPitchEnv,onChange:C=>s(m,{carrierPitchEnv:{...M.carrierPitchEnv,...C}})}),o.jsx("div",{className:"cm-range-row",children:o.jsx(Ut,{label:"Pitch Range",value:M.carrierPitchRange,min:0,max:500,unit:"Hz",onChange:C=>s(m,{carrierPitchRange:C})})})]}),o.jsxs("div",{className:"cm-topology",children:[o.jsx("div",{className:"cm-topology-title",children:"FM: (Op A + Op B)  Op C  Carrier"}),o.jsxs("div",{className:"cm-topology-diagram",children:[o.jsx("div",{className:"cm-topo-box cm-op-a",children:"A"}),o.jsx("span",{className:"cm-topo-plus",children:"+"}),o.jsx("div",{className:"cm-topo-box cm-op-b",children:"B"}),o.jsx("span",{className:"cm-topo-arrow",children:""}),o.jsx("div",{className:"cm-topo-box cm-op-c",children:"C"}),o.jsx("span",{className:"cm-topo-arrow",children:""}),o.jsx("div",{className:"cm-topo-box cm-carrier",children:"Car"}),o.jsx("span",{className:"cm-topo-arrow",children:""}),o.jsx("div",{className:"cm-topo-box cm-notch",children:""})]})]}),o.jsx(jc,{name:"Operator A",color:"#00ff88",operator:M.opA,onFreqChange:C=>y("opA",C),onEnvelopeChange:(C,B)=>j("opA",C,B)}),o.jsx(jc,{name:"Operator B",color:"#00aaff",operator:M.opB,onFreqChange:C=>y("opB",C),onEnvelopeChange:(C,B)=>j("opB",C,B)}),o.jsx(jc,{name:"Operator C",color:"#ff66aa",operator:M.opC,onFreqChange:C=>y("opC",C),onEnvelopeChange:(C,B)=>j("opC",C,B)}),o.jsxs("div",{className:"cm-amp-section",children:[o.jsx("div",{className:"cm-section-title",children:"AMP ENVELOPE"}),o.jsx(Sn,{label:"Master Amplitude",color:"#ffffff",envelope:M.ampEnv,onChange:C=>s(m,{ampEnv:{...M.ampEnv,...C}})})]}),o.jsxs("div",{className:"cm-notch-section",children:[o.jsx("div",{className:"cm-section-title",children:"NOTCH FILTER"}),o.jsxs("div",{className:"cm-notch-row",children:[o.jsx(Ut,{label:"Frequency",value:M.notchFreq,min:100,max:1e4,logarithmic:!0,unit:"Hz",onChange:C=>s(m,{notchFreq:C})}),o.jsx(Ut,{label:"Q",value:M.notchQ,min:1,max:30,onChange:C=>s(m,{notchQ:C})})]}),o.jsx(Sn,{label:"Filter Envelope",color:"#aa66ff",envelope:M.notchEnv,onChange:C=>s(m,{notchEnv:{...M.notchEnv,...C}})}),o.jsx("div",{className:"cm-range-row",children:o.jsx(Ut,{label:"Filter Range",value:M.notchRange,min:0,max:2e3,unit:"Hz",onChange:C=>s(m,{notchRange:C})})})]}),o.jsxs("div",{className:"cm-output-section",children:[o.jsx("div",{className:"cm-section-title",children:"OUTPUT"}),o.jsxs("div",{className:"cm-output-row",children:[o.jsx(Ut,{label:"Level",value:M.outputLevel,min:0,max:1,onChange:C=>s(m,{outputLevel:C})}),o.jsx(Ut,{label:"Gain",value:M.gain,min:0,max:1,onChange:C=>s(m,{gain:C})})]})]})]})]})}const Oc=[{value:"fm-drum",label:"FM Drum"},{value:"fm-melodic",label:"FM Melodic"},{value:"noise",label:"Noise/Hat"},{value:"complex-morph",label:"Complex Morph"},{value:"sample",label:"Sample"},{value:"ocean",label:"Ocean"},{value:"plaits-va",label:"Virtual Analog",group:"Plaits Melodic"},{value:"plaits-waveshaper",label:"Waveshaper",group:"Plaits Melodic"},{value:"plaits-fm",label:"FM",group:"Plaits Melodic"},{value:"plaits-formant",label:"Formant",group:"Plaits Melodic"},{value:"plaits-additive",label:"Additive",group:"Plaits Melodic"},{value:"plaits-wavetable",label:"Wavetable",group:"Plaits Melodic"},{value:"plaits-chords",label:"Chords",group:"Plaits Melodic"},{value:"plaits-speech",label:"Speech",group:"Plaits Melodic"},{value:"plaits-grain",label:"Grain Cloud",group:"Plaits Perc"},{value:"plaits-noise",label:"Filtered Noise",group:"Plaits Perc"},{value:"plaits-particle",label:"Particle Noise",group:"Plaits Perc"},{value:"plaits-string",label:"Inharmonic String",group:"Plaits Perc"},{value:"plaits-modal",label:"Modal Resonator",group:"Plaits Perc"},{value:"plaits-kick",label:"Analog Kick",group:"Plaits Perc"},{value:"plaits-snare",label:"Analog Snare",group:"Plaits Perc"},{value:"plaits-hihat",label:"Analog Hi-Hat",group:"Plaits Perc"}];function at({label:m,value:a,min:l,max:s,step:u=.01,unit:h="",onChange:p}){return o.jsx("div",{className:"param-slider",children:o.jsxs("label",{children:[o.jsx("span",{className:"param-label",children:m}),o.jsx("input",{type:"range",min:l,max:s,step:u,value:a,onChange:f=>p(parseFloat(f.target.value))}),o.jsxs("span",{className:"param-value",children:[a.toFixed(u<1?2:0),h]})]})})}function Ig({trackId:m,startPoint:a,onStartPointChange:l,refreshKey:s}){const u=T.useRef(null),[h,p]=T.useState(null),[f,g]=T.useState("");T.useEffect(()=>{try{const M=R.getVoice(m);if(M&&"getWaveformData"in M){const S=M.getWaveformData(200);p(S),g(M.getSampleName?.()||"")}}catch(M){console.error("Error getting waveform data:",M)}},[m,s]),T.useEffect(()=>{const M=u.current;if(!M)return;const S=M.getContext("2d");if(!S)return;const y=M.width,j=M.height;if(S.fillStyle="#1a1a2e",S.fillRect(0,0,y,j),h){S.strokeStyle="#4ade80",S.lineWidth=1,S.beginPath();const B=j/2,G=j/2-4;for(let Z=0;Z<h.length;Z++){const W=Z/h.length*y,I=B-h[Z]*G;Z===0?S.moveTo(W,I):S.lineTo(W,I)}S.stroke(),S.beginPath();for(let Z=0;Z<h.length;Z++){const W=Z/h.length*y,I=B+h[Z]*G;Z===0?S.moveTo(W,I):S.lineTo(W,I)}S.stroke()}else S.fillStyle="#666",S.font="12px monospace",S.textAlign="center",S.fillText("No sample loaded",y/2,j/2);const C=a*y;S.strokeStyle="#f97316",S.lineWidth=2,S.beginPath(),S.moveTo(C,0),S.lineTo(C,j),S.stroke(),S.fillStyle="#f97316",S.beginPath(),S.moveTo(C-5,0),S.lineTo(C+5,0),S.lineTo(C,8),S.closePath(),S.fill()},[h,a]);const b=T.useCallback(M=>{const S=u.current;if(!S)return;const y=S.getBoundingClientRect(),C=(M.clientX-y.left)/y.width;l(Math.max(0,Math.min(1,C)))},[l]);return o.jsxs("div",{className:"waveform-container",children:[o.jsx("canvas",{ref:u,width:400,height:80,onClick:b,className:"waveform-canvas"}),f&&o.jsx("div",{className:"sample-name",children:f})]})}function e1({trackId:m,params:a,onChange:l,onPresetChange:s,onVoiceChange:u,currentPreset:h,channelParams:p,onChannelChange:f}){const[g,b]=T.useState(!0),M=T.useRef(null),[S,y]=T.useState(!1),[j,C]=T.useState(0),B=a.mode??"standard",G=Object.keys(yn),Z=T.useCallback(L=>{l({mode:L})},[l]),W=T.useCallback(async L=>{try{const ne=R.getVoice(m);if(!ne){console.error("No voice found for track:",m);return}if(!("loadSampleFromFile"in ne)){console.error("Voice does not support sample loading:",ne);return}await ne.loadSampleFromFile(L),C(Me=>Me+1),l({})}catch(ne){console.error("Failed to load sample:",ne)}},[m,l]),I=T.useCallback(L=>{console.log("[SamplePanel] File input change event",L.target.files);const ne=L.target.files?.[0];ne&&(console.log("[SamplePanel] File selected:",ne.name,ne.type),W(ne))},[W]),Y=T.useCallback(L=>{L.preventDefault(),y(!1),console.log("[SamplePanel] Drop event",L.dataTransfer.files);const ne=L.dataTransfer.files[0];ne&&(console.log("[SamplePanel] Dropped file:",ne.name,ne.type),ne.type.startsWith("audio/")?W(ne):console.log("[SamplePanel] File is not audio type:",ne.type))},[W]),te=T.useCallback(L=>{L.preventDefault(),y(!0)},[]),O=T.useCallback(()=>{y(!1)},[]),w=T.useCallback(L=>{const ne=L.target.value;ne!=="sample"&&u&&u(m,ne)},[m,u]);return o.jsxs("div",{className:"sample-panel",children:[o.jsxs("div",{className:"sample-panel-header",onClick:()=>b(!g),children:[o.jsx("span",{className:"expand-icon",children:g?"":""}),o.jsx("span",{className:"panel-title",children:"SAMPLE"}),h&&o.jsx("span",{className:"preset-label",children:h})]}),g&&o.jsxs("div",{className:"sample-panel-content",children:[o.jsxs("div",{className:"preset-row",children:[o.jsx("label",{children:"Voice"}),o.jsxs("select",{value:"sample",onChange:w,children:[Oc.filter(L=>!L.group).map(L=>o.jsx("option",{value:L.value,children:L.label},L.value)),o.jsx("optgroup",{label:"Plaits Melodic",children:Oc.filter(L=>L.group==="Plaits Melodic").map(L=>o.jsx("option",{value:L.value,children:L.label},L.value))}),o.jsx("optgroup",{label:"Plaits Percussion",children:Oc.filter(L=>L.group==="Plaits Perc").map(L=>o.jsx("option",{value:L.value,children:L.label},L.value))})]}),o.jsx("label",{children:"Preset"}),o.jsxs("select",{value:h??"",onChange:L=>s(L.target.value),children:[o.jsx("option",{value:"",children:"Custom"}),G.map(L=>o.jsx("option",{value:L,children:L},L))]})]}),o.jsxs("div",{className:"mode-toggle",children:[o.jsx("button",{className:B==="standard"?"active":"",onClick:()=>Z("standard"),children:"STANDARD"}),o.jsx("button",{className:B==="granular"?"active":"",onClick:()=>Z("granular"),children:"GRANULAR"})]}),o.jsxs("div",{className:`sample-drop-zone ${S?"dragging":""}`,onDrop:Y,onDragOver:te,onDragLeave:O,onClick:()=>{console.log("[SamplePanel] Drop zone clicked, triggering file input"),M.current?.click()},children:[o.jsx("input",{ref:M,type:"file",accept:"audio/*",onChange:I,style:{display:"none"}}),o.jsx("span",{children:"Drop audio file or click to load"})]}),o.jsx(Ig,{trackId:m,startPoint:a.startPoint??0,onStartPointChange:L=>l({startPoint:L}),refreshKey:j}),B==="standard"?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Playback"}),o.jsx(at,{label:"Start",value:a.startPoint??0,min:0,max:1,onChange:L=>l({startPoint:L})}),o.jsx(at,{label:"Pitch",value:a.pitch??0,min:-24,max:24,step:1,unit:" st",onChange:L=>l({pitch:L})}),o.jsxs("div",{className:"direction-toggle",children:[o.jsx("label",{children:"Direction"}),o.jsx("button",{className:(a.direction??"forward")==="forward"?"active":"",onClick:()=>l({direction:"forward"}),children:"FWD"}),o.jsx("button",{className:a.direction==="reverse"?"active":"",onClick:()=>l({direction:"reverse"}),children:"REV"})]})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Envelope"}),o.jsx(at,{label:"Attack",value:a.attack??.001,min:.001,max:2,onChange:L=>l({attack:L})}),o.jsx(at,{label:"Decay",value:a.decay??.1,min:.001,max:2,onChange:L=>l({decay:L})}),o.jsx(at,{label:"Sustain",value:a.sustain??1,min:0,max:1,onChange:L=>l({sustain:L})}),o.jsx(at,{label:"Release",value:a.release??.1,min:.001,max:5,onChange:L=>l({release:L})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Lowpass Filter"}),o.jsx("div",{className:"filter-toggle",children:o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.lpEnabled??!1,onChange:L=>l({lpEnabled:L.target.checked})}),"Enable"]})}),o.jsx(at,{label:"Cutoff",value:a.lpCutoff??2e4,min:20,max:2e4,step:10,unit:" Hz",onChange:L=>l({lpCutoff:L})}),o.jsx(at,{label:"Resonance",value:a.lpResonance??0,min:0,max:20,onChange:L=>l({lpResonance:L})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Highpass Filter"}),o.jsx("div",{className:"filter-toggle",children:o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.hpEnabled??!1,onChange:L=>l({hpEnabled:L.target.checked})}),"Enable"]})}),o.jsx(at,{label:"Cutoff",value:a.hpCutoff??20,min:20,max:2e4,step:10,unit:" Hz",onChange:L=>l({hpCutoff:L})}),o.jsx(at,{label:"Resonance",value:a.hpResonance??0,min:0,max:20,onChange:L=>l({hpResonance:L})})]})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Scan"}),o.jsx(at,{label:"Start",value:a.startPoint??0,min:0,max:1,onChange:L=>l({startPoint:L})}),o.jsx(at,{label:"Speed",value:a.scanSpeed??1,min:0,max:8,step:.1,unit:"x",onChange:L=>l({scanSpeed:L})})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Grains"}),o.jsx(at,{label:"Length",value:(a.grainLength??.05)*1e3,min:1,max:1e3,step:1,unit:" ms",onChange:L=>l({grainLength:L/1e3})}),o.jsx(at,{label:"Density",value:a.grainDensity??20,min:1,max:100,step:1,unit:" /s",onChange:L=>l({grainDensity:L})}),o.jsx(at,{label:"Spread",value:a.spread??0,min:0,max:1,onChange:L=>l({spread:L})}),o.jsx(at,{label:"Pan",value:a.grainPan??0,min:-1,max:1,onChange:L=>l({grainPan:L})})]})]}),o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Output"}),o.jsx(at,{label:"Gain",value:a.gain??.8,min:0,max:1,onChange:L=>l({gain:L})})]}),p&&f&&o.jsx(Hc,{params:p.filter,onChange:L=>f(m,{filter:{...p.filter,...L}})}),p&&f&&o.jsxs("div",{className:"param-group",children:[o.jsx("h4",{children:"Saturation"}),o.jsx("div",{className:"saturation-mode-selector",children:Vc.map(({mode:L,label:ne,description:Me})=>o.jsx("button",{className:`saturation-mode-btn ${p.saturation.mode===L?"active":""}`,onClick:()=>f(m,{saturation:{...p.saturation,mode:L}}),title:Me,children:ne},L))}),o.jsx(at,{label:"Drive",value:p.saturation.drive,min:0,max:1,onChange:L=>f(m,{saturation:{...p.saturation,drive:L}})}),o.jsx(at,{label:"Mix",value:p.saturation.mix,min:0,max:1,onChange:L=>f(m,{saturation:{...p.saturation,mix:L}})}),o.jsxs("div",{className:"saturation-advanced",children:[o.jsx(at,{label:"Bias",value:p.saturation.bias,min:-1,max:1,onChange:L=>f(m,{saturation:{...p.saturation,bias:L}})}),o.jsxs("div",{className:"harmonics-selector",children:[o.jsx("span",{className:"param-label",children:"Harmonics"}),o.jsx("div",{className:"harmonics-buttons",children:["even","odd","both"].map(L=>o.jsx("button",{className:`harmonics-btn ${p.saturation.harmonics===L?"active":""}`,onClick:()=>f(m,{saturation:{...p.saturation,harmonics:L}}),children:L.charAt(0).toUpperCase()+L.slice(1)},L))})]})]})]})]})]})}const Pc=[{value:"fm-drum",label:"FM Drum"},{value:"fm-melodic",label:"FM Melodic"},{value:"noise",label:"Noise/Hat"},{value:"complex-morph",label:"Complex Morph"},{value:"sample",label:"Sample"},{value:"ocean",label:"Ocean"},{value:"plaits-va",label:"Virtual Analog",group:"Plaits Melodic"},{value:"plaits-waveshaper",label:"Waveshaper",group:"Plaits Melodic"},{value:"plaits-fm",label:"FM",group:"Plaits Melodic"},{value:"plaits-formant",label:"Formant",group:"Plaits Melodic"},{value:"plaits-additive",label:"Additive",group:"Plaits Melodic"},{value:"plaits-wavetable",label:"Wavetable",group:"Plaits Melodic"},{value:"plaits-chords",label:"Chords",group:"Plaits Melodic"},{value:"plaits-speech",label:"Speech",group:"Plaits Melodic"},{value:"plaits-grain",label:"Grain Cloud",group:"Plaits Perc"},{value:"plaits-noise",label:"Filtered Noise",group:"Plaits Perc"},{value:"plaits-particle",label:"Particle Noise",group:"Plaits Perc"},{value:"plaits-string",label:"Inharmonic String",group:"Plaits Perc"},{value:"plaits-modal",label:"Modal Resonator",group:"Plaits Perc"},{value:"plaits-kick",label:"Analog Kick",group:"Plaits Perc"},{value:"plaits-snare",label:"Analog Snare",group:"Plaits Perc"},{value:"plaits-hihat",label:"Analog Hi-Hat",group:"Plaits Perc"}],t1=[{value:"hanning",label:"Hanning"},{value:"trapezoid",label:"Trapezoid"},{value:"exponentialUp",label:"Exp Up"},{value:"exponentialDown",label:"Exp Down"},{value:"rectangle",label:"Rectangle"},{value:"trapezium",label:"Trapezium"}];function Kt({label:m,value:a,min:l,max:s,step:u=.01,unit:h="",onChange:p}){return o.jsx("div",{className:"ocean-param-slider",children:o.jsxs("label",{children:[o.jsx("span",{className:"param-label",children:m}),o.jsx("input",{type:"range",min:l,max:s,step:u,value:a,onChange:f=>p(parseFloat(f.target.value))}),o.jsxs("span",{className:"param-value",children:[a.toFixed(u<1?2:0),h]})]})})}function a1({trackId:m,position:a,spread:l,onPositionChange:s,refreshKey:u}){const h=T.useRef(null),[p,f]=T.useState(null),[g,b]=T.useState("");T.useEffect(()=>{try{const S=R.getVoice(m);if(S&&"getWaveformData"in S){const y=S.getWaveformData(200);f(y),b(S.getSampleName?.()||"")}}catch(S){console.error("Error getting waveform data:",S)}},[m,u]),T.useEffect(()=>{const S=h.current;if(!S)return;const y=S.getContext("2d");if(!y)return;const j=S.width,C=S.height;if(y.fillStyle="#1a1a2e",y.fillRect(0,0,j,C),p){y.strokeStyle="#06b6d4",y.lineWidth=1,y.beginPath();const Z=C/2,W=C/2-4;for(let I=0;I<p.length;I++){const Y=I/p.length*j,te=Z-p[I]*W;I===0?y.moveTo(Y,te):y.lineTo(Y,te)}y.stroke(),y.beginPath();for(let I=0;I<p.length;I++){const Y=I/p.length*j,te=Z+p[I]*W;I===0?y.moveTo(Y,te):y.lineTo(Y,te)}y.stroke()}else y.fillStyle="#666",y.font="12px monospace",y.textAlign="center",y.fillText("No sample loaded",j/2,C/2);const B=a/100*j,G=l/100*j;y.fillStyle="rgba(6, 182, 212, 0.2)",y.fillRect(B-G/2,0,G,C),y.strokeStyle="#06b6d4",y.lineWidth=2,y.beginPath(),y.moveTo(B,0),y.lineTo(B,C),y.stroke(),y.fillStyle="#06b6d4",y.beginPath(),y.moveTo(B-5,0),y.lineTo(B+5,0),y.lineTo(B,8),y.closePath(),y.fill()},[p,a,l]);const M=T.useCallback(S=>{const y=h.current;if(!y)return;const j=y.getBoundingClientRect(),B=(S.clientX-j.left)/j.width*100;s(Math.max(0,Math.min(100,B)))},[s]);return o.jsxs("div",{className:"ocean-waveform-container",children:[o.jsx("canvas",{ref:h,width:400,height:80,onClick:M,className:"ocean-waveform-canvas"}),g&&o.jsx("div",{className:"ocean-sample-name",children:g})]})}function i1({trackId:m,params:a,onChange:l,onPresetChange:s,onVoiceChange:u,currentPreset:h,channelParams:p,onChannelChange:f}){const[g,b]=T.useState(!0),M=T.useRef(null),[S,y]=T.useState(!1),[j,C]=T.useState(0),B=[],G=T.useCallback(async O=>{try{const w=R.getVoice(m);if(!w){console.error("No voice found for track:",m);return}if(!("loadSampleFromFile"in w)){console.error("Voice does not support sample loading:",w);return}await w.loadSampleFromFile(O),C(L=>L+1),l({})}catch(w){console.error("Failed to load sample:",w)}},[m,l]),Z=T.useCallback(O=>{const w=O.target.files?.[0];w&&G(w)},[G]),W=T.useCallback(O=>{O.preventDefault(),y(!1);const w=O.dataTransfer.files[0];w&&w.type.startsWith("audio/")&&G(w)},[G]),I=T.useCallback(O=>{O.preventDefault(),y(!0)},[]),Y=T.useCallback(()=>{y(!1)},[]),te=T.useCallback(O=>{const w=O.target.value;w!=="ocean"&&u&&u(m,w)},[m,u]);return o.jsxs("div",{className:"ocean-panel",children:[o.jsxs("div",{className:"ocean-panel-header",onClick:()=>b(!g),children:[o.jsx("span",{className:"expand-icon",children:g?"":""}),o.jsx("span",{className:"panel-title",children:"OCEAN"}),h&&o.jsx("span",{className:"preset-label",children:h})]}),g&&o.jsxs("div",{className:"ocean-panel-content",children:[o.jsxs("div",{className:"ocean-preset-row",children:[o.jsx("label",{children:"Voice"}),o.jsxs("select",{value:"ocean",onChange:te,children:[Pc.filter(O=>!O.group).map(O=>o.jsx("option",{value:O.value,children:O.label},O.value)),o.jsx("optgroup",{label:"Plaits Melodic",children:Pc.filter(O=>O.group==="Plaits Melodic").map(O=>o.jsx("option",{value:O.value,children:O.label},O.value))}),o.jsx("optgroup",{label:"Plaits Percussion",children:Pc.filter(O=>O.group==="Plaits Perc").map(O=>o.jsx("option",{value:O.value,children:O.label},O.value))})]}),o.jsx("label",{children:"Preset"}),o.jsxs("select",{value:h??"",onChange:O=>s(O.target.value),children:[o.jsx("option",{value:"",children:"Custom"}),B.map(O=>o.jsx("option",{value:O,children:O},O))]})]}),o.jsxs("div",{className:`ocean-drop-zone ${S?"dragging":""}`,onDrop:W,onDragOver:I,onDragLeave:Y,onClick:()=>M.current?.click(),children:[o.jsx("input",{ref:M,type:"file",accept:"audio/*",onChange:Z,style:{display:"none"}}),o.jsx("span",{children:"Drop audio file or click to load"})]}),o.jsx(a1,{trackId:m,position:a.position??50,spread:a.spread??10,onPositionChange:O=>l({position:O}),refreshKey:j}),o.jsxs("div",{className:"ocean-param-group",children:[o.jsx("h4",{children:"Pitch"}),o.jsx(Kt,{label:"Pitch",value:a.pitch??0,min:-24,max:24,step:1,unit:" st",onChange:O=>l({pitch:O})})]}),o.jsxs("div",{className:"ocean-param-group",children:[o.jsx("h4",{children:"Grains"}),o.jsx(Kt,{label:"Size",value:a.grainSize??100,min:10,max:4e3,step:1,unit:" ms",onChange:O=>l({grainSize:O})}),o.jsx(Kt,{label:"Density",value:a.density??100,min:0,max:200,step:1,unit:"%",onChange:O=>l({density:O})}),o.jsx(Kt,{label:"Position",value:a.position??50,min:0,max:100,step:1,unit:"%",onChange:O=>l({position:O})}),o.jsx(Kt,{label:"Spread",value:a.spread??10,min:0,max:100,step:1,unit:"%",onChange:O=>l({spread:O})}),o.jsxs("div",{className:"ocean-shape-select",children:[o.jsx("label",{children:"Shape"}),o.jsx("select",{value:a.grainShape??"hanning",onChange:O=>l({grainShape:O.target.value}),children:t1.map(O=>o.jsx("option",{value:O.value,children:O.label},O.value))})]})]}),o.jsxs("div",{className:"ocean-param-group",children:[o.jsx("h4",{children:"Filters"}),o.jsx(Kt,{label:"HPF",value:a.hpfFreq??20,min:20,max:2e4,step:1,unit:" Hz",onChange:O=>l({hpfFreq:O})}),o.jsx(Kt,{label:"LPF",value:a.lpfFreq??2e4,min:20,max:2e4,step:1,unit:" Hz",onChange:O=>l({lpfFreq:O})})]}),o.jsxs("div",{className:"ocean-param-group",children:[o.jsx("h4",{children:"Output"}),o.jsx(Kt,{label:"Volume",value:a.volume??80,min:0,max:100,step:1,unit:"%",onChange:O=>l({volume:O})})]}),p&&f&&o.jsx(Hc,{params:p.filter,onChange:O=>f(m,{filter:{...p.filter,...O}})}),p&&f&&o.jsxs("div",{className:"ocean-param-group",children:[o.jsx("h4",{children:"Saturation"}),o.jsx("div",{className:"saturation-mode-selector",children:Vc.map(({mode:O,label:w,description:L})=>o.jsx("button",{className:`saturation-mode-btn ${p.saturation.mode===O?"active":""}`,onClick:()=>f(m,{saturation:{...p.saturation,mode:O}}),title:L,children:w},O))}),o.jsx(Kt,{label:"Drive",value:p.saturation.drive,min:0,max:1,onChange:O=>f(m,{saturation:{...p.saturation,drive:O}})}),o.jsx(Kt,{label:"Mix",value:p.saturation.mix,min:0,max:1,onChange:O=>f(m,{saturation:{...p.saturation,mix:O}})}),o.jsxs("div",{className:"saturation-advanced",children:[o.jsx(Kt,{label:"Bias",value:p.saturation.bias,min:-1,max:1,onChange:O=>f(m,{saturation:{...p.saturation,bias:O}})}),o.jsxs("div",{className:"harmonics-selector",children:[o.jsx("span",{className:"param-label",children:"Harmonics"}),o.jsx("div",{className:"harmonics-buttons",children:["even","odd","both"].map(O=>o.jsx("button",{className:`harmonics-btn ${p.saturation.harmonics===O?"active":""}`,onClick:()=>f(m,{saturation:{...p.saturation,harmonics:O}}),children:O.charAt(0).toUpperCase()+O.slice(1)},O))})]})]})]})]})]})}function n1({value:m,min:a,max:l,onChange:s,height:u=100}){const h=T.useRef(null),[p,f]=T.useState(!1),g=l-a,M=(m-a)/g*u,S=T.useCallback(y=>{y.preventDefault(),f(!0);const j=G=>{if(!h.current)return;const W=h.current.getBoundingClientRect().bottom-G,I=Math.max(0,Math.min(u,W)),Y=a+I/u*g;s(Math.round(Y*100)/100)};j(y.clientY);const C=G=>{j(G.clientY)},B=()=>{f(!1),document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",B)};document.addEventListener("mousemove",C),document.addEventListener("mouseup",B)},[a,l,g,u,s]);return o.jsxs("div",{ref:h,className:`vertical-fader-track ${p?"dragging":""}`,style:{height:`${u}px`},onMouseDown:S,children:[o.jsx("div",{className:"vertical-fader-fill",style:{height:`${M}px`}}),o.jsx("div",{className:"vertical-fader-thumb",style:{bottom:`${M-10}px`}})]})}function l1({tracks:m,refreshKey:a}){const[l,s]=T.useState(new Map),u=T.useCallback(()=>{const y=new Map;for(const j of m){const C=R.getChannelParams(j.id),B=R.getTrack(j.id);C&&B?y.set(j.id,{volume:C.volume,pan:C.pan,delaySend:C.delaySend,delaySend2:C.delaySend2,delaySend3:C.delaySend3,delaySend4:C.delaySend4,reverbSend:C.reverbSend,muted:B.muted,solo:B.solo}):y.set(j.id,{volume:.8,pan:0,delaySend:0,delaySend2:0,delaySend3:0,delaySend4:0,reverbSend:0,muted:!1,solo:!1})}s(y)},[m]);T.useEffect(()=>{u()},[u,a]),T.useEffect(()=>R.onStateChange(()=>{u()}),[u]);const h=T.useCallback((y,j)=>{R.updateChannelParams(y,{volume:j}),s(C=>{const B=new Map(C),G=B.get(y);return G&&B.set(y,{...G,volume:j}),B})},[]),p=T.useCallback((y,j)=>{R.updateChannelParams(y,{pan:j}),s(C=>{const B=new Map(C),G=B.get(y);return G&&B.set(y,{...G,pan:j}),B})},[]),f=T.useCallback((y,j,C)=>{R.updateChannelParams(y,{[j]:C}),s(B=>{const G=new Map(B),Z=G.get(y);return Z&&G.set(y,{...Z,[j]:C}),G})},[]),g=T.useCallback(y=>{const j=l.get(y);if(j){const C=!j.muted;R.setTrackMuted(y,C),s(B=>{const G=new Map(B),Z=G.get(y);return Z&&G.set(y,{...Z,muted:C}),G})}},[l]),b=T.useCallback(y=>{const j=l.get(y);if(j){const C=!j.solo;R.setTrackSolo(y,C),s(B=>{const G=new Map(B),Z=G.get(y);return Z&&G.set(y,{...Z,solo:C}),G})}},[l]),M=y=>y===0?"C":y<0?`L${Math.abs(Math.round(y*100))}`:`R${Math.round(y*100)}`,S=y=>{if(y===0)return"-";const j=20*Math.log10(y);return j<=-60?"-":`${j.toFixed(1)}`};return o.jsx("div",{className:"mixer-view",children:o.jsx("div",{className:"mixer-channels",children:m.map(y=>{const j=l.get(y.id);return j?o.jsxs("div",{className:"mixer-channel",children:[o.jsx("div",{className:"channel-name",children:y.name}),o.jsxs("div",{className:"channel-buttons",children:[o.jsx("button",{className:`channel-btn solo-btn ${j.solo?"active":""}`,onClick:()=>b(y.id),title:"Solo",children:"S"}),o.jsx("button",{className:`channel-btn mute-btn ${j.muted?"active":""}`,onClick:()=>g(y.id),title:"Mute",children:"M"})]}),o.jsxs("div",{className:"channel-sends",children:[o.jsxs("div",{className:"send-knob",children:[o.jsx("label",{children:"D1"}),o.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:j.delaySend,onChange:C=>f(y.id,"delaySend",parseFloat(C.target.value)),className:"knob-input"}),o.jsx("span",{className:"send-value",children:Math.round(j.delaySend*100)})]}),o.jsxs("div",{className:"send-knob",children:[o.jsx("label",{children:"D2"}),o.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:j.delaySend2,onChange:C=>f(y.id,"delaySend2",parseFloat(C.target.value)),className:"knob-input"}),o.jsx("span",{className:"send-value",children:Math.round(j.delaySend2*100)})]}),o.jsxs("div",{className:"send-knob",children:[o.jsx("label",{children:"D3"}),o.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:j.delaySend3,onChange:C=>f(y.id,"delaySend3",parseFloat(C.target.value)),className:"knob-input"}),o.jsx("span",{className:"send-value",children:Math.round(j.delaySend3*100)})]}),o.jsxs("div",{className:"send-knob",children:[o.jsx("label",{children:"D4"}),o.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:j.delaySend4,onChange:C=>f(y.id,"delaySend4",parseFloat(C.target.value)),className:"knob-input"}),o.jsx("span",{className:"send-value",children:Math.round(j.delaySend4*100)})]}),o.jsxs("div",{className:"send-knob reverb",children:[o.jsx("label",{children:"REV"}),o.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:j.reverbSend,onChange:C=>f(y.id,"reverbSend",parseFloat(C.target.value)),className:"knob-input"}),o.jsx("span",{className:"send-value",children:Math.round(j.reverbSend*100)})]})]}),o.jsxs("div",{className:"channel-pan",children:[o.jsx("label",{children:"PAN"}),o.jsx("input",{type:"range",min:"-1",max:"1",step:"0.01",value:j.pan,onChange:C=>p(y.id,parseFloat(C.target.value)),className:"pan-input"}),o.jsx("span",{className:"pan-value",children:M(j.pan)})]}),o.jsxs("div",{className:"channel-fader",children:[o.jsx(n1,{value:j.volume,min:0,max:1,onChange:C=>h(y.id,C),height:100}),o.jsx("span",{className:"fader-value",children:S(j.volume)})]})]},y.id):null})})})}console.log("[App] Module loaded, engine:",R);const Ti=[{id:"track1",name:"Track 1"},{id:"track2",name:"Track 2"},{id:"track3",name:"Track 3"},{id:"track4",name:"Track 4"},{id:"track5",name:"Track 5"},{id:"track6",name:"Track 6"},{id:"track7",name:"Track 7"},{id:"track8",name:"Track 8"},{id:"track9",name:"Track 9"},{id:"track10",name:"Track 10"},{id:"track11",name:"Track 11"},{id:"track12",name:"Track 12"}];function s1(){const[m,a]=T.useState(!1),[l,s]=T.useState([]),[u,h]=T.useState(null),[p,f]=T.useState(new Map),[g,b]=T.useState(new Map),[M,S]=T.useState(null),[y,j]=T.useState(null),[C,B]=T.useState(null),[G,Z]=T.useState(null),[W,I]=T.useState(null),[Y,te]=T.useState(null),[O,w]=T.useState(1),[L,ne]=T.useState(1),[Me,Be]=T.useState(1),[qe,P]=T.useState(1),[ee,ge]=T.useState(1),[F,$]=T.useState({...Gc}),[le,me]=T.useState([]),[fe,E]=T.useState([]),[U,se]=T.useState({rate1:.1,rate2:.07,smoothing1:.8,smoothing2:.9}),[k,_]=T.useState([]),[ae,ce]=T.useState(1),[ue,Te]=T.useState(!0),[Rt,Qt]=T.useState(!1),[ia,Aa]=T.useState(.02),[,na]=T.useState({isActive:!1,trackId:"",stepIndex:-1}),[Ai,Tn]=T.useState(!1),[Ks,Rl]=T.useState(0);T.useEffect(()=>{(async()=>{try{console.log("[App] Starting engine initialization..."),await R.init(),console.log("[App] Engine initialized successfully");for(const Se of Ti){console.log(`[App] Creating track: ${Se.id}`),R.createTrack(Se.id,Se.name);const Ne="fm-drum",nt="kick";console.log(`[App] Assigning voice ${Ne} with preset ${nt} to track ${Se.id}`),R.assignVoice({trackId:Se.id,voiceType:Ne,preset:nt}),console.log(`[App] Voice assigned successfully for track ${Se.id}`)}const re=new Map;for(const Se of Ti){const Ne=R.getVoiceConfig(Se.id);Ne&&re.set(Se.id,Ne)}const pe=new Map;for(const Se of Ti){const Ne=R.getChannelParams(Se.id);Ne&&pe.set(Se.id,Ne),R.captureBaseChannelState(Se.id)}b(pe),S(R.getMimeophonParams()),j(R.getMimeophonParams2()),B(R.getMimeophonParams3()),Z(R.getMimeophonParams4()),I(R.getReverbParams()),te(R.getMasterParams()),w(R.getMimeophonReturnLevel()),ne(R.getMimeophonReturnLevel2()),Be(R.getMimeophonReturnLevel3()),P(R.getMimeophonReturnLevel4()),ge(R.getReverbReturnLevel()),me(R.getLFOParams()),E(R.getEnvModParams()),se(R.getSlowRandomParams()),_(R.getModRoutes()),ce(R.getGlobalModDepth()),Te(R.isModEnabled());const je=R.getMicroJitter();Qt(je.enabled),Aa(je.amount),f(re),s(Ti),h("track1"),a(!0),console.log("[App] Initialization complete, setting isInitialized to true")}catch(re){console.error("[App] Failed to initialize engine:",re)}})();const oe=R.onParamLockEditStateChange(re=>{if(na(re),re.isActive){const pe=R.getVoiceConfig(re.trackId),je=R.getStepParamLocks(re.trackId,re.stepIndex);if(pe){const Ne={...pe,params:{...pe.params,...je??{}}};f(nt=>new Map(nt).set(re.trackId,Ne))}R.restoreToBaseChannelState(re.trackId);const Se=R.getChannelParams(re.trackId);if(Se){if(je&&je.filterType!==void 0){const An={0:"bypass",1:"wasp",2:"sem",3:"moog",4:"threeSisters"}[je.filterType]??"bypass";R.updateChannelParams(re.trackId,{filter:{...Se.filter,type:An}})}const Ne=R.getChannelParams(re.trackId);Ne&&b(nt=>new Map(nt).set(re.trackId,Ne))}}else{const pe=R.getAllTracks();for(const je of pe){const Se=R.getVoiceConfig(je.id);Se&&f(nt=>new Map(nt).set(je.id,Se)),R.restoreToBaseChannelState(je.id);const Ne=R.getChannelParams(je.id);Ne&&b(nt=>new Map(nt).set(je.id,Ne))}}});return()=>{R.stop(),oe()}},[]);const ka=T.useCallback((Q,oe,re)=>{R.assignVoice({trackId:Q,voiceType:oe,preset:re});const pe=R.getVoiceConfig(Q);pe&&f(je=>new Map(je).set(Q,pe))},[]),Ea=T.useCallback((Q,oe)=>{const re=R.getParamLockEditState();if(re.isActive&&re.trackId===Q){for(const[Se,Ne]of Object.entries(oe))typeof Ne=="number"&&R.setStepParamLock(Q,re.stepIndex,Se,Ne);const pe=R.getVoiceConfig(Q),je=R.getStepParamLocks(Q,re.stepIndex);if(pe&&je){const Se={...pe,params:{...pe.params,...je}};f(Ne=>new Map(Ne).set(Q,Se))}}else{R.updateVoiceParams(Q,oe);const pe=R.getVoiceConfig(Q);pe&&f(je=>new Map(je).set(Q,pe))}},[]),ja=T.useCallback((Q,oe)=>{R.loadVoicePreset(Q,oe);const re=R.getVoiceConfig(Q);re&&f(pe=>new Map(pe).set(Q,re))},[]),Js=T.useCallback((Q,oe)=>{R.setTrackNote(Q,oe);const re=R.getVoiceConfig(Q);re&&f(pe=>new Map(pe).set(Q,re))},[]),Cn=T.useCallback((Q,oe)=>{const re=R.getParamLockEditState();if(re.isActive&&re.trackId===Q){if(oe.filter){const pe=oe.filter;if(pe.type!==void 0){const je={bypass:0,wasp:1,sem:2,moog:3,threeSisters:4};R.setStepParamLock(Q,re.stepIndex,"filterType",je[pe.type]??0),R.removeStepParamLock(Q,re.stepIndex,"filterCutoff"),R.removeStepParamLock(Q,re.stepIndex,"filterResonance"),R.removeStepParamLock(Q,re.stepIndex,"filterSpan"),R.updateChannelParams(Q,{filter:oe.filter})}pe.wasp?.cutoff!==void 0&&R.setStepParamLock(Q,re.stepIndex,"filterCutoff",pe.wasp.cutoff),pe.wasp?.resonance!==void 0&&R.setStepParamLock(Q,re.stepIndex,"filterResonance",pe.wasp.resonance),pe.sem?.cutoff!==void 0&&R.setStepParamLock(Q,re.stepIndex,"filterCutoff",pe.sem.cutoff),pe.sem?.resonance!==void 0&&R.setStepParamLock(Q,re.stepIndex,"filterResonance",pe.sem.resonance),pe.moog?.cutoff!==void 0&&R.setStepParamLock(Q,re.stepIndex,"filterCutoff",pe.moog.cutoff),pe.moog?.resonance!==void 0&&R.setStepParamLock(Q,re.stepIndex,"filterResonance",pe.moog.resonance),pe.threeSisters?.freq!==void 0&&R.setStepParamLock(Q,re.stepIndex,"filterCutoff",pe.threeSisters.freq),pe.threeSisters?.quality!==void 0&&R.setStepParamLock(Q,re.stepIndex,"filterResonance",pe.threeSisters.quality),pe.threeSisters?.span!==void 0&&R.setStepParamLock(Q,re.stepIndex,"filterSpan",pe.threeSisters.span)}if(oe.saturation){const pe=oe.saturation;pe.drive!==void 0&&R.setStepParamLock(Q,re.stepIndex,"saturationDrive",pe.drive),pe.bias!==void 0&&R.setStepParamLock(Q,re.stepIndex,"saturationBias",pe.bias),pe.mix!==void 0&&R.setStepParamLock(Q,re.stepIndex,"saturationMix",pe.mix)}oe.delaySend!==void 0&&R.setStepParamLock(Q,re.stepIndex,"sendDelay1",oe.delaySend),oe.delaySend2!==void 0&&R.setStepParamLock(Q,re.stepIndex,"sendDelay2",oe.delaySend2),oe.delaySend3!==void 0&&R.setStepParamLock(Q,re.stepIndex,"sendDelay3",oe.delaySend3),oe.delaySend4!==void 0&&R.setStepParamLock(Q,re.stepIndex,"sendDelay4",oe.delaySend4),oe.reverbSend!==void 0&&R.setStepParamLock(Q,re.stepIndex,"sendReverb",oe.reverbSend),oe.volume!==void 0&&R.setStepParamLock(Q,re.stepIndex,"volume",oe.volume),oe.pan!==void 0&&R.setStepParamLock(Q,re.stepIndex,"pan",oe.pan),b(pe=>{const je=pe.get(Q);if(!je)return pe;const Se={...je,...oe};return new Map(pe).set(Q,Se)})}else{R.updateChannelParams(Q,oe),R.captureBaseChannelState(Q);const pe=R.getChannelParams(Q);pe&&b(je=>new Map(je).set(Q,pe))}},[]),ft=T.useCallback(Q=>{R.setMimeophonParams(Q),S(R.getMimeophonParams())},[]),$s=T.useCallback(Q=>{R.setMimeophonParams2(Q),j(R.getMimeophonParams2())},[]),Al=T.useCallback(Q=>{R.setMimeophonParams3(Q),B(R.getMimeophonParams3())},[]),kl=T.useCallback(Q=>{R.setMimeophonParams4(Q),Z(R.getMimeophonParams4())},[]),ki=T.useCallback(Q=>{R.setReverbParams(Q),I(R.getReverbParams())},[]),Ws=T.useCallback(Q=>{R.setMasterParams(Q),te(R.getMasterParams())},[]),El=T.useCallback(Q=>{R.setMimeophonReturnLevel(Q),w(R.getMimeophonReturnLevel())},[]),Is=T.useCallback(Q=>{R.setMimeophonReturnLevel2(Q),ne(R.getMimeophonReturnLevel2())},[]),eo=T.useCallback(Q=>{R.setMimeophonReturnLevel3(Q),Be(R.getMimeophonReturnLevel3())},[]),ti=T.useCallback(Q=>{R.setMimeophonReturnLevel4(Q),P(R.getMimeophonReturnLevel4())},[]),vt=T.useCallback(Q=>{R.setReverbReturnLevel(Q),ge(R.getReverbReturnLevel())},[]),Jt=T.useCallback(Q=>{R.setFXCrossSends(Q),$(R.getFXCrossSends())},[]),gt=T.useCallback((Q,oe)=>{R.setLFOParams(Q,oe),me(R.getLFOParams())},[]),to=T.useCallback((Q,oe)=>{R.setEnvModParams(Q,oe),E(R.getEnvModParams())},[]),ao=T.useCallback((Q,oe,re)=>{R.setSlowRandomParams(Q,oe,re),se(R.getSlowRandomParams())},[]),io=T.useCallback(Q=>{R.addModRoute(Q),_(R.getModRoutes())},[]),Ei=T.useCallback((Q,oe)=>{R.updateModRoute(Q,oe),_(R.getModRoutes())},[]),ji=T.useCallback(Q=>{R.removeModRoute(Q),_(R.getModRoutes())},[]),Ni=T.useCallback(Q=>{R.loadModPreset(Q),_(R.getModRoutes())},[]),la=T.useCallback(Q=>{R.setGlobalModDepth(Q),ce(R.getGlobalModDepth())},[]),Oi=T.useCallback(Q=>{R.setModEnabled(Q),Te(R.isModEnabled())},[]),ai=T.useCallback(Q=>{if(u){R.mutateTrack(u,Q);const oe=R.getVoiceConfig(u);oe&&f(re=>new Map(re).set(u,oe))}},[u]),no=T.useCallback(Q=>{R.randomizeScene(Q);const oe=new Map;for(const re of Ti){const pe=R.getVoiceConfig(re.id);pe&&oe.set(re.id,pe)}f(oe)},[]),jl=T.useCallback((Q,oe)=>{R.setMicroJitter({enabled:Q,amount:oe}),Qt(Q),Aa(oe)},[]),Rn=T.useCallback(()=>{const Q=new Map;for(const oe of Ti){const re=R.getVoiceConfig(oe.id);re&&Q.set(oe.id,re)}f(Q)},[]),ii=T.useCallback(()=>{const Q=new Map;for(const oe of Ti){const re=R.getChannelParams(oe.id);re&&Q.set(oe.id,re)}b(Q),Rl(oe=>oe+1)},[]),lo=T.useCallback(()=>{S(R.getMimeophonParams()),j(R.getMimeophonParams2()),B(R.getMimeophonParams3()),Z(R.getMimeophonParams4()),I(R.getReverbParams()),te(R.getMasterParams()),w(R.getMimeophonReturnLevel()),ne(R.getMimeophonReturnLevel2()),Be(R.getMimeophonReturnLevel3()),P(R.getMimeophonReturnLevel4()),ge(R.getReverbReturnLevel()),$(R.getFXCrossSends())},[]),Nl=T.useCallback(()=>{Tn(Q=>!Q)},[]),Ol=T.useCallback(()=>R.exportPreset(p,g,M,y,C,G,W,Y,O,L,Me,qe,ee,F,le,fe,U,k,ae,ue,Rt,ia),[p,g,M,y,C,G,W,Y,O,L,Me,qe,ee,F,le,fe,U,k,ae,ue,Rt,ia]),Pl=T.useCallback(Q=>{const oe=R.importPreset(Q);f(oe.voiceConfigs),b(oe.channelParams),S(oe.mimeophonParams),j(oe.mimeophonParams2),B(oe.mimeophonParams3),Z(oe.mimeophonParams4),I(oe.reverbParams),te(oe.masterParams),w(oe.mimeophonReturnLevel),ne(oe.mimeophonReturnLevel2),Be(oe.mimeophonReturnLevel3),P(oe.mimeophonReturnLevel4),ge(oe.reverbReturnLevel),$(oe.fxCrossSends),me(oe.lfoParams),E(oe.envModParams),se(oe.slowRandomParams),_(oe.modRoutes),ce(oe.globalModDepth),Te(oe.modEnabled),Qt(oe.microJitterEnabled),Aa(oe.microJitterAmount)},[]);return m?o.jsxs("div",{className:"app",children:[o.jsx("header",{className:"app-header",children:o.jsx("h1",{children:"tQr4x"})}),o.jsxs("main",{className:"app-main",children:[o.jsx("section",{className:"transport-section",children:o.jsx(cg,{onSavePreset:Ol,onLoadPreset:Pl,mixerOpen:Ai,onMixerToggle:Nl})}),Ai&&o.jsx("section",{className:"mixer-section",children:o.jsx(l1,{tracks:l,refreshKey:Ks})}),o.jsxs("section",{className:"pattern-bank-section",children:[o.jsx(pg,{onVoiceConfigsRefresh:Rn,onChannelParamsRefresh:ii,onFXParamsRefresh:lo}),o.jsx(fg,{})]}),o.jsxs("section",{className:"patterns-section",children:[o.jsx("h2",{children:"Tracks"}),o.jsx("div",{className:"track-tabs",children:l.map(Q=>o.jsx("button",{className:`track-tab ${u===Q.id?"active":""}`,onClick:()=>h(Q.id),children:Q.name},Q.id))}),u&&o.jsxs("div",{className:"track-editor",children:[o.jsx(hg,{trackId:u,trackName:l.find(Q=>Q.id===u)?.name??"",isMelodic:Qp(p.get(u)?.voiceType??"fm-drum")}),o.jsx(Ng,{trackId:u,isMelodic:Qp(p.get(u)?.voiceType??"fm-drum")}),p.get(u)?.voiceType==="complex-morph"?o.jsx(Wg,{trackId:u,params:p.get(u)?.params??null,preset:p.get(u)?.preset??"",onParamChange:Ea,onPresetChange:ja,onVoiceChange:ka}):p.get(u)?.voiceType==="sample"?o.jsx(e1,{trackId:u,params:p.get(u)?.params??{},onChange:Q=>Ea(u,Q),onPresetChange:Q=>ja(u,Q),onVoiceChange:ka,currentPreset:p.get(u)?.preset,channelParams:g.get(u)??null,onChannelChange:Cn}):p.get(u)?.voiceType==="ocean"?o.jsx(i1,{trackId:u,params:p.get(u)?.params??{},onChange:Q=>Ea(u,Q),onPresetChange:Q=>ja(u,Q),onVoiceChange:ka,currentPreset:p.get(u)?.preset,channelParams:g.get(u)??null,onChannelChange:Cn}):o.jsx(kg,{trackId:u,config:p.get(u)??null,onVoiceChange:ka,onParamChange:Ea,onPresetChange:ja,onNoteChange:Js,channelParams:g.get(u)??null,onChannelChange:Cn}),M&&y&&C&&G&&W&&Y&&o.jsx(Lg,{mimeophonParams:M,mimeophonParams2:y,mimeophonParams3:C,mimeophonParams4:G,reverbParams:W,masterParams:Y,onMimeophonChange:ft,onMimeophonChange2:$s,onMimeophonChange3:Al,onMimeophonChange4:kl,onReverbChange:ki,onMasterChange:Ws,mimeophonReturnLevel:O,mimeophonReturnLevel2:L,mimeophonReturnLevel3:Me,mimeophonReturnLevel4:qe,reverbReturnLevel:ee,onMimeophonReturnChange:El,onMimeophonReturnChange2:Is,onMimeophonReturnChange3:eo,onMimeophonReturnChange4:ti,onReverbReturnChange:vt,fxCrossSends:F,onFXCrossSendsChange:Jt}),o.jsx(Ug,{lfoParams:le,onLFOChange:gt,envModParams:fe,onEnvModChange:to,slowRandomParams:U,onSlowRandomChange:ao,routes:k,onAddRoute:io,onUpdateRoute:Ei,onRemoveRoute:ji,onLoadModPreset:Ni,globalDepth:ae,onGlobalDepthChange:la,modEnabled:ue,onModEnabledChange:Oi,onMutate:ai,onRandomizeScene:no,microJitterEnabled:Rt,microJitterAmount:ia,onMicroJitterChange:jl})]})]})]}),o.jsx("footer",{className:"app-footer",children:o.jsx("p",{children:'Phase 5: Complex Morph FM Engine - "The Structuralist"'})})]}):o.jsxs("div",{className:"app loading",children:[o.jsx("h1",{children:"tQr4x"}),o.jsx("p",{children:"Initializing audio engine..."})]})}j0.createRoot(document.getElementById("root")).render(o.jsx(T.StrictMode,{children:o.jsx(s1,{})}));
